{
  "metadata": {
    "generated_at": "2026-02-18T01:53:45.853690+00:00",
    "workflow_count": 23,
    "table_count": 29,
    "function_count": 173,
    "tables_used_by_n8n": 7,
    "functions_used_by_n8n": 2
  },
  "workflows": [
    {
      "updatedAt": "2026-01-14T14:12:31.573Z",
      "createdAt": "2025-03-17T22:29:16.893Z",
      "id": "926UQuN4WyOXikAX",
      "name": "chatbot notion",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "public": true,
            "mode": "webhook",
            "options": {
              "allowedOrigins": "*",
              "responseMode": "lastNode"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.1,
          "position": [
            0,
            0
          ],
          "id": "58ac03ac-9b3c-4c06-99d8-7df59eb6d63c",
          "name": "When chat message received",
          "webhookId": "59b75607-ae13-4940-b426-449b37ec3180"
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "You are a helpful knowledge base assistant with access to a vector database containing the company’s documentation. When an employee asks a question, you should check if there is a documented standard process. You must check metadata and content. If it exists, provide the name and url of the page where this process is documented. If no standard process is found, inform the user that there is no documented procedure available for their query."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.8,
          "position": [
            272,
            32
          ],
          "id": "316d878d-4155-4203-830f-1c993336aa67",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            224,
            224
          ],
          "id": "cc16f9d2-e8e0-4fef-9ba4-0ae23287dce9",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "knowledge_database",
            "toolDescription": "Use this to get information about the company's knowledge",
            "tableName": {
              "__rl": true,
              "value": "rpc/match_documents_wiki",
              "mode": "list",
              "cachedResultName": "rpc/match_documents_wiki"
            },
            "options": {
              "queryName": "match_documents_wiki"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            512,
            224
          ],
          "id": "1e4be9f2-a60b-47e0-8926-68e424b13b21",
          "name": "Supabase Vector Store1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            560,
            400
          ],
          "id": "d008a2b1-2eea-4aee-84a1-1e6cf8576a13",
          "name": "Embeddings OpenAI1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
          "typeVersion": 1.3,
          "position": [
            368,
            240
          ],
          "id": "fb3f5d11-1842-496a-97db-103d27454aab",
          "name": "Postgres Chat Memory",
          "credentials": {
            "postgres": {
              "id": "hcJ8tf2FtmvMQGb7",
              "name": "Postgres account"
            }
          }
        },
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "wiki",
              "mode": "list",
              "cachedResultName": "wiki"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            2544,
            -736
          ],
          "id": "aa65a714-a787-4680-abb5-c800906b90b6",
          "name": "Supabase Vector Store",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            2528,
            -528
          ],
          "id": "7430271f-d9a0-4d1e-a0e3-a17ad88d1b1f",
          "name": "Embeddings OpenAI",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "jsonMode": "expressionData",
            "jsonData": "={{ $('Merge').item.json.name }} {{ $('Merge').item.json.property_tags }} {{ $('Concatena os blocos da página').item.json.concatenated_content }}",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "name",
                    "value": "={{ $('Merge').item.json.name }}"
                  },
                  {
                    "name": "url",
                    "value": "={{ $('Merge').item.json.url }}"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1,
          "position": [
            2640,
            -528
          ],
          "id": "fab580ff-88f9-434a-bb5f-e0f18012be3b",
          "name": "Default Data Loader"
        },
        {
          "parameters": {
            "chunkSize": 1000000000,
            "chunkOverlap": 1000,
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
          "typeVersion": 1,
          "position": [
            2752,
            -320
          ],
          "id": "6a1f62c2-e251-4976-a3cb-2ba3283697ec",
          "name": "Recursive Character Text Splitter"
        },
        {
          "parameters": {
            "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/wiki",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "supabaseApi",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "select",
                  "value": "updated_at"
                },
                {
                  "name": "order",
                  "value": "updated_at.desc"
                },
                {
                  "name": "limit",
                  "value": "1"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -64,
            -608
          ],
          "id": "5975e699-19be-40d5-abed-856c1f86ba25",
          "name": "Busca maior updated_at no supabase",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "method": "DELETE",
            "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/wiki",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "supabaseApi",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "metadata->>url",
                  "value": "=eq.{{ $json.url }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {}
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            992,
            -656
          ],
          "id": "5e5acd4e-c446-4c32-a486-1f2bdb124fe7",
          "name": "Deleta IDs das páginas lidas",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "block",
            "operation": "getAll",
            "blockId": {
              "__rl": true,
              "value": "={{ $('Merge').item.json.id }}",
              "mode": "id"
            },
            "returnAll": true,
            "fetchNestedBlocks": true
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1648,
            -816
          ],
          "id": "2bc66b24-dc71-4060-ae5c-683bc54dd8ec",
          "name": "Lê blocos da página",
          "alwaysOutputData": true,
          "credentials": {
            "notionApi": {
              "id": "zzCvXzZAIqjLKfOg",
              "name": "Notion account"
            }
          },
          "onError": "continueRegularOutput"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            1424,
            -816
          ],
          "id": "e1477e3c-1642-446b-abc4-9433361c3836",
          "name": "Limita para 1 item"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "7a5129b9-446c-4828-8752-b7a3403e90c3",
                  "leftValue": "={{ $input.all().length > 1 }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1872,
            -736
          ],
          "id": "d55f0d55-b4ac-4454-8421-0c2286a8c52d",
          "name": "Checa se o tamanho do input é maior que 0"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "1b7a9511-2e9c-4973-aac9-07a5fe4ae46d",
                  "leftValue": "={{ $json.isEmpty()}}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "false",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            2080,
            -736
          ],
          "id": "9b9edc76-e313-4ede-9909-e01bb7ffa7f2",
          "name": "Filtra para jsons não vazios",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "fieldsToSummarize": {
              "values": [
                {
                  "aggregation": "concatenate",
                  "field": "content",
                  "includeEmpty": true,
                  "separateBy": "\n"
                }
              ]
            },
            "options": {
              "outputFormat": "separateItems"
            }
          },
          "id": "b0fdfe6f-f8eb-4661-accc-b3c15264716a",
          "name": "Concatena os blocos da página",
          "type": "n8n-nodes-base.summarize",
          "position": [
            2304,
            -736
          ],
          "typeVersion": 1,
          "alwaysOutputData": true
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.limit",
          "typeVersion": 1,
          "position": [
            3024,
            -736
          ],
          "id": "ff5bfa96-9f63-44f8-8a26-1564196e9ef3",
          "name": "Limita para 1 item1"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            1248,
            -624
          ],
          "id": "72551b32-2225-48fb-af0d-b7dca919d635",
          "name": "Loop sobre páginas"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "e17070a1508d4359a28d7ffc29859a01",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Alterado em|last_edited_time",
                  "condition": "on_or_after",
                  "lastEditedTime": "={{ $json.updated_at }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            544,
            -656
          ],
          "id": "89d27a57-265e-4ae9-b46d-10dbc8a0448e",
          "name": "Busca páginas atualizadas após o maior updated_at1",
          "alwaysOutputData": false,
          "credentials": {
            "notionApi": {
              "id": "zzCvXzZAIqjLKfOg",
              "name": "Notion account"
            }
          }
        },
        {
          "parameters": {
            "amount": 2
          },
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            3248,
            -560
          ],
          "id": "7be3f829-8398-4434-8610-fddf5c2cf5d5",
          "name": "Wait",
          "webhookId": "3f0d6a89-40fc-4949-9848-bd1e600c2381"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "f13320eb-0bfc-49f5-afe9-078fea335eb8",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Alterado em|last_edited_time",
                  "condition": "on_or_after",
                  "lastEditedTime": "={{ $json.updated_at }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            544,
            -464
          ],
          "id": "36d38c3a-8ec5-4caa-b9d9-6e929bb7d749",
          "name": "Busca páginas atualizadas após o maior updated_at2",
          "alwaysOutputData": false,
          "credentials": {
            "notionApi": {
              "id": "zzCvXzZAIqjLKfOg",
              "name": "Notion account"
            }
          }
        },
        {
          "parameters": {
            "numberInputs": 3
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3,
          "position": [
            768,
            -656
          ],
          "id": "c152e960-a6fb-401e-bebc-63a38059a2f2",
          "name": "Merge"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 6
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -304,
            -608
          ],
          "id": "a6d5e639-fe3e-4d1c-941b-1da1f5ff766a",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "1bf02cfe-4c0e-81b9-9826-ef80bc8bc57e\t",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Alterado em|last_edited_time",
                  "condition": "on_or_after",
                  "lastEditedTime": "={{ $json.updated_at }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            544,
            -240
          ],
          "id": "c43132e6-d0b5-4feb-8cb9-f01e836f3e94",
          "name": "FinCorp",
          "alwaysOutputData": false,
          "credentials": {
            "notionApi": {
              "id": "zzCvXzZAIqjLKfOg",
              "name": "Notion account"
            }
          }
        }
      ],
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store1": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI1": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Postgres Chat Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store": {
          "main": [
            [
              {
                "node": "Limita para 1 item1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Recursive Character Text Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Busca maior updated_at no supabase": {
          "main": [
            [
              {
                "node": "Busca páginas atualizadas após o maior updated_at1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Busca páginas atualizadas após o maior updated_at2",
                "type": "main",
                "index": 0
              },
              {
                "node": "FinCorp",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Deleta IDs das páginas lidas": {
          "main": [
            [
              {
                "node": "Loop sobre páginas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Lê blocos da página": {
          "main": [
            [
              {
                "node": "Checa se o tamanho do input é maior que 0",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limita para 1 item": {
          "main": [
            [
              {
                "node": "Lê blocos da página",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Checa se o tamanho do input é maior que 0": {
          "main": [
            [
              {
                "node": "Filtra para jsons não vazios",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Loop sobre páginas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filtra para jsons não vazios": {
          "main": [
            [
              {
                "node": "Concatena os blocos da página",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Concatena os blocos da página": {
          "main": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Limita para 1 item1": {
          "main": [
            [
              {
                "node": "Wait",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop sobre páginas": {
          "main": [
            [],
            [
              {
                "node": "Limita para 1 item",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca páginas atualizadas após o maior updated_at1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait": {
          "main": [
            [
              {
                "node": "Loop sobre páginas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca páginas atualizadas após o maior updated_at2": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Deleta IDs das páginas lidas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Busca maior updated_at no supabase",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FinCorp": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "1fa3cae8-6a76-42d9-b7a6-9f5c09aa0c26",
      "activeVersionId": "51ea158c-b00b-427e-8d45-18628c1571e4",
      "versionCounter": 51,
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-03-17T22:29:16.893Z",
          "createdAt": "2025-03-17T22:29:16.893Z",
          "role": "workflow:owner",
          "workflowId": "926UQuN4WyOXikAX",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "51ea158c-b00b-427e-8d45-18628c1571e4",
        "workflowId": "926UQuN4WyOXikAX",
        "nodes": [
          {
            "parameters": {
              "public": true,
              "mode": "webhook",
              "options": {
                "allowedOrigins": "*",
                "responseMode": "lastNode"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.1,
            "position": [
              0,
              0
            ],
            "id": "58ac03ac-9b3c-4c06-99d8-7df59eb6d63c",
            "name": "When chat message received",
            "webhookId": "59b75607-ae13-4940-b426-449b37ec3180"
          },
          {
            "parameters": {
              "options": {
                "systemMessage": "You are a helpful knowledge base assistant with access to a vector database containing the company’s documentation. When an employee asks a question, you should check if there is a documented standard process. You must check metadata and content. If it exists, provide the name and url of the page where this process is documented. If no standard process is found, inform the user that there is no documented procedure available for their query."
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.8,
            "position": [
              260,
              20
            ],
            "id": "316d878d-4155-4203-830f-1c993336aa67",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "mode": "list",
                "value": "gpt-4o-mini"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              220,
              220
            ],
            "id": "cc16f9d2-e8e0-4fef-9ba4-0ae23287dce9",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "mode": "retrieve-as-tool",
              "toolName": "knowledge_database",
              "toolDescription": "Use this to get information about the company's knowledge",
              "tableName": {
                "__rl": true,
                "value": "rpc/match_documents_wiki",
                "mode": "list",
                "cachedResultName": "rpc/match_documents_wiki"
              },
              "options": {
                "queryName": "match_documents_wiki"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1,
            "position": [
              500,
              220
            ],
            "id": "1e4be9f2-a60b-47e0-8926-68e424b13b21",
            "name": "Supabase Vector Store1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase account 4"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              560,
              400
            ],
            "id": "d008a2b1-2eea-4aee-84a1-1e6cf8576a13",
            "name": "Embeddings OpenAI1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {},
            "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
            "typeVersion": 1.3,
            "position": [
              360,
              240
            ],
            "id": "fb3f5d11-1842-496a-97db-103d27454aab",
            "name": "Postgres Chat Memory",
            "credentials": {
              "postgres": {
                "id": "hcJ8tf2FtmvMQGb7",
                "name": "Postgres account"
              }
            }
          },
          {
            "parameters": {
              "mode": "insert",
              "tableName": {
                "__rl": true,
                "value": "wiki",
                "mode": "list",
                "cachedResultName": "wiki"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1,
            "position": [
              2540,
              -740
            ],
            "id": "aa65a714-a787-4680-abb5-c800906b90b6",
            "name": "Supabase Vector Store",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase account 4"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              2520,
              -520
            ],
            "id": "7430271f-d9a0-4d1e-a0e3-a17ad88d1b1f",
            "name": "Embeddings OpenAI",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "jsonMode": "expressionData",
              "jsonData": "={{ $('Merge').item.json.name }} {{ $('Merge').item.json.property_tags }} {{ $('Concatena os blocos da página').item.json.concatenated_content }}",
              "options": {
                "metadata": {
                  "metadataValues": [
                    {
                      "name": "name",
                      "value": "={{ $('Merge').item.json.name }}"
                    },
                    {
                      "name": "url",
                      "value": "={{ $('Merge').item.json.url }}"
                    }
                  ]
                }
              }
            },
            "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
            "typeVersion": 1,
            "position": [
              2640,
              -520
            ],
            "id": "fab580ff-88f9-434a-bb5f-e0f18012be3b",
            "name": "Default Data Loader"
          },
          {
            "parameters": {
              "chunkSize": 1000000000,
              "chunkOverlap": 1000,
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
            "typeVersion": 1,
            "position": [
              2740,
              -320
            ],
            "id": "6a1f62c2-e251-4976-a3cb-2ba3283697ec",
            "name": "Recursive Character Text Splitter"
          },
          {
            "parameters": {
              "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/wiki",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "supabaseApi",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {
                    "name": "select",
                    "value": "updated_at"
                  },
                  {
                    "name": "order",
                    "value": "updated_at.desc"
                  },
                  {
                    "name": "limit",
                    "value": "1"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              -60,
              -600
            ],
            "id": "5975e699-19be-40d5-abed-856c1f86ba25",
            "name": "Busca maior updated_at no supabase",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase account 4"
              }
            }
          },
          {
            "parameters": {
              "method": "DELETE",
              "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/wiki",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "supabaseApi",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {
                    "name": "metadata->>url",
                    "value": "=eq.{{ $json.url }}"
                  }
                ]
              },
              "sendHeaders": true,
              "headerParameters": {
                "parameters": [
                  {}
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              980,
              -660
            ],
            "id": "5e5acd4e-c446-4c32-a486-1f2bdb124fe7",
            "name": "Deleta IDs das páginas lidas",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase account 4"
              }
            }
          },
          {
            "parameters": {
              "resource": "block",
              "operation": "getAll",
              "blockId": {
                "__rl": true,
                "value": "={{ $('Merge').item.json.id }}",
                "mode": "id"
              },
              "returnAll": true,
              "fetchNestedBlocks": true
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1640,
              -820
            ],
            "id": "2bc66b24-dc71-4060-ae5c-683bc54dd8ec",
            "name": "Lê blocos da página",
            "alwaysOutputData": true,
            "credentials": {
              "notionApi": {
                "id": "zzCvXzZAIqjLKfOg",
                "name": "Notion account"
              }
            },
            "onError": "continueRegularOutput"
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.limit",
            "typeVersion": 1,
            "position": [
              1420,
              -820
            ],
            "id": "e1477e3c-1642-446b-abc4-9433361c3836",
            "name": "Limita para 1 item"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "7a5129b9-446c-4828-8752-b7a3403e90c3",
                    "leftValue": "={{ $input.all().length > 1 }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
              1860,
              -740
            ],
            "id": "d55f0d55-b4ac-4454-8421-0c2286a8c52d",
            "name": "Checa se o tamanho do input é maior que 0"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "1b7a9511-2e9c-4973-aac9-07a5fe4ae46d",
                    "leftValue": "={{ $json.isEmpty()}}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "false",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.filter",
            "typeVersion": 2.2,
            "position": [
              2080,
              -740
            ],
            "id": "9b9edc76-e313-4ede-9909-e01bb7ffa7f2",
            "name": "Filtra para jsons não vazios",
            "alwaysOutputData": true
          },
          {
            "parameters": {
              "fieldsToSummarize": {
                "values": [
                  {
                    "aggregation": "concatenate",
                    "field": "content",
                    "includeEmpty": true,
                    "separateBy": "\n"
                  }
                ]
              },
              "options": {
                "outputFormat": "separateItems"
              }
            },
            "id": "b0fdfe6f-f8eb-4661-accc-b3c15264716a",
            "name": "Concatena os blocos da página",
            "type": "n8n-nodes-base.summarize",
            "position": [
              2300,
              -740
            ],
            "typeVersion": 1,
            "alwaysOutputData": true
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.limit",
            "typeVersion": 1,
            "position": [
              3020,
              -740
            ],
            "id": "ff5bfa96-9f63-44f8-8a26-1564196e9ef3",
            "name": "Limita para 1 item1"
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              1240,
              -620
            ],
            "id": "72551b32-2225-48fb-af0d-b7dca919d635",
            "name": "Loop sobre páginas"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "e17070a1508d4359a28d7ffc29859a01",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Alterado em|last_edited_time",
                    "condition": "on_or_after",
                    "lastEditedTime": "={{ $json.updated_at }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              540,
              -660
            ],
            "id": "89d27a57-265e-4ae9-b46d-10dbc8a0448e",
            "name": "Busca páginas atualizadas após o maior updated_at1",
            "alwaysOutputData": false,
            "credentials": {
              "notionApi": {
                "id": "zzCvXzZAIqjLKfOg",
                "name": "Notion account"
              }
            }
          },
          {
            "parameters": {
              "amount": 2
            },
            "type": "n8n-nodes-base.wait",
            "typeVersion": 1.1,
            "position": [
              3240,
              -560
            ],
            "id": "7be3f829-8398-4434-8610-fddf5c2cf5d5",
            "name": "Wait",
            "webhookId": "3f0d6a89-40fc-4949-9848-bd1e600c2381"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "f13320eb-0bfc-49f5-afe9-078fea335eb8",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Alterado em|last_edited_time",
                    "condition": "on_or_after",
                    "lastEditedTime": "={{ $json.updated_at }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              540,
              -460
            ],
            "id": "36d38c3a-8ec5-4caa-b9d9-6e929bb7d749",
            "name": "Busca páginas atualizadas após o maior updated_at2",
            "alwaysOutputData": false,
            "credentials": {
              "notionApi": {
                "id": "zzCvXzZAIqjLKfOg",
                "name": "Notion account"
              }
            }
          },
          {
            "parameters": {
              "numberInputs": 3
            },
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3,
            "position": [
              760,
              -660
            ],
            "id": "c152e960-a6fb-401e-bebc-63a38059a2f2",
            "name": "Merge"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "triggerAtHour": 6
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
              -300,
              -600
            ],
            "id": "a6d5e639-fe3e-4d1c-941b-1da1f5ff766a",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "1bf02cfe-4c0e-81b9-9826-ef80bc8bc57e\t",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Alterado em|last_edited_time",
                    "condition": "on_or_after",
                    "lastEditedTime": "={{ $json.updated_at }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              540,
              -240
            ],
            "id": "c43132e6-d0b5-4feb-8cb9-f01e836f3e94",
            "name": "FinCorp",
            "alwaysOutputData": false,
            "credentials": {
              "notionApi": {
                "id": "zzCvXzZAIqjLKfOg",
                "name": "Notion account"
              }
            }
          }
        ],
        "connections": {
          "When chat message received": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Supabase Vector Store1": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI1": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase Vector Store1",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Postgres Chat Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Supabase Vector Store": {
            "main": [
              [
                {
                  "node": "Limita para 1 item1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Default Data Loader": {
            "ai_document": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "ai_document",
                  "index": 0
                }
              ]
            ]
          },
          "Recursive Character Text Splitter": {
            "ai_textSplitter": [
              [
                {
                  "node": "Default Data Loader",
                  "type": "ai_textSplitter",
                  "index": 0
                }
              ]
            ]
          },
          "Busca maior updated_at no supabase": {
            "main": [
              [
                {
                  "node": "Busca páginas atualizadas após o maior updated_at1",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Busca páginas atualizadas após o maior updated_at2",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "FinCorp",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Deleta IDs das páginas lidas": {
            "main": [
              [
                {
                  "node": "Loop sobre páginas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Lê blocos da página": {
            "main": [
              [
                {
                  "node": "Checa se o tamanho do input é maior que 0",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Limita para 1 item": {
            "main": [
              [
                {
                  "node": "Lê blocos da página",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Checa se o tamanho do input é maior que 0": {
            "main": [
              [
                {
                  "node": "Filtra para jsons não vazios",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Loop sobre páginas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Filtra para jsons não vazios": {
            "main": [
              [
                {
                  "node": "Concatena os blocos da página",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Concatena os blocos da página": {
            "main": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Limita para 1 item1": {
            "main": [
              [
                {
                  "node": "Wait",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop sobre páginas": {
            "main": [
              [],
              [
                {
                  "node": "Limita para 1 item",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca páginas atualizadas após o maior updated_at1": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Wait": {
            "main": [
              [
                {
                  "node": "Loop sobre páginas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca páginas atualizadas após o maior updated_at2": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "Deleta IDs das páginas lidas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "Busca maior updated_at no supabase",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "FinCorp": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 2
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-05-30T14:59:02.491Z",
            "id": 10,
            "workflowId": "926UQuN4WyOXikAX",
            "versionId": "51ea158c-b00b-427e-8d45-18628c1571e4",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-14T13:44:25.505Z",
      "createdAt": "2025-03-21T19:29:10.369Z",
      "id": "8K7gKN7osMdpMcFS",
      "name": "Datalake vecotring scheadule",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            -1424,
            320
          ],
          "id": "70b593c2-a629-4413-a85e-71762738140f",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "tableName": "n8n_chat_history_datalake"
          },
          "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
          "typeVersion": 1.3,
          "position": [
            -1264,
            320
          ],
          "id": "73826747-82e7-4cf7-9eac-fcfe1593b0af",
          "name": "Postgres Chat Memory",
          "credentials": {
            "postgres": {
              "id": "hcJ8tf2FtmvMQGb7",
              "name": "Postgres account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            -656,
            432
          ],
          "id": "b849e113-116f-4d65-a4dc-5e0d367322fb",
          "name": "Embeddings OpenAI1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "company_datalake",
            "toolDescription": "Work with a google bigquery datalake tables metadata in supabase",
            "tableName": {
              "__rl": true,
              "value": "rpc/match_documents_datalake",
              "mode": "list",
              "cachedResultName": "rpc/match_documents_datalake"
            },
            "options": {
              "queryName": "match_documents_datalake"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            -816,
            272
          ],
          "id": "eb53004d-9d24-49a1-a419-2c8b891b07a8",
          "name": "Supabase1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "You are a helpful AI assistant that answers in brazilian portuguese with full access to the company’s public datalake metadata (catalog schemas, table names, column names, data types, descriptions). Your sole source of truth is the datalake metadata — do not invent table or column names.\n\nWhen the user asks for data:\n\n1 **Discover**: Query the Supabase metadata API to find the exact table name(s), schema, and column names that match the user’s request.  \n2 **Confirm**: Present the user with the identified table(s) and columns, including a brief description of each, asking for confirmation of intent before querying.  \n3 **Build SQL**: After user confirmation, generate a fully‑qualified BigQuery SQL statement (including project.dataset.table) using only the real metadata.  \n4 **Execute**: Use the BigQuery API tool to run the SQL.  \n5 **Save**: Send the raw JSON response from BigQuery to the save_xlsx workflow tool to store results on GCS.  \n6 **Deliver**: Fetch the resulting XLSX file from GCS and return it for user download.\n\n **Strict rules**:\n• Never return placeholder names like “sua_tabela_de_cdi.”  \n• Always derive and display actual table/column names from metadata first.  \n• Do not proceed to execution until the user confirms the identified table and query logic.  \n• Only use information present in the datalake metadata; do not hallucinate any schema details.\n• The VALOR on cdi comes as absolute value, so you don't need to convert from percentage. Use the folowing expresion: EXP(SUM(LN(1 + VALOR))) - 1\n\nFormat responses as a 2‑step process:\n1. Metadata discovery summary (table, columns, descriptions).  \n2. SQL query draft (awaiting user confirmation).  \n",
              "returnIntermediateSteps": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.8,
          "position": [
            -1168,
            80
          ],
          "id": "d41af0ab-2892-4e35-9351-beff4a5d1f97",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "public": true,
            "initialMessages": "Como posso te ajudar hoje?",
            "options": {
              "allowedOrigins": "*",
              "responseMode": "lastNode"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.1,
          "position": [
            -1488,
            80
          ],
          "id": "4b2d0056-c994-42c0-9327-45fb431a8272",
          "name": "When chat message received",
          "webhookId": "758bae84-8479-414c-bf5d-c539e0d16573"
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "data-lake-interno",
              "mode": "list",
              "cachedResultName": "Data Lake Interno",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
            },
            "sqlQuery": "{{ $fromAI(\"sql_query\", \"SQL Query\") }}",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQueryTool",
          "typeVersion": 2.1,
          "position": [
            -896,
            384
          ],
          "id": "5386a75a-1172-4c8b-86e5-064b2e150c47",
          "name": "Google BigQuery1",
          "credentials": {
            "googleBigQueryOAuth2Api": {
              "id": "XUgNL8mJfmuwKJRU",
              "name": "Google BigQuery account"
            }
          }
        },
        {
          "parameters": {
            "name": "save_xlsx",
            "description": "Call this tool to save bigquery json response as a xlsx file and return it to the chat user.",
            "workflowId": {
              "__rl": true,
              "value": "k8tv47GLScBdQI1h",
              "mode": "list",
              "cachedResultName": "Save xlsx"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {},
              "matchingColumns": [],
              "schema": [],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "typeVersion": 2.1,
          "position": [
            -1104,
            480
          ],
          "id": "71c9a788-abcd-43bc-9a01-af5b54061334",
          "name": "Call n8n Workflow Tool"
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "data-lake-interno",
              "mode": "list",
              "cachedResultName": "Data Lake Interno",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
            },
            "sqlQuery": "\nSELECT\n  table_catalog,\n  table_schema,\n  table_name,\n  ddl\nFROM\n  `data-lake-interno`.`{{ $json.schema_name }}`.INFORMATION_SCHEMA.TABLES",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQuery",
          "typeVersion": 2.1,
          "position": [
            368,
            32
          ],
          "id": "e383ae54-abe7-48e9-9028-b517f53e2c0a",
          "name": "Google BigQuery",
          "credentials": {
            "googleBigQueryOAuth2Api": {
              "id": "XUgNL8mJfmuwKJRU",
              "name": "Google BigQuery account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            1120,
            208
          ],
          "id": "9d8ae4bd-0fc8-42ee-9c47-35c382d2272d",
          "name": "Embeddings OpenAI",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "jsonMode": "expressionData",
            "jsonData": "={{ $('Google BigQuery').item.json.ddl }}",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "table_catalog",
                    "value": "={{ $('Google BigQuery').item.json.table_catalog }}"
                  },
                  {
                    "name": "table_schema",
                    "value": "={{ $('Google BigQuery').item.json.table_schema }}"
                  },
                  {
                    "name": "table_name",
                    "value": "={{ $('Google BigQuery').item.json.table_name }}"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1,
          "position": [
            1248,
            208
          ],
          "id": "68dfce86-c2b9-4bd1-8bb1-7d27ca99ca1d",
          "name": "Default Data Loader"
        },
        {
          "parameters": {
            "chunkSize": 10000000000000
          },
          "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
          "typeVersion": 1,
          "position": [
            1328,
            384
          ],
          "id": "5c2454bb-c684-4b68-887d-1df916bb23c1",
          "name": "Token Splitter"
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "metadata_datalake",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "gt",
                  "keyValue": "0"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            160,
            -176
          ],
          "id": "71468af7-4cbf-4d45-9de5-346a5d59ff2c",
          "name": "Supabase",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "metadata_datalake",
              "mode": "list",
              "cachedResultName": "metadata_datalake"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            1152,
            32
          ],
          "id": "b9ad1e4e-7871-4a5c-ba74-f5beca142664",
          "name": "Supabase Vector Store",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {}
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -448,
            0
          ],
          "id": "3590f3d0-ab26-40b1-b4db-f18515483bc5",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "data-lake-interno",
              "mode": "list",
              "cachedResultName": "Data Lake Interno",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
            },
            "sqlQuery": "SELECT schema_name\nFROM data-lake-interno.INFORMATION_SCHEMA.SCHEMATA\nWHERE schema_name NOT IN ('intermediate', 'midias', 'silver', 'staging', 'teste_dagster');",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQuery",
          "typeVersion": 2.1,
          "position": [
            -224,
            0
          ],
          "id": "791e76ed-4a05-42ef-8638-2eb79f3b83ea",
          "name": "Busca schemas",
          "credentials": {
            "googleBigQueryOAuth2Api": {
              "id": "XUgNL8mJfmuwKJRU",
              "name": "Google BigQuery account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            160,
            0
          ],
          "id": "e5c67bd9-1c51-4cfb-bfed-6aab5e846d2d",
          "name": "Loop Sobre Schemas"
        },
        {
          "parameters": {
            "options": {
              "reset": "={{ $node['Loop Sobre Tabelas'].context[\"done\"] }}"
            }
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            800,
            32
          ],
          "id": "9563e34e-50cc-4462-ae77-a66a9a8e3a4c",
          "name": "Loop Sobre Tabelas"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            1184,
            720
          ],
          "id": "b6e80469-c0cf-468a-879c-664cf60b5108",
          "name": "Embeddings OpenAI2",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "jsonMode": "expressionData",
            "jsonData": "={{ $('Execute a SQL query').item.json.ddl }}",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "table_catalog",
                    "value": "={{ $('Execute a SQL query').item.json.table_catalog }}"
                  },
                  {
                    "name": "table_schema",
                    "value": "={{ $('Execute a SQL query').item.json.table_schema }}"
                  },
                  {
                    "name": "table_name",
                    "value": "={{ $('Execute a SQL query').item.json.table_name }}"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1,
          "position": [
            1312,
            720
          ],
          "id": "dbd0a9d9-05ba-409a-81a9-56f4561ac5ef",
          "name": "Default Data Loader1"
        },
        {
          "parameters": {
            "chunkSize": 10000000000000
          },
          "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
          "typeVersion": 1,
          "position": [
            1392,
            912
          ],
          "id": "69ea756a-02f9-4126-b93f-86c428c459d7",
          "name": "Token Splitter1"
        },
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "metadata_datalake",
              "mode": "list",
              "cachedResultName": "metadata_datalake"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            1200,
            544
          ],
          "id": "49ba24e2-93b7-4dda-b60a-923f544bb851",
          "name": "Supabase Vector Store1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            224,
            528
          ],
          "id": "f9426d4b-0cd2-470c-809a-8d5354d917d3",
          "name": "Loop Sobre Schemas1"
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "data-lake-interno",
              "mode": "list",
              "cachedResultName": "Data Lake Interno",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
            },
            "sqlQuery": "\nSELECT\n  table_catalog,\n  table_schema,\n  table_name,\n  view_definition as ddl\nFROM\n  `data-lake-interno`.`{{ $json.schema_name }}`.INFORMATION_SCHEMA.VIEWS",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQuery",
          "typeVersion": 2.1,
          "position": [
            432,
            544
          ],
          "id": "a4c8720f-82e2-4b0f-93c2-a7824c0a46d7",
          "name": "Execute a SQL query",
          "credentials": {
            "googleBigQueryOAuth2Api": {
              "id": "XUgNL8mJfmuwKJRU",
              "name": "Google BigQuery account"
            }
          }
        },
        {
          "parameters": {
            "options": {
              "reset": "={{ $node['Loop Sobre Views'].context[\"done\"] }}"
            }
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            864,
            544
          ],
          "id": "18e75fa5-4a45-4c72-b73e-cf795834fdcc",
          "name": "Loop Sobre Views"
        }
      ],
      "connections": {
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Postgres Chat Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI1": {
          "ai_embedding": [
            [
              {
                "node": "Supabase1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Supabase1": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google BigQuery1": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            []
          ]
        },
        "Call n8n Workflow Tool": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google BigQuery": {
          "main": [
            [
              {
                "node": "Loop Sobre Tabelas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Token Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store": {
          "main": [
            [
              {
                "node": "Loop Sobre Tabelas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Busca schemas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca schemas": {
          "main": [
            [
              {
                "node": "Loop Sobre Schemas",
                "type": "main",
                "index": 0
              },
              {
                "node": "Supabase",
                "type": "main",
                "index": 0
              },
              {
                "node": "Loop Sobre Schemas1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Sobre Schemas": {
          "main": [
            [],
            [
              {
                "node": "Google BigQuery",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Sobre Tabelas": {
          "main": [
            [
              {
                "node": "Loop Sobre Schemas",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Supabase Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI2": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader1": {
          "ai_document": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Token Splitter1": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader1",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store1": {
          "main": [
            [
              {
                "node": "Loop Sobre Views",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Sobre Schemas1": {
          "main": [
            [],
            [
              {
                "node": "Execute a SQL query",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execute a SQL query": {
          "main": [
            [
              {
                "node": "Loop Sobre Views",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Sobre Views": {
          "main": [
            [
              {
                "node": "Loop Sobre Schemas1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Supabase Vector Store1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "befcd110-0954-43cf-b0c9-8c869d8f8a56",
      "activeVersionId": "9d02184b-80e1-4d67-91f3-5c2d13242da9",
      "versionCounter": 51,
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-03-21T19:29:10.369Z",
          "createdAt": "2025-03-21T19:29:10.369Z",
          "role": "workflow:owner",
          "workflowId": "8K7gKN7osMdpMcFS",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "9d02184b-80e1-4d67-91f3-5c2d13242da9",
        "workflowId": "8K7gKN7osMdpMcFS",
        "nodes": [
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-4.1",
                "mode": "list",
                "cachedResultName": "gpt-4.1"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              -1420,
              320
            ],
            "id": "70b593c2-a629-4413-a85e-71762738140f",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "tableName": "n8n_chat_history_datalake"
            },
            "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
            "typeVersion": 1.3,
            "position": [
              -1260,
              320
            ],
            "id": "73826747-82e7-4cf7-9eac-fcfe1593b0af",
            "name": "Postgres Chat Memory",
            "credentials": {
              "postgres": {
                "id": "hcJ8tf2FtmvMQGb7",
                "name": "Postgres account"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              -660,
              420
            ],
            "id": "b849e113-116f-4d65-a4dc-5e0d367322fb",
            "name": "Embeddings OpenAI1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "mode": "retrieve-as-tool",
              "toolName": "company_datalake",
              "toolDescription": "Work with a google bigquery datalake tables metadata in supabase",
              "tableName": {
                "__rl": true,
                "value": "rpc/match_documents_datalake",
                "mode": "list",
                "cachedResultName": "rpc/match_documents_datalake"
              },
              "options": {
                "queryName": "match_documents_datalake"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1,
            "position": [
              -820,
              260
            ],
            "id": "eb53004d-9d24-49a1-a419-2c8b891b07a8",
            "name": "Supabase1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "options": {
                "systemMessage": "You are a helpful AI assistant that answers in brazilian portuguese with full access to the company’s public datalake metadata (catalog schemas, table names, column names, data types, descriptions). Your sole source of truth is the datalake metadata — do not invent table or column names.\n\nWhen the user asks for data:\n\n1 **Discover**: Query the Supabase metadata API to find the exact table name(s), schema, and column names that match the user’s request.  \n2 **Confirm**: Present the user with the identified table(s) and columns, including a brief description of each, asking for confirmation of intent before querying.  \n3 **Build SQL**: After user confirmation, generate a fully‑qualified BigQuery SQL statement (including project.dataset.table) using only the real metadata.  \n4 **Execute**: Use the BigQuery API tool to run the SQL.  \n5 **Save**: Send the raw JSON response from BigQuery to the save_xlsx workflow tool to store results on GCS.  \n6 **Deliver**: Fetch the resulting XLSX file from GCS and return it for user download.\n\n **Strict rules**:\n• Never return placeholder names like “sua_tabela_de_cdi.”  \n• Always derive and display actual table/column names from metadata first.  \n• Do not proceed to execution until the user confirms the identified table and query logic.  \n• Only use information present in the datalake metadata; do not hallucinate any schema details.\n• The VALOR on cdi comes as absolute value, so you don't need to convert from percentage. Use the folowing expresion: EXP(SUM(LN(1 + VALOR))) - 1\n\nFormat responses as a 2‑step process:\n1. Metadata discovery summary (table, columns, descriptions).  \n2. SQL query draft (awaiting user confirmation).  \n",
                "returnIntermediateSteps": true
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.8,
            "position": [
              -1160,
              80
            ],
            "id": "d41af0ab-2892-4e35-9351-beff4a5d1f97",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "public": true,
              "initialMessages": "Como posso te ajudar hoje?",
              "options": {
                "allowedOrigins": "*",
                "responseMode": "lastNode"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.1,
            "position": [
              -1480,
              80
            ],
            "id": "4b2d0056-c994-42c0-9327-45fb431a8272",
            "name": "When chat message received",
            "webhookId": "758bae84-8479-414c-bf5d-c539e0d16573"
          },
          {
            "parameters": {
              "projectId": {
                "__rl": true,
                "value": "data-lake-interno",
                "mode": "list",
                "cachedResultName": "Data Lake Interno",
                "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
              },
              "sqlQuery": "{{ $fromAI(\"sql_query\", \"SQL Query\") }}",
              "options": {}
            },
            "type": "n8n-nodes-base.googleBigQueryTool",
            "typeVersion": 2.1,
            "position": [
              -900,
              380
            ],
            "id": "5386a75a-1172-4c8b-86e5-064b2e150c47",
            "name": "Google BigQuery1",
            "credentials": {
              "googleBigQueryOAuth2Api": {
                "id": "XUgNL8mJfmuwKJRU",
                "name": "Google BigQuery account"
              }
            }
          },
          {
            "parameters": {
              "name": "save_xlsx",
              "description": "Call this tool to save bigquery json response as a xlsx file and return it to the chat user.",
              "workflowId": {
                "__rl": true,
                "value": "k8tv47GLScBdQI1h",
                "mode": "list",
                "cachedResultName": "Save xlsx"
              },
              "workflowInputs": {
                "mappingMode": "defineBelow",
                "value": {},
                "matchingColumns": [],
                "schema": [],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
            "typeVersion": 2.1,
            "position": [
              -1100,
              480
            ],
            "id": "71c9a788-abcd-43bc-9a01-af5b54061334",
            "name": "Call n8n Workflow Tool"
          },
          {
            "parameters": {
              "projectId": {
                "__rl": true,
                "value": "data-lake-interno",
                "mode": "list",
                "cachedResultName": "Data Lake Interno",
                "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
              },
              "sqlQuery": "\nSELECT\n  table_catalog,\n  table_schema,\n  table_name,\n  ddl\nFROM\n  `data-lake-interno`.`{{ $json.schema_name }}`.INFORMATION_SCHEMA.TABLES",
              "options": {}
            },
            "type": "n8n-nodes-base.googleBigQuery",
            "typeVersion": 2.1,
            "position": [
              360,
              20
            ],
            "id": "e383ae54-abe7-48e9-9028-b517f53e2c0a",
            "name": "Google BigQuery",
            "credentials": {
              "googleBigQueryOAuth2Api": {
                "id": "XUgNL8mJfmuwKJRU",
                "name": "Google BigQuery account"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              1120,
              200
            ],
            "id": "9d8ae4bd-0fc8-42ee-9c47-35c382d2272d",
            "name": "Embeddings OpenAI",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "jsonMode": "expressionData",
              "jsonData": "={{ $('Google BigQuery').item.json.ddl }}",
              "options": {
                "metadata": {
                  "metadataValues": [
                    {
                      "name": "table_catalog",
                      "value": "={{ $('Google BigQuery').item.json.table_catalog }}"
                    },
                    {
                      "name": "table_schema",
                      "value": "={{ $('Google BigQuery').item.json.table_schema }}"
                    },
                    {
                      "name": "table_name",
                      "value": "={{ $('Google BigQuery').item.json.table_name }}"
                    }
                  ]
                }
              }
            },
            "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
            "typeVersion": 1,
            "position": [
              1240,
              200
            ],
            "id": "68dfce86-c2b9-4bd1-8bb1-7d27ca99ca1d",
            "name": "Default Data Loader"
          },
          {
            "parameters": {
              "chunkSize": 10000000000000
            },
            "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
            "typeVersion": 1,
            "position": [
              1320,
              380
            ],
            "id": "5c2454bb-c684-4b68-887d-1df916bb23c1",
            "name": "Token Splitter"
          },
          {
            "parameters": {
              "operation": "delete",
              "tableId": "metadata_datalake",
              "filters": {
                "conditions": [
                  {
                    "keyName": "id",
                    "condition": "gt",
                    "keyValue": "0"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              160,
              -180
            ],
            "id": "71468af7-4cbf-4d45-9de5-346a5d59ff2c",
            "name": "Supabase",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "mode": "insert",
              "tableName": {
                "__rl": true,
                "value": "metadata_datalake",
                "mode": "list",
                "cachedResultName": "metadata_datalake"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1,
            "position": [
              1140,
              20
            ],
            "id": "b9ad1e4e-7871-4a5c-ba74-f5beca142664",
            "name": "Supabase Vector Store",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {}
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
              -440,
              0
            ],
            "id": "3590f3d0-ab26-40b1-b4db-f18515483bc5",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "projectId": {
                "__rl": true,
                "value": "data-lake-interno",
                "mode": "list",
                "cachedResultName": "Data Lake Interno",
                "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
              },
              "sqlQuery": "SELECT schema_name\nFROM data-lake-interno.INFORMATION_SCHEMA.SCHEMATA\nWHERE schema_name NOT IN ('intermediate', 'midias', 'silver', 'staging', 'teste_dagster');",
              "options": {}
            },
            "type": "n8n-nodes-base.googleBigQuery",
            "typeVersion": 2.1,
            "position": [
              -220,
              0
            ],
            "id": "791e76ed-4a05-42ef-8638-2eb79f3b83ea",
            "name": "Busca schemas",
            "credentials": {
              "googleBigQueryOAuth2Api": {
                "id": "XUgNL8mJfmuwKJRU",
                "name": "Google BigQuery account"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              160,
              0
            ],
            "id": "e5c67bd9-1c51-4cfb-bfed-6aab5e846d2d",
            "name": "Loop Sobre Schemas"
          },
          {
            "parameters": {
              "options": {
                "reset": "={{ $node['Loop Sobre Tabelas'].context[\"done\"] }}"
              }
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              800,
              20
            ],
            "id": "9563e34e-50cc-4462-ae77-a66a9a8e3a4c",
            "name": "Loop Sobre Tabelas"
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              1180,
              720
            ],
            "id": "b6e80469-c0cf-468a-879c-664cf60b5108",
            "name": "Embeddings OpenAI2",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "jsonMode": "expressionData",
              "jsonData": "={{ $('Execute a SQL query').item.json.ddl }}",
              "options": {
                "metadata": {
                  "metadataValues": [
                    {
                      "name": "table_catalog",
                      "value": "={{ $('Execute a SQL query').item.json.table_catalog }}"
                    },
                    {
                      "name": "table_schema",
                      "value": "={{ $('Execute a SQL query').item.json.table_schema }}"
                    },
                    {
                      "name": "table_name",
                      "value": "={{ $('Execute a SQL query').item.json.table_name }}"
                    }
                  ]
                }
              }
            },
            "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
            "typeVersion": 1,
            "position": [
              1300,
              720
            ],
            "id": "dbd0a9d9-05ba-409a-81a9-56f4561ac5ef",
            "name": "Default Data Loader1"
          },
          {
            "parameters": {
              "chunkSize": 10000000000000
            },
            "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
            "typeVersion": 1,
            "position": [
              1380,
              900
            ],
            "id": "69ea756a-02f9-4126-b93f-86c428c459d7",
            "name": "Token Splitter1"
          },
          {
            "parameters": {
              "mode": "insert",
              "tableName": {
                "__rl": true,
                "value": "metadata_datalake",
                "mode": "list",
                "cachedResultName": "metadata_datalake"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1,
            "position": [
              1200,
              540
            ],
            "id": "49ba24e2-93b7-4dda-b60a-923f544bb851",
            "name": "Supabase Vector Store1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              220,
              520
            ],
            "id": "f9426d4b-0cd2-470c-809a-8d5354d917d3",
            "name": "Loop Sobre Schemas1"
          },
          {
            "parameters": {
              "projectId": {
                "__rl": true,
                "value": "data-lake-interno",
                "mode": "list",
                "cachedResultName": "Data Lake Interno",
                "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
              },
              "sqlQuery": "\nSELECT\n  table_catalog,\n  table_schema,\n  table_name,\n  view_definition as ddl\nFROM\n  `data-lake-interno`.`{{ $json.schema_name }}`.INFORMATION_SCHEMA.VIEWS",
              "options": {}
            },
            "type": "n8n-nodes-base.googleBigQuery",
            "typeVersion": 2.1,
            "position": [
              420,
              540
            ],
            "id": "a4c8720f-82e2-4b0f-93c2-a7824c0a46d7",
            "name": "Execute a SQL query",
            "credentials": {
              "googleBigQueryOAuth2Api": {
                "id": "XUgNL8mJfmuwKJRU",
                "name": "Google BigQuery account"
              }
            }
          },
          {
            "parameters": {
              "options": {
                "reset": "={{ $node['Loop Sobre Views'].context[\"done\"] }}"
              }
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              860,
              540
            ],
            "id": "18e75fa5-4a45-4c72-b73e-cf795834fdcc",
            "name": "Loop Sobre Views"
          }
        ],
        "connections": {
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Postgres Chat Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI1": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase1",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Supabase1": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "When chat message received": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Google BigQuery1": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent": {
            "main": [
              []
            ]
          },
          "Call n8n Workflow Tool": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Google BigQuery": {
            "main": [
              [
                {
                  "node": "Loop Sobre Tabelas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Default Data Loader": {
            "ai_document": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "ai_document",
                  "index": 0
                }
              ]
            ]
          },
          "Token Splitter": {
            "ai_textSplitter": [
              [
                {
                  "node": "Default Data Loader",
                  "type": "ai_textSplitter",
                  "index": 0
                }
              ]
            ]
          },
          "Supabase Vector Store": {
            "main": [
              [
                {
                  "node": "Loop Sobre Tabelas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "Busca schemas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca schemas": {
            "main": [
              [
                {
                  "node": "Loop Sobre Schemas",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Supabase",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Loop Sobre Schemas1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Sobre Schemas": {
            "main": [
              [],
              [
                {
                  "node": "Google BigQuery",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Sobre Tabelas": {
            "main": [
              [
                {
                  "node": "Loop Sobre Schemas",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI2": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase Vector Store1",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Default Data Loader1": {
            "ai_document": [
              [
                {
                  "node": "Supabase Vector Store1",
                  "type": "ai_document",
                  "index": 0
                }
              ]
            ]
          },
          "Token Splitter1": {
            "ai_textSplitter": [
              [
                {
                  "node": "Default Data Loader1",
                  "type": "ai_textSplitter",
                  "index": 0
                }
              ]
            ]
          },
          "Supabase Vector Store1": {
            "main": [
              [
                {
                  "node": "Loop Sobre Views",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Sobre Schemas1": {
            "main": [
              [],
              [
                {
                  "node": "Execute a SQL query",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Execute a SQL query": {
            "main": [
              [
                {
                  "node": "Loop Sobre Views",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Sobre Views": {
            "main": [
              [
                {
                  "node": "Loop Sobre Schemas1",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Supabase Vector Store1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-07-31T11:36:14.906Z",
            "id": 7,
            "workflowId": "8K7gKN7osMdpMcFS",
            "versionId": "9d02184b-80e1-4d67-91f3-5c2d13242da9",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-14T14:07:49.116Z",
      "createdAt": "2025-03-22T17:28:33.947Z",
      "id": "k8tv47GLScBdQI1h",
      "name": "Save xlsx",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "inputSource": "passthrough"
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            112,
            64
          ],
          "id": "4d89614e-1a74-4e5f-a600-43bc0739b5cd",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "operation": "xlsx",
            "options": {}
          },
          "type": "n8n-nodes-base.convertToFile",
          "typeVersion": 1.1,
          "position": [
            560,
            64
          ],
          "id": "9475511d-edaa-46fc-97b6-9757fa47e803",
          "name": "Convert to File"
        },
        {
          "parameters": {
            "resource": "object",
            "operation": "create",
            "bucketName": "chatbot-pier",
            "objectName": "={{ $execution.id + $now }}",
            "createData": {
              "acl": "[{\"bucket\":\"chatbot-pier\",\n  \"entity\": \"allUsers\", \n  \"role\":\"OWNER\"\n}]"
            },
            "createQuery": {},
            "encryptionHeaders": {},
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.googleCloudStorage",
          "typeVersion": 1,
          "position": [
            784,
            80
          ],
          "id": "adf1c49e-ef10-4dc7-b74e-7d1f0d7b45ef",
          "name": "Google Cloud Storage",
          "alwaysOutputData": false,
          "credentials": {
            "googleCloudStorageOAuth2Api": {
              "id": "3Vlr2nFmWtIOYVmK",
              "name": "Google Cloud Storage account"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Assuming input is from a node like HTTP Request or BigQuery, and has a field named `query`\nconst rawQuery = items[0].json.query;\n\n// Parse the raw query string (which is itself a JSON string)\nconst parsedData = JSON.parse(rawQuery);\n\n// Return the parsed array as output items\nreturn parsedData.map(row => ({ json: row }));"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            320,
            64
          ],
          "id": "6eb3092b-4c23-457d-891c-66c4e5aaa72a",
          "name": "Code"
        }
      ],
      "connections": {
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Convert to File": {
          "main": [
            [
              {
                "node": "Google Cloud Storage",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Google Cloud Storage": {
          "main": [
            []
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Convert to File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "bd27b239-4622-4717-a75a-8337eaffce6b",
      "activeVersionId": "4a85bbe9-6378-47b2-860e-101971853036",
      "versionCounter": 51,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2025-03-22T17:28:33.947Z",
          "createdAt": "2025-03-22T17:28:33.947Z",
          "role": "workflow:owner",
          "workflowId": "k8tv47GLScBdQI1h",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-03-25T17:28:44.590Z",
          "createdAt": "2025-03-25T17:28:44.590Z",
          "id": "SGLcCfFPtH9ESbyP",
          "name": "Marujo"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "4a85bbe9-6378-47b2-860e-101971853036",
        "workflowId": "k8tv47GLScBdQI1h",
        "nodes": [
          {
            "parameters": {
              "inputSource": "passthrough"
            },
            "type": "n8n-nodes-base.executeWorkflowTrigger",
            "typeVersion": 1.1,
            "position": [
              100,
              60
            ],
            "id": "4d89614e-1a74-4e5f-a600-43bc0739b5cd",
            "name": "When Executed by Another Workflow"
          },
          {
            "parameters": {
              "operation": "xlsx",
              "options": {}
            },
            "type": "n8n-nodes-base.convertToFile",
            "typeVersion": 1.1,
            "position": [
              560,
              60
            ],
            "id": "9475511d-edaa-46fc-97b6-9757fa47e803",
            "name": "Convert to File"
          },
          {
            "parameters": {
              "resource": "object",
              "operation": "create",
              "bucketName": "chatbot-pier",
              "objectName": "={{ $execution.id + $now }}",
              "createData": {
                "acl": "[{\"bucket\":\"chatbot-pier\",\n  \"entity\": \"allUsers\", \n  \"role\":\"OWNER\"\n}]"
              },
              "createQuery": {},
              "encryptionHeaders": {},
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.googleCloudStorage",
            "typeVersion": 1,
            "position": [
              780,
              80
            ],
            "id": "adf1c49e-ef10-4dc7-b74e-7d1f0d7b45ef",
            "name": "Google Cloud Storage",
            "alwaysOutputData": false,
            "credentials": {
              "googleCloudStorageOAuth2Api": {
                "id": "3Vlr2nFmWtIOYVmK",
                "name": "Google Cloud Storage account"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "// Assuming input is from a node like HTTP Request or BigQuery, and has a field named `query`\nconst rawQuery = items[0].json.query;\n\n// Parse the raw query string (which is itself a JSON string)\nconst parsedData = JSON.parse(rawQuery);\n\n// Return the parsed array as output items\nreturn parsedData.map(row => ({ json: row }));"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              320,
              60
            ],
            "id": "6eb3092b-4c23-457d-891c-66c4e5aaa72a",
            "name": "Code"
          }
        ],
        "connections": {
          "When Executed by Another Workflow": {
            "main": [
              [
                {
                  "node": "Code",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Convert to File": {
            "main": [
              [
                {
                  "node": "Google Cloud Storage",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Google Cloud Storage": {
            "main": [
              []
            ]
          },
          "Code": {
            "main": [
              [
                {
                  "node": "Convert to File",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-03-28T20:16:07.991Z",
            "id": 26,
            "workflowId": "k8tv47GLScBdQI1h",
            "versionId": "4a85bbe9-6378-47b2-860e-101971853036",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-14T14:11:27.102Z",
      "createdAt": "2025-03-28T14:48:54.388Z",
      "id": "GIJFHR0mnSYYxPh2",
      "name": "Slides Retriever",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            80,
            144
          ],
          "id": "d5e6ce56-3ed7-4859-99ba-9b577d37ccb8",
          "name": "Embeddings OpenAI",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "mode": "load",
            "tableName": {
              "__rl": true,
              "value": "rpc/match_slides",
              "mode": "list",
              "cachedResultName": "rpc/match_slides"
            },
            "prompt": "={{ $json.message.content }}",
            "topK": 5,
            "options": {
              "queryName": "match_slides"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.1,
          "position": [
            48,
            -80
          ],
          "id": "65dfb83e-0402-46cb-bbe1-01d796ecff38",
          "name": "Supabase Vector Store",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "92f32531-bd06-4629-9be4-4b64a12a06d9",
            "responseMode": "lastNode",
            "responseData": "allEntries",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -656,
            48
          ],
          "id": "8faa67c8-2fed-4f38-ba3a-d3fdc41156ce",
          "name": "Webhook",
          "webhookId": "92f32531-bd06-4629-9be4-4b64a12a06d9"
        },
        {
          "parameters": {
            "modelId": {
              "__rl": true,
              "value": "gpt-4o-mini",
              "mode": "list",
              "cachedResultName": "GPT-4O-MINI"
            },
            "messages": {
              "values": [
                {
                  "content": "Extraia palavras chave desse prompt.\nUtilize apenas palavras mencionadas pelo usuário.",
                  "role": "system"
                },
                {
                  "content": "={{ $json.body.query }}"
                }
              ]
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            -368,
            -80
          ],
          "id": "14a6910b-30f7-4988-8e0f-1c2318cbde5d",
          "name": "OpenAI",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -688,
            -208
          ],
          "id": "93bc2f26-4c3e-496f-a908-88dba5c7516c",
          "name": "When clicking ‘Test workflow’"
        }
      ],
      "connections": {
        "Embeddings OpenAI": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store": {
          "ai_tool": [
            []
          ],
          "main": [
            []
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "OpenAI",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI": {
          "main": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When clicking ‘Test workflow’": {
          "main": [
            [
              {
                "node": "OpenAI",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "When clicking ‘Test workflow’": [
          {
            "json": {
              "body": {
                "query": "DuckDB"
              }
            }
          }
        ]
      },
      "versionId": "826e036d-9272-446b-a5d7-06fe19433727",
      "activeVersionId": "a2534668-5960-4f3e-9dbe-39cffece1a7f",
      "versionCounter": 51,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-03-28T14:48:54.388Z",
          "createdAt": "2025-03-28T14:48:54.388Z",
          "role": "workflow:owner",
          "workflowId": "GIJFHR0mnSYYxPh2",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "a2534668-5960-4f3e-9dbe-39cffece1a7f",
        "workflowId": "GIJFHR0mnSYYxPh2",
        "nodes": [
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              80,
              140
            ],
            "id": "d5e6ce56-3ed7-4859-99ba-9b577d37ccb8",
            "name": "Embeddings OpenAI",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "mode": "load",
              "tableName": {
                "__rl": true,
                "value": "rpc/match_slides",
                "mode": "list",
                "cachedResultName": "rpc/match_slides"
              },
              "prompt": "={{ $json.message.content }}",
              "topK": 5,
              "options": {
                "queryName": "match_slides"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1.1,
            "position": [
              40,
              -80
            ],
            "id": "65dfb83e-0402-46cb-bbe1-01d796ecff38",
            "name": "Supabase Vector Store",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase account 4"
              }
            }
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "92f32531-bd06-4629-9be4-4b64a12a06d9",
              "responseMode": "lastNode",
              "responseData": "allEntries",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              -660,
              40
            ],
            "id": "8faa67c8-2fed-4f38-ba3a-d3fdc41156ce",
            "name": "Webhook",
            "webhookId": "92f32531-bd06-4629-9be4-4b64a12a06d9"
          },
          {
            "parameters": {
              "modelId": {
                "__rl": true,
                "value": "gpt-4o-mini",
                "mode": "list",
                "cachedResultName": "GPT-4O-MINI"
              },
              "messages": {
                "values": [
                  {
                    "content": "Extraia palavras chave desse prompt.\nUtilize apenas palavras mencionadas pelo usuário.",
                    "role": "system"
                  },
                  {
                    "content": "={{ $json.body.query }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.openAi",
            "typeVersion": 1.8,
            "position": [
              -360,
              -80
            ],
            "id": "14a6910b-30f7-4988-8e0f-1c2318cbde5d",
            "name": "OpenAI",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.manualTrigger",
            "typeVersion": 1,
            "position": [
              -680,
              -200
            ],
            "id": "93bc2f26-4c3e-496f-a908-88dba5c7516c",
            "name": "When clicking ‘Test workflow’"
          }
        ],
        "connections": {
          "Embeddings OpenAI": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Supabase Vector Store": {
            "ai_tool": [
              []
            ],
            "main": [
              []
            ]
          },
          "Webhook": {
            "main": [
              [
                {
                  "node": "OpenAI",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI": {
            "main": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "When clicking ‘Test workflow’": {
            "main": [
              [
                {
                  "node": "OpenAI",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-05-20T14:15:45.093Z",
            "id": 18,
            "workflowId": "GIJFHR0mnSYYxPh2",
            "versionId": "a2534668-5960-4f3e-9dbe-39cffece1a7f",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2025-04-13T14:04:34.679Z",
      "createdAt": "2025-04-12T19:00:36.875Z",
      "id": "O3tlLwo1K76G67s1",
      "name": "Agente Exemplo",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "Você é o Marujo, assistente da Píer Partners. Você tem acesso a uma ferramenta com conteúdo sobre finanças. Restrinja suas respostas a esse conteúdo. Não responda nada qe não esteja ali."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.8,
          "position": [
            460,
            0
          ],
          "id": "823c7283-e5b7-493a-b3df-c9afd825a144",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "mode": "list",
              "value": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            300,
            180
          ],
          "id": "69f8d585-d5f1-4dec-a42f-98f498e14708",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.sessionId }}"
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            420,
            180
          ],
          "id": "c0ab651d-d739-4daf-b243-6ef3a872d54e",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "151dcee0-d4d3-400f-8082-46fc059923bf",
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -460,
            -220
          ],
          "id": "1d6a22b4-838e-4ed1-b978-add2515859c7",
          "name": "Webhook",
          "webhookId": "151dcee0-d4d3-400f-8082-46fc059923bf"
        },
        {
          "parameters": {
            "formTitle": "Import documento",
            "formFields": {
              "values": [
                {
                  "fieldLabel": "data",
                  "fieldType": "file",
                  "multipleFiles": false,
                  "acceptFileTypes": ".pdf"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.formTrigger",
          "typeVersion": 2.2,
          "position": [
            440,
            -700
          ],
          "id": "1b70c430-28c3-48da-b7c6-a962b3433abc",
          "name": "On form submission",
          "webhookId": "8e0cef4c-5866-4b40-9b01-617977a4b12e"
        },
        {
          "parameters": {
            "mode": "insert",
            "tableName": {
              "__rl": true,
              "value": "livro_damodaran",
              "mode": "list",
              "cachedResultName": "livro_damodaran"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.1,
          "position": [
            1060,
            -700
          ],
          "id": "a31e3ab4-7f58-4df2-a3da-24bcdea9d263",
          "name": "Supabase Vector Store",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase account 4"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            980,
            -520
          ],
          "id": "d068d6bf-c64b-4794-aaef-19648a02367a",
          "name": "Embeddings OpenAI",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "jsonMode": "expressionData",
            "jsonData": "={{ $json.sanitizedText }}",
            "options": {
              "splitPages": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1,
          "position": [
            1120,
            -540
          ],
          "id": "d8dfd523-f89f-4c2d-87e6-dc07b8eb8883",
          "name": "Default Data Loader"
        },
        {
          "parameters": {
            "chunkSize": 2000,
            "chunkOverlap": 100
          },
          "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
          "typeVersion": 1,
          "position": [
            1300,
            -420
          ],
          "id": "206aa69f-693b-4cf1-80d5-d7661b6d88ac",
          "name": "Token Splitter"
        },
        {
          "parameters": {
            "operation": "pdf",
            "options": {}
          },
          "type": "n8n-nodes-base.extractFromFile",
          "typeVersion": 1,
          "position": [
            660,
            -700
          ],
          "id": "393673b9-40fc-4cff-8225-1fb9e9ebe211",
          "name": "Extract from File"
        },
        {
          "parameters": {
            "jsCode": "const sanitizedText = $json[\"text\"].replace(/[^\\x20-\\x7E]/g, \"\");  // Removes non-ASCII characters\nreturn [{ json: { sanitizedText } }];\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            880,
            -700
          ],
          "id": "35b684b8-0145-40c4-9627-a3baab125ff9",
          "name": "Code"
        },
        {
          "parameters": {
            "public": true,
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.1,
          "position": [
            200,
            20
          ],
          "id": "20bbb4ff-6bec-4128-a2e7-95e5e4266487",
          "name": "When chat message received",
          "webhookId": "5aaa0ecb-87b1-416d-912c-850b6cda2c76"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "88d44756-a8d8-40be-a4c1-7c94d7cdb47d",
                  "name": "sessionId",
                  "value": "={{ $json.body.sessionId }}",
                  "type": "string"
                },
                {
                  "id": "85441c09-637c-40f2-9c9b-e0393b89cf04",
                  "name": "chatInput",
                  "value": "={{ $json.body.chatInput }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -240,
            -220
          ],
          "id": "2491bab9-380d-482d-8758-cc2c220a4e68",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "livro_damodaran",
            "toolDescription": "Utilize essa ferramenta sempre que for consultado sobre qualquer tema financeiro para gerar contexto sobre o tema.",
            "tableName": {
              "__rl": true,
              "value": "rpc/match_documents_livro_damodaran",
              "mode": "list",
              "cachedResultName": "rpc/match_documents_livro_damodaran"
            },
            "topK": 10,
            "includeDocumentMetadata": false,
            "options": {
              "queryName": "match_documents_livro_damodaran"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.1,
          "position": [
            820,
            240
          ],
          "id": "77c33246-d176-4446-8bbd-09cf15708267",
          "name": "Supabase Vector Store1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase account 4"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            920,
            380
          ],
          "id": "28abbdc8-b1d3-4553-8b90-860b16417e13",
          "name": "Embeddings OpenAI1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        }
      ],
      "connections": {
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            []
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "On form submission": {
          "main": [
            [
              {
                "node": "Extract from File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Token Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Extract from File": {
          "main": [
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Supabase Vector Store",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Supabase Vector Store1": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI1": {
          "ai_embedding": [
            [
              {
                "node": "Supabase Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "c93ebfcf-9970-4188-ba6c-eb11587006c3",
      "activeVersionId": "c93ebfcf-9970-4188-ba6c-eb11587006c3",
      "versionCounter": 50,
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2025-04-12T19:00:36.875Z",
          "createdAt": "2025-04-12T19:00:36.875Z",
          "role": "workflow:owner",
          "workflowId": "O3tlLwo1K76G67s1",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-04-12T19:03:48.667Z",
          "createdAt": "2025-04-12T19:03:48.667Z",
          "id": "r7n5XWMEG4n04zo9",
          "name": "treinamento"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "c93ebfcf-9970-4188-ba6c-eb11587006c3",
        "workflowId": "O3tlLwo1K76G67s1",
        "nodes": [
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $json.chatInput }}",
              "options": {
                "systemMessage": "Você é o Marujo, assistente da Píer Partners. Você tem acesso a uma ferramenta com conteúdo sobre finanças. Restrinja suas respostas a esse conteúdo. Não responda nada qe não esteja ali."
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.8,
            "position": [
              460,
              0
            ],
            "id": "823c7283-e5b7-493a-b3df-c9afd825a144",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "mode": "list",
                "value": "gpt-4o-mini"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              300,
              180
            ],
            "id": "69f8d585-d5f1-4dec-a42f-98f498e14708",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "sessionIdType": "customKey",
              "sessionKey": "={{ $json.sessionId }}"
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              420,
              180
            ],
            "id": "c0ab651d-d739-4daf-b243-6ef3a872d54e",
            "name": "Simple Memory"
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "151dcee0-d4d3-400f-8082-46fc059923bf",
              "responseMode": "lastNode",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              -460,
              -220
            ],
            "id": "1d6a22b4-838e-4ed1-b978-add2515859c7",
            "name": "Webhook",
            "webhookId": "151dcee0-d4d3-400f-8082-46fc059923bf"
          },
          {
            "parameters": {
              "formTitle": "Import documento",
              "formFields": {
                "values": [
                  {
                    "fieldLabel": "data",
                    "fieldType": "file",
                    "multipleFiles": false,
                    "acceptFileTypes": ".pdf"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.formTrigger",
            "typeVersion": 2.2,
            "position": [
              440,
              -700
            ],
            "id": "1b70c430-28c3-48da-b7c6-a962b3433abc",
            "name": "On form submission",
            "webhookId": "8e0cef4c-5866-4b40-9b01-617977a4b12e"
          },
          {
            "parameters": {
              "mode": "insert",
              "tableName": {
                "__rl": true,
                "value": "livro_damodaran",
                "mode": "list",
                "cachedResultName": "livro_damodaran"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1.1,
            "position": [
              1060,
              -700
            ],
            "id": "a31e3ab4-7f58-4df2-a3da-24bcdea9d263",
            "name": "Supabase Vector Store",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase account 4"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              980,
              -520
            ],
            "id": "d068d6bf-c64b-4794-aaef-19648a02367a",
            "name": "Embeddings OpenAI",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "jsonMode": "expressionData",
              "jsonData": "={{ $json.sanitizedText }}",
              "options": {
                "splitPages": false
              }
            },
            "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
            "typeVersion": 1,
            "position": [
              1120,
              -540
            ],
            "id": "d8dfd523-f89f-4c2d-87e6-dc07b8eb8883",
            "name": "Default Data Loader"
          },
          {
            "parameters": {
              "chunkSize": 2000,
              "chunkOverlap": 100
            },
            "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
            "typeVersion": 1,
            "position": [
              1300,
              -420
            ],
            "id": "206aa69f-693b-4cf1-80d5-d7661b6d88ac",
            "name": "Token Splitter"
          },
          {
            "parameters": {
              "operation": "pdf",
              "options": {}
            },
            "type": "n8n-nodes-base.extractFromFile",
            "typeVersion": 1,
            "position": [
              660,
              -700
            ],
            "id": "393673b9-40fc-4cff-8225-1fb9e9ebe211",
            "name": "Extract from File"
          },
          {
            "parameters": {
              "jsCode": "const sanitizedText = $json[\"text\"].replace(/[^\\x20-\\x7E]/g, \"\");  // Removes non-ASCII characters\nreturn [{ json: { sanitizedText } }];\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              880,
              -700
            ],
            "id": "35b684b8-0145-40c4-9627-a3baab125ff9",
            "name": "Code"
          },
          {
            "parameters": {
              "public": true,
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.1,
            "position": [
              200,
              20
            ],
            "id": "20bbb4ff-6bec-4128-a2e7-95e5e4266487",
            "name": "When chat message received",
            "webhookId": "5aaa0ecb-87b1-416d-912c-850b6cda2c76"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "88d44756-a8d8-40be-a4c1-7c94d7cdb47d",
                    "name": "sessionId",
                    "value": "={{ $json.body.sessionId }}",
                    "type": "string"
                  },
                  {
                    "id": "85441c09-637c-40f2-9c9b-e0393b89cf04",
                    "name": "chatInput",
                    "value": "={{ $json.body.chatInput }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              -240,
              -220
            ],
            "id": "2491bab9-380d-482d-8758-cc2c220a4e68",
            "name": "Edit Fields"
          },
          {
            "parameters": {
              "mode": "retrieve-as-tool",
              "toolName": "livro_damodaran",
              "toolDescription": "Utilize essa ferramenta sempre que for consultado sobre qualquer tema financeiro para gerar contexto sobre o tema.",
              "tableName": {
                "__rl": true,
                "value": "rpc/match_documents_livro_damodaran",
                "mode": "list",
                "cachedResultName": "rpc/match_documents_livro_damodaran"
              },
              "topK": 10,
              "includeDocumentMetadata": false,
              "options": {
                "queryName": "match_documents_livro_damodaran"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1.1,
            "position": [
              820,
              240
            ],
            "id": "77c33246-d176-4446-8bbd-09cf15708267",
            "name": "Supabase Vector Store1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase account 4"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              920,
              380
            ],
            "id": "28abbdc8-b1d3-4553-8b90-860b16417e13",
            "name": "Embeddings OpenAI1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          }
        ],
        "connections": {
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent": {
            "main": [
              []
            ]
          },
          "Webhook": {
            "main": [
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "On form submission": {
            "main": [
              [
                {
                  "node": "Extract from File",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Default Data Loader": {
            "ai_document": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "ai_document",
                  "index": 0
                }
              ]
            ]
          },
          "Token Splitter": {
            "ai_textSplitter": [
              [
                {
                  "node": "Default Data Loader",
                  "type": "ai_textSplitter",
                  "index": 0
                }
              ]
            ]
          },
          "Extract from File": {
            "main": [
              [
                {
                  "node": "Code",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code": {
            "main": [
              [
                {
                  "node": "Supabase Vector Store",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "When chat message received": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Supabase Vector Store1": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI1": {
            "ai_embedding": [
              [
                {
                  "node": "Supabase Vector Store1",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-04-13T14:04:34.679Z",
            "id": 14,
            "workflowId": "O3tlLwo1K76G67s1",
            "versionId": "c93ebfcf-9970-4188-ba6c-eb11587006c3",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-22T17:13:05.320Z",
      "createdAt": "2025-05-08T16:23:40.335Z",
      "id": "lAdQBHUWkV3jXJoK",
      "name": "Marujo - Whatsapp",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "numberInputs": 4
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.1,
          "position": [
            -208,
            144
          ],
          "id": "66b42691-8f3b-45a6-bed8-f9e5539eddde",
          "name": "Merge"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "550405e2-d9dd-4e6e-a6d6-9e922f9a2951",
                  "name": "texto",
                  "value": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -816,
            -64
          ],
          "id": "d46e338d-1757-424c-aed6-979dd229a428",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f87f82e2-8826-42f5-bbc0-2b5f3a777ca6",
                  "name": "texto",
                  "value": "={{ $json.text }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -624,
            112
          ],
          "id": "bba58c99-9c6c-4362-813e-4def48dd3f94",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                        "rightValue": "555185317067",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "eb212612-cc8f-479b-bd41-e985e6e6ed15"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "bruna"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "0f688230-77bf-4426-9ad7-175cda79073a",
                        "leftValue": "={{ $('Webhook').item.json.body.data.key.fromMe }}",
                        "rightValue": "",
                        "operator": {
                          "type": "boolean",
                          "operation": "true",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "fromMe"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e2a0a0eb-1af7-4050-b596-5c7883ea3bde",
                        "leftValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                        "rightValue": "555191842957",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "ramiro"
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            432,
            128
          ],
          "id": "703d4b50-961c-45df-bf51-d3da4fe74b56",
          "name": "Switch1"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "marujozap",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -1904,
            32
          ],
          "id": "a3b660e7-c225-41c5-abb4-e76854f7be72",
          "name": "Webhook",
          "webhookId": "47aa07c5-eb9a-40bf-97fd-baaf46b6fdc0"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "742cc1be-0f41-4f97-9b34-8bef1b2270f5",
                  "name": "sessionId",
                  "value": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                  "type": "string"
                },
                {
                  "id": "7f4b6969-9bd3-4be7-8661-f3604de6b1df",
                  "name": "chatInput",
                  "value": "={{ $('Merge').item.json.texto }}",
                  "type": "string"
                },
                {
                  "id": "90c0c4df-672b-44fc-8a50-08fb3fd9ce4a",
                  "name": "nome",
                  "value": "={{ $('Get many database pages').item.json.name }}",
                  "type": "string"
                },
                {
                  "id": "90b85caa-65d5-4c00-af61-b7ef45f8e94b",
                  "name": "cargo",
                  "value": "={{ $('Get many database pages').item.json.property_posi_o }}",
                  "type": "string"
                },
                {
                  "id": "4a2b0cd0-cf61-4fec-a052-da5a638f07f1",
                  "name": "setor",
                  "value": "={{ $('Get many database pages').item.json.property_vertical }}",
                  "type": "string"
                },
                {
                  "id": "ddaf11ca-09e2-4841-a8f9-78cf873e1bc4",
                  "name": "id_notion",
                  "value": "={{ $('Get many database pages').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "d0c14406-305f-499f-9f52-2ef50df6bcec",
                  "name": "memoria_marujo",
                  "value": "={{ $('Get many database pages').item.json.property_memoria_marujo }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -80,
            -352
          ],
          "id": "7ea29f9d-d310-462d-8f18-d0e737dcdb17",
          "name": "Edit Fields3"
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "douglas",
            "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
            "messageText": "={{ $json.output.message }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            1040,
            -112
          ],
          "id": "efca32bc-6930-4e3e-940b-02d69e2b06d1",
          "name": "Evolution API2",
          "credentials": {
            "evolutionApi": {
              "id": "WYzhjAsTmZb6LE1P",
              "name": "Evolution account"
            }
          }
        },
        {
          "parameters": {
            "tableId": "historico_marujo",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "pessoa",
                  "fieldValue": "={{ $json.name }}"
                },
                {
                  "fieldId": "tipo",
                  "fieldValue": "Input"
                },
                {
                  "fieldId": "conteudo",
                  "fieldValue": "={{ $('Merge').item.json.texto }}"
                },
                {
                  "fieldId": "sessionID",
                  "fieldValue": "={{ $('Webhook').item.json.body.data.key.id }}\n"
                },
                {
                  "fieldId": "id_pessoa",
                  "fieldValue": "={{ $json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            224,
            384
          ],
          "id": "25f1c142-0228-4479-a1f6-b8c80d98e75a",
          "name": "RegistrarInput",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "exists",
                          "singleValue": true
                        },
                        "id": "7ddfbe8a-567b-455d-9aeb-0a9d8d192d0a"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "texto"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "e44c1cd3-d581-4f3b-ab6b-9dfac3526fa7",
                        "leftValue": "={{ $('Webhook').item.json.body.data.message.audioMessage }}",
                        "rightValue": "",
                        "operator": {
                          "type": "object",
                          "operation": "notEmpty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "audio"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "f93f0af0-63d9-4949-8bdb-31ccd94ca1c7",
                        "leftValue": "={{ $('Webhook').item.json.body.data.message.documentMessage }}",
                        "rightValue": "",
                        "operator": {
                          "type": "object",
                          "operation": "notEmpty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "documento"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "84b629af-d8ab-412b-a222-c35f90a3ce13",
                        "leftValue": "={{ $('Webhook').item.json.body.data.message.imageMessage }}",
                        "rightValue": "",
                        "operator": {
                          "type": "object",
                          "operation": "notEmpty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "imagem"
                }
              ]
            },
            "options": {
              "allMatchingOutputs": true
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            -1440,
            160
          ],
          "id": "f00a16b2-5ff3-465b-a6e8-ea628cf74c51",
          "name": "Switch4"
        },
        {
          "parameters": {
            "resource": "audio",
            "operation": "transcribe",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            -816,
            112
          ],
          "id": "1429291e-ec01-47d3-8274-f163de293bf7",
          "name": "Transcribe a recording",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
              "mode": "id"
            },
            "limit": 1,
            "filterType": "json",
            "filterJson": "={\n    \"property\": \"Telefone\",\n    \"rich_text\": {\n      \"contains\": \"{{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}\"\n    }\n  }",
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            -288,
            -352
          ],
          "id": "454e0788-128d-4a5f-853c-d90909e7cff1",
          "name": "Get many database pages",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/632e8eea-7479-40a4-9aa0-27de80c61094",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "arquivobase64",
                  "value": "={{ $('Webhook').item.json.body.data.message.base64 }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -912,
            272
          ],
          "id": "ee4319e5-d6b2-4ab3-bcec-c46af219259e",
          "name": "HTTP Request"
        },
        {
          "parameters": {
            "resource": "image",
            "operation": "analyze",
            "modelId": {
              "__rl": true,
              "value": "gpt-4o",
              "mode": "list",
              "cachedResultName": "GPT-4O"
            },
            "text": "Descreva essa imagem em detalhes.",
            "inputType": "base64",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            -816,
            432
          ],
          "id": "d3b5cc0b-b8b4-4465-85f7-d519e0c5789d",
          "name": "Analyze image",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "operation": "toBinary",
            "sourceProperty": "body.data.message.base64",
            "options": {}
          },
          "type": "n8n-nodes-base.convertToFile",
          "typeVersion": 1.1,
          "position": [
            -1008,
            432
          ],
          "id": "24f4e79c-fcf9-488c-9aa6-73b17233bbcb",
          "name": "Convert to File"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f87f82e2-8826-42f5-bbc0-2b5f3a777ca6",
                  "name": "texto",
                  "value": "={{ $('Webhook').item.json.body.data.message.documentMessage.caption ?? '' }}\n\n<contexto>\nO texto a seguir é a versão markdown de um documento enviado pelo usuário e deve ser utilizado apenas como um contexto. Portanto não responda diretamente a este conteúdo:\n\n<texto do contexto>\n{{ $json.data }}\n</texto do contexto>\n</contexto>",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -720,
            272
          ],
          "id": "673bf4ca-a848-4256-b12a-3149e449cb41",
          "name": "Edit Fields4"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "f87f82e2-8826-42f5-bbc0-2b5f3a777ca6",
                  "name": "texto",
                  "value": "={{ $('Webhook').item.json.body.data.message.imageMessage.caption ?? '' }}\n\n<contexto>\nO texto a descriçao de uma iamgem enviada pelo usuário e deve ser utilizado apenas como um contexto. Portanto não responda diretamente a este conteúdo:\n\n<texto do contexto>\n{{ $json.content }}\n</texto do contexto>\n</contexto>",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            -624,
            432
          ],
          "id": "06f331e5-7203-4509-b7f5-ed4c27d2ce11",
          "name": "Edit Fields5"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "mensagem",
                  "value": "={{ $json.chatInput }}"
                },
                {
                  "name": "nome",
                  "value": "={{ $json.nome }}"
                },
                {
                  "name": "cargo",
                  "value": "={{ $json.cargo }}"
                },
                {
                  "name": "setor",
                  "value": "={{ $json.setor }}"
                },
                {
                  "name": "id_notion",
                  "value": "={{ $json.id_notion }}"
                },
                {
                  "name": "telefone",
                  "value": "={{ $json.sessionId }}"
                },
                {
                  "name": "session_ID",
                  "value": "={{ \"whatsapp\".concat(\"|\", $('Webhook').item.json.body.data.key.id) }}"
                },
                {
                  "name": "pessoa",
                  "value": "={{ $('Get many database pages').item.json.name }}"
                },
                {
                  "name": "id_pessoa",
                  "value": "={{ $('Get many database pages').item.json.id }}\n"
                },
                {
                  "name": "memoria_marujo",
                  "value": "={{ $('Get many database pages').item.json.property_memoria_marujo }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            128,
            -352
          ],
          "id": "36d7e88d-ec48-4479-87b5-5cce693be325",
          "name": "HTTP Request1",
          "credentials": {
            "httpBasicAuth": {
              "id": "tCmsIBEt9lhM1cnI",
              "name": "Unnamed credential"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "instanceName": "douglas",
            "remoteJid": "={{ $('Edit Fields6').item.json.sessionId }}",
            "messageText": "={{ $('HTTP Request3').item.json.message }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            1296,
            192
          ],
          "id": "6599637e-0663-4a1c-b509-c94143764031",
          "name": "Enviar texto",
          "credentials": {
            "evolutionApi": {
              "id": "WYzhjAsTmZb6LE1P",
              "name": "Evolution account"
            }
          }
        },
        {
          "parameters": {
            "resource": "messages-api",
            "operation": "send-image",
            "instanceName": "douglas",
            "remoteJid": "={{ $('Edit Fields6').item.json.sessionId }}",
            "media": "={{ $json.images.imagebase64 }}",
            "caption": "={{ $json.images.url }}",
            "options_message": {}
          },
          "type": "n8n-nodes-evolution-api.evolutionApi",
          "typeVersion": 1,
          "position": [
            1568,
            496
          ],
          "id": "5b1da3cb-c4da-4b5b-a8e7-0b4d40727043",
          "name": "Enviar imagem",
          "credentials": {
            "evolutionApi": {
              "id": "WYzhjAsTmZb6LE1P",
              "name": "Evolution account"
            }
          }
        },
        {
          "parameters": {
            "fieldToSplitOut": "=images",
            "include": "allOtherFields",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            1296,
            496
          ],
          "id": "2011290f-8d47-46f5-93cf-c32ade298df6",
          "name": "Split Out1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "loose",
                "version": 2
              },
              "conditions": [
                {
                  "id": "62c53597-4435-4f0e-b013-b81f17b041cb",
                  "leftValue": "={{ $('Aggregate').item.json }}",
                  "rightValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                  "operator": {
                    "type": "string",
                    "operation": "contains"
                  }
                }
              ],
              "combinator": "and"
            },
            "looseTypeValidation": true,
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            -1712,
            192
          ],
          "id": "1ef815a9-84e8-4642-8b4c-aeaa2e6698b3",
          "name": "If"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "destinationFieldName": "Data",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -1904,
            192
          ],
          "id": "2ffbdfd4-1b92-42e0-8247-0cee92b248f4",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "returnAll": true,
            "output": "fields",
            "fields": [
              "mobilePhone"
            ],
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            -2080,
            192
          ],
          "id": "0ec4623c-5af0-4b35-915f-5e582d155fde",
          "name": "Get many users",
          "retryOnFail": true,
          "maxTries": 5,
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "pessoas",
            "filters": {
              "conditions": [
                {
                  "keyName": "telefone",
                  "keyValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            0,
            176
          ],
          "id": "2955439c-e6e4-45e5-a6ec-b2b733cbcca8",
          "name": "Get a row",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "742cc1be-0f41-4f97-9b34-8bef1b2270f5",
                  "name": "sessionId",
                  "value": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                  "type": "string"
                },
                {
                  "id": "7f4b6969-9bd3-4be7-8661-f3604de6b1df",
                  "name": "chatInput",
                  "value": "={{ $('Merge').item.json.texto }}",
                  "type": "string"
                },
                {
                  "id": "90c0c4df-672b-44fc-8a50-08fb3fd9ce4a",
                  "name": "nome",
                  "value": "={{ $('Get a row').item.json.nome }}",
                  "type": "string"
                },
                {
                  "id": "90b85caa-65d5-4c00-af61-b7ef45f8e94b",
                  "name": "cargo",
                  "value": "={{ $('Get a row').item.json.cargo }}",
                  "type": "string"
                },
                {
                  "id": "4a2b0cd0-cf61-4fec-a052-da5a638f07f1",
                  "name": "setor",
                  "value": "={{ $('Get a row').item.json.vertical }}",
                  "type": "string"
                },
                {
                  "id": "ddaf11ca-09e2-4841-a8f9-78cf873e1bc4",
                  "name": "id_notion",
                  "value": "={{ $('Get a row').item.json.id_notion }}",
                  "type": "string"
                },
                {
                  "id": "d0c14406-305f-499f-9f52-2ef50df6bcec",
                  "name": "memoria_marujo",
                  "value": "=\"\"",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            224,
            176
          ],
          "id": "e5e21b3d-d0b6-4e13-b3b9-8ff2316e6f94",
          "name": "Edit Fields6"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBasicAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "mensagem",
                  "value": "={{ $json.chatInput }}"
                },
                {
                  "name": "nome",
                  "value": "={{ $json.nome }}"
                },
                {
                  "name": "cargo",
                  "value": "={{ $json.cargo }}"
                },
                {
                  "name": "setor",
                  "value": "={{ $json.setor }}"
                },
                {
                  "name": "id_notion",
                  "value": "={{ $json.id_notion }}"
                },
                {
                  "name": "telefone",
                  "value": "={{ $json.sessionId }}"
                },
                {
                  "name": "session_ID",
                  "value": "={{ \"whatsapp\".concat(\"|\", $('Webhook').item.json.body.data.key.id) }}"
                },
                {
                  "name": "pessoa",
                  "value": "={{ $('Get a row').item.json.nome }}"
                },
                {
                  "name": "id_pessoa",
                  "value": "={{ $('Get a row').item.json.id_notion }}\n"
                },
                {
                  "name": "memoria_marujo",
                  "value": "=\" \""
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1008,
            352
          ],
          "id": "d65a06ad-c091-4294-9143-23cb5a5ade29",
          "name": "HTTP Request3",
          "credentials": {
            "httpBasicAuth": {
              "id": "tCmsIBEt9lhM1cnI",
              "name": "Unnamed credential"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const base64String = $('Webhook').item.json.body.data.message.base64;  // or provide the raw base64 string here\n\n// Decode base64 and create binary data\nconst binaryData = Buffer.from(base64String, 'base64');\n\n// Return binary data to be used in the next node (like Write Binary File)\nreturn [\n  {\n    binary: {\n      data: {\n        data: binaryData.toString('base64'), // n8n expects base64 format in binary\n        mimeType: 'audio/mpeg',\n        fileName: 'output.mp3'\n      }\n    }\n  }\n];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            -1008,
            112
          ],
          "id": "4e61e497-7e20-4eb6-a343-0e7d3ab6d4f2",
          "name": "Code"
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "pessoas",
            "filters": {
              "conditions": [
                {
                  "keyName": "telefone",
                  "keyValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -1712,
            32
          ],
          "id": "4dc0ea9f-2cc7-4f93-9e64-e2930b280a39",
          "name": "Get a row1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        }
      ],
      "connections": {
        "Merge": {
          "main": [
            [
              {
                "node": "Get a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Evolution API2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Evolution API2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Evolution API2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "HTTP Request3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Get a row1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields3": {
          "main": [
            [
              {
                "node": "HTTP Request1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Evolution API2": {
          "main": [
            []
          ]
        },
        "RegistrarInput": {
          "main": [
            []
          ]
        },
        "Switch4": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Code",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Convert to File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Transcribe a recording": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many database pages": {
          "main": [
            [
              {
                "node": "Edit Fields3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Convert to File": {
          "main": [
            [
              {
                "node": "Analyze image",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Edit Fields4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields4": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 2
              }
            ]
          ]
        },
        "Analyze image": {
          "main": [
            [
              {
                "node": "Edit Fields5",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields5": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 3
              }
            ]
          ]
        },
        "HTTP Request1": {
          "main": [
            []
          ]
        },
        "Enviar texto": {
          "main": [
            []
          ]
        },
        "Enviar imagem": {
          "main": [
            []
          ]
        },
        "Split Out1": {
          "main": [
            [
              {
                "node": "Enviar imagem",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Switch4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many users": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a row": {
          "main": [
            [
              {
                "node": "RegistrarInput",
                "type": "main",
                "index": 0
              },
              {
                "node": "Edit Fields6",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields6": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request3": {
          "main": [
            [
              {
                "node": "Enviar texto",
                "type": "main",
                "index": 0
              },
              {
                "node": "Split Out1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code": {
          "main": [
            [
              {
                "node": "Transcribe a recording",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a row1": {
          "main": [
            [
              {
                "node": "Switch4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "timeSavedMode": "fixed",
        "callerPolicy": "workflowsFromSameOwner",
        "availableInMCP": true
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "e86fd688-e242-4e28-b55b-02045e4f36e8",
      "activeVersionId": "d8405cb5-c4c5-4d2c-8b9f-da156c00c49a",
      "versionCounter": 50,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-08T16:23:40.335Z",
          "createdAt": "2025-05-08T16:23:40.335Z",
          "role": "workflow:owner",
          "workflowId": "lAdQBHUWkV3jXJoK",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-03-25T17:28:44.590Z",
          "createdAt": "2025-03-25T17:28:44.590Z",
          "id": "SGLcCfFPtH9ESbyP",
          "name": "Marujo"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "d8405cb5-c4c5-4d2c-8b9f-da156c00c49a",
        "workflowId": "lAdQBHUWkV3jXJoK",
        "nodes": [
          {
            "parameters": {
              "numberInputs": 4
            },
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.1,
            "position": [
              -208,
              144
            ],
            "id": "66b42691-8f3b-45a6-bed8-f9e5539eddde",
            "name": "Merge"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "550405e2-d9dd-4e6e-a6d6-9e922f9a2951",
                    "name": "texto",
                    "value": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              -816,
              -64
            ],
            "id": "d46e338d-1757-424c-aed6-979dd229a428",
            "name": "Edit Fields"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "f87f82e2-8826-42f5-bbc0-2b5f3a777ca6",
                    "name": "texto",
                    "value": "={{ $json.text }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              -624,
              112
            ],
            "id": "bba58c99-9c6c-4362-813e-4def48dd3f94",
            "name": "Edit Fields1"
          },
          {
            "parameters": {
              "rules": {
                "values": [
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "leftValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                          "rightValue": "555185317067",
                          "operator": {
                            "type": "string",
                            "operation": "equals"
                          },
                          "id": "eb212612-cc8f-479b-bd41-e985e6e6ed15"
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "bruna"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "0f688230-77bf-4426-9ad7-175cda79073a",
                          "leftValue": "={{ $('Webhook').item.json.body.data.key.fromMe }}",
                          "rightValue": "",
                          "operator": {
                            "type": "boolean",
                            "operation": "true",
                            "singleValue": true
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "fromMe"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "e2a0a0eb-1af7-4050-b596-5c7883ea3bde",
                          "leftValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                          "rightValue": "555191842957",
                          "operator": {
                            "type": "string",
                            "operation": "equals",
                            "name": "filter.operator.equals"
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "ramiro"
                  }
                ]
              },
              "options": {
                "fallbackOutput": "extra"
              }
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.2,
            "position": [
              432,
              128
            ],
            "id": "703d4b50-961c-45df-bf51-d3da4fe74b56",
            "name": "Switch1"
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "marujozap",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              -1904,
              32
            ],
            "id": "a3b660e7-c225-41c5-abb4-e76854f7be72",
            "name": "Webhook",
            "webhookId": "47aa07c5-eb9a-40bf-97fd-baaf46b6fdc0"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "742cc1be-0f41-4f97-9b34-8bef1b2270f5",
                    "name": "sessionId",
                    "value": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                    "type": "string"
                  },
                  {
                    "id": "7f4b6969-9bd3-4be7-8661-f3604de6b1df",
                    "name": "chatInput",
                    "value": "={{ $('Merge').item.json.texto }}",
                    "type": "string"
                  },
                  {
                    "id": "90c0c4df-672b-44fc-8a50-08fb3fd9ce4a",
                    "name": "nome",
                    "value": "={{ $('Get many database pages').item.json.name }}",
                    "type": "string"
                  },
                  {
                    "id": "90b85caa-65d5-4c00-af61-b7ef45f8e94b",
                    "name": "cargo",
                    "value": "={{ $('Get many database pages').item.json.property_posi_o }}",
                    "type": "string"
                  },
                  {
                    "id": "4a2b0cd0-cf61-4fec-a052-da5a638f07f1",
                    "name": "setor",
                    "value": "={{ $('Get many database pages').item.json.property_vertical }}",
                    "type": "string"
                  },
                  {
                    "id": "ddaf11ca-09e2-4841-a8f9-78cf873e1bc4",
                    "name": "id_notion",
                    "value": "={{ $('Get many database pages').item.json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "d0c14406-305f-499f-9f52-2ef50df6bcec",
                    "name": "memoria_marujo",
                    "value": "={{ $('Get many database pages').item.json.property_memoria_marujo }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              -80,
              -384
            ],
            "id": "7ea29f9d-d310-462d-8f18-d0e737dcdb17",
            "name": "Edit Fields3"
          },
          {
            "parameters": {
              "resource": "messages-api",
              "instanceName": "douglas",
              "remoteJid": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
              "messageText": "={{ $json.output.message }}",
              "options_message": {}
            },
            "type": "n8n-nodes-evolution-api.evolutionApi",
            "typeVersion": 1,
            "position": [
              1040,
              -112
            ],
            "id": "efca32bc-6930-4e3e-940b-02d69e2b06d1",
            "name": "Evolution API2",
            "credentials": {
              "evolutionApi": {
                "id": "WYzhjAsTmZb6LE1P",
                "name": "Evolution account"
              }
            }
          },
          {
            "parameters": {
              "tableId": "historico_marujo",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "pessoa",
                    "fieldValue": "={{ $json.name }}"
                  },
                  {
                    "fieldId": "tipo",
                    "fieldValue": "Input"
                  },
                  {
                    "fieldId": "conteudo",
                    "fieldValue": "={{ $('Merge').item.json.texto }}"
                  },
                  {
                    "fieldId": "sessionID",
                    "fieldValue": "={{ $('Webhook').item.json.body.data.key.id }}\n"
                  },
                  {
                    "fieldId": "id_pessoa",
                    "fieldValue": "={{ $json.id }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              224,
              384
            ],
            "id": "25f1c142-0228-4479-a1f6-b8c80d98e75a",
            "name": "RegistrarInput",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "rules": {
                "values": [
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "leftValue": "={{ $('Webhook').item.json.body.data.message.conversation }}",
                          "rightValue": "",
                          "operator": {
                            "type": "string",
                            "operation": "exists",
                            "singleValue": true
                          },
                          "id": "7ddfbe8a-567b-455d-9aeb-0a9d8d192d0a"
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "texto"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "e44c1cd3-d581-4f3b-ab6b-9dfac3526fa7",
                          "leftValue": "={{ $('Webhook').item.json.body.data.message.audioMessage }}",
                          "rightValue": "",
                          "operator": {
                            "type": "object",
                            "operation": "notEmpty",
                            "singleValue": true
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "audio"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "f93f0af0-63d9-4949-8bdb-31ccd94ca1c7",
                          "leftValue": "={{ $('Webhook').item.json.body.data.message.documentMessage }}",
                          "rightValue": "",
                          "operator": {
                            "type": "object",
                            "operation": "notEmpty",
                            "singleValue": true
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "documento"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "84b629af-d8ab-412b-a222-c35f90a3ce13",
                          "leftValue": "={{ $('Webhook').item.json.body.data.message.imageMessage }}",
                          "rightValue": "",
                          "operator": {
                            "type": "object",
                            "operation": "notEmpty",
                            "singleValue": true
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "imagem"
                  }
                ]
              },
              "options": {
                "allMatchingOutputs": true
              }
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.2,
            "position": [
              -1440,
              160
            ],
            "id": "f00a16b2-5ff3-465b-a6e8-ea628cf74c51",
            "name": "Switch4"
          },
          {
            "parameters": {
              "resource": "audio",
              "operation": "transcribe",
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.openAi",
            "typeVersion": 1.8,
            "position": [
              -816,
              112
            ],
            "id": "1429291e-ec01-47d3-8274-f163de293bf7",
            "name": "Transcribe a recording",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
                "mode": "id"
              },
              "limit": 1,
              "filterType": "json",
              "filterJson": "={\n    \"property\": \"Telefone\",\n    \"rich_text\": {\n      \"contains\": \"{{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}\"\n    }\n  }",
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              -288,
              -384
            ],
            "id": "454e0788-128d-4a5f-853c-d90909e7cff1",
            "name": "Get many database pages",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/632e8eea-7479-40a4-9aa0-27de80c61094",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "arquivobase64",
                    "value": "={{ $('Webhook').item.json.body.data.message.base64 }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              -912,
              272
            ],
            "id": "ee4319e5-d6b2-4ab3-bcec-c46af219259e",
            "name": "HTTP Request"
          },
          {
            "parameters": {
              "resource": "image",
              "operation": "analyze",
              "modelId": {
                "__rl": true,
                "value": "gpt-4o",
                "mode": "list",
                "cachedResultName": "GPT-4O"
              },
              "text": "Descreva essa imagem em detalhes.",
              "inputType": "base64",
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.openAi",
            "typeVersion": 1.8,
            "position": [
              -816,
              432
            ],
            "id": "d3b5cc0b-b8b4-4465-85f7-d519e0c5789d",
            "name": "Analyze image",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "operation": "toBinary",
              "sourceProperty": "body.data.message.base64",
              "options": {}
            },
            "type": "n8n-nodes-base.convertToFile",
            "typeVersion": 1.1,
            "position": [
              -1008,
              432
            ],
            "id": "24f4e79c-fcf9-488c-9aa6-73b17233bbcb",
            "name": "Convert to File"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "f87f82e2-8826-42f5-bbc0-2b5f3a777ca6",
                    "name": "texto",
                    "value": "={{ $('Webhook').item.json.body.data.message.documentMessage.caption ?? '' }}\n\n<contexto>\nO texto a seguir é a versão markdown de um documento enviado pelo usuário e deve ser utilizado apenas como um contexto. Portanto não responda diretamente a este conteúdo:\n\n<texto do contexto>\n{{ $json.data }}\n</texto do contexto>\n</contexto>",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              -720,
              272
            ],
            "id": "673bf4ca-a848-4256-b12a-3149e449cb41",
            "name": "Edit Fields4"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "f87f82e2-8826-42f5-bbc0-2b5f3a777ca6",
                    "name": "texto",
                    "value": "={{ $('Webhook').item.json.body.data.message.imageMessage.caption ?? '' }}\n\n<contexto>\nO texto a descriçao de uma iamgem enviada pelo usuário e deve ser utilizado apenas como um contexto. Portanto não responda diretamente a este conteúdo:\n\n<texto do contexto>\n{{ $json.content }}\n</texto do contexto>\n</contexto>",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              -624,
              432
            ],
            "id": "06f331e5-7203-4509-b7f5-ed4c27d2ce11",
            "name": "Edit Fields5"
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpBasicAuth",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {
                    "name": "mensagem",
                    "value": "={{ $json.chatInput }}"
                  },
                  {
                    "name": "nome",
                    "value": "={{ $json.nome }}"
                  },
                  {
                    "name": "cargo",
                    "value": "={{ $json.cargo }}"
                  },
                  {
                    "name": "setor",
                    "value": "={{ $json.setor }}"
                  },
                  {
                    "name": "id_notion",
                    "value": "={{ $json.id_notion }}"
                  },
                  {
                    "name": "telefone",
                    "value": "={{ $json.sessionId }}"
                  },
                  {
                    "name": "session_ID",
                    "value": "={{ \"whatsapp\".concat(\"|\", $('Webhook').item.json.body.data.key.id) }}"
                  },
                  {
                    "name": "pessoa",
                    "value": "={{ $('Get many database pages').item.json.name }}"
                  },
                  {
                    "name": "id_pessoa",
                    "value": "={{ $('Get many database pages').item.json.id }}\n"
                  },
                  {
                    "name": "memoria_marujo",
                    "value": "={{ $('Get many database pages').item.json.property_memoria_marujo }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              128,
              -384
            ],
            "id": "36d7e88d-ec48-4479-87b5-5cce693be325",
            "name": "HTTP Request1",
            "credentials": {
              "httpBasicAuth": {
                "id": "tCmsIBEt9lhM1cnI",
                "name": "Unnamed credential"
              }
            }
          },
          {
            "parameters": {
              "resource": "messages-api",
              "instanceName": "douglas",
              "remoteJid": "={{ $('Edit Fields6').item.json.sessionId }}",
              "messageText": "={{ $('HTTP Request3').item.json.message }}",
              "options_message": {}
            },
            "type": "n8n-nodes-evolution-api.evolutionApi",
            "typeVersion": 1,
            "position": [
              1296,
              192
            ],
            "id": "6599637e-0663-4a1c-b509-c94143764031",
            "name": "Enviar texto",
            "credentials": {
              "evolutionApi": {
                "id": "WYzhjAsTmZb6LE1P",
                "name": "Evolution account"
              }
            }
          },
          {
            "parameters": {
              "resource": "messages-api",
              "operation": "send-image",
              "instanceName": "douglas",
              "remoteJid": "={{ $('Edit Fields6').item.json.sessionId }}",
              "media": "={{ $json.images.imagebase64 }}",
              "caption": "={{ $json.images.url }}",
              "options_message": {}
            },
            "type": "n8n-nodes-evolution-api.evolutionApi",
            "typeVersion": 1,
            "position": [
              1568,
              496
            ],
            "id": "5b1da3cb-c4da-4b5b-a8e7-0b4d40727043",
            "name": "Enviar imagem",
            "credentials": {
              "evolutionApi": {
                "id": "WYzhjAsTmZb6LE1P",
                "name": "Evolution account"
              }
            }
          },
          {
            "parameters": {
              "fieldToSplitOut": "=images",
              "include": "allOtherFields",
              "options": {}
            },
            "type": "n8n-nodes-base.splitOut",
            "typeVersion": 1,
            "position": [
              1296,
              496
            ],
            "id": "2011290f-8d47-46f5-93cf-c32ade298df6",
            "name": "Split Out1"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "loose",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "62c53597-4435-4f0e-b013-b81f17b041cb",
                    "leftValue": "={{ $('Aggregate').item.json }}",
                    "rightValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "looseTypeValidation": true,
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
              -1712,
              192
            ],
            "id": "1ef815a9-84e8-4642-8b4c-aeaa2e6698b3",
            "name": "If"
          },
          {
            "parameters": {
              "aggregate": "aggregateAllItemData",
              "destinationFieldName": "Data",
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              -1904,
              192
            ],
            "id": "2ffbdfd4-1b92-42e0-8247-0cee92b248f4",
            "name": "Aggregate"
          },
          {
            "parameters": {
              "returnAll": true,
              "output": "fields",
              "fields": [
                "mobilePhone"
              ],
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              -2080,
              192
            ],
            "id": "0ec4623c-5af0-4b35-915f-5e582d155fde",
            "name": "Get many users",
            "retryOnFail": true,
            "maxTries": 5,
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "tableId": "pessoas",
              "filters": {
                "conditions": [
                  {
                    "keyName": "telefone",
                    "keyValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              0,
              176
            ],
            "id": "2955439c-e6e4-45e5-a6ec-b2b733cbcca8",
            "name": "Get a row",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "742cc1be-0f41-4f97-9b34-8bef1b2270f5",
                    "name": "sessionId",
                    "value": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}",
                    "type": "string"
                  },
                  {
                    "id": "7f4b6969-9bd3-4be7-8661-f3604de6b1df",
                    "name": "chatInput",
                    "value": "={{ $('Merge').item.json.texto }}",
                    "type": "string"
                  },
                  {
                    "id": "90c0c4df-672b-44fc-8a50-08fb3fd9ce4a",
                    "name": "nome",
                    "value": "={{ $('Get a row').item.json.nome }}",
                    "type": "string"
                  },
                  {
                    "id": "90b85caa-65d5-4c00-af61-b7ef45f8e94b",
                    "name": "cargo",
                    "value": "={{ $('Get a row').item.json.cargo }}",
                    "type": "string"
                  },
                  {
                    "id": "4a2b0cd0-cf61-4fec-a052-da5a638f07f1",
                    "name": "setor",
                    "value": "={{ $('Get a row').item.json.vertical }}",
                    "type": "string"
                  },
                  {
                    "id": "ddaf11ca-09e2-4841-a8f9-78cf873e1bc4",
                    "name": "id_notion",
                    "value": "={{ $('Get a row').item.json.id_notion }}",
                    "type": "string"
                  },
                  {
                    "id": "d0c14406-305f-499f-9f52-2ef50df6bcec",
                    "name": "memoria_marujo",
                    "value": "=\"\"",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              224,
              176
            ],
            "id": "e5e21b3d-d0b6-4e13-b3b9-8ff2316e6f94",
            "name": "Edit Fields6"
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpBasicAuth",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {
                    "name": "mensagem",
                    "value": "={{ $json.chatInput }}"
                  },
                  {
                    "name": "nome",
                    "value": "={{ $json.nome }}"
                  },
                  {
                    "name": "cargo",
                    "value": "={{ $json.cargo }}"
                  },
                  {
                    "name": "setor",
                    "value": "={{ $json.setor }}"
                  },
                  {
                    "name": "id_notion",
                    "value": "={{ $json.id_notion }}"
                  },
                  {
                    "name": "telefone",
                    "value": "={{ $json.sessionId }}"
                  },
                  {
                    "name": "session_ID",
                    "value": "={{ \"whatsapp\".concat(\"|\", $('Webhook').item.json.body.data.key.id) }}"
                  },
                  {
                    "name": "pessoa",
                    "value": "={{ $('Get a row').item.json.nome }}"
                  },
                  {
                    "name": "id_pessoa",
                    "value": "={{ $('Get a row').item.json.id_notion }}\n"
                  },
                  {
                    "name": "memoria_marujo",
                    "value": "=\" \""
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              1008,
              352
            ],
            "id": "d65a06ad-c091-4294-9143-23cb5a5ade29",
            "name": "HTTP Request3",
            "credentials": {
              "httpBasicAuth": {
                "id": "tCmsIBEt9lhM1cnI",
                "name": "Unnamed credential"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "const base64String = $('Webhook').item.json.body.data.message.base64;  // or provide the raw base64 string here\n\n// Decode base64 and create binary data\nconst binaryData = Buffer.from(base64String, 'base64');\n\n// Return binary data to be used in the next node (like Write Binary File)\nreturn [\n  {\n    binary: {\n      data: {\n        data: binaryData.toString('base64'), // n8n expects base64 format in binary\n        mimeType: 'audio/mpeg',\n        fileName: 'output.mp3'\n      }\n    }\n  }\n];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              -1008,
              112
            ],
            "id": "4e61e497-7e20-4eb6-a343-0e7d3ab6d4f2",
            "name": "Code"
          },
          {
            "parameters": {
              "operation": "get",
              "tableId": "pessoas",
              "filters": {
                "conditions": [
                  {
                    "keyName": "telefone",
                    "keyValue": "={{ $('Webhook').item.json.body.data.key.remoteJid.split(\"@\").first() }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              -1712,
              32
            ],
            "id": "4dc0ea9f-2cc7-4f93-9e64-e2930b280a39",
            "name": "Get a row1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          }
        ],
        "connections": {
          "Merge": {
            "main": [
              [
                {
                  "node": "Get a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields1": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Switch1": {
            "main": [
              [
                {
                  "node": "Evolution API2",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Evolution API2",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Evolution API2",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "HTTP Request3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Webhook": {
            "main": [
              [
                {
                  "node": "Get a row1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields3": {
            "main": [
              [
                {
                  "node": "HTTP Request1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Evolution API2": {
            "main": [
              []
            ]
          },
          "RegistrarInput": {
            "main": [
              []
            ]
          },
          "Switch4": {
            "main": [
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Code",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "HTTP Request",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Convert to File",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Transcribe a recording": {
            "main": [
              [
                {
                  "node": "Edit Fields1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many database pages": {
            "main": [
              [
                {
                  "node": "Edit Fields3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Convert to File": {
            "main": [
              [
                {
                  "node": "Analyze image",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request": {
            "main": [
              [
                {
                  "node": "Edit Fields4",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields4": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 2
                }
              ]
            ]
          },
          "Analyze image": {
            "main": [
              [
                {
                  "node": "Edit Fields5",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields5": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 3
                }
              ]
            ]
          },
          "HTTP Request1": {
            "main": [
              []
            ]
          },
          "Enviar texto": {
            "main": [
              []
            ]
          },
          "Enviar imagem": {
            "main": [
              []
            ]
          },
          "Split Out1": {
            "main": [
              [
                {
                  "node": "Enviar imagem",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "If": {
            "main": [
              [
                {
                  "node": "Switch4",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate": {
            "main": [
              [
                {
                  "node": "If",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many users": {
            "main": [
              [
                {
                  "node": "Aggregate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get a row": {
            "main": [
              [
                {
                  "node": "RegistrarInput",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Edit Fields6",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields6": {
            "main": [
              [
                {
                  "node": "Switch1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request3": {
            "main": [
              [
                {
                  "node": "Enviar texto",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Split Out1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code": {
            "main": [
              [
                {
                  "node": "Transcribe a recording",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get a row1": {
            "main": [
              [
                {
                  "node": "Switch4",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-22T17:13:05.469Z",
            "id": 151,
            "workflowId": "lAdQBHUWkV3jXJoK",
            "versionId": "d8405cb5-c4c5-4d2c-8b9f-da156c00c49a",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          },
          {
            "createdAt": "2025-12-08T12:04:25.649Z",
            "id": 12,
            "workflowId": "lAdQBHUWkV3jXJoK",
            "versionId": "d8405cb5-c4c5-4d2c-8b9f-da156c00c49a",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-14T13:51:47.122Z",
      "createdAt": "2025-05-20T11:32:03.232Z",
      "id": "mSBWm33b9cNbreQo",
      "name": "Slides Retriever Tags",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "e7147c99-fdf4-41b3-8ec7-248f1784b54b",
            "responseMode": "lastNode",
            "responseData": "allEntries",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -976,
            -80
          ],
          "id": "a64d7ec4-9181-487a-9861-21fc64d3c1c4",
          "name": "Webhook",
          "webhookId": "e7147c99-fdf4-41b3-8ec7-248f1784b54b"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('When clicking ‘Execute workflow’').item.json.body.tags }}",
            "hasOutputParser": true,
            "options": {
              "systemMessage": "=Extraia palavras chave desse prompt que estejam na lista abaixo:\n{{ $json['Sub Classificação do Slide'] }}\n\nSua Resposta deve ser um array com esses itens (um item é obrigatório, mas o usuário pode ter solicitado mais e vc deve levar em consideração também).\n\"tags\" : [\"tag_1\", \"tag_2\"]"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.9,
          "position": [
            144,
            -240
          ],
          "id": "99bbf4c1-b143-4954-8943-bd50f4acf059",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4o-mini",
              "mode": "list",
              "cachedResultName": "gpt-4o-mini"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            64,
            32
          ],
          "id": "ee8a8eff-5217-4163-b12f-b0d9ec30b60a",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "schemaType": "manual",
            "inputSchema": "{\n      \"tags\": {\n          \"type\": \"array\",\n          \"items\": {\n              \"type\": \"string\"\n          }\n      }\n  }\n"
          },
          "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
          "typeVersion": 1.2,
          "position": [
            368,
            32
          ],
          "id": "dbfa35a7-c79e-46c4-94b4-5810ccc84b8d",
          "name": "Structured Output Parser"
        },
        {
          "parameters": {
            "curlImport": "",
            "httpVariantWarning": "",
            "method": "GET",
            "url": "=https://brpier.sharepoint.com/sites/BancodeSlides/_api/web/GetFileByServerRelativeUrl('/sites/BancodeSlides/Shared Documents/Geral/Classificação Slides.xlsx')/$value",
            "": "",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "microsoftSharePointOAuth2Api",
            "provideSslCertificates": false,
            "sendQuery": true,
            "specifyQuery": "keypair",
            "queryParameters": {
              "parameters": [
                {
                  "name": "Accept",
                  "value": "application/json;odata=verbose"
                }
              ]
            },
            "sendHeaders": false,
            "sendBody": false,
            "options": {},
            "infoMessage": ""
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            -528,
            -240
          ],
          "id": "63ef2243-09bf-4d0c-89e0-920dff6ecffc",
          "name": "Lista Classificação",
          "extendsCredential": "microsoftSharePointOAuth2Api",
          "credentials": {
            "microsoftSharePointOAuth2Api": {
              "id": "eVCY5tND91lf63SX",
              "name": "Microsoft SharePoint account"
            }
          }
        },
        {
          "parameters": {
            "operation": "xlsx",
            "options": {
              "headerRow": true,
              "range": "M1:M100"
            }
          },
          "type": "n8n-nodes-base.extractFromFile",
          "typeVersion": 1,
          "position": [
            -304,
            -240
          ],
          "id": "ed08ea68-f2f6-48cc-bca9-d7ed065e1e4f",
          "name": "Extract from File"
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "Sub Classificação do Slide"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            -80,
            -240
          ],
          "id": "8317af48-440e-42fe-9fad-93cf03740b60",
          "name": "Aggregate"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -976,
            -368
          ],
          "id": "694bf227-9812-4258-ad57-75441dda804d",
          "name": "When clicking ‘Execute workflow’"
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "embedding_slides",
            "limit": 5,
            "filterType": "string",
            "filterString": "=metadata->'tags' ?| array{{ \"['\" + $json.output.tags.map(t => t.trim().replace(/'/g, \"''\")).join(\"','\") + \"']\" }} AND id > 2070"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            528,
            -240
          ],
          "id": "30bc30da-f2e5-497d-9594-33a7f08e4200",
          "name": "Get many rows",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Lista Classificação",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Get many rows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Structured Output Parser": {
          "ai_outputParser": [
            [
              {
                "node": "AI Agent",
                "type": "ai_outputParser",
                "index": 0
              }
            ]
          ]
        },
        "Lista Classificação": {
          "main": [
            [
              {
                "node": "Extract from File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract from File": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When clicking ‘Execute workflow’": {
          "main": [
            [
              {
                "node": "Lista Classificação",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many rows": {
          "main": [
            []
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Webhook": [
          {
            "json": {
              "name": "First item",
              "code": 1
            }
          },
          {
            "json": {
              "name": "Second item",
              "code": 2
            }
          }
        ],
        "When clicking ‘Execute workflow’": [
          {
            "json": {
              "headers": {
                "host": "primary-production-0ad4f.up.railway.app",
                "user-agent": "axios/1.8.3",
                "content-length": "24",
                "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",
                "accept-encoding": "gzip, compress, deflate, br",
                "content-type": "application/json",
                "x-forwarded-for": "162.220.232.4",
                "x-forwarded-host": "primary-production-0ad4f.up.railway.app",
                "x-forwarded-proto": "https",
                "x-railway-edge": "railway/us-west1",
                "x-railway-request-id": "FVNzahDARlWaE4fIz8YAag",
                "x-real-ip": "162.220.232.4",
                "x-request-start": "1751401719231"
              },
              "params": {},
              "query": {},
              "body": {
                "tags": "endividamento"
              },
              "webhookUrl": "https://primary-production-0ad4f.up.railway.app/webhook/e7147c99-fdf4-41b3-8ec7-248f1784b54b",
              "executionMode": "production"
            }
          }
        ]
      },
      "versionId": "dd03550c-87f0-427e-864c-748881b0692b",
      "activeVersionId": "20d37c24-c6b7-48a2-86d4-f6999d9bc8f0",
      "versionCounter": 51,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-05-20T11:32:03.232Z",
          "createdAt": "2025-05-20T11:32:03.232Z",
          "role": "workflow:owner",
          "workflowId": "mSBWm33b9cNbreQo",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-03-25T17:28:44.590Z",
          "createdAt": "2025-03-25T17:28:44.590Z",
          "id": "SGLcCfFPtH9ESbyP",
          "name": "Marujo"
        },
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "20d37c24-c6b7-48a2-86d4-f6999d9bc8f0",
        "workflowId": "mSBWm33b9cNbreQo",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "e7147c99-fdf4-41b3-8ec7-248f1784b54b",
              "responseMode": "lastNode",
              "responseData": "allEntries",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              -980,
              -80
            ],
            "id": "a64d7ec4-9181-487a-9861-21fc64d3c1c4",
            "name": "Webhook",
            "webhookId": "e7147c99-fdf4-41b3-8ec7-248f1784b54b"
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $('When clicking ‘Execute workflow’').item.json.body.tags }}",
              "hasOutputParser": true,
              "options": {
                "systemMessage": "=Extraia palavras chave desse prompt que estejam na lista abaixo:\n{{ $json['Sub Classificação do Slide'] }}\n\nSua Resposta deve ser um array com esses itens (um item é obrigatório, mas o usuário pode ter solicitado mais e vc deve levar em consideração também).\n\"tags\" : [\"tag_1\", \"tag_2\"]"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.9,
            "position": [
              140,
              -240
            ],
            "id": "99bbf4c1-b143-4954-8943-bd50f4acf059",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-4o-mini",
                "mode": "list",
                "cachedResultName": "gpt-4o-mini"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              60,
              20
            ],
            "id": "ee8a8eff-5217-4163-b12f-b0d9ec30b60a",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "schemaType": "manual",
              "inputSchema": "{\n      \"tags\": {\n          \"type\": \"array\",\n          \"items\": {\n              \"type\": \"string\"\n          }\n      }\n  }\n"
            },
            "type": "@n8n/n8n-nodes-langchain.outputParserStructured",
            "typeVersion": 1.2,
            "position": [
              360,
              20
            ],
            "id": "dbfa35a7-c79e-46c4-94b4-5810ccc84b8d",
            "name": "Structured Output Parser"
          },
          {
            "parameters": {
              "curlImport": "",
              "httpVariantWarning": "",
              "method": "GET",
              "url": "=https://brpier.sharepoint.com/sites/BancodeSlides/_api/web/GetFileByServerRelativeUrl('/sites/BancodeSlides/Shared Documents/Geral/Classificação Slides.xlsx')/$value",
              "": "",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "microsoftSharePointOAuth2Api",
              "provideSslCertificates": false,
              "sendQuery": true,
              "specifyQuery": "keypair",
              "queryParameters": {
                "parameters": [
                  {
                    "name": "Accept",
                    "value": "application/json;odata=verbose"
                  }
                ]
              },
              "sendHeaders": false,
              "sendBody": false,
              "options": {},
              "infoMessage": ""
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              -520,
              -240
            ],
            "id": "63ef2243-09bf-4d0c-89e0-920dff6ecffc",
            "name": "Lista Classificação",
            "extendsCredential": "microsoftSharePointOAuth2Api",
            "credentials": {
              "microsoftSharePointOAuth2Api": {
                "id": "eVCY5tND91lf63SX",
                "name": "Microsoft SharePoint account"
              }
            }
          },
          {
            "parameters": {
              "operation": "xlsx",
              "options": {
                "headerRow": true,
                "range": "M1:M100"
              }
            },
            "type": "n8n-nodes-base.extractFromFile",
            "typeVersion": 1,
            "position": [
              -300,
              -240
            ],
            "id": "ed08ea68-f2f6-48cc-bca9-d7ed065e1e4f",
            "name": "Extract from File"
          },
          {
            "parameters": {
              "fieldsToAggregate": {
                "fieldToAggregate": [
                  {
                    "fieldToAggregate": "Sub Classificação do Slide"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              -80,
              -240
            ],
            "id": "8317af48-440e-42fe-9fad-93cf03740b60",
            "name": "Aggregate"
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.manualTrigger",
            "typeVersion": 1,
            "position": [
              -980,
              -360
            ],
            "id": "694bf227-9812-4258-ad57-75441dda804d",
            "name": "When clicking ‘Execute workflow’"
          },
          {
            "parameters": {
              "operation": "getAll",
              "tableId": "embedding_slides",
              "limit": 5,
              "filterType": "string",
              "filterString": "=metadata->'tags' ?| array{{ \"['\" + $json.output.tags.map(t => t.trim().replace(/'/g, \"''\")).join(\"','\") + \"']\" }} AND id > 2070"
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              520,
              -240
            ],
            "id": "30bc30da-f2e5-497d-9594-33a7f08e4200",
            "name": "Get many rows",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          }
        ],
        "connections": {
          "Webhook": {
            "main": [
              [
                {
                  "node": "Lista Classificação",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent": {
            "main": [
              [
                {
                  "node": "Get many rows",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Structured Output Parser": {
            "ai_outputParser": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_outputParser",
                  "index": 0
                }
              ]
            ]
          },
          "Lista Classificação": {
            "main": [
              [
                {
                  "node": "Extract from File",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Extract from File": {
            "main": [
              [
                {
                  "node": "Aggregate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "When clicking ‘Execute workflow’": {
            "main": [
              [
                {
                  "node": "Lista Classificação",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many rows": {
            "main": [
              []
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-07-01T20:53:16.372Z",
            "id": 8,
            "workflowId": "mSBWm33b9cNbreQo",
            "versionId": "20d37c24-c6b7-48a2-86d4-f6999d9bc8f0",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-21T18:56:14.151Z",
      "createdAt": "2025-06-05T11:33:44.658Z",
      "id": "U434SINQUpYFGqbx",
      "name": "DataLake Agent",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.chatInput }}",
            "options": {
              "systemMessage": "=Você é um assistente especializado na exploração de dados no datalake interno, utilizando SQL. Seu principal objetivo é ajudar os usuários a realizar análises, consultando e recuperando dados relevantes.\n\nVocê tem à sua disposição as seguintes ferramentas:\n- Vector Store: Para descobrir informações sobre os dados disponíveis no datalake. Essa tool deve ser utilizada *SEMPRE* antes de qualquer query no datalake\n- Calculadora: Para executar cálculos precisos sempre que necessário para concluir uma análise.\n- Acesso ao Datalake: Você pode enviar consultas em SQL compatíveis com o Google BigQuery para extrair os dados necessários. Tome cuidado para escrever as querys de forma completa, inclusive indique o dataset junto ao nome de cada tabela para ser o mais fiel possível.\n\nExplore esses recursos e forneça respostas completas e bem fundamentadas, sempre que possível.\nCaso o usuário questione por algo, sempre retorne o dado mais atual. Então modele suas requisições para que o retorno seja dessa forma, mas não basei-se na data atual, procure fazer reordenar e limitar a consulta para evitar retornos vazios. Da mesma forma, procure utilizar formatos LIKE \"%xxx%\" no lugar de igualidades, pode ser que caractéres especiais ou acentos nos causam problemas, poderíamos então fazer a query LIKE \"%\" OR LIKE \"%\".\nCaso encontre erros nas requisições, uma estratégia é fazer uma query que retorna algumas linhas para entender como os dados aparecem, ao utilizar essa estratégia, pense em limitar também os retornos aplicando leves filtros em descrições ou datas para que os retorno faça sentido, por exemplo, se você estiver utilizando um filtro em uma tabela categoria, por que não descobrir  os dados fazendo um DISTINCT(categoria) antes? me parece uma boa idéia.\nAlém disso, se form utilizar filtros comparando strings tente ao máximo homogenizar a consulta por exemplo: \n- Usuário: subsetor de Energia Elétrica\n- O filtro na sua consulta: UPPER(subsetor) LIKE \"%ENERGIA ELÉTRICA%\" OR UPPER(subsetor) LIKE \"%ENERGIA ELETRICA%\"\n-- Note que o caractere especial pode opu não estar na base de dados.\n\nOs dados podem ser apresentados de formas diferentes, tome nota das descrições de cada campo. Por exemplo a tabela cdi que é diarizada, pode ser que o usuário queira o valor mensal ou anual dela, então você deve realizar os calculos necessários para isso.\n\nImportante:\n- Retorne tua query em um linha. Ela sera utilizada pelo usuário.\n- Para o calculo do cdi mensalizado e anualizado, uitlize a seguinte forma quando requisitado: EXP(SUM(LN(1 + VALOR))) - 1. NÃO DIVIDA O VALOR POR 100!\n- Quando for solicitado algo referente a índices, garanta que a tabela selecionada para o cálculo se refere ao índice solicitado. Se não houver uma tabela com ele ou se ficar na dúvida, diga que não tem essa informação ainda e sugira ao usuário falar com o time de dados\n- Foque sempre que possível em usar a schema data-lake-interno.economia\n\nExemplo do formato da resposta:\n{\n   \"mensagem\": \"A taxa do CDI mais recente que encontrei é 1.6% em 2025-03-01.\",\n   \"query\": \"SELECT * FROM `economia.cdi` ORDER BY data_referencia DESC LIMIT 1\"\n}"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.8,
          "position": [
            880,
            -80
          ],
          "id": "a7af51d2-5bbc-4766-9935-e11974c50064",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.sessionId }}"
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            864,
            272
          ],
          "id": "35bd1c0b-a553-4190-ace6-2fa43370df18",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "public": true,
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.1,
          "position": [
            384,
            48
          ],
          "id": "8027665c-f1d5-4d48-8ea3-28144cc9e352",
          "name": "When chat message received",
          "webhookId": "5aaa0ecb-87b1-416d-912c-850b6cda2c76"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "88d44756-a8d8-40be-a4c1-7c94d7cdb47d",
                  "name": "sessionId",
                  "value": "={{ $json.body.sessionId }}",
                  "type": "string"
                },
                {
                  "id": "85441c09-637c-40f2-9c9b-e0393b89cf04",
                  "name": "chatInput",
                  "value": "={{ $json.body.chatInput }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            384,
            -176
          ],
          "id": "8af82112-c5d0-4ddf-a3bb-751804045239",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "tabelas_do_datalake",
            "toolDescription": "Utilize essa ferramenta para conhecer mais sobre os dados no datalake.\nNele você consegue consultar as tabelas e colunas de cada uma delas, bem como os títulos e suas descrições.",
            "tableName": {
              "__rl": true,
              "value": "rpc/match_documents_datalake",
              "mode": "list",
              "cachedResultName": "rpc/match_documents_datalake"
            },
            "topK": 10,
            "options": {
              "queryName": "match_documents_datalake"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1.1,
          "position": [
            1264,
            384
          ],
          "id": "bb75e7b6-1ff8-4df6-83cc-2f5c0976f4d2",
          "name": "DataLake Vector Store",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            1408,
            544
          ],
          "id": "67fb9f28-43f6-4ae7-b0a5-482c90840e0d",
          "name": "Embeddings 3-small",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.toolCalculator",
          "typeVersion": 1,
          "position": [
            1360,
            160
          ],
          "id": "8b5125b9-9aa5-46fa-ae6e-ff3e31c35edf",
          "name": "Calculator"
        },
        {
          "parameters": {
            "projectId": {
              "__rl": true,
              "value": "data-lake-interno",
              "mode": "list",
              "cachedResultName": "Data Lake Interno",
              "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
            },
            "sqlQuery": "{{ $fromAI(\"sql_query\", \"SQL Query\") }}",
            "options": {}
          },
          "type": "n8n-nodes-base.googleBigQueryTool",
          "typeVersion": 2.1,
          "position": [
            1104,
            320
          ],
          "id": "9a0bead1-44c8-44b7-a6b1-954428f9c0c9",
          "name": "Google BigQuery1",
          "credentials": {
            "googleBigQueryOAuth2Api": {
              "id": "XUgNL8mJfmuwKJRU",
              "name": "Google BigQuery account"
            }
          }
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "1a015d6f-d7e3-49ab-b3ee-2e8107ff149a",
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            112,
            -176
          ],
          "id": "624e63af-8fdb-4eac-b36c-0476bb806a42",
          "name": "Webhook",
          "webhookId": "1a015d6f-d7e3-49ab-b3ee-2e8107ff149a"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            768,
            160
          ],
          "id": "26e90dd6-ec97-4cc2-b8cf-917fa45ae242",
          "name": "OpenAI",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "text": "={{ $json.output }}",
            "schemaType": "fromJson",
            "jsonSchemaExample": "{\n\t\"mensagem\": \"A taxa Selic mais recente que encontrei é 14,9% ao ano (valor anual) e 0,05513% ao dia (valor diário), com referência em 2025-07-25\",\n\t\"query\": \"SELECT VALOR_DIARIO, VALOR_ANUAL, DATA_REFERENCIA FROM `data-lake-interno.economia.selic` ORDER BY DATA_REFERENCIA DESC LIMIT 1\"\n}",
            "options": {
              "systemPromptTemplate": "You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value.\nNEVER EVER RETURN LINKS IN THE MESSAGE VARIABLE"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1.2,
          "position": [
            1328,
            -80
          ],
          "id": "f7a8d2b4-9041-4ea0-8b58-55e72cd1f7c1",
          "name": "Information Extractor"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "={\n  \"mensagem\": {{ JSON.stringify($('Information Extractor').item.json.output.mensagem) }},\n  \"query_url\": \"{{ $json.data }}\"\n}\n",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2224,
            -224
          ],
          "id": "84ea69c4-b93d-4c3a-8229-570a1b81b54c",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "url": "http://tinyurl.com/api-create.php",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "url",
                  "value": "=https://metabase-production-3fc5.up.railway.app/question#{{ $json.encoded_data }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1920,
            -80
          ],
          "id": "b8b02138-cb2e-4b0f-b693-ee0c8bf7c452",
          "name": "HTTP Request",
          "credentials": {
            "httpBasicAuth": {
              "id": "tCmsIBEt9lhM1cnI",
              "name": "Unnamed credential"
            },
            "httpBearerAuth": {
              "id": "xkpB5I1dSRgr610K",
              "name": "tinyURL"
            }
          },
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "mode": "raw",
            "jsonOutput": "={\n  \"mensagem\": \"{{ $('Information Extractor').item.json.output.mensagem }}\",\n  \"query_url\": \"https://metabase-production-3fc5.up.railway.app/question#{{ $json.encoded_data }}\"\n}\n",
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2224,
            64
          ],
          "id": "94b2e16b-583e-4ad0-bbd0-7caa260c47d0",
          "name": "Edit Fields_OnError"
        },
        {
          "parameters": {
            "jsCode": "const input = $input.item.json;\n\nif (!input.output || !input.output.query) {\n  throw new Error(\"A chave 'query' não foi encontrada no item de entrada.\");\n}\n\nconst inputQuery = input.output.query;\n\nconst jsonData = {\n  dataset_query: {\n    database: 2,\n    type: \"native\",\n    native: {\n      query: inputQuery,\n      \"template-tags\": {}\n    }\n  },\n  display: \"table\",\n  parameters: [],\n  visualization_setting: {},\n  type: \"question\"\n};\n\nconst jsonString = JSON.stringify(jsonData);\nconst encodedData = Buffer.from(jsonString).toString(\"base64\").replace(/=+$/, \"\");\n\nreturn [\n  {\n    json: {\n      encoded_data: encodedData\n    }\n  }\n];\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1680,
            -80
          ],
          "id": "45116325-01ca-45f2-a646-93f72da2c12c",
          "name": "Code in JavaScript"
        }
      ],
      "connections": {
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "DataLake Vector Store": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings 3-small": {
          "ai_embedding": [
            [
              {
                "node": "DataLake Vector Store",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Calculator": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google BigQuery1": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Information Extractor",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Information Extractor",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Information Extractor": {
          "main": [
            [
              {
                "node": "Code in JavaScript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Edit Fields_OnError",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "availableInMCP": false
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "9382025e-9621-473c-a86d-1ea19aa14124",
      "activeVersionId": "9382025e-9621-473c-a86d-1ea19aa14124",
      "versionCounter": 119,
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-06-05T11:33:44.658Z",
          "createdAt": "2025-06-05T11:33:44.658Z",
          "role": "workflow:owner",
          "workflowId": "U434SINQUpYFGqbx",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-03-25T17:28:44.590Z",
          "createdAt": "2025-03-25T17:28:44.590Z",
          "id": "SGLcCfFPtH9ESbyP",
          "name": "Marujo"
        }
      ],
      "activeVersion": {
        "updatedAt": "2026-01-13T17:45:16.149Z",
        "createdAt": "2026-01-13T17:45:10.774Z",
        "versionId": "9382025e-9621-473c-a86d-1ea19aa14124",
        "workflowId": "U434SINQUpYFGqbx",
        "nodes": [
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $json.chatInput }}",
              "options": {
                "systemMessage": "=Você é um assistente especializado na exploração de dados no datalake interno, utilizando SQL. Seu principal objetivo é ajudar os usuários a realizar análises, consultando e recuperando dados relevantes.\n\nVocê tem à sua disposição as seguintes ferramentas:\n- Vector Store: Para descobrir informações sobre os dados disponíveis no datalake. Essa tool deve ser utilizada *SEMPRE* antes de qualquer query no datalake\n- Calculadora: Para executar cálculos precisos sempre que necessário para concluir uma análise.\n- Acesso ao Datalake: Você pode enviar consultas em SQL compatíveis com o Google BigQuery para extrair os dados necessários. Tome cuidado para escrever as querys de forma completa, inclusive indique o dataset junto ao nome de cada tabela para ser o mais fiel possível.\n\nExplore esses recursos e forneça respostas completas e bem fundamentadas, sempre que possível.\nCaso o usuário questione por algo, sempre retorne o dado mais atual. Então modele suas requisições para que o retorno seja dessa forma, mas não basei-se na data atual, procure fazer reordenar e limitar a consulta para evitar retornos vazios. Da mesma forma, procure utilizar formatos LIKE \"%xxx%\" no lugar de igualidades, pode ser que caractéres especiais ou acentos nos causam problemas, poderíamos então fazer a query LIKE \"%\" OR LIKE \"%\".\nCaso encontre erros nas requisições, uma estratégia é fazer uma query que retorna algumas linhas para entender como os dados aparecem, ao utilizar essa estratégia, pense em limitar também os retornos aplicando leves filtros em descrições ou datas para que os retorno faça sentido, por exemplo, se você estiver utilizando um filtro em uma tabela categoria, por que não descobrir  os dados fazendo um DISTINCT(categoria) antes? me parece uma boa idéia.\nAlém disso, se form utilizar filtros comparando strings tente ao máximo homogenizar a consulta por exemplo: \n- Usuário: subsetor de Energia Elétrica\n- O filtro na sua consulta: UPPER(subsetor) LIKE \"%ENERGIA ELÉTRICA%\" OR UPPER(subsetor) LIKE \"%ENERGIA ELETRICA%\"\n-- Note que o caractere especial pode opu não estar na base de dados.\n\nOs dados podem ser apresentados de formas diferentes, tome nota das descrições de cada campo. Por exemplo a tabela cdi que é diarizada, pode ser que o usuário queira o valor mensal ou anual dela, então você deve realizar os calculos necessários para isso.\n\nImportante:\n- Retorne tua query em um linha. Ela sera utilizada pelo usuário.\n- Para o calculo do cdi mensalizado e anualizado, uitlize a seguinte forma quando requisitado: EXP(SUM(LN(1 + VALOR))) - 1. NÃO DIVIDA O VALOR POR 100!\n- Quando for solicitado algo referente a índices, garanta que a tabela selecionada para o cálculo se refere ao índice solicitado. Se não houver uma tabela com ele ou se ficar na dúvida, diga que não tem essa informação ainda e sugira ao usuário falar com o time de dados\n- Foque sempre que possível em usar a schema data-lake-interno.economia\n\nExemplo do formato da resposta:\n{\n   \"mensagem\": \"A taxa do CDI mais recente que encontrei é 1.6% em 2025-03-01.\",\n   \"query\": \"SELECT * FROM `economia.cdi` ORDER BY data_referencia DESC LIMIT 1\"\n}"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.8,
            "position": [
              880,
              -80
            ],
            "id": "a7af51d2-5bbc-4766-9935-e11974c50064",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "sessionIdType": "customKey",
              "sessionKey": "={{ $json.sessionId }}"
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              864,
              272
            ],
            "id": "35bd1c0b-a553-4190-ace6-2fa43370df18",
            "name": "Simple Memory"
          },
          {
            "parameters": {
              "public": true,
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.1,
            "position": [
              384,
              48
            ],
            "id": "8027665c-f1d5-4d48-8ea3-28144cc9e352",
            "name": "When chat message received",
            "webhookId": "5aaa0ecb-87b1-416d-912c-850b6cda2c76"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "88d44756-a8d8-40be-a4c1-7c94d7cdb47d",
                    "name": "sessionId",
                    "value": "={{ $json.body.sessionId }}",
                    "type": "string"
                  },
                  {
                    "id": "85441c09-637c-40f2-9c9b-e0393b89cf04",
                    "name": "chatInput",
                    "value": "={{ $json.body.chatInput }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              384,
              -176
            ],
            "id": "8af82112-c5d0-4ddf-a3bb-751804045239",
            "name": "Edit Fields"
          },
          {
            "parameters": {
              "mode": "retrieve-as-tool",
              "toolName": "tabelas_do_datalake",
              "toolDescription": "Utilize essa ferramenta para conhecer mais sobre os dados no datalake.\nNele você consegue consultar as tabelas e colunas de cada uma delas, bem como os títulos e suas descrições.",
              "tableName": {
                "__rl": true,
                "value": "rpc/match_documents_datalake",
                "mode": "list",
                "cachedResultName": "rpc/match_documents_datalake"
              },
              "topK": 10,
              "options": {
                "queryName": "match_documents_datalake"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1.1,
            "position": [
              1264,
              384
            ],
            "id": "bb75e7b6-1ff8-4df6-83cc-2f5c0976f4d2",
            "name": "DataLake Vector Store",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              1408,
              544
            ],
            "id": "67fb9f28-43f6-4ae7-b0a5-482c90840e0d",
            "name": "Embeddings 3-small",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {},
            "type": "@n8n/n8n-nodes-langchain.toolCalculator",
            "typeVersion": 1,
            "position": [
              1360,
              160
            ],
            "id": "8b5125b9-9aa5-46fa-ae6e-ff3e31c35edf",
            "name": "Calculator"
          },
          {
            "parameters": {
              "projectId": {
                "__rl": true,
                "value": "data-lake-interno",
                "mode": "list",
                "cachedResultName": "Data Lake Interno",
                "cachedResultUrl": "https://console.cloud.google.com/bigquery?project=data-lake-interno"
              },
              "sqlQuery": "{{ $fromAI(\"sql_query\", \"SQL Query\") }}",
              "options": {}
            },
            "type": "n8n-nodes-base.googleBigQueryTool",
            "typeVersion": 2.1,
            "position": [
              1104,
              320
            ],
            "id": "9a0bead1-44c8-44b7-a6b1-954428f9c0c9",
            "name": "Google BigQuery1",
            "credentials": {
              "googleBigQueryOAuth2Api": {
                "id": "XUgNL8mJfmuwKJRU",
                "name": "Google BigQuery account"
              }
            }
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "1a015d6f-d7e3-49ab-b3ee-2e8107ff149a",
              "responseMode": "lastNode",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              112,
              -176
            ],
            "id": "624e63af-8fdb-4eac-b36c-0476bb806a42",
            "name": "Webhook",
            "webhookId": "1a015d6f-d7e3-49ab-b3ee-2e8107ff149a"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-4.1",
                "mode": "list",
                "cachedResultName": "gpt-4.1"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              768,
              160
            ],
            "id": "26e90dd6-ec97-4cc2-b8cf-917fa45ae242",
            "name": "OpenAI",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "text": "={{ $json.output }}",
              "schemaType": "fromJson",
              "jsonSchemaExample": "{\n\t\"mensagem\": \"A taxa Selic mais recente que encontrei é 14,9% ao ano (valor anual) e 0,05513% ao dia (valor diário), com referência em 2025-07-25\",\n\t\"query\": \"SELECT VALOR_DIARIO, VALOR_ANUAL, DATA_REFERENCIA FROM `data-lake-interno.economia.selic` ORDER BY DATA_REFERENCIA DESC LIMIT 1\"\n}",
              "options": {
                "systemPromptTemplate": "You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value.\nNEVER EVER RETURN LINKS IN THE MESSAGE VARIABLE"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.informationExtractor",
            "typeVersion": 1.2,
            "position": [
              1328,
              -80
            ],
            "id": "f7a8d2b4-9041-4ea0-8b58-55e72cd1f7c1",
            "name": "Information Extractor"
          },
          {
            "parameters": {
              "mode": "raw",
              "jsonOutput": "={\n  \"mensagem\": {{ JSON.stringify($('Information Extractor').item.json.output.mensagem) }},\n  \"query_url\": \"{{ $json.data }}\"\n}\n",
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              2224,
              -224
            ],
            "id": "84ea69c4-b93d-4c3a-8229-570a1b81b54c",
            "name": "Edit Fields1"
          },
          {
            "parameters": {
              "url": "http://tinyurl.com/api-create.php",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpBearerAuth",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {
                    "name": "url",
                    "value": "=https://metabase-production-3fc5.up.railway.app/question#{{ $json.encoded_data }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              1920,
              -80
            ],
            "id": "b8b02138-cb2e-4b0f-b693-ee0c8bf7c452",
            "name": "HTTP Request",
            "credentials": {
              "httpBasicAuth": {
                "id": "tCmsIBEt9lhM1cnI",
                "name": "Unnamed credential"
              },
              "httpBearerAuth": {
                "id": "xkpB5I1dSRgr610K",
                "name": "tinyURL"
              }
            },
            "onError": "continueErrorOutput"
          },
          {
            "parameters": {
              "mode": "raw",
              "jsonOutput": "={\n  \"mensagem\": \"{{ $('Information Extractor').item.json.output.mensagem }}\",\n  \"query_url\": \"https://metabase-production-3fc5.up.railway.app/question#{{ $json.encoded_data }}\"\n}\n",
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              2224,
              64
            ],
            "id": "94b2e16b-583e-4ad0-bbd0-7caa260c47d0",
            "name": "Edit Fields_OnError"
          },
          {
            "parameters": {
              "jsCode": "const input = $input.item.json;\n\nif (!input.output || !input.output.query) {\n  throw new Error(\"A chave 'query' não foi encontrada no item de entrada.\");\n}\n\nconst inputQuery = input.output.query;\n\nconst jsonData = {\n  dataset_query: {\n    database: 2,\n    type: \"native\",\n    native: {\n      query: inputQuery,\n      \"template-tags\": {}\n    }\n  },\n  display: \"table\",\n  parameters: [],\n  visualization_setting: {},\n  type: \"question\"\n};\n\nconst jsonString = JSON.stringify(jsonData);\nconst encodedData = Buffer.from(jsonString).toString(\"base64\").replace(/=+$/, \"\");\n\nreturn [\n  {\n    json: {\n      encoded_data: encodedData\n    }\n  }\n];\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1680,
              -80
            ],
            "id": "45116325-01ca-45f2-a646-93f72da2c12c",
            "name": "Code in JavaScript"
          }
        ],
        "connections": {
          "Simple Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "When chat message received": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "DataLake Vector Store": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings 3-small": {
            "ai_embedding": [
              [
                {
                  "node": "DataLake Vector Store",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Calculator": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Google BigQuery1": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Webhook": {
            "main": [
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                },
                {
                  "node": "Information Extractor",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent": {
            "main": [
              [
                {
                  "node": "Information Extractor",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Information Extractor": {
            "main": [
              [
                {
                  "node": "Code in JavaScript",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request": {
            "main": [
              [
                {
                  "node": "Edit Fields1",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Edit Fields_OnError",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript": {
            "main": [
              [
                {
                  "node": "HTTP Request",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 9382025e",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-21T18:54:35.096Z",
            "id": 142,
            "workflowId": "U434SINQUpYFGqbx",
            "versionId": "9382025e-9621-473c-a86d-1ea19aa14124",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          },
          {
            "createdAt": "2026-01-21T18:56:14.300Z",
            "id": 145,
            "workflowId": "U434SINQUpYFGqbx",
            "versionId": "9382025e-9621-473c-a86d-1ea19aa14124",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          },
          {
            "createdAt": "2026-01-13T17:45:16.121Z",
            "id": 92,
            "workflowId": "U434SINQUpYFGqbx",
            "versionId": "9382025e-9621-473c-a86d-1ea19aa14124",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-30T17:50:58.961Z",
      "createdAt": "2025-06-28T20:43:54.723Z",
      "id": "Hnf52KRQWgkwPSs4",
      "name": "Marujo - backend",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
            "authentication": "basicAuth",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -480,
            448
          ],
          "id": "87d5ce81-2715-45cb-ba55-268b6ead0499",
          "name": "Webhook",
          "webhookId": "8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
          "credentials": {
            "httpBasicAuth": {
              "id": "tCmsIBEt9lhM1cnI",
              "name": "Unnamed credential"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('Webhook').item.json.query.mensagem }}",
            "options": {
              "systemMessage": "=# Você é o Marujo, assistente da Píer Partners. O dia e hora dessa requisição é {{ $now.toISO() }}\n\n# Você está falando com {{ $('Webhook').item.json.query.nome }}. O cargo dessa pessoa é {{ $('Webhook').item.json.query.cargo }} do time de {{ $('Webhook').item.json.query.setor }}. O ID dessa pessoa no notion é {{ $('Webhook').item.json.query.id_notion }}. Leve em consideração o contexto passado dessa pessoa {{ $('Webhook').item.json.query.memoria_marujo }}\n\n# Quando for questionado sobre buscas:\n- Use a ferramenta SerpAPI se forem simples, como cotações e links\n- Use a ferramenta Perplexity se forem mais complexas, como descrever alguma coisa e saber mais sobre alguma coisa\n\n# Quando for perguntado sobre como fazer alguma você deve:\n1. buscas na base de conhecimento.\n2. se não encontrar uma resposta ali fazer uma busca usando a serpapi ou a perplexity\n3. sempre forneça as fontes usas.\n\n# Você possui ferramentas para interagir com o Notion, com as funcionalidades:\n- Listar projetos\n- Listar taregas\n- Criar tarefas\nSempre que for criar uma tarefa você deve alocar o usuário como responsável pelo seu nome usando a relação com c6b4e8ff-ed22-4259-b5e4-6e190107c597. Sempre liste projetos antes de criar a tarefa. Veja em qual o usuário está alocado, ou qual faz mais sentido pela Área. Se ficar em dúvida sobre algum campo obrigatório, confirme com o usuário.\nVocê não tem acesso à edição de uma task. Não se ofereça para alterar campos após criá-las.\n\n# Quando pedido quanto a alocação de horas em projetos use as ferramentas do supabase abaixo para as suas determinadas tarefas:\n- Criar alocação: Usado para criar uma nova alocação de horas da pessoa em determinado projeto conforme o prompt do usuário\n- Deletar alocação: Usado para deletar uma nova alocação de horas da pessoa em determinado projeto conforme o prompt do usuário\n- Buscar alocações dia: Realiza uma busca dentro do banco para as alocações no dia pedido no prompt\n- Buscar alocações projeto: Realiza uma busca dentro do banco para as alocações para o projeto pedido no prompt\n\n\nOs projetos podem vir escritos de forma diferente, então é necessário que realize um match que melhor combina com o pedido dentre a lista de projeto, é é obrigatório que na criação, busca e deleção você coloque o nome como listado, caso não encontre um match satisfatorio retorne ao usuário que não foi possível encontrar.\nOs formatos para dias sempre estarão nessas 3 ferramentas deve ser usado YYYY-MM-DD.\nCaso no prompt não seja especificado data, somente o dia da semana, considere sempre de forma retroativa, ou seja ultima ocorrencia desse dia.\nAntes de salvar mande uma mensagem de confirmação com as alterações e criações a serem realizadas.\nLista de projetos:\n{{ $json.data[1].resultado }}\n\n# Quando for perguntado sobre as informações de alguma reunião que aconteceu e foi gravada:\n- Use a ferramenta Reunioes Pinhao para buscar informações de data, partcipantes, transcrição, anotações e resumo da reunião.\n- Jamais invente prazos que não sejam explicitamente definidos entre os participantes e se restrinja a fornecer informações extremamente objetivas sobre a reunião, sem extrapolar interpretações.\n\n# Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes nos campos url_markdown junto do nome do arquivo.\n\n# Quando questionado sobre reuniões ou algo realacaionado ao Google Agenda, retorne para o usuário um aviso dizendo que a maneira mais fácil de saber as suas informações sobre agenda é acessando o Google Agenda.\n\n# Formate sua mensagem de modo adequado para exibição no WhatsApp.\n\n# Use linguagem adequada para uma consultoria financeira mais despojada, não muito formal. Adicione alguns termos de marujo exclusivamente nas saudações, sem poluir a fala.\n\n# Se retornar uma imagem, retorne no máximo uma URL\n\n# A sua saída final nunca deve ser feita utilizando uma chave chamada output\n\n# Se julgar que alguma das informações passadas pelo usuário for importante para mensagens futuras, use a tool \"RegistroMemoria\".\n\n\n# REGRAS PARA SUA RESPOSTA!\n## Sempre que for indicar um slide é obrigatório que indique a url desse slide image_url e também a referencia do arquivo que é o metadado url_fileName. Para que fique claro, deve ser retornado duas urls... Uma do google storage com o slide, e outra do sharepoint com o arquivo. Não altere a url! (o parâmetro nav deve ser mantido)\n## Retorne unicamente um arquivo json com o seguinte formato\n## Caso utilize a tool de slides, não é necessário declarar a url também na mensagem, ela será enviada direto para o usuário e os links serão utilizados para mostrar a foto. Então essa mensagem é um texto complementar e não deve conter nenhum url nela.\n## Caso você tenha recebido mais slides e eles façam sentido para a necessidade do usuário, crie outros objetos para responder o usuário.\n## Caso você faça uso do agente datalake, ele pode te retornar uma url de referência, é importante que você retorne ela ao usuário caso ele queira explorar os dados de origem da sua resposta. ATENÇÃO esse é o único caso em que a url deve ser retornada junto da mensagem no campo url_fileName.\n## Caso você utilize a ferramenta do DataLake, você deve retornar uma mensagem completa a ser encaminhada como resposta ao usuário.\n## No campo \"ferramenta\" do json salve as ferramentas utilizadas.\n\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"files\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"image_urls\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        },\n        \"url_fileName\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    },\n    \"message\": {\n      \"type\": \"string\"\n    },\n    \"ferramentas\": {\n      \"type\": \"string\"\n    }\n  }\n}\n",
              "returnIntermediateSteps": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.8,
          "position": [
            704,
            464
          ],
          "id": "bbcf3c16-36be-4da9-8ce0-d184a6853269",
          "name": "AI Agent",
          "retryOnFail": true,
          "maxTries": 2,
          "onError": "continueErrorOutput"
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $('Webhook').item.json.query.telefone }}",
            "contextWindowLength": 10
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            160,
            960
          ],
          "id": "c4659126-dd72-452f-a684-3fe7bf0b36ac",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "toolDescription": "Conector da perplexity. Faz buscas complexas e pesquisas na internet passando o tópico que deve ser pesquisado. Quando usar essa ferramenta sempre cite a fonte utilizada caso disponível.",
            "method": "POST",
            "url": "https://api.perplexity.ai/chat/completions",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "{\n  \"temperature\": 0.2,\n  \"top_p\": 0.9,\n  \"return_images\": false,\n  \"return_related_questions\": false,\n  \"top_k\": 0,\n  \"stream\": false,\n  \"presence_penalty\": 0,\n  \"frequency_penalty\": 1,\n  \"web_search_options\": {\n    \"search_context_size\": \"low\"\n  },\n  \"model\": \"sonar\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"{message}\"\n    }\n  ]\n}",
            "placeholderDefinitions": {
              "values": [
                {
                  "name": "message",
                  "description": "Conteúdo que deve ser buscado na internet",
                  "type": "string"
                }
              ]
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
          "typeVersion": 1.1,
          "position": [
            448,
            832
          ],
          "id": "6d4c587b-6547-4ddc-a022-361ed2f4cc20",
          "name": "Perplexity",
          "credentials": {
            "httpHeaderAuth": {
              "id": "kUplH1nEfORYagbX",
              "name": "LLamaParse"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Ferramenta para buscas simples usando a SerpAPI (busca no google)",
            "url": "https://serpapi.com/search",
            "sendQuery": true,
            "parametersQuery": {
              "values": [
                {
                  "name": "api_key",
                  "valueProvider": "fieldValue",
                  "value": "9b21f65f01a5ed663deb8907735c851b79b95c84f1742e68726a0fa943c1f703"
                },
                {
                  "name": "engine",
                  "valueProvider": "fieldValue",
                  "value": "google"
                },
                {
                  "name": "q",
                  "valueProvider": "fieldValue",
                  "value": "{query}"
                },
                {
                  "name": "location",
                  "valueProvider": "fieldValue",
                  "value": "Rio Grande do Sul, Brazil"
                },
                {
                  "name": "google_domain",
                  "valueProvider": "fieldValue",
                  "value": "google.com"
                },
                {
                  "name": "gl",
                  "valueProvider": "fieldValue",
                  "value": "br"
                },
                {
                  "name": "hl",
                  "valueProvider": "fieldValue",
                  "value": "pt-br"
                },
                {
                  "name": "device",
                  "valueProvider": "fieldValue",
                  "value": "desktop"
                }
              ]
            },
            "placeholderDefinitions": {
              "values": [
                {
                  "name": "query",
                  "description": "busca a ser feita no google",
                  "type": "string"
                }
              ]
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
          "typeVersion": 1.1,
          "position": [
            624,
            912
          ],
          "id": "fb0397d1-6cfe-4cfc-85f7-1d698b44ed0e",
          "name": "Google"
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Cria uma tarefa no notion. Sempre usa a ferramenta Listar Projetos antes de usar essa ferramenta.",
            "resource": "databasePage",
            "databaseId": {
              "__rl": true,
              "value": "15002cfe4c0e80e1852bf26aa022e174",
              "mode": "id"
            },
            "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', `Nome da tarefa a ser criada`, 'string') }}",
            "simple": false,
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "=Responsável|relation",
                  "relationValue": [
                    "={{ $json.query.id_notion }}"
                  ]
                },
                {
                  "key": "Projeto|relation",
                  "relationValue": [
                    "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Relation_IDs', `ID do projeto onde deve ser vinculada a tarefa. Caso não seja informado usar o id 2d8a0e73b40047a28cff63b81f252bbb`, 'string') }}"
                  ]
                },
                {
                  "key": "Status|status",
                  "statusValue": "=To-Do"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notionTool",
          "typeVersion": 2.2,
          "position": [
            400,
            1168
          ],
          "id": "6c8afc0b-f82c-480b-866f-2701fd459888",
          "name": "Criar tarefa",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Lista os projetos do Notion",
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "c2af396cc2a347eca452b2b2bf6b9031",
              "mode": "id"
            },
            "returnAll": true,
            "options": {}
          },
          "type": "n8n-nodes-base.notionTool",
          "typeVersion": 2.2,
          "position": [
            528,
            1312
          ],
          "id": "1212ad99-a5a5-47f5-8644-a3845f546965",
          "name": "Lista projetos",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Lista tarefas do Notion",
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "15002cfe4c0e80e1852bf26aa022e174",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "key": "=OtQ~|relation",
                  "condition": "contains",
                  "relationValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Relation_ID', `ID da pessoa responsável pela tarefa. Geralmente será o ID da pessoa com quem você está conversnado a menos que ela solitie o contrário.`, 'string') }}"
                },
                {
                  "key": "Status|status",
                  "condition": "does_not_equal",
                  "statusValue": "Done"
                },
                {
                  "key": "Status|status",
                  "condition": "does_not_equal",
                  "statusValue": "Archive"
                },
                {
                  "key": "Status|status",
                  "condition": "does_not_equal",
                  "statusValue": "Roadmap"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notionTool",
          "typeVersion": 2.2,
          "position": [
            528,
            1168
          ],
          "id": "279f2f43-f381-4f4d-acd7-a6f4437d5a8b",
          "name": "Lista tarefas",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Lista prospects da Píer Partners cadastrados do Notion",
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "bcd4de9d507c494492cd9208e5115533",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "json",
            "filterJson": "{\n    \"or\": [\n        {\n            \"property\": \"Status\",\n            \"select\": {\n                \"equals\": \"1. Lead\"\n            }\n        },\n        {\n            \"property\": \"Status\",\n            \"select\": {\n                \"equals\": \"2. Reunião Inicial\"\n            }\n        },\n        {\n            \"property\": \"Status\",\n            \"select\": {\n                \"equals\": \"3. Fazer Proposta\"\n            }\n        }\n    ]\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.notionTool",
          "typeVersion": 2.2,
          "position": [
            400,
            1312
          ],
          "id": "fdbc1c4e-afda-4f20-83a8-626f288e6492",
          "name": "Lista prospects abertos",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            1392,
            1168
          ],
          "id": "593d60c8-3546-4505-86cf-2219b4b4252d",
          "name": "Embeddings OpenAI1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "knowledge_database",
            "toolDescription": "Base de conhecimento da empresa",
            "tableName": {
              "__rl": true,
              "value": "rpc/match_documents_wiki",
              "mode": "list",
              "cachedResultName": "rpc/match_documents_wiki"
            },
            "options": {
              "queryName": "match_documents_wiki"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            1280,
            1008
          ],
          "id": "7a713c61-e227-4455-af88-a0bfa8eaa7e4",
          "name": "Base de conhcimento",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Retorna dados de slides a partir de um termo de busca. # Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes no campo metadata.",
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/92f32531-bd06-4629-9be4-4b64a12a06d9",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "query",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {},
            "optimizeResponse": true
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            784,
            1168
          ],
          "id": "4dd32bbe-7e8a-4bd6-af0b-92dc94f54d91",
          "name": "Slides"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.output.files.image_urls[0].url }}",
                        "rightValue": ".jpg",
                        "operator": {
                          "type": "string",
                          "operation": "notEmpty",
                          "singleValue": true
                        },
                        "id": "a1146d6f-286e-4b02-99c7-797f062b9e1a"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "tem_imagem"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "fcd23702-7809-4183-82fa-d691796d0464",
                        "leftValue": "={{ $json.output.files.image_urls }}",
                        "rightValue": "",
                        "operator": {
                          "type": "array",
                          "operation": "empty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "85569628-92a9-4df1-8b81-0f0c173a0c96",
                        "leftValue": "={{ $json.output.files.image_urls[0].url }}",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "empty",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1760,
            336
          ],
          "id": "72e27af0-5930-43cf-a356-ea4f896f0183",
          "name": "Switch"
        },
        {
          "parameters": {
            "operation": "binaryToPropery",
            "options": {}
          },
          "type": "n8n-nodes-base.extractFromFile",
          "typeVersion": 1,
          "position": [
            3024,
            112
          ],
          "id": "c81aa946-bda9-4010-99ee-72708147af6c",
          "name": "Extract from File"
        },
        {
          "parameters": {
            "text": "={{ $json.output }}",
            "schemaType": "manual",
            "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"files\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"image_urls\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        },\n        \"url_fileName\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    },\n    \"message\": {\n      \"type\": \"string\"\n    },\n    \"ferramentas\": {\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\"message\", \"ferramentas\"]\n}\n",
            "options": {
              "systemPromptTemplate": "You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value.\nIf files is empty, the message part returns the same as input.\nDo not mess with the urls, they are coupled. If error inform in the \"message\" field.\n"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1,
          "position": [
            1344,
            352
          ],
          "id": "7c533f8b-1865-428d-807a-c49542c0bf8c",
          "name": "Information Extractor"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "3ec176d3-7c8c-4e43-85b8-3fd5f2d5ce22",
                  "name": "output.image_urls",
                  "value": "={{ $('Information Extractor').item.json.output.files.image_urls }}",
                  "type": "array"
                },
                {
                  "id": "6a23043b-5a84-4f24-9cdc-0b4505a636cd",
                  "name": "output.file_urls",
                  "value": "={{ $('Information Extractor').item.json.output.files.url_fileName }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            2368,
            112
          ],
          "id": "5e70362f-4b7f-441e-8725-effe7e9c2902",
          "name": "Edit Fields2"
        },
        {
          "parameters": {
            "fieldToSplitOut": "output.image_urls",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            2592,
            112
          ],
          "id": "b2d2935d-9c46-4443-853a-0081d3f5187f",
          "name": "Split Out"
        },
        {
          "parameters": {
            "toolDescription": "=!ATENÇÃO! Utilize essa tool somente se a requisição solicitar consulta por tag.\n\nAlém disso existe também nos valores das tags o ano da apresentação a empresa e o tipo de apresentação (Deck, Boook ou Pitch), caso o usuário referencie algum desses itens.\n\nEssas classificações estão em um array \"tags\" na coluna metadata (type jsonb) na tabela em questão.\n",
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/e7147c99-fdf4-41b3-8ec7-248f1784b54b",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "tags",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {},
            "optimizeResponse": true
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            848,
            1328
          ],
          "id": "19d1fd54-577d-4661-b23a-38c7c07d5859",
          "name": "Slides_via tag"
        },
        {
          "parameters": {
            "url": "={{ $json.url }}",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "supabaseApi",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Content-Type",
                  "value": "image/jpg"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            2800,
            112
          ],
          "id": "61582055-5571-4347-bf21-82415d4ffa28",
          "name": "Download from Supabase",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.toolCalculator",
          "typeVersion": 1,
          "position": [
            272,
            832
          ],
          "id": "a9f12442-e29d-4015-ae00-68e9ae042f27",
          "name": "Calculator"
        },
        {
          "parameters": {
            "toolDescription": "Auxiliar IA com acesso à base de dados interna, ele consegue encontrar e retornar os valores de indicadores de mercado, dados financeiros de empresas abertas, bolsas brasileiras e americanas.\nAlém disso ele tem acesso a indicadores econõmicos e pode te ajudar com análises e precisões para uma resposta completa a requisição do usuário.\nAo utilizar essa tool, tente descrever bem a tarefa que o agente deve realizar. Por exemplo, se o usuário questionar pelo historico do cdi mensal nos últimos 12 mêses, todas essas informações devem ser enviadas para o agente.",
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/1a015d6f-d7e3-49ab-b3ee-2e8107ff149a",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "chatInput",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            1136,
            944
          ],
          "id": "506f03dd-678d-4c54-b35c-776c9c37dacf",
          "name": "Agente DataLake"
        },
        {
          "parameters": {
            "toolDescription": "Você tem acesso a informações de uma tabela de reuniões",
            "method": "POST",
            "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/rpc/buscar_reunioes_por_telefone",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "supabaseApi",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "telefone_input",
                  "value": "={{ $('Webhook').item.json.query.telefone }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            912,
            1168
          ],
          "id": "e9b13d7f-2574-4056-b89f-73feaf00503a",
          "name": "Reunioes Pinhao",
          "credentials": {
            "supabaseApi": {
              "id": "Oi412ZyXXAKVt09K",
              "name": "Supabase Admin"
            }
          }
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={\n  \"message\": {{ JSON.stringify($('Information Extractor').item.json.output.message) }},\n  \"images\": {{ JSON.stringify($json[\"data\"]) }}\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            3680,
            112
          ],
          "id": "524ee91f-8de5-4cd5-af3e-699552279dde",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            3472,
            112
          ],
          "id": "274227f8-dc25-4e6f-81b1-055f9f6a4baa",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "a0978d24-3947-434f-864d-19edf8c0bb49",
                  "name": "imagebase64",
                  "value": "={{ $json.data }}",
                  "type": "string"
                },
                {
                  "id": "2e13156a-6647-4c43-a304-fa3727d0b51c",
                  "name": "url",
                  "value": "={{ $('Edit Fields2').item.json.output.file_urls[$itemIndex].url.replaceAll(\" \",\"%20\") }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            3248,
            112
          ],
          "id": "3189e825-1d99-4c53-abc2-dbc0eb9bb787",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={\n  \"message\": {{JSON.stringify($('Information Extractor').item.json.output.message.concat(' ', $('Information Extractor').item.json.output.files.url_fileName?.[0]?.url) ?? '').replace(' undefined','')}},\n  \"images\": []\n}\n\n",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            2272,
            496
          ],
          "id": "15a14eb7-56b6-4b57-bb82-214704969926",
          "name": "Respond to Webhook1"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.1",
              "mode": "list",
              "cachedResultName": "gpt-5.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            112,
            800
          ],
          "id": "554e8842-b6ab-4671-9795-d27315d8b360",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "tableId": "historico_marujo",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "pessoa",
                  "fieldValue": "={{ $('Webhook').item.json.query.pessoa }}"
                },
                {
                  "fieldId": "tipo",
                  "fieldValue": "Output"
                },
                {
                  "fieldId": "conteudo",
                  "fieldValue": "={{ $json.output.message }}"
                },
                {
                  "fieldId": "sessionID",
                  "fieldValue": "={{ $('Webhook').item.json.query.session_ID }}"
                },
                {
                  "fieldId": "tools",
                  "fieldValue": "={{ $('AI Agent').item.json.intermediateSteps.map(step => step.action.tool).join(', ') }}"
                },
                {
                  "fieldId": "id_pessoa",
                  "fieldValue": "={{ $('Webhook').item.json.query.id_pessoa }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            1824,
            -64
          ],
          "id": "c28cb5e6-398f-4c8c-b418-42ddbd0ee923",
          "name": "RegistrarOutput",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "update",
            "pageId": {
              "__rl": true,
              "value": "={{ $json.query.id_notion }}",
              "mode": "id"
            },
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Memoria Marujo|rich_text",
                  "richText": true,
                  "text": {
                    "text": [
                      {
                        "text": "={{ \n  (() => {\n    const atual = $json.query.memoria_marujo || '';     // o que já está salvo\n    const nova  = $fromAI(\n      'propertyValues0_text0_Text',\n      `Frase curta (até 200 caracteres) com a informação importante que deve ser lembrada sobre o usuário. Escreva em português.`,\n      'string'\n    ) || '';\n\n    // Se a nova memória já existe ou veio vazia, devolve só o que já tinha\n    if (!nova || atual.includes(nova)) return atual;\n\n    // Caso contrário, concatena com quebra de linha\n    return (atual ? atual + '\\n' : '') + nova;\n  })()\n}}\n",
                        "annotationUi": {}
                      }
                    ]
                  }
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notionTool",
          "typeVersion": 2.2,
          "position": [
            1760,
            784
          ],
          "id": "5615de19-dd2f-4ff4-9297-011b679153c9",
          "name": "RegistroMemoria",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "name": "save_xlsx",
            "description": "Call this tool to save bigquery json response as a xlsx file and return it to the chat user.",
            "workflowId": {
              "__rl": true,
              "value": "k8tv47GLScBdQI1h",
              "mode": "list",
              "cachedResultName": "Save xlsx"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {},
              "matchingColumns": [],
              "schema": [],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "typeVersion": 2.1,
          "position": [
            1440,
            848
          ],
          "id": "6989ec2d-ca46-41e9-9895-961ee7cf9366",
          "name": "Call n8n Workflow Tool"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            1280,
            512
          ],
          "id": "d3f48128-4c85-48d0-aa54-99ac72bfd744",
          "name": "OpenAI Chat Model1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "pessoas",
            "filters": {
              "conditions": [
                {
                  "keyName": "telefone",
                  "keyValue": "={{$json.query.telefone }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -48,
            448
          ],
          "id": "a45d2851-53e5-4f79-9a4d-de6fa9adbde1",
          "name": "Get a row1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// items contém o array de entrada do n8n\nconst projetos = items.map(item => {\n  const projeto = item.json.projeto?.trim();\n  const vertical = item.json.vertical?.trim();\n\n  // ignora projetos vazios\n  if (!projeto) return null;\n\n  // fallback quando vertical é null\n  const verticalLabel = vertical ?? 'Sem vertical';\n\n  return `${projeto}`;\n}).filter(Boolean);\n\n// retorna como uma única string (quebra de linha)\nreturn [\n  {\n    json: {\n      resultado: projetos.join('\\n')\n    }\n  }\n];\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            48,
            608
          ],
          "id": "1c3a04d0-a13b-4079-bd68-f184ee07349a",
          "name": "Code in JavaScript"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            256,
            464
          ],
          "id": "4dfbfc6d-3019-4d4c-b930-cd588bf9f014",
          "name": "Merge"
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "projetos_gp",
            "returnAll": true,
            "matchType": "allFilters"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -144,
            608
          ],
          "id": "f34f1d22-6d6b-4132-a373-e55af6376cf8",
          "name": "Get many rows1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            464,
            464
          ],
          "id": "8c45fae8-73b6-4bbf-97f9-9cf727c38f09",
          "name": "Aggregate1"
        },
        {
          "parameters": {
            "tableId": "alocacoes_horas",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "email",
                  "fieldValue": "={{ $('Aggregate1').item.json.data[0].email }}"
                },
                {
                  "fieldId": "nome_pessoa",
                  "fieldValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                },
                {
                  "fieldId": "projeto",
                  "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', `Projeto da lista correspondente ao pedido, o nome deve estar igual a correspondencia da lista, não ao pedido do usuário`, 'string') }}"
                },
                {
                  "fieldId": "dia",
                  "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', `Dia da atividade formato YYYY-MM-DD`, 'string') }}"
                },
                {
                  "fieldId": "horas",
                  "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues4_Field_Value', `Numero de horas do pedido`, 'string') }}"
                },
                {
                  "fieldId": "cargo",
                  "fieldValue": "={{ $('Aggregate1').item.json.data[0].cargo }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            1088,
            1328
          ],
          "id": "f9aed4a9-34be-4211-aeec-61e9d80060cc",
          "name": "Criar alocação",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "alocacoes_horas",
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "keyName": "nome_pessoa",
                  "condition": "=eq",
                  "keyValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                },
                {
                  "keyName": "dia",
                  "condition": "eq",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Field_Value', `Dia da atividade formato YYYY-MM-DD`, 'string') }}"
                },
                {
                  "keyName": "projeto",
                  "condition": "eq",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions2_Field_Value', `Projeto da lista correspondente ao pedido, o nome deve estar igual a correspondencia da lista, não ao pedido do usuário`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            1232,
            1328
          ],
          "id": "56531b57-74ce-4feb-a191-18cdff884461",
          "name": "Deletar alocação",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "alocacoes_horas",
            "returnAll": true,
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "keyName": "nome_pessoa",
                  "condition": "eq",
                  "keyValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                },
                {
                  "keyName": "dia",
                  "condition": "eq",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions2_Field_Value', `Dia da atividade formato YYYY-MM-DD`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            1088,
            1168
          ],
          "id": "cfbfe221-6290-4065-beaf-e3c2e0db1529",
          "name": "Buscar alocações dia",
          "rewireOutputLogTo": "ai_tool",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "tableId": "alocacoes_horas",
            "returnAll": true,
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "keyName": "nome_pessoa",
                  "condition": "eq",
                  "keyValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                },
                {
                  "keyName": "projeto",
                  "condition": "eq",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Field_Value', `Projeto pedido no prompt`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            1232,
            1168
          ],
          "id": "b6a7211d-191c-4a92-acdc-b0d9b0b61057",
          "name": "Buscar alocações projeto",
          "rewireOutputLogTo": "ai_tool",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Get a row1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get many rows1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Perplexity": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Criar tarefa": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Lista projetos": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Lista tarefas": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Lista prospects abertos": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI1": {
          "ai_embedding": [
            [
              {
                "node": "Base de conhcimento",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Base de conhcimento": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Information Extractor",
                "type": "main",
                "index": 0
              }
            ],
            []
          ]
        },
        "Slides": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Edit Fields2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Extract from File": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Information Extractor": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              },
              {
                "node": "RegistrarOutput",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields2": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Download from Supabase",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Slides_via tag": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Download from Supabase": {
          "main": [
            [
              {
                "node": "Extract from File",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Calculator": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Agente DataLake": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Reunioes Pinhao": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "RegistroMemoria": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Call n8n Workflow Tool": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Information Extractor",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Get a row1": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Aggregate1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many rows1": {
          "main": [
            [
              {
                "node": "Code in JavaScript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate1": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Criar alocação": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Deletar alocação": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Buscar alocações dia": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Buscar alocações projeto": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "timeSavedMode": "fixed",
        "timezone": "America/Argentina/Buenos_Aires",
        "callerPolicy": "workflowsFromSameOwner",
        "availableInMCP": true,
        "errorWorkflow": "JETmLBaO3fj2xDYa-A4Nc"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Webhook": [
          {
            "json": {
              "headers": {
                "host": "primary-production-0ad4f.up.railway.app",
                "user-agent": "axios/1.8.3",
                "content-length": "0",
                "accept": "application/json,text/html,application/xhtml+xml,application/xml,text/*;q=0.9, image/*;q=0.8, */*;q=0.7",
                "accept-encoding": "gzip, compress, deflate, br",
                "authorization": "Basic bWFydWpvX2JhY2tlbmQ6bWFydWpvZGFtYXNzYQ==",
                "x-forwarded-for": "162.220.232.5",
                "x-forwarded-host": "primary-production-0ad4f.up.railway.app",
                "x-forwarded-proto": "https",
                "x-railway-edge": "railway/us-west2",
                "x-railway-request-id": "HDqidjBMTCWJT8Bzn6XIxQ",
                "x-real-ip": "162.220.232.5",
                "x-request-start": "1767976470432"
              },
              "params": {},
              "query": {
                "mensagem": "Uepa",
                "nome": "Douglas Zechin",
                "cargo": "Sócio",
                "setor": "Dados",
                "id_notion": "657a14f4-63b3-4f92-8858-b2e3f735c700",
                "telefone": "555491562985",
                "session_ID": "whatsapp|3A752A36E6DA34BB8C18",
                "pessoa": "Douglas Zechin",
                "id_pessoa": "657a14f4-63b3-4f92-8858-b2e3f735c700\n",
                "memoria_marujo": "\" \""
              },
              "body": {},
              "webhookUrl": "https://primary-production-0ad4f.up.railway.app/webhook/8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
              "executionMode": "production"
            }
          }
        ],
        "Information Extractor": [
          {
            "json": {
              "output": {
                "files": {
                  "image_urls": [
                    {
                      "url": ""
                    }
                  ],
                  "url_fileName": [
                    {
                      "url": ""
                    }
                  ]
                },
                "message": "Confirmação de alocação:\n- Dia: 14/01/2026 (quarta-feira)\n- Projeto: Egali [Dados 25]\n- Horas: 8h\nA alocação já foi registrada no sistema. Caso precise lançar de outros dias ou projetos, envie as informações.",
                "ferramentas": "Criar_alocação"
              }
            }
          }
        ]
      },
      "versionId": "15f999af-dff3-41f5-8594-c88855544f61",
      "activeVersionId": "042400e8-6ec8-4057-8ed1-eb69f69fb12f",
      "versionCounter": 262,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-28T20:43:54.723Z",
          "createdAt": "2025-06-28T20:43:54.723Z",
          "role": "workflow:owner",
          "workflowId": "Hnf52KRQWgkwPSs4",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-03-25T17:28:44.590Z",
          "createdAt": "2025-03-25T17:28:44.590Z",
          "id": "SGLcCfFPtH9ESbyP",
          "name": "Marujo"
        }
      ],
      "activeVersion": {
        "updatedAt": "2026-01-16T19:22:20.987Z",
        "createdAt": "2026-01-16T19:22:02.314Z",
        "versionId": "042400e8-6ec8-4057-8ed1-eb69f69fb12f",
        "workflowId": "Hnf52KRQWgkwPSs4",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
              "authentication": "basicAuth",
              "responseMode": "responseNode",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              -480,
              448
            ],
            "id": "87d5ce81-2715-45cb-ba55-268b6ead0499",
            "name": "Webhook",
            "webhookId": "8cef5f7e-ce64-4dd9-adba-5d817dbf26a6",
            "credentials": {
              "httpBasicAuth": {
                "id": "tCmsIBEt9lhM1cnI",
                "name": "Unnamed credential"
              }
            }
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $('Webhook').item.json.query.mensagem }}",
              "options": {
                "systemMessage": "=# Você é o Marujo, assistente da Píer Partners. O dia e hora dessa requisição é {{ $now.toISO() }}\n\n# Você está falando com {{ $('Webhook').item.json.query.nome }}. O cargo dessa pessoa é {{ $('Webhook').item.json.query.cargo }} do time de {{ $('Webhook').item.json.query.setor }}. O ID dessa pessoa no notion é {{ $('Webhook').item.json.query.id_notion }}. Leve em consideração o contexto passado dessa pessoa {{ $('Webhook').item.json.query.memoria_marujo }}\n\n# Quando for questionado sobre buscas:\n- Use a ferramenta SerpAPI se forem simples, como cotações e links\n- Use a ferramenta Perplexity se forem mais complexas, como descrever alguma coisa e saber mais sobre alguma coisa\n\n# Quando for perguntado sobre como fazer alguma você deve:\n1. buscas na base de conhecimento.\n2. se não encontrar uma resposta ali fazer uma busca usando a serpapi ou a perplexity\n3. sempre forneça as fontes usas.\n\n# Você possui ferramentas para interagir com o Notion, com as funcionalidades:\n- Listar projetos\n- Listar taregas\n- Criar tarefas\nSempre que for criar uma tarefa você deve alocar o usuário como responsável pelo seu nome usando a relação com c6b4e8ff-ed22-4259-b5e4-6e190107c597. Sempre liste projetos antes de criar a tarefa. Veja em qual o usuário está alocado, ou qual faz mais sentido pela Área. Se ficar em dúvida sobre algum campo obrigatório, confirme com o usuário.\nVocê não tem acesso à edição de uma task. Não se ofereça para alterar campos após criá-las.\n\n# Quando pedido quanto a alocação de horas em projetos use as ferramentas do supabase abaixo para as suas determinadas tarefas:\n- Criar alocação: Usado para criar uma nova alocação de horas da pessoa em determinado projeto conforme o prompt do usuário\n- Deletar alocação: Usado para deletar uma nova alocação de horas da pessoa em determinado projeto conforme o prompt do usuário\n- Buscar alocações dia: Realiza uma busca dentro do banco para as alocações no dia pedido no prompt\n- Buscar alocações projeto: Realiza uma busca dentro do banco para as alocações para o projeto pedido no prompt\n\n\nOs projetos podem vir escritos de forma diferente, então é necessário que realize um match que melhor combina com o pedido dentre a lista de projeto, é é obrigatório que na criação, busca e deleção você coloque o nome como listado, caso não encontre um match satisfatorio retorne ao usuário que não foi possível encontrar.\nOs formatos para dias sempre estarão nessas 3 ferramentas deve ser usado YYYY-MM-DD.\nCaso no prompt não seja especificado data, somente o dia da semana, considere sempre de forma retroativa, ou seja ultima ocorrencia desse dia.\nAntes de salvar mande uma mensagem de confirmação com as alterações e criações a serem realizadas.\nLista de projetos:\n{{ $json.data[1].resultado }}\n\n# Quando for perguntado sobre as informações de alguma reunião que aconteceu e foi gravada:\n- Use a ferramenta Reunioes Pinhao para buscar informações de data, partcipantes, transcrição, anotações e resumo da reunião.\n- Jamais invente prazos que não sejam explicitamente definidos entre os participantes e se restrinja a fornecer informações extremamente objetivas sobre a reunião, sem extrapolar interpretações.\n\n# Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes nos campos url_markdown junto do nome do arquivo.\n\n# Quando questionado sobre reuniões ou algo realacaionado ao Google Agenda, retorne para o usuário um aviso dizendo que a maneira mais fácil de saber as suas informações sobre agenda é acessando o Google Agenda.\n\n# Formate sua mensagem de modo adequado para exibição no WhatsApp.\n\n# Use linguagem adequada para uma consultoria financeira mais despojada, não muito formal. Adicione alguns termos de marujo exclusivamente nas saudações, sem poluir a fala.\n\n# Se retornar uma imagem, retorne no máximo uma URL\n\n# A sua saída final nunca deve ser feita utilizando uma chave chamada output\n\n# Se julgar que alguma das informações passadas pelo usuário for importante para mensagens futuras, use a tool \"RegistroMemoria\".\n\n\n# REGRAS PARA SUA RESPOSTA!\n## Sempre que for indicar um slide é obrigatório que indique a url desse slide image_url e também a referencia do arquivo que é o metadado url_fileName. Para que fique claro, deve ser retornado duas urls... Uma do google storage com o slide, e outra do sharepoint com o arquivo. Não altere a url! (o parâmetro nav deve ser mantido)\n## Retorne unicamente um arquivo json com o seguinte formato\n## Caso utilize a tool de slides, não é necessário declarar a url também na mensagem, ela será enviada direto para o usuário e os links serão utilizados para mostrar a foto. Então essa mensagem é um texto complementar e não deve conter nenhum url nela.\n## Caso você tenha recebido mais slides e eles façam sentido para a necessidade do usuário, crie outros objetos para responder o usuário.\n## Caso você faça uso do agente datalake, ele pode te retornar uma url de referência, é importante que você retorne ela ao usuário caso ele queira explorar os dados de origem da sua resposta. ATENÇÃO esse é o único caso em que a url deve ser retornada junto da mensagem no campo url_fileName.\n## Caso você utilize a ferramenta do DataLake, você deve retornar uma mensagem completa a ser encaminhada como resposta ao usuário.\n## No campo \"ferramenta\" do json salve as ferramentas utilizadas.\n\n{\n  \"type\": \"object\",\n  \"properties\": {\n    \"files\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"image_urls\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        },\n        \"url_fileName\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    },\n    \"message\": {\n      \"type\": \"string\"\n    },\n    \"ferramentas\": {\n      \"type\": \"string\"\n    }\n  }\n}\n",
                "returnIntermediateSteps": true
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.8,
            "position": [
              704,
              464
            ],
            "id": "bbcf3c16-36be-4da9-8ce0-d184a6853269",
            "name": "AI Agent",
            "retryOnFail": true,
            "maxTries": 2,
            "onError": "continueErrorOutput"
          },
          {
            "parameters": {
              "sessionIdType": "customKey",
              "sessionKey": "={{ $('Webhook').item.json.query.telefone }}",
              "contextWindowLength": 10
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              160,
              960
            ],
            "id": "c4659126-dd72-452f-a684-3fe7bf0b36ac",
            "name": "Simple Memory"
          },
          {
            "parameters": {
              "toolDescription": "Conector da perplexity. Faz buscas complexas e pesquisas na internet passando o tópico que deve ser pesquisado. Quando usar essa ferramenta sempre cite a fonte utilizada caso disponível.",
              "method": "POST",
              "url": "https://api.perplexity.ai/chat/completions",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpHeaderAuth",
              "sendBody": true,
              "specifyBody": "json",
              "jsonBody": "{\n  \"temperature\": 0.2,\n  \"top_p\": 0.9,\n  \"return_images\": false,\n  \"return_related_questions\": false,\n  \"top_k\": 0,\n  \"stream\": false,\n  \"presence_penalty\": 0,\n  \"frequency_penalty\": 1,\n  \"web_search_options\": {\n    \"search_context_size\": \"low\"\n  },\n  \"model\": \"sonar\",\n  \"messages\": [\n    {\n      \"role\": \"user\",\n      \"content\": \"{message}\"\n    }\n  ]\n}",
              "placeholderDefinitions": {
                "values": [
                  {
                    "name": "message",
                    "description": "Conteúdo que deve ser buscado na internet",
                    "type": "string"
                  }
                ]
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
            "typeVersion": 1.1,
            "position": [
              544,
              784
            ],
            "id": "6d4c587b-6547-4ddc-a022-361ed2f4cc20",
            "name": "Perplexity",
            "credentials": {
              "httpHeaderAuth": {
                "id": "kUplH1nEfORYagbX",
                "name": "LLamaParse"
              }
            }
          },
          {
            "parameters": {
              "toolDescription": "Ferramenta para buscas simples usando a SerpAPI (busca no google)",
              "url": "https://serpapi.com/search",
              "sendQuery": true,
              "parametersQuery": {
                "values": [
                  {
                    "name": "api_key",
                    "valueProvider": "fieldValue",
                    "value": "9b21f65f01a5ed663deb8907735c851b79b95c84f1742e68726a0fa943c1f703"
                  },
                  {
                    "name": "engine",
                    "valueProvider": "fieldValue",
                    "value": "google"
                  },
                  {
                    "name": "q",
                    "valueProvider": "fieldValue",
                    "value": "{query}"
                  },
                  {
                    "name": "location",
                    "valueProvider": "fieldValue",
                    "value": "Rio Grande do Sul, Brazil"
                  },
                  {
                    "name": "google_domain",
                    "valueProvider": "fieldValue",
                    "value": "google.com"
                  },
                  {
                    "name": "gl",
                    "valueProvider": "fieldValue",
                    "value": "br"
                  },
                  {
                    "name": "hl",
                    "valueProvider": "fieldValue",
                    "value": "pt-br"
                  },
                  {
                    "name": "device",
                    "valueProvider": "fieldValue",
                    "value": "desktop"
                  }
                ]
              },
              "placeholderDefinitions": {
                "values": [
                  {
                    "name": "query",
                    "description": "busca a ser feita no google",
                    "type": "string"
                  }
                ]
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolHttpRequest",
            "typeVersion": 1.1,
            "position": [
              624,
              912
            ],
            "id": "fb0397d1-6cfe-4cfc-85f7-1d698b44ed0e",
            "name": "Google"
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Cria uma tarefa no notion. Sempre usa a ferramenta Listar Projetos antes de usar essa ferramenta.",
              "resource": "databasePage",
              "databaseId": {
                "__rl": true,
                "value": "15002cfe4c0e80e1852bf26aa022e174",
                "mode": "id"
              },
              "title": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Title', `Nome da tarefa a ser criada`, 'string') }}",
              "simple": false,
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "=Responsável|relation",
                    "relationValue": [
                      "={{ $json.query.id_notion }}"
                    ]
                  },
                  {
                    "key": "Projeto|relation",
                    "relationValue": [
                      "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Relation_IDs', `ID do projeto onde deve ser vinculada a tarefa. Caso não seja informado usar o id 2d8a0e73b40047a28cff63b81f252bbb`, 'string') }}"
                    ]
                  },
                  {
                    "key": "Status|status",
                    "statusValue": "=To-Do"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notionTool",
            "typeVersion": 2.2,
            "position": [
              400,
              1168
            ],
            "id": "6c8afc0b-f82c-480b-866f-2701fd459888",
            "name": "Criar tarefa",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Lista os projetos do Notion",
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "c2af396cc2a347eca452b2b2bf6b9031",
                "mode": "id"
              },
              "returnAll": true,
              "options": {}
            },
            "type": "n8n-nodes-base.notionTool",
            "typeVersion": 2.2,
            "position": [
              528,
              1312
            ],
            "id": "1212ad99-a5a5-47f5-8644-a3845f546965",
            "name": "Lista projetos",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Lista tarefas do Notion",
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "15002cfe4c0e80e1852bf26aa022e174",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "key": "=OtQ~|relation",
                    "condition": "contains",
                    "relationValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Relation_ID', `ID da pessoa responsável pela tarefa. Geralmente será o ID da pessoa com quem você está conversnado a menos que ela solitie o contrário.`, 'string') }}"
                  },
                  {
                    "key": "Status|status",
                    "condition": "does_not_equal",
                    "statusValue": "Done"
                  },
                  {
                    "key": "Status|status",
                    "condition": "does_not_equal",
                    "statusValue": "Archive"
                  },
                  {
                    "key": "Status|status",
                    "condition": "does_not_equal",
                    "statusValue": "Roadmap"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notionTool",
            "typeVersion": 2.2,
            "position": [
              528,
              1168
            ],
            "id": "279f2f43-f381-4f4d-acd7-a6f4437d5a8b",
            "name": "Lista tarefas",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Lista prospects da Píer Partners cadastrados do Notion",
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "bcd4de9d507c494492cd9208e5115533",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "json",
              "filterJson": "{\n    \"or\": [\n        {\n            \"property\": \"Status\",\n            \"select\": {\n                \"equals\": \"1. Lead\"\n            }\n        },\n        {\n            \"property\": \"Status\",\n            \"select\": {\n                \"equals\": \"2. Reunião Inicial\"\n            }\n        },\n        {\n            \"property\": \"Status\",\n            \"select\": {\n                \"equals\": \"3. Fazer Proposta\"\n            }\n        }\n    ]\n}",
              "options": {}
            },
            "type": "n8n-nodes-base.notionTool",
            "typeVersion": 2.2,
            "position": [
              400,
              1312
            ],
            "id": "fdbc1c4e-afda-4f20-83a8-626f288e6492",
            "name": "Lista prospects abertos",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              1392,
              1168
            ],
            "id": "593d60c8-3546-4505-86cf-2219b4b4252d",
            "name": "Embeddings OpenAI1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "mode": "retrieve-as-tool",
              "toolName": "knowledge_database",
              "toolDescription": "Base de conhecimento da empresa",
              "tableName": {
                "__rl": true,
                "value": "rpc/match_documents_wiki",
                "mode": "list",
                "cachedResultName": "rpc/match_documents_wiki"
              },
              "options": {
                "queryName": "match_documents_wiki"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1,
            "position": [
              1280,
              1008
            ],
            "id": "7a713c61-e227-4455-af88-a0bfa8eaa7e4",
            "name": "Base de conhcimento",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "toolDescription": "Retorna dados de slides a partir de um termo de busca. # Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes no campo metadata.",
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/92f32531-bd06-4629-9be4-4b64a12a06d9",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "query",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {},
              "optimizeResponse": true
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.2,
            "position": [
              784,
              1168
            ],
            "id": "4dd32bbe-7e8a-4bd6-af0b-92dc94f54d91",
            "name": "Slides"
          },
          {
            "parameters": {
              "rules": {
                "values": [
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "leftValue": "={{ $json.output.files.image_urls[0].url }}",
                          "rightValue": ".jpg",
                          "operator": {
                            "type": "string",
                            "operation": "notEmpty",
                            "singleValue": true
                          },
                          "id": "a1146d6f-286e-4b02-99c7-797f062b9e1a"
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "tem_imagem"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "fcd23702-7809-4183-82fa-d691796d0464",
                          "leftValue": "={{ $json.output.files.image_urls }}",
                          "rightValue": "",
                          "operator": {
                            "type": "array",
                            "operation": "empty",
                            "singleValue": true
                          }
                        }
                      ],
                      "combinator": "and"
                    }
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "85569628-92a9-4df1-8b81-0f0c173a0c96",
                          "leftValue": "={{ $json.output.files.image_urls[0].url }}",
                          "rightValue": "",
                          "operator": {
                            "type": "string",
                            "operation": "empty",
                            "singleValue": true
                          }
                        }
                      ],
                      "combinator": "and"
                    }
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.2,
            "position": [
              1760,
              336
            ],
            "id": "72e27af0-5930-43cf-a356-ea4f896f0183",
            "name": "Switch"
          },
          {
            "parameters": {
              "operation": "binaryToPropery",
              "options": {}
            },
            "type": "n8n-nodes-base.extractFromFile",
            "typeVersion": 1,
            "position": [
              3024,
              112
            ],
            "id": "c81aa946-bda9-4010-99ee-72708147af6c",
            "name": "Extract from File"
          },
          {
            "parameters": {
              "text": "={{ $json.output }}",
              "schemaType": "manual",
              "inputSchema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"files\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"image_urls\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        },\n        \"url_fileName\": {\n          \"type\": \"array\",\n          \"items\": {\n            \"type\": \"object\",\n            \"properties\": {\n              \"url\": {\n                \"type\": \"string\"\n              }\n            }\n          }\n        }\n      }\n    },\n    \"message\": {\n      \"type\": \"string\"\n    },\n    \"ferramentas\": {\n      \"type\": \"string\"\n    }\n  },\n  \"required\": [\"message\", \"ferramentas\"]\n}\n",
              "options": {
                "systemPromptTemplate": "You are an expert extraction algorithm.\nOnly extract relevant information from the text.\nIf you do not know the value of an attribute asked to extract, you may omit the attribute's value.\nIf files is empty, the message part returns the same as input.\nDo not mess with the urls, they are coupled. If error inform in the \"message\" field.\n"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.informationExtractor",
            "typeVersion": 1,
            "position": [
              1344,
              352
            ],
            "id": "7c533f8b-1865-428d-807a-c49542c0bf8c",
            "name": "Information Extractor"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "3ec176d3-7c8c-4e43-85b8-3fd5f2d5ce22",
                    "name": "output.image_urls",
                    "value": "={{ $('Information Extractor').item.json.output.files.image_urls }}",
                    "type": "array"
                  },
                  {
                    "id": "6a23043b-5a84-4f24-9cdc-0b4505a636cd",
                    "name": "output.file_urls",
                    "value": "={{ $('Information Extractor').item.json.output.files.url_fileName }}",
                    "type": "array"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              2368,
              112
            ],
            "id": "5e70362f-4b7f-441e-8725-effe7e9c2902",
            "name": "Edit Fields2"
          },
          {
            "parameters": {
              "fieldToSplitOut": "output.image_urls",
              "options": {}
            },
            "type": "n8n-nodes-base.splitOut",
            "typeVersion": 1,
            "position": [
              2592,
              112
            ],
            "id": "b2d2935d-9c46-4443-853a-0081d3f5187f",
            "name": "Split Out"
          },
          {
            "parameters": {
              "toolDescription": "=!ATENÇÃO! Utilize essa tool somente se a requisição solicitar consulta por tag.\n\nAlém disso existe também nos valores das tags o ano da apresentação a empresa e o tipo de apresentação (Deck, Boook ou Pitch), caso o usuário referencie algum desses itens.\n\nEssas classificações estão em um array \"tags\" na coluna metadata (type jsonb) na tabela em questão.\n",
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/e7147c99-fdf4-41b3-8ec7-248f1784b54b",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "tags",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {},
              "optimizeResponse": true
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.2,
            "position": [
              848,
              1328
            ],
            "id": "19d1fd54-577d-4661-b23a-38c7c07d5859",
            "name": "Slides_via tag"
          },
          {
            "parameters": {
              "url": "={{ $json.url }}",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "supabaseApi",
              "sendHeaders": true,
              "headerParameters": {
                "parameters": [
                  {
                    "name": "Content-Type",
                    "value": "image/jpg"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              2800,
              112
            ],
            "id": "61582055-5571-4347-bf21-82415d4ffa28",
            "name": "Download from Supabase",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {},
            "type": "@n8n/n8n-nodes-langchain.toolCalculator",
            "typeVersion": 1,
            "position": [
              272,
              832
            ],
            "id": "a9f12442-e29d-4015-ae00-68e9ae042f27",
            "name": "Calculator"
          },
          {
            "parameters": {
              "toolDescription": "Auxiliar IA com acesso à base de dados interna, ele consegue encontrar e retornar os valores de indicadores de mercado, dados financeiros de empresas abertas, bolsas brasileiras e americanas.\nAlém disso ele tem acesso a indicadores econõmicos e pode te ajudar com análises e precisões para uma resposta completa a requisição do usuário.\nAo utilizar essa tool, tente descrever bem a tarefa que o agente deve realizar. Por exemplo, se o usuário questionar pelo historico do cdi mensal nos últimos 12 mêses, todas essas informações devem ser enviadas para o agente.",
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/1a015d6f-d7e3-49ab-b3ee-2e8107ff149a",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "chatInput",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.2,
            "position": [
              1136,
              944
            ],
            "id": "506f03dd-678d-4c54-b35c-776c9c37dacf",
            "name": "Agente DataLake"
          },
          {
            "parameters": {
              "toolDescription": "Você tem acesso a informações de uma tabela de reuniões",
              "method": "POST",
              "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/rpc/buscar_reunioes_por_telefone",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "supabaseApi",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "telefone_input",
                    "value": "={{ $('Webhook').item.json.query.telefone }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.2,
            "position": [
              912,
              1168
            ],
            "id": "e9b13d7f-2574-4056-b89f-73feaf00503a",
            "name": "Reunioes Pinhao",
            "credentials": {
              "supabaseApi": {
                "id": "Oi412ZyXXAKVt09K",
                "name": "Supabase Admin"
              }
            }
          },
          {
            "parameters": {
              "respondWith": "json",
              "responseBody": "={\n  \"message\": {{ JSON.stringify($('Information Extractor').item.json.output.message) }},\n  \"images\": {{ JSON.stringify($json[\"data\"]) }}\n}",
              "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.4,
            "position": [
              3680,
              112
            ],
            "id": "524ee91f-8de5-4cd5-af3e-699552279dde",
            "name": "Respond to Webhook"
          },
          {
            "parameters": {
              "aggregate": "aggregateAllItemData",
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              3472,
              112
            ],
            "id": "274227f8-dc25-4e6f-81b1-055f9f6a4baa",
            "name": "Aggregate"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "a0978d24-3947-434f-864d-19edf8c0bb49",
                    "name": "imagebase64",
                    "value": "={{ $json.data }}",
                    "type": "string"
                  },
                  {
                    "id": "2e13156a-6647-4c43-a304-fa3727d0b51c",
                    "name": "url",
                    "value": "={{ $('Edit Fields2').item.json.output.file_urls[$itemIndex].url.replaceAll(\" \",\"%20\") }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              3248,
              112
            ],
            "id": "3189e825-1d99-4c53-abc2-dbc0eb9bb787",
            "name": "Edit Fields"
          },
          {
            "parameters": {
              "respondWith": "json",
              "responseBody": "={\n  \"message\": {{JSON.stringify($('Information Extractor').item.json.output.message.concat(' ', $('Information Extractor').item.json.output.files.url_fileName?.[0]?.url) ?? '').replace(' undefined','')}},\n  \"images\": []\n}\n\n",
              "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.4,
            "position": [
              2272,
              496
            ],
            "id": "15a14eb7-56b6-4b57-bb82-214704969926",
            "name": "Respond to Webhook1"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.1",
                "mode": "list",
                "cachedResultName": "gpt-5.1"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              112,
              800
            ],
            "id": "554e8842-b6ab-4671-9795-d27315d8b360",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "tableId": "historico_marujo",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "pessoa",
                    "fieldValue": "={{ $('Webhook').item.json.query.pessoa }}"
                  },
                  {
                    "fieldId": "tipo",
                    "fieldValue": "Output"
                  },
                  {
                    "fieldId": "conteudo",
                    "fieldValue": "={{ $json.output.message }}"
                  },
                  {
                    "fieldId": "sessionID",
                    "fieldValue": "={{ $('Webhook').item.json.query.session_ID }}"
                  },
                  {
                    "fieldId": "tools",
                    "fieldValue": "={{ $('AI Agent').item.json.intermediateSteps.map(step => step.action.tool).join(', ') }}"
                  },
                  {
                    "fieldId": "id_pessoa",
                    "fieldValue": "={{ $('Webhook').item.json.query.id_pessoa }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              1824,
              -64
            ],
            "id": "c28cb5e6-398f-4c8c-b418-42ddbd0ee923",
            "name": "RegistrarOutput",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "update",
              "pageId": {
                "__rl": true,
                "value": "={{ $json.query.id_notion }}",
                "mode": "id"
              },
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "Memoria Marujo|rich_text",
                    "richText": true,
                    "text": {
                      "text": [
                        {
                          "text": "={{ \n  (() => {\n    const atual = $json.query.memoria_marujo || '';     // o que já está salvo\n    const nova  = $fromAI(\n      'propertyValues0_text0_Text',\n      `Frase curta (até 200 caracteres) com a informação importante que deve ser lembrada sobre o usuário. Escreva em português.`,\n      'string'\n    ) || '';\n\n    // Se a nova memória já existe ou veio vazia, devolve só o que já tinha\n    if (!nova || atual.includes(nova)) return atual;\n\n    // Caso contrário, concatena com quebra de linha\n    return (atual ? atual + '\\n' : '') + nova;\n  })()\n}}\n",
                          "annotationUi": {}
                        }
                      ]
                    }
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notionTool",
            "typeVersion": 2.2,
            "position": [
              1760,
              784
            ],
            "id": "5615de19-dd2f-4ff4-9297-011b679153c9",
            "name": "RegistroMemoria",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "name": "save_xlsx",
              "description": "Call this tool to save bigquery json response as a xlsx file and return it to the chat user.",
              "workflowId": {
                "__rl": true,
                "value": "k8tv47GLScBdQI1h",
                "mode": "list",
                "cachedResultName": "Save xlsx"
              },
              "workflowInputs": {
                "mappingMode": "defineBelow",
                "value": {},
                "matchingColumns": [],
                "schema": [],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
            "typeVersion": 2.1,
            "position": [
              1440,
              848
            ],
            "id": "6989ec2d-ca46-41e9-9895-961ee7cf9366",
            "name": "Call n8n Workflow Tool"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-4.1",
                "mode": "list",
                "cachedResultName": "gpt-4.1"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              1280,
              512
            ],
            "id": "d3f48128-4c85-48d0-aa54-99ac72bfd744",
            "name": "OpenAI Chat Model1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "tableId": "pessoas",
              "filters": {
                "conditions": [
                  {
                    "keyName": "telefone",
                    "keyValue": "={{$json.query.telefone }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              -48,
              448
            ],
            "id": "a45d2851-53e5-4f79-9a4d-de6fa9adbde1",
            "name": "Get a row1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "// items contém o array de entrada do n8n\nconst projetos = items.map(item => {\n  const projeto = item.json.projeto?.trim();\n  const vertical = item.json.vertical?.trim();\n\n  // ignora projetos vazios\n  if (!projeto) return null;\n\n  // fallback quando vertical é null\n  const verticalLabel = vertical ?? 'Sem vertical';\n\n  return `${projeto}`;\n}).filter(Boolean);\n\n// retorna como uma única string (quebra de linha)\nreturn [\n  {\n    json: {\n      resultado: projetos.join('\\n')\n    }\n  }\n];\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              48,
              608
            ],
            "id": "1c3a04d0-a13b-4079-bd68-f184ee07349a",
            "name": "Code in JavaScript"
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              256,
              464
            ],
            "id": "4dfbfc6d-3019-4d4c-b930-cd588bf9f014",
            "name": "Merge"
          },
          {
            "parameters": {
              "operation": "getAll",
              "tableId": "projetos_gp",
              "returnAll": true,
              "matchType": "allFilters"
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              -144,
              608
            ],
            "id": "f34f1d22-6d6b-4132-a373-e55af6376cf8",
            "name": "Get many rows1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "aggregate": "aggregateAllItemData",
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              464,
              464
            ],
            "id": "8c45fae8-73b6-4bbf-97f9-9cf727c38f09",
            "name": "Aggregate1"
          },
          {
            "parameters": {
              "tableId": "alocacoes_horas",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "email",
                    "fieldValue": "={{ $('Aggregate1').item.json.data[0].email }}"
                  },
                  {
                    "fieldId": "nome_pessoa",
                    "fieldValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                  },
                  {
                    "fieldId": "projeto",
                    "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', `Projeto da lista correspondente ao pedido, o nome deve estar igual a correspondencia da lista, não ao pedido do usuário`, 'string') }}"
                  },
                  {
                    "fieldId": "dia",
                    "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', `Dia da atividade formato YYYY-MM-DD`, 'string') }}"
                  },
                  {
                    "fieldId": "horas",
                    "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues4_Field_Value', `Numero de horas do pedido`, 'string') }}"
                  },
                  {
                    "fieldId": "cargo",
                    "fieldValue": "={{ $('Aggregate1').item.json.data[0].cargo }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              1088,
              1328
            ],
            "id": "f9aed4a9-34be-4211-aeec-61e9d80060cc",
            "name": "Criar alocação",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "operation": "delete",
              "tableId": "alocacoes_horas",
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "keyName": "nome_pessoa",
                    "condition": "=eq",
                    "keyValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                  },
                  {
                    "keyName": "dia",
                    "condition": "eq",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Field_Value', `Dia da atividade formato YYYY-MM-DD`, 'string') }}"
                  },
                  {
                    "keyName": "projeto",
                    "condition": "eq",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions2_Field_Value', `Projeto da lista correspondente ao pedido, o nome deve estar igual a correspondencia da lista, não ao pedido do usuário`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              1232,
              1328
            ],
            "id": "56531b57-74ce-4feb-a191-18cdff884461",
            "name": "Deletar alocação",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "operation": "getAll",
              "tableId": "alocacoes_horas",
              "returnAll": true,
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "keyName": "nome_pessoa",
                    "condition": "eq",
                    "keyValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                  },
                  {
                    "keyName": "dia",
                    "condition": "eq",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions2_Field_Value', `Dia da atividade formato YYYY-MM-DD`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              1088,
              1168
            ],
            "id": "cfbfe221-6290-4065-beaf-e3c2e0db1529",
            "name": "Buscar alocações dia",
            "rewireOutputLogTo": "ai_tool",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "operation": "getAll",
              "tableId": "alocacoes_horas",
              "returnAll": true,
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "keyName": "nome_pessoa",
                    "condition": "eq",
                    "keyValue": "={{ $('Aggregate1').item.json.data[0].nome }}"
                  },
                  {
                    "keyName": "projeto",
                    "condition": "eq",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions1_Field_Value', `Projeto pedido no prompt`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              1232,
              1168
            ],
            "id": "b6a7211d-191c-4a92-acdc-b0d9b0b61057",
            "name": "Buscar alocações projeto",
            "rewireOutputLogTo": "ai_tool",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          }
        ],
        "connections": {
          "Webhook": {
            "main": [
              [
                {
                  "node": "Get a row1",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Get many rows1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Perplexity": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Google": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Criar tarefa": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Lista projetos": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Lista tarefas": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Lista prospects abertos": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI1": {
            "ai_embedding": [
              [
                {
                  "node": "Base de conhcimento",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Base de conhcimento": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent": {
            "main": [
              [
                {
                  "node": "Information Extractor",
                  "type": "main",
                  "index": 0
                }
              ],
              []
            ]
          },
          "Slides": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Switch": {
            "main": [
              [
                {
                  "node": "Edit Fields2",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Respond to Webhook1",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Respond to Webhook1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Extract from File": {
            "main": [
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Information Extractor": {
            "main": [
              [
                {
                  "node": "Switch",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "RegistrarOutput",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields2": {
            "main": [
              [
                {
                  "node": "Split Out",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Split Out": {
            "main": [
              [
                {
                  "node": "Download from Supabase",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Slides_via tag": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Download from Supabase": {
            "main": [
              [
                {
                  "node": "Extract from File",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Calculator": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Agente DataLake": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Reunioes Pinhao": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate": {
            "main": [
              [
                {
                  "node": "Respond to Webhook",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "Aggregate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "RegistroMemoria": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Call n8n Workflow Tool": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model1": {
            "ai_languageModel": [
              [
                {
                  "node": "Information Extractor",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Get a row1": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "Aggregate1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many rows1": {
            "main": [
              [
                {
                  "node": "Code in JavaScript",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate1": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Criar alocação": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Deletar alocação": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Buscar alocações dia": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Buscar alocações projeto": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 042400e8",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-22T17:12:29.072Z",
            "id": 150,
            "workflowId": "Hnf52KRQWgkwPSs4",
            "versionId": "042400e8-6ec8-4057-8ed1-eb69f69fb12f",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          },
          {
            "createdAt": "2026-01-16T19:22:20.981Z",
            "id": 132,
            "workflowId": "Hnf52KRQWgkwPSs4",
            "versionId": "042400e8-6ec8-4057-8ed1-eb69f69fb12f",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-14T13:52:49.844Z",
      "createdAt": "2025-06-28T21:32:19.687Z",
      "id": "MntM8gWEwIbho0zZ",
      "name": "Llamaparse",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "632e8eea-7479-40a4-9aa0-27de80c61094",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            -80,
            0
          ],
          "id": "fd970fa1-d5f7-4436-93bb-5ab5332caf1d",
          "name": "Webhook",
          "webhookId": "632e8eea-7479-40a4-9aa0-27de80c61094"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.cloud.llamaindex.ai/api/v1/parsing/upload",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "contentType": "multipart-form-data",
            "bodyParameters": {
              "parameters": [
                {
                  "parameterType": "formBinaryData",
                  "name": "file",
                  "inputDataFieldName": "arquivo"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            880,
            0
          ],
          "id": "58e5b768-0335-4d70-8d12-149161a6e04f",
          "name": "HTTP Request",
          "credentials": {
            "httpBearerAuth": {
              "id": "AnsrbOZlFPnW3BTa",
              "name": "Llamaparse"
            }
          }
        },
        {
          "parameters": {
            "url": "=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $json.id }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1280,
            0
          ],
          "id": "d3ecb197-7cca-43dd-a44b-e8038659b632",
          "name": "HTTP Request1",
          "credentials": {
            "httpBearerAuth": {
              "id": "AnsrbOZlFPnW3BTa",
              "name": "Llamaparse"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.wait",
          "typeVersion": 1.1,
          "position": [
            1104,
            0
          ],
          "id": "61daf311-7888-4aa5-9862-fddbdaad1445",
          "name": "Wait",
          "webhookId": "7ca09a46-66ce-4e12-8cd2-802e3ed41407"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "PENDING",
                        "operator": {
                          "type": "string",
                          "operation": "equals"
                        },
                        "id": "3450eba8-5bcd-4418-919c-6fa1adcb717c"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "pending"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "2ec3854d-8b82-4510-bdf0-599b2eb50553",
                        "leftValue": "={{ $json.status }}",
                        "rightValue": "SUCCESS",
                        "operator": {
                          "type": "string",
                          "operation": "equals",
                          "name": "filter.operator.equals"
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "success"
                }
              ]
            },
            "options": {
              "fallbackOutput": "extra"
            }
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            1504,
            0
          ],
          "id": "c53b163b-3a06-49dc-ab50-cb6823eec28d",
          "name": "Switch"
        },
        {
          "parameters": {
            "url": "=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $json.id }}/result/markdown",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpBearerAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            1728,
            0
          ],
          "id": "152cc4fd-2b5a-4285-b03e-19ac182e9492",
          "name": "HTTP Request2",
          "credentials": {
            "httpBearerAuth": {
              "id": "AnsrbOZlFPnW3BTa",
              "name": "Llamaparse"
            }
          }
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={\n  \"status\": \"success\",\n  \"data\": {{ JSON.stringify($json.markdown) }}\n} ",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            1952,
            0
          ],
          "id": "e9e8ea7a-11cc-46d6-b787-45ec60ea57bf",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "rules": {
              "values": [
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "leftValue": "={{ $json.body.arquivobase64 }}",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "exists",
                          "singleValue": true
                        },
                        "id": "a5e8698c-98e7-4c42-88ab-ccbe87a908ab"
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "base64"
                },
                {
                  "conditions": {
                    "options": {
                      "caseSensitive": true,
                      "leftValue": "",
                      "typeValidation": "strict",
                      "version": 2
                    },
                    "conditions": [
                      {
                        "id": "c6d88ccf-88de-4ada-823e-56b52f7f4160",
                        "leftValue": "arquivo",
                        "rightValue": "",
                        "operator": {
                          "type": "string",
                          "operation": "exists",
                          "singleValue": true
                        }
                      }
                    ],
                    "combinator": "and"
                  },
                  "renameOutput": true,
                  "outputKey": "arquivo"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.switch",
          "typeVersion": 3.2,
          "position": [
            144,
            0
          ],
          "id": "fdc1ae09-80c5-4f4b-a58c-7ea9fe7ab7d5",
          "name": "Switch1"
        },
        {
          "parameters": {
            "operation": "toBinary",
            "sourceProperty": "body.arquivobase64",
            "binaryPropertyName": "arquivo",
            "options": {}
          },
          "type": "n8n-nodes-base.convertToFile",
          "typeVersion": 1.1,
          "position": [
            368,
            -96
          ],
          "id": "5c94b759-df74-4e79-a7a3-03db0567d629",
          "name": "Convert to File"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            640,
            0
          ],
          "id": "f4fa9e0d-510a-4c56-b92b-aa4b8e21c10c",
          "name": "Merge"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Switch1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Wait",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Wait": {
          "main": [
            [
              {
                "node": "HTTP Request1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request1": {
          "main": [
            [
              {
                "node": "Switch",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch": {
          "main": [
            [
              {
                "node": "Wait",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "HTTP Request2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request2": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Switch1": {
          "main": [
            [
              {
                "node": "Convert to File",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Convert to File": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": null,
      "pinData": {},
      "versionId": "bb05ee16-db73-4db8-aa80-f19dfdd015e9",
      "activeVersionId": "d4006dc6-2fb9-4e42-9704-ce7e7793bd22",
      "versionCounter": 51,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-06-28T21:32:19.687Z",
          "createdAt": "2025-06-28T21:32:19.687Z",
          "role": "workflow:owner",
          "workflowId": "MntM8gWEwIbho0zZ",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-14T13:21:31.423Z",
          "createdAt": "2026-01-14T13:21:31.423Z",
          "id": "8pv6dakS5M8aOsyG",
          "name": "outdated"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "d4006dc6-2fb9-4e42-9704-ce7e7793bd22",
        "workflowId": "MntM8gWEwIbho0zZ",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "632e8eea-7479-40a4-9aa0-27de80c61094",
              "responseMode": "responseNode",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              -80,
              0
            ],
            "id": "fd970fa1-d5f7-4436-93bb-5ab5332caf1d",
            "name": "Webhook",
            "webhookId": "632e8eea-7479-40a4-9aa0-27de80c61094"
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://api.cloud.llamaindex.ai/api/v1/parsing/upload",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpBearerAuth",
              "sendHeaders": true,
              "headerParameters": {
                "parameters": [
                  {
                    "name": "accept",
                    "value": "application/json"
                  }
                ]
              },
              "sendBody": true,
              "contentType": "multipart-form-data",
              "bodyParameters": {
                "parameters": [
                  {
                    "parameterType": "formBinaryData",
                    "name": "file",
                    "inputDataFieldName": "arquivo"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              880,
              0
            ],
            "id": "58e5b768-0335-4d70-8d12-149161a6e04f",
            "name": "HTTP Request",
            "credentials": {
              "httpBearerAuth": {
                "id": "AnsrbOZlFPnW3BTa",
                "name": "Llamaparse"
              }
            }
          },
          {
            "parameters": {
              "url": "=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $json.id }}",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpBearerAuth",
              "sendHeaders": true,
              "headerParameters": {
                "parameters": [
                  {
                    "name": "accept",
                    "value": "application/json"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              1280,
              0
            ],
            "id": "d3ecb197-7cca-43dd-a44b-e8038659b632",
            "name": "HTTP Request1",
            "credentials": {
              "httpBearerAuth": {
                "id": "AnsrbOZlFPnW3BTa",
                "name": "Llamaparse"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.wait",
            "typeVersion": 1.1,
            "position": [
              1100,
              0
            ],
            "id": "61daf311-7888-4aa5-9862-fddbdaad1445",
            "name": "Wait",
            "webhookId": "7ca09a46-66ce-4e12-8cd2-802e3ed41407"
          },
          {
            "parameters": {
              "rules": {
                "values": [
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "leftValue": "={{ $json.status }}",
                          "rightValue": "PENDING",
                          "operator": {
                            "type": "string",
                            "operation": "equals"
                          },
                          "id": "3450eba8-5bcd-4418-919c-6fa1adcb717c"
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "pending"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "2ec3854d-8b82-4510-bdf0-599b2eb50553",
                          "leftValue": "={{ $json.status }}",
                          "rightValue": "SUCCESS",
                          "operator": {
                            "type": "string",
                            "operation": "equals",
                            "name": "filter.operator.equals"
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "success"
                  }
                ]
              },
              "options": {
                "fallbackOutput": "extra"
              }
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.2,
            "position": [
              1500,
              0
            ],
            "id": "c53b163b-3a06-49dc-ab50-cb6823eec28d",
            "name": "Switch"
          },
          {
            "parameters": {
              "url": "=https://api.cloud.llamaindex.ai/api/v1/parsing/job/{{ $json.id }}/result/markdown",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpBearerAuth",
              "sendHeaders": true,
              "headerParameters": {
                "parameters": [
                  {
                    "name": "accept",
                    "value": "application/json"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              1720,
              0
            ],
            "id": "152cc4fd-2b5a-4285-b03e-19ac182e9492",
            "name": "HTTP Request2",
            "credentials": {
              "httpBearerAuth": {
                "id": "AnsrbOZlFPnW3BTa",
                "name": "Llamaparse"
              }
            }
          },
          {
            "parameters": {
              "respondWith": "json",
              "responseBody": "={\n  \"status\": \"success\",\n  \"data\": {{ JSON.stringify($json.markdown) }}\n} ",
              "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.4,
            "position": [
              1940,
              0
            ],
            "id": "e9e8ea7a-11cc-46d6-b787-45ec60ea57bf",
            "name": "Respond to Webhook"
          },
          {
            "parameters": {
              "rules": {
                "values": [
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "leftValue": "={{ $json.body.arquivobase64 }}",
                          "rightValue": "",
                          "operator": {
                            "type": "string",
                            "operation": "exists",
                            "singleValue": true
                          },
                          "id": "a5e8698c-98e7-4c42-88ab-ccbe87a908ab"
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "base64"
                  },
                  {
                    "conditions": {
                      "options": {
                        "caseSensitive": true,
                        "leftValue": "",
                        "typeValidation": "strict",
                        "version": 2
                      },
                      "conditions": [
                        {
                          "id": "c6d88ccf-88de-4ada-823e-56b52f7f4160",
                          "leftValue": "arquivo",
                          "rightValue": "",
                          "operator": {
                            "type": "string",
                            "operation": "exists",
                            "singleValue": true
                          }
                        }
                      ],
                      "combinator": "and"
                    },
                    "renameOutput": true,
                    "outputKey": "arquivo"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.switch",
            "typeVersion": 3.2,
            "position": [
              140,
              0
            ],
            "id": "fdc1ae09-80c5-4f4b-a58c-7ea9fe7ab7d5",
            "name": "Switch1"
          },
          {
            "parameters": {
              "operation": "toBinary",
              "sourceProperty": "body.arquivobase64",
              "binaryPropertyName": "arquivo",
              "options": {}
            },
            "type": "n8n-nodes-base.convertToFile",
            "typeVersion": 1.1,
            "position": [
              360,
              -100
            ],
            "id": "5c94b759-df74-4e79-a7a3-03db0567d629",
            "name": "Convert to File"
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              640,
              0
            ],
            "id": "f4fa9e0d-510a-4c56-b92b-aa4b8e21c10c",
            "name": "Merge"
          }
        ],
        "connections": {
          "Webhook": {
            "main": [
              [
                {
                  "node": "Switch1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request": {
            "main": [
              [
                {
                  "node": "Wait",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Wait": {
            "main": [
              [
                {
                  "node": "HTTP Request1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request1": {
            "main": [
              [
                {
                  "node": "Switch",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Switch": {
            "main": [
              [
                {
                  "node": "Wait",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "HTTP Request2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request2": {
            "main": [
              [
                {
                  "node": "Respond to Webhook",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Switch1": {
            "main": [
              [
                {
                  "node": "Convert to File",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Convert to File": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "HTTP Request",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-06-28T21:58:00.647Z",
            "id": 13,
            "workflowId": "MntM8gWEwIbho0zZ",
            "versionId": "d4006dc6-2fb9-4e42-9704-ce7e7793bd22",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-02-11T18:10:08.944Z",
      "createdAt": "2025-07-23T19:13:20.373Z",
      "id": "2oauDYUglr1vkbiw",
      "name": "Pessoas Sharepoint  - Notion - Supabase",
      "description": "(Atualmente desativado por problemas no id) Mantêm atualizado conforme o azure de pessoas da Píer os dados no database Pessoas do Notion, criando para aqueles que ainda não existem e atualizando os dados em caso de mudança. Possuí tambem no fluxo a atualização diaária dos projetos do notion para o supabase.",
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Telefone|rich_text",
                  "condition": "is_not_empty"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            352,
            1200
          ],
          "id": "abcd690b-8695-4028-b1d8-f3b50f86deff",
          "name": "Get many database pages1",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3b745feb-e9a5-4d09-9f24-601c419e84e1",
                  "leftValue": "={{ $json.mobilePhone }}",
                  "rightValue": "^\\d+$",
                  "operator": {
                    "type": "string",
                    "operation": "regex"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            720,
            960
          ],
          "id": "9a3e4e27-b90f-4d69-ba25-6c7ec5254b59",
          "name": "Filter2"
        },
        {
          "parameters": {
            "content": "## Criar pessoa no Notion\n### Com base na condição: está cadastrado no sharepoint, tem telefone e não está com id do notion preenchido (aboutMe)\n**TO-DO: Lidar com deleções**",
            "height": 736,
            "width": 1856
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -208,
            784
          ],
          "typeVersion": 1,
          "id": "63943969-4846-4a20-a131-82b771b8d817",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "databaseId": {
              "__rl": true,
              "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
              "mode": "id"
            },
            "title": "={{ $json.displayName }}",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Email|email",
                  "emailValue": "={{ $json.mail }}"
                },
                {
                  "key": "Telefone|rich_text",
                  "textContent": "={{ $json.mobilePhone }}"
                },
                {
                  "key": "Aniversário|date",
                  "includeTime": false,
                  "date": "={{ $json.birthday.split(\"T\")[0] }}"
                },
                {
                  "key": "Vertical|select",
                  "selectValue": "={{ $json.department }}"
                },
                {
                  "key": "Posição|select",
                  "selectValue": "={{ $json.jobTitle }}"
                },
                {
                  "key": "Nome|title",
                  "title": "={{ $json.displayName }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1200,
            1184
          ],
          "id": "9f6f4d50-234f-43fc-9036-9b937b2f38f9",
          "name": "Create a database page",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "returnAll": true,
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            352,
            960
          ],
          "id": "8e1cc756-b01d-4a0a-9081-537a806dc59f",
          "name": "Get many users2",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "user": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "output": "fields",
            "fields": [
              "aboutMe",
              "birthday",
              "department",
              "employeeHireDate",
              "jobTitle",
              "mail",
              "mobilePhone",
              "userPrincipalName",
              "displayName"
            ],
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            544,
            960
          ],
          "id": "ca59fd82-032b-41bd-907d-7f814794d992",
          "name": "Get user1",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "mode": "combine",
            "advanced": true,
            "mergeByFields": {
              "values": [
                {
                  "field1": "aboutMe",
                  "field2": "id"
                }
              ]
            },
            "joinMode": "keepNonMatches",
            "outputDataFrom": "input1",
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            992,
            1184
          ],
          "id": "ce220eb1-70e2-4aed-b695-b67a7ca58d83",
          "name": "Busca não criados no Notion"
        },
        {
          "parameters": {
            "mode": "combine",
            "advanced": true,
            "mergeByFields": {
              "values": [
                {
                  "field1": "aboutMe",
                  "field2": "id"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            992,
            976
          ],
          "id": "8ab9de4a-9c98-43d7-a5d0-7d28f359dd87",
          "name": "Cruza informações"
        },
        {
          "parameters": {
            "jsCode": "return items.filter(item => {\n  return item.json.mail !== item.json.property_email || item.json.mobilePhone !== item.json.property_telefone || item.json.birthday.split('T')[0] !== item.json.property_anivers_rio.start || \nitem.json.department !== item.json.property_vertical || item.json.jobTitle !== item.json.property_posi_o \n});"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1200,
            976
          ],
          "id": "7f8f07a4-53e3-472a-991e-148133b27324",
          "name": "Code1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3b745feb-e9a5-4d09-9f24-601c419e84e1",
                  "leftValue": "={{ $json.mobilePhone }}",
                  "rightValue": "^\\d+$",
                  "operator": {
                    "type": "string",
                    "operation": "regex"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            560,
            1680
          ],
          "id": "9e61035c-a79b-4b10-b9f0-a2f968a557a6",
          "name": "Filter"
        },
        {
          "parameters": {
            "returnAll": true,
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            192,
            1680
          ],
          "id": "1bdfaa48-b1b8-42cd-b13f-564478ca1343",
          "name": "Get many users3",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "user": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "output": "fields",
            "fields": [
              "aboutMe",
              "birthday",
              "department",
              "employeeHireDate",
              "jobTitle",
              "mail",
              "mobilePhone",
              "userPrincipalName",
              "displayName"
            ],
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            384,
            1680
          ],
          "id": "25a41ff0-3a6d-43de-92ca-be596d74b97e",
          "name": "Get user",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "2c456cda-98f8-4de2-ac43-7836bee70703",
                  "name": "id_notion",
                  "value": "={{ $json.aboutMe }}",
                  "type": "string"
                },
                {
                  "id": "69035d94-c125-4b98-b04c-422011d1d6bd",
                  "name": "id_microsoft",
                  "value": "={{ $json.id }}",
                  "type": "string"
                },
                {
                  "id": "dda09bb9-4e7f-40e0-958d-e14a14a99904",
                  "name": "nome",
                  "value": "={{ $json.displayName }}",
                  "type": "string"
                },
                {
                  "id": "cd42519c-f781-4f3e-9d25-a59b4740ac9e",
                  "name": "vertical",
                  "value": "={{ $json.department }}",
                  "type": "string"
                },
                {
                  "id": "cad1b65e-d1c2-4b17-96ac-ab7fe612e9fa",
                  "name": "cargo",
                  "value": "={{ $json.jobTitle }}",
                  "type": "string"
                },
                {
                  "id": "b8d01a9c-3a7b-4152-94fc-39bd2e6f57bd",
                  "name": "email",
                  "value": "={{ $json.mail }}",
                  "type": "string"
                },
                {
                  "id": "25f2a93e-1389-4d4a-9202-e169e7e36842",
                  "name": "telefone",
                  "value": "={{ $json.mobilePhone }}",
                  "type": "string"
                },
                {
                  "id": "70b8fbee-b5e1-4792-b2d1-ec4a1ff6737d",
                  "name": "aniversario",
                  "value": "={{ $json.birthday }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            736,
            1680
          ],
          "id": "ca2eb5c4-2944-4b91-8be3-6e30443f854e",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "operation": "update",
            "tableId": "pessoas",
            "filters": {
              "conditions": [
                {
                  "keyName": "id_microsoft",
                  "condition": "eq",
                  "keyValue": "={{ $json.id_microsoft }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "nome",
                  "fieldValue": "={{ $('Edit Fields').item.json.nome }}"
                },
                {
                  "fieldId": "email",
                  "fieldValue": "={{ $('Edit Fields').item.json.email }}"
                },
                {
                  "fieldId": "telefone",
                  "fieldValue": "={{ $('Edit Fields').item.json.telefone }}"
                },
                {
                  "fieldId": "id_notion",
                  "fieldValue": "={{ $('Edit Fields').item.json.id_notion }}"
                },
                {
                  "fieldId": "vertical",
                  "fieldValue": "={{ $('Edit Fields').item.json.vertical }}"
                },
                {
                  "fieldId": "cargo",
                  "fieldValue": "={{ $('Edit Fields').item.json.cargo }}"
                },
                {
                  "fieldId": "aniversario",
                  "fieldValue": "={{ $('Edit Fields').item.json.aniversario }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            1536,
            1968
          ],
          "id": "165977a7-a0d1-4796-850a-d4730237a740",
          "name": "Update a row",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "pessoas",
            "filters": {
              "conditions": [
                {
                  "keyName": "id_microsoft",
                  "keyValue": "={{ $json.id_microsoft }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            1104,
            2048
          ],
          "id": "55c43ee5-b185-4d13-a2a4-3f5d508b1c2c",
          "name": "Get a row",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            928,
            1888
          ],
          "id": "28795c16-6fb9-4a8c-8362-b195a7be263a",
          "name": "Loop Over Items1"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "542c1d17-d430-4696-b8ce-4ded78df50cf",
                  "leftValue": "={{ $json.id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "number",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.2,
          "position": [
            1296,
            2048
          ],
          "id": "f6b7789b-b287-4916-8580-c77db7644383",
          "name": "Exists"
        },
        {
          "parameters": {
            "tableId": "pessoas",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "nome",
                  "fieldValue": "={{ $('Edit Fields').item.json.nome }}"
                },
                {
                  "fieldId": "email",
                  "fieldValue": "={{ $('Edit Fields').item.json.email }}"
                },
                {
                  "fieldId": "telefone",
                  "fieldValue": "={{ $('Edit Fields').item.json.telefone }}"
                },
                {
                  "fieldId": "id_microsoft",
                  "fieldValue": "={{ $('Edit Fields').item.json.id_microsoft }}"
                },
                {
                  "fieldId": "id_notion",
                  "fieldValue": "={{ $('Edit Fields').item.json.id_notion }}"
                },
                {
                  "fieldId": "vertical",
                  "fieldValue": "={{ $('Edit Fields').item.json.vertical }}"
                },
                {
                  "fieldId": "cargo",
                  "fieldValue": "={{ $('Edit Fields').item.json.cargo }}"
                },
                {
                  "fieldId": "aniversario",
                  "fieldValue": "={{ $('Edit Fields').item.json.aniversario }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            1536,
            2128
          ],
          "id": "0a373c7b-ffcc-4fbd-b369-483d350d3b42",
          "name": "Create a row",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            1776,
            2048
          ],
          "id": "49ef9de3-e8c7-40dc-b5b9-0314da978e82",
          "name": "Merge"
        },
        {
          "parameters": {
            "operation": "update",
            "user": {
              "__rl": true,
              "value": "={{ $('Busca não criados no Notion').item.json.id }}",
              "mode": "id"
            },
            "updateFields": {
              "aboutMe": "={{ $json.id }}"
            },
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            1408,
            1184
          ],
          "id": "c1d6795c-a694-4c1a-91bb-16f3751db9a1",
          "name": "Preenche ID Notion",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "update",
            "pageId": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Aniversário|date",
                  "includeTime": false,
                  "date": "={{ $json.birthday.split(\"T\")[0] }}"
                },
                {
                  "key": "Vertical|select",
                  "selectValue": "={{ $json.department }}"
                },
                {
                  "key": "Posição|select",
                  "selectValue": "={{ $json.jobTitle }}"
                },
                {
                  "key": "Email|email",
                  "emailValue": "={{ $json.mail }}"
                },
                {
                  "key": "Telefone|rich_text",
                  "textContent": "={{ $json.mobilePhone }}"
                },
                {
                  "key": "Nome|title",
                  "title": "={{ $json.name }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1408,
            976
          ],
          "id": "8e89e35f-59b3-4168-9bf2-a3165d953ac0",
          "name": "Update a database page",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 1
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -144,
            1088
          ],
          "id": "60eb246f-3201-4ad3-b9b8-0527fbd2bb25",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "triggerAtHour": 2
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -144,
            1680
          ],
          "id": "4d24cc14-d258-45b6-a187-fb5acbdccb3c",
          "name": "Schedule Trigger1"
        },
        {
          "parameters": {
            "content": "## Carrega no Supabase\n### Com base na condição: está cadastrado no sharepoint e tem telefone. Se o id_microsoft já existe no Supabase, faz update. Se não, faz insert.\n**TO-DO: Lidar com deleções**",
            "height": 736,
            "width": 2176
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -208,
            1568
          ],
          "typeVersion": 1,
          "id": "885c8a3a-100e-4624-ba76-56767239208e",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "## Carrega projetos no Supabase",
            "height": 608,
            "width": 1280
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -208,
            2352
          ],
          "typeVersion": 1,
          "id": "d49ab468-94f8-4fc6-9e4a-03863d5270fc",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {}
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -128,
            2656
          ],
          "id": "0bc9a81b-2a2c-4355-8e3d-a38f64c6d3a7",
          "name": "Schedule Trigger2"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "c2af396cc2a347eca452b2b2bf6b9031",
              "mode": "id"
            },
            "returnAll": true,
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            272,
            2656
          ],
          "id": "4c47cbe8-c76b-4f08-a7bb-acfffb68a8ce",
          "name": "Get many database pages",
          "retryOnFail": true,
          "waitBetweenTries": 5000,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "54157827-662f-4765-af49-d6525442c4a4",
                  "name": "id_notion",
                  "value": "={{ $json.id }}",
                  "type": "string"
                },
                {
                  "id": "59039e65-9f12-4749-9578-0777f02e9d60",
                  "name": "projeto",
                  "value": "={{ $json.name }}",
                  "type": "string"
                },
                {
                  "id": "99ca1fc0-46a6-47ae-8e91-b3dc9447a5e2",
                  "name": "empresa",
                  "value": "={{ $json.property_empresa }}",
                  "type": "string"
                },
                {
                  "id": "58986c42-930d-4267-b5ed-a708c5f290c8",
                  "name": "vertical",
                  "value": "={{ $json.property_vertical }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            448,
            2656
          ],
          "id": "12754d74-38a9-42c0-a12d-b2777652e259",
          "name": "Edit Fields1"
        },
        {
          "parameters": {
            "tableId": "projetos",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "projeto",
                  "fieldValue": "={{ $json.projeto }}"
                },
                {
                  "fieldId": "empresa",
                  "fieldValue": "={{ $json.empresa }}"
                },
                {
                  "fieldId": "id_notion",
                  "fieldValue": "={{ $json.id_notion }}"
                },
                {
                  "fieldId": "vertical",
                  "fieldValue": "={{ $json.vertical }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            896,
            2720
          ],
          "id": "ba5269be-289e-4fc4-bc89-9633aad2aee9",
          "name": "Create a row1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            672,
            2656
          ],
          "id": "a046a5be-f5fe-4f16-baa3-b18d4d8d4ec9",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "projetos",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "gt",
                  "keyValue": "0"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            96,
            2512
          ],
          "id": "b0ef7ea4-55ec-4c9e-bfc5-d64d7eb372a0",
          "name": "Delete a row",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "url": "https://graph.microsoft.com/v1.0/me",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "microsoftEntraOAuth2Api",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            64,
            1088
          ],
          "id": "0948043e-fcaf-4d73-81c5-315e3751af3f",
          "name": "HTTP Request",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "url": "https://graph.microsoft.com/v1.0/me",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "microsoftEntraOAuth2Api",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            16,
            1680
          ],
          "id": "f92c3658-d34c-44d4-9287-24c8723d9cf9",
          "name": "HTTP Request1",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Telefone|rich_text",
                  "condition": "is_not_empty"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            544,
            400
          ],
          "id": "70980835-ff97-4e22-8bff-25808326e700",
          "name": "Get many database pages2",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "3b745feb-e9a5-4d09-9f24-601c419e84e1",
                  "leftValue": "={{ $json.aboutMe }}",
                  "rightValue": "^\\d+$",
                  "operator": {
                    "type": "string",
                    "operation": "notEmpty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            720,
            176
          ],
          "id": "960f3b92-714d-4cc7-be99-37b1681422fa",
          "name": "Filter3"
        },
        {
          "parameters": {
            "content": "## Ajustar informação user azure\n### Com base na condição: está cadastrado no sharepoint, tem telefone e não está com id do notion preenchido (aboutMe)",
            "height": 736,
            "width": 1856
          },
          "type": "n8n-nodes-base.stickyNote",
          "position": [
            -208,
            0
          ],
          "typeVersion": 1,
          "id": "8b16ae05-1b17-49a9-afef-de41f634036c",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "returnAll": true,
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            352,
            176
          ],
          "id": "df8aff9b-54c5-4794-b970-43f1af359e96",
          "name": "Get many users",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "user": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "output": "fields",
            "fields": [
              "aboutMe",
              "birthday",
              "department",
              "employeeHireDate",
              "jobTitle",
              "mail",
              "mobilePhone",
              "userPrincipalName",
              "displayName"
            ],
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            544,
            176
          ],
          "id": "ae590faa-6f1d-4f3b-95e1-42c3fa0c0545",
          "name": "Get user2",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "mode": "combine",
            "advanced": true,
            "mergeByFields": {
              "values": [
                {
                  "field1": "aboutMe",
                  "field2": "id"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            976,
            304
          ],
          "id": "4c3c67d5-52d9-4cb3-bda6-c57bb96ac440",
          "name": "Busca não criados no Notion1"
        },
        {
          "parameters": {
            "url": "https://graph.microsoft.com/v1.0/me",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "microsoftEntraOAuth2Api",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            64,
            320
          ],
          "id": "5fefa117-07f7-4c89-aec0-2f8e83a45d92",
          "name": "HTTP Request2",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -144,
            320
          ],
          "id": "ed37b21a-28f8-47b4-b892-5ece265eab46",
          "name": "When clicking ‘Execute workflow’"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 2
              },
              "conditions": [
                {
                  "id": "45a7bc05-1311-48ea-8995-eb03efed3d0f",
                  "leftValue": "={{ $json.property_hire_date != null && $json.property_hire_date !== '' }}",
                  "rightValue": "",
                  "operator": {
                    "type": "boolean",
                    "operation": "true",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.filter",
          "typeVersion": 2.2,
          "position": [
            1184,
            304
          ],
          "id": "d8fad07c-c366-4984-86a0-08f89e6c9a66",
          "name": "Filter1"
        },
        {
          "parameters": {
            "operation": "update",
            "user": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "updateFields": {
              "employeeHireDate": "={{ new Date($json.property_hire_date.start).toISOString() }}"
            },
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            1472,
            416
          ],
          "id": "ba4b8e27-ab5c-45f8-9b56-f2dab404150d",
          "name": "Preenche hiredate",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "user": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "output": "fields",
            "fields": [
              "aboutMe",
              "hireDate"
            ],
            "requestOptions": {}
          },
          "type": "n8n-nodes-base.microsoftEntra",
          "typeVersion": 1,
          "position": [
            1472,
            160
          ],
          "id": "cfe83718-f37a-4fbd-b49b-b165631332fa",
          "name": "Get user3",
          "credentials": {
            "microsoftEntraOAuth2Api": {
              "id": "4pvYUwvVLls5URCq",
              "name": "Microsoft Entra ID (Azure Active Directory) account"
            }
          }
        }
      ],
      "connections": {
        "Get many database pages1": {
          "main": [
            [
              {
                "node": "Busca não criados no Notion",
                "type": "main",
                "index": 1
              },
              {
                "node": "Cruza informações",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Filter2": {
          "main": [
            [
              {
                "node": "Busca não criados no Notion",
                "type": "main",
                "index": 0
              },
              {
                "node": "Cruza informações",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a database page": {
          "main": [
            [
              {
                "node": "Preenche ID Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many users2": {
          "main": [
            [
              {
                "node": "Get user1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get user1": {
          "main": [
            [
              {
                "node": "Filter2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca não criados no Notion": {
          "main": [
            [
              {
                "node": "Create a database page",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cruza informações": {
          "main": [
            [
              {
                "node": "Code1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many users3": {
          "main": [
            [
              {
                "node": "Get user",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get user": {
          "main": [
            [
              {
                "node": "Filter",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a row": {
          "main": [
            [
              {
                "node": "Exists",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items1": {
          "main": [
            [],
            [
              {
                "node": "Get a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Exists": {
          "main": [
            [
              {
                "node": "Update a row",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update a row": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code1": {
          "main": [
            [
              {
                "node": "Update a database page",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger1": {
          "main": [
            [
              {
                "node": "HTTP Request1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger2": {
          "main": [
            [
              {
                "node": "Delete a row",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get many database pages",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many database pages": {
          "main": [
            [
              {
                "node": "Edit Fields1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields1": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Create a row1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row1": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete a row": {
          "main": [
            []
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Get many database pages1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get many users2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request1": {
          "main": [
            [
              {
                "node": "Get many users3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many database pages2": {
          "main": [
            [
              {
                "node": "Busca não criados no Notion1",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Filter3": {
          "main": [
            [
              {
                "node": "Busca não criados no Notion1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many users": {
          "main": [
            [
              {
                "node": "Get user2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get user2": {
          "main": [
            [
              {
                "node": "Filter3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca não criados no Notion1": {
          "main": [
            [
              {
                "node": "Filter1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request2": {
          "main": [
            [
              {
                "node": "Get many users",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get many database pages2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "When clicking ‘Execute workflow’": {
          "main": [
            [
              {
                "node": "HTTP Request2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Filter1": {
          "main": [
            [
              {
                "node": "Get user3",
                "type": "main",
                "index": 0
              },
              {
                "node": "Preenche hiredate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "timeSavedMode": "fixed",
        "callerPolicy": "workflowsFromSameOwner",
        "availableInMCP": false
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        },
        "node:Schedule Trigger1": {
          "recurrenceRules": []
        },
        "node:Schedule Trigger2": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "9334320a-0961-40d0-a621-a25f13d63348",
      "activeVersionId": "9334320a-0961-40d0-a621-a25f13d63348",
      "versionCounter": 107,
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2025-07-23T19:13:20.373Z",
          "createdAt": "2025-07-23T19:13:20.373Z",
          "role": "workflow:owner",
          "workflowId": "2oauDYUglr1vkbiw",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [],
      "activeVersion": {
        "updatedAt": "2026-02-11T19:51:33.139Z",
        "createdAt": "2026-02-11T18:10:08.957Z",
        "versionId": "9334320a-0961-40d0-a621-a25f13d63348",
        "workflowId": "2oauDYUglr1vkbiw",
        "nodes": [
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Telefone|rich_text",
                    "condition": "is_not_empty"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              352,
              1200
            ],
            "id": "abcd690b-8695-4028-b1d8-f3b50f86deff",
            "name": "Get many database pages1",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3b745feb-e9a5-4d09-9f24-601c419e84e1",
                    "leftValue": "={{ $json.mobilePhone }}",
                    "rightValue": "^\\d+$",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.filter",
            "typeVersion": 2.2,
            "position": [
              720,
              960
            ],
            "id": "9a3e4e27-b90f-4d69-ba25-6c7ec5254b59",
            "name": "Filter2"
          },
          {
            "parameters": {
              "content": "## Criar pessoa no Notion\n### Com base na condição: está cadastrado no sharepoint, tem telefone e não está com id do notion preenchido (aboutMe)\n**TO-DO: Lidar com deleções**",
              "height": 736,
              "width": 1856
            },
            "type": "n8n-nodes-base.stickyNote",
            "position": [
              -208,
              784
            ],
            "typeVersion": 1,
            "id": "63943969-4846-4a20-a131-82b771b8d817",
            "name": "Sticky Note"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "databaseId": {
                "__rl": true,
                "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
                "mode": "id"
              },
              "title": "={{ $json.displayName }}",
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "Email|email",
                    "emailValue": "={{ $json.mail }}"
                  },
                  {
                    "key": "Telefone|rich_text",
                    "textContent": "={{ $json.mobilePhone }}"
                  },
                  {
                    "key": "Aniversário|date",
                    "includeTime": false,
                    "date": "={{ $json.birthday.split(\"T\")[0] }}"
                  },
                  {
                    "key": "Vertical|select",
                    "selectValue": "={{ $json.department }}"
                  },
                  {
                    "key": "Posição|select",
                    "selectValue": "={{ $json.jobTitle }}"
                  },
                  {
                    "key": "Nome|title",
                    "title": "={{ $json.displayName }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1200,
              1184
            ],
            "id": "9f6f4d50-234f-43fc-9036-9b937b2f38f9",
            "name": "Create a database page",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "returnAll": true,
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              352,
              960
            ],
            "id": "8e1cc756-b01d-4a0a-9081-537a806dc59f",
            "name": "Get many users2",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "user": {
                "__rl": true,
                "value": "={{ $json.id }}",
                "mode": "id"
              },
              "output": "fields",
              "fields": [
                "aboutMe",
                "birthday",
                "department",
                "employeeHireDate",
                "jobTitle",
                "mail",
                "mobilePhone",
                "userPrincipalName",
                "displayName"
              ],
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              544,
              960
            ],
            "id": "ca59fd82-032b-41bd-907d-7f814794d992",
            "name": "Get user1",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "mode": "combine",
              "advanced": true,
              "mergeByFields": {
                "values": [
                  {
                    "field1": "aboutMe",
                    "field2": "id"
                  }
                ]
              },
              "joinMode": "keepNonMatches",
              "outputDataFrom": "input1",
              "options": {}
            },
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              992,
              1184
            ],
            "id": "ce220eb1-70e2-4aed-b695-b67a7ca58d83",
            "name": "Busca não criados no Notion"
          },
          {
            "parameters": {
              "mode": "combine",
              "advanced": true,
              "mergeByFields": {
                "values": [
                  {
                    "field1": "aboutMe",
                    "field2": "id"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              992,
              976
            ],
            "id": "8ab9de4a-9c98-43d7-a5d0-7d28f359dd87",
            "name": "Cruza informações"
          },
          {
            "parameters": {
              "jsCode": "return items.filter(item => {\n  return item.json.mail !== item.json.property_email || item.json.mobilePhone !== item.json.property_telefone || item.json.birthday.split('T')[0] !== item.json.property_anivers_rio.start || \nitem.json.department !== item.json.property_vertical || item.json.jobTitle !== item.json.property_posi_o \n});"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1200,
              976
            ],
            "id": "7f8f07a4-53e3-472a-991e-148133b27324",
            "name": "Code1"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3b745feb-e9a5-4d09-9f24-601c419e84e1",
                    "leftValue": "={{ $json.mobilePhone }}",
                    "rightValue": "^\\d+$",
                    "operator": {
                      "type": "string",
                      "operation": "regex"
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.filter",
            "typeVersion": 2.2,
            "position": [
              560,
              1680
            ],
            "id": "9e61035c-a79b-4b10-b9f0-a2f968a557a6",
            "name": "Filter"
          },
          {
            "parameters": {
              "returnAll": true,
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              192,
              1680
            ],
            "id": "1bdfaa48-b1b8-42cd-b13f-564478ca1343",
            "name": "Get many users3",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "user": {
                "__rl": true,
                "value": "={{ $json.id }}",
                "mode": "id"
              },
              "output": "fields",
              "fields": [
                "aboutMe",
                "birthday",
                "department",
                "employeeHireDate",
                "jobTitle",
                "mail",
                "mobilePhone",
                "userPrincipalName",
                "displayName"
              ],
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              384,
              1680
            ],
            "id": "25a41ff0-3a6d-43de-92ca-be596d74b97e",
            "name": "Get user",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "2c456cda-98f8-4de2-ac43-7836bee70703",
                    "name": "id_notion",
                    "value": "={{ $json.aboutMe }}",
                    "type": "string"
                  },
                  {
                    "id": "69035d94-c125-4b98-b04c-422011d1d6bd",
                    "name": "id_microsoft",
                    "value": "={{ $json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "dda09bb9-4e7f-40e0-958d-e14a14a99904",
                    "name": "nome",
                    "value": "={{ $json.displayName }}",
                    "type": "string"
                  },
                  {
                    "id": "cd42519c-f781-4f3e-9d25-a59b4740ac9e",
                    "name": "vertical",
                    "value": "={{ $json.department }}",
                    "type": "string"
                  },
                  {
                    "id": "cad1b65e-d1c2-4b17-96ac-ab7fe612e9fa",
                    "name": "cargo",
                    "value": "={{ $json.jobTitle }}",
                    "type": "string"
                  },
                  {
                    "id": "b8d01a9c-3a7b-4152-94fc-39bd2e6f57bd",
                    "name": "email",
                    "value": "={{ $json.mail }}",
                    "type": "string"
                  },
                  {
                    "id": "25f2a93e-1389-4d4a-9202-e169e7e36842",
                    "name": "telefone",
                    "value": "={{ $json.mobilePhone }}",
                    "type": "string"
                  },
                  {
                    "id": "70b8fbee-b5e1-4792-b2d1-ec4a1ff6737d",
                    "name": "aniversario",
                    "value": "={{ $json.birthday }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              736,
              1680
            ],
            "id": "ca2eb5c4-2944-4b91-8be3-6e30443f854e",
            "name": "Edit Fields"
          },
          {
            "parameters": {
              "operation": "update",
              "tableId": "pessoas",
              "filters": {
                "conditions": [
                  {
                    "keyName": "id_microsoft",
                    "condition": "eq",
                    "keyValue": "={{ $json.id_microsoft }}"
                  }
                ]
              },
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "nome",
                    "fieldValue": "={{ $('Edit Fields').item.json.nome }}"
                  },
                  {
                    "fieldId": "email",
                    "fieldValue": "={{ $('Edit Fields').item.json.email }}"
                  },
                  {
                    "fieldId": "telefone",
                    "fieldValue": "={{ $('Edit Fields').item.json.telefone }}"
                  },
                  {
                    "fieldId": "id_notion",
                    "fieldValue": "={{ $('Edit Fields').item.json.id_notion }}"
                  },
                  {
                    "fieldId": "vertical",
                    "fieldValue": "={{ $('Edit Fields').item.json.vertical }}"
                  },
                  {
                    "fieldId": "cargo",
                    "fieldValue": "={{ $('Edit Fields').item.json.cargo }}"
                  },
                  {
                    "fieldId": "aniversario",
                    "fieldValue": "={{ $('Edit Fields').item.json.aniversario }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              1536,
              1968
            ],
            "id": "165977a7-a0d1-4796-850a-d4730237a740",
            "name": "Update a row",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "tableId": "pessoas",
              "filters": {
                "conditions": [
                  {
                    "keyName": "id_microsoft",
                    "keyValue": "={{ $json.id_microsoft }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              1104,
              2048
            ],
            "id": "55c43ee5-b185-4d13-a2a4-3f5d508b1c2c",
            "name": "Get a row",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              928,
              1888
            ],
            "id": "28795c16-6fb9-4a8c-8362-b195a7be263a",
            "name": "Loop Over Items1"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "542c1d17-d430-4696-b8ce-4ded78df50cf",
                    "leftValue": "={{ $json.id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "number",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.2,
            "position": [
              1296,
              2048
            ],
            "id": "f6b7789b-b287-4916-8580-c77db7644383",
            "name": "Exists"
          },
          {
            "parameters": {
              "tableId": "pessoas",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "nome",
                    "fieldValue": "={{ $('Edit Fields').item.json.nome }}"
                  },
                  {
                    "fieldId": "email",
                    "fieldValue": "={{ $('Edit Fields').item.json.email }}"
                  },
                  {
                    "fieldId": "telefone",
                    "fieldValue": "={{ $('Edit Fields').item.json.telefone }}"
                  },
                  {
                    "fieldId": "id_microsoft",
                    "fieldValue": "={{ $('Edit Fields').item.json.id_microsoft }}"
                  },
                  {
                    "fieldId": "id_notion",
                    "fieldValue": "={{ $('Edit Fields').item.json.id_notion }}"
                  },
                  {
                    "fieldId": "vertical",
                    "fieldValue": "={{ $('Edit Fields').item.json.vertical }}"
                  },
                  {
                    "fieldId": "cargo",
                    "fieldValue": "={{ $('Edit Fields').item.json.cargo }}"
                  },
                  {
                    "fieldId": "aniversario",
                    "fieldValue": "={{ $('Edit Fields').item.json.aniversario }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              1536,
              2128
            ],
            "id": "0a373c7b-ffcc-4fbd-b369-483d350d3b42",
            "name": "Create a row",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              1776,
              2048
            ],
            "id": "49ef9de3-e8c7-40dc-b5b9-0314da978e82",
            "name": "Merge"
          },
          {
            "parameters": {
              "operation": "update",
              "user": {
                "__rl": true,
                "value": "={{ $('Busca não criados no Notion').item.json.id }}",
                "mode": "id"
              },
              "updateFields": {
                "aboutMe": "={{ $json.id }}"
              },
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              1408,
              1184
            ],
            "id": "c1d6795c-a694-4c1a-91bb-16f3751db9a1",
            "name": "Preenche ID Notion",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "update",
              "pageId": {
                "__rl": true,
                "value": "={{ $json.id }}",
                "mode": "id"
              },
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "Aniversário|date",
                    "includeTime": false,
                    "date": "={{ $json.birthday.split(\"T\")[0] }}"
                  },
                  {
                    "key": "Vertical|select",
                    "selectValue": "={{ $json.department }}"
                  },
                  {
                    "key": "Posição|select",
                    "selectValue": "={{ $json.jobTitle }}"
                  },
                  {
                    "key": "Email|email",
                    "emailValue": "={{ $json.mail }}"
                  },
                  {
                    "key": "Telefone|rich_text",
                    "textContent": "={{ $json.mobilePhone }}"
                  },
                  {
                    "key": "Nome|title",
                    "title": "={{ $json.name }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1408,
              976
            ],
            "id": "8e89e35f-59b3-4168-9bf2-a3165d953ac0",
            "name": "Update a database page",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "triggerAtHour": 1
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
              -144,
              1088
            ],
            "id": "60eb246f-3201-4ad3-b9b8-0527fbd2bb25",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "triggerAtHour": 2
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
              -144,
              1680
            ],
            "id": "4d24cc14-d258-45b6-a187-fb5acbdccb3c",
            "name": "Schedule Trigger1"
          },
          {
            "parameters": {
              "content": "## Carrega no Supabase\n### Com base na condição: está cadastrado no sharepoint e tem telefone. Se o id_microsoft já existe no Supabase, faz update. Se não, faz insert.\n**TO-DO: Lidar com deleções**",
              "height": 736,
              "width": 2176
            },
            "type": "n8n-nodes-base.stickyNote",
            "position": [
              -208,
              1568
            ],
            "typeVersion": 1,
            "id": "885c8a3a-100e-4624-ba76-56767239208e",
            "name": "Sticky Note1"
          },
          {
            "parameters": {
              "content": "## Carrega projetos no Supabase",
              "height": 608,
              "width": 1280
            },
            "type": "n8n-nodes-base.stickyNote",
            "position": [
              -208,
              2352
            ],
            "typeVersion": 1,
            "id": "d49ab468-94f8-4fc6-9e4a-03863d5270fc",
            "name": "Sticky Note2"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {}
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
              -128,
              2656
            ],
            "id": "0bc9a81b-2a2c-4355-8e3d-a38f64c6d3a7",
            "name": "Schedule Trigger2"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "c2af396cc2a347eca452b2b2bf6b9031",
                "mode": "id"
              },
              "returnAll": true,
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              272,
              2656
            ],
            "id": "4c47cbe8-c76b-4f08-a7bb-acfffb68a8ce",
            "name": "Get many database pages",
            "retryOnFail": true,
            "waitBetweenTries": 5000,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "54157827-662f-4765-af49-d6525442c4a4",
                    "name": "id_notion",
                    "value": "={{ $json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "59039e65-9f12-4749-9578-0777f02e9d60",
                    "name": "projeto",
                    "value": "={{ $json.name }}",
                    "type": "string"
                  },
                  {
                    "id": "99ca1fc0-46a6-47ae-8e91-b3dc9447a5e2",
                    "name": "empresa",
                    "value": "={{ $json.property_empresa }}",
                    "type": "string"
                  },
                  {
                    "id": "58986c42-930d-4267-b5ed-a708c5f290c8",
                    "name": "vertical",
                    "value": "={{ $json.property_vertical }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              448,
              2656
            ],
            "id": "12754d74-38a9-42c0-a12d-b2777652e259",
            "name": "Edit Fields1"
          },
          {
            "parameters": {
              "tableId": "projetos",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "projeto",
                    "fieldValue": "={{ $json.projeto }}"
                  },
                  {
                    "fieldId": "empresa",
                    "fieldValue": "={{ $json.empresa }}"
                  },
                  {
                    "fieldId": "id_notion",
                    "fieldValue": "={{ $json.id_notion }}"
                  },
                  {
                    "fieldId": "vertical",
                    "fieldValue": "={{ $json.vertical }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              896,
              2720
            ],
            "id": "ba5269be-289e-4fc4-bc89-9633aad2aee9",
            "name": "Create a row1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              672,
              2656
            ],
            "id": "a046a5be-f5fe-4f16-baa3-b18d4d8d4ec9",
            "name": "Loop Over Items"
          },
          {
            "parameters": {
              "operation": "delete",
              "tableId": "projetos",
              "filters": {
                "conditions": [
                  {
                    "keyName": "id",
                    "condition": "gt",
                    "keyValue": "0"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              96,
              2512
            ],
            "id": "b0ef7ea4-55ec-4c9e-bfc5-d64d7eb372a0",
            "name": "Delete a row",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "url": "https://graph.microsoft.com/v1.0/me",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "microsoftEntraOAuth2Api",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              64,
              1088
            ],
            "id": "0948043e-fcaf-4d73-81c5-315e3751af3f",
            "name": "HTTP Request",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "url": "https://graph.microsoft.com/v1.0/me",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "microsoftEntraOAuth2Api",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              16,
              1680
            ],
            "id": "f92c3658-d34c-44d4-9287-24c8723d9cf9",
            "name": "HTTP Request1",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Telefone|rich_text",
                    "condition": "is_not_empty"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              544,
              400
            ],
            "id": "70980835-ff97-4e22-8bff-25808326e700",
            "name": "Get many database pages2",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "3b745feb-e9a5-4d09-9f24-601c419e84e1",
                    "leftValue": "={{ $json.aboutMe }}",
                    "rightValue": "^\\d+$",
                    "operator": {
                      "type": "string",
                      "operation": "notEmpty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.filter",
            "typeVersion": 2.2,
            "position": [
              720,
              176
            ],
            "id": "960f3b92-714d-4cc7-be99-37b1681422fa",
            "name": "Filter3"
          },
          {
            "parameters": {
              "content": "## Ajustar informação user azure\n### Com base na condição: está cadastrado no sharepoint, tem telefone e não está com id do notion preenchido (aboutMe)",
              "height": 736,
              "width": 1856
            },
            "type": "n8n-nodes-base.stickyNote",
            "position": [
              -208,
              0
            ],
            "typeVersion": 1,
            "id": "8b16ae05-1b17-49a9-afef-de41f634036c",
            "name": "Sticky Note3"
          },
          {
            "parameters": {
              "returnAll": true,
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              352,
              176
            ],
            "id": "df8aff9b-54c5-4794-b970-43f1af359e96",
            "name": "Get many users",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "user": {
                "__rl": true,
                "value": "={{ $json.id }}",
                "mode": "id"
              },
              "output": "fields",
              "fields": [
                "aboutMe",
                "birthday",
                "department",
                "employeeHireDate",
                "jobTitle",
                "mail",
                "mobilePhone",
                "userPrincipalName",
                "displayName"
              ],
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              544,
              176
            ],
            "id": "ae590faa-6f1d-4f3b-95e1-42c3fa0c0545",
            "name": "Get user2",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "mode": "combine",
              "advanced": true,
              "mergeByFields": {
                "values": [
                  {
                    "field1": "aboutMe",
                    "field2": "id"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              976,
              304
            ],
            "id": "4c3c67d5-52d9-4cb3-bda6-c57bb96ac440",
            "name": "Busca não criados no Notion1"
          },
          {
            "parameters": {
              "url": "https://graph.microsoft.com/v1.0/me",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "microsoftEntraOAuth2Api",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              64,
              320
            ],
            "id": "5fefa117-07f7-4c89-aec0-2f8e83a45d92",
            "name": "HTTP Request2",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.manualTrigger",
            "typeVersion": 1,
            "position": [
              -144,
              320
            ],
            "id": "ed37b21a-28f8-47b4-b892-5ece265eab46",
            "name": "When clicking ‘Execute workflow’"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "45a7bc05-1311-48ea-8995-eb03efed3d0f",
                    "leftValue": "={{ $json.property_hire_date != null && $json.property_hire_date !== '' }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.filter",
            "typeVersion": 2.2,
            "position": [
              1184,
              304
            ],
            "id": "d8fad07c-c366-4984-86a0-08f89e6c9a66",
            "name": "Filter1"
          },
          {
            "parameters": {
              "operation": "update",
              "user": {
                "__rl": true,
                "value": "={{ $json.id }}",
                "mode": "id"
              },
              "updateFields": {
                "employeeHireDate": "={{ new Date($json.property_hire_date.start).toISOString() }}"
              },
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              1472,
              416
            ],
            "id": "ba4b8e27-ab5c-45f8-9b56-f2dab404150d",
            "name": "Preenche hiredate",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "user": {
                "__rl": true,
                "value": "={{ $json.id }}",
                "mode": "id"
              },
              "output": "fields",
              "fields": [
                "aboutMe",
                "hireDate"
              ],
              "requestOptions": {}
            },
            "type": "n8n-nodes-base.microsoftEntra",
            "typeVersion": 1,
            "position": [
              1472,
              160
            ],
            "id": "cfe83718-f37a-4fbd-b49b-b165631332fa",
            "name": "Get user3",
            "credentials": {
              "microsoftEntraOAuth2Api": {
                "id": "4pvYUwvVLls5URCq",
                "name": "Microsoft Entra ID (Azure Active Directory) account"
              }
            }
          }
        ],
        "connections": {
          "Get many database pages1": {
            "main": [
              [
                {
                  "node": "Busca não criados no Notion",
                  "type": "main",
                  "index": 1
                },
                {
                  "node": "Cruza informações",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Filter2": {
            "main": [
              [
                {
                  "node": "Busca não criados no Notion",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Cruza informações",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a database page": {
            "main": [
              [
                {
                  "node": "Preenche ID Notion",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many users2": {
            "main": [
              [
                {
                  "node": "Get user1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get user1": {
            "main": [
              [
                {
                  "node": "Filter2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca não criados no Notion": {
            "main": [
              [
                {
                  "node": "Create a database page",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Cruza informações": {
            "main": [
              [
                {
                  "node": "Code1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many users3": {
            "main": [
              [
                {
                  "node": "Get user",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get user": {
            "main": [
              [
                {
                  "node": "Filter",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Filter": {
            "main": [
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "Loop Over Items1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get a row": {
            "main": [
              [
                {
                  "node": "Exists",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items1": {
            "main": [
              [],
              [
                {
                  "node": "Get a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Exists": {
            "main": [
              [
                {
                  "node": "Update a row",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Create a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Update a row": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a row": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "Loop Over Items1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code1": {
            "main": [
              [
                {
                  "node": "Update a database page",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger1": {
            "main": [
              [
                {
                  "node": "HTTP Request1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "HTTP Request",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger2": {
            "main": [
              [
                {
                  "node": "Delete a row",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Get many database pages",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many database pages": {
            "main": [
              [
                {
                  "node": "Edit Fields1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields1": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items": {
            "main": [
              [],
              [
                {
                  "node": "Create a row1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a row1": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Delete a row": {
            "main": [
              []
            ]
          },
          "HTTP Request": {
            "main": [
              [
                {
                  "node": "Get many database pages1",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Get many users2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request1": {
            "main": [
              [
                {
                  "node": "Get many users3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many database pages2": {
            "main": [
              [
                {
                  "node": "Busca não criados no Notion1",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Filter3": {
            "main": [
              [
                {
                  "node": "Busca não criados no Notion1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many users": {
            "main": [
              [
                {
                  "node": "Get user2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get user2": {
            "main": [
              [
                {
                  "node": "Filter3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca não criados no Notion1": {
            "main": [
              [
                {
                  "node": "Filter1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request2": {
            "main": [
              [
                {
                  "node": "Get many users",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Get many database pages2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "When clicking ‘Execute workflow’": {
            "main": [
              [
                {
                  "node": "HTTP Request2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Filter1": {
            "main": [
              [
                {
                  "node": "Get user3",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Preenche hiredate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 9334320a",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-02-11T19:51:33.105Z",
            "id": 333,
            "workflowId": "2oauDYUglr1vkbiw",
            "versionId": "9334320a-0961-40d0-a621-a25f13d63348",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-14T13:38:06.377Z",
      "createdAt": "2025-08-29T19:19:26.579Z",
      "id": "bQ3zvMKLZlxeBW31",
      "name": "Criar Ata Notion",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "criar-ata-notion",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            0,
            0
          ],
          "id": "50d37089-c970-4936-8ba2-6958e5a4229e",
          "name": "Webhook",
          "webhookId": "19a5e01f-d661-483d-9874-2b9c16171fe6"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "databaseId": {
              "__rl": true,
              "value": "66a3cfa0e0024323a279d63d19a9c6a9",
              "mode": "id"
            },
            "title": "={{ $('Webhook').item.json.body.titulo }}",
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Data|date",
                  "date": "={{ $json.body.data }}",
                  "timezone": "Brazil/East"
                },
                {
                  "key": "Projetos|relation",
                  "relationValue": [
                    "={{ $('Webhook').item.json.body.id_projeto }}"
                  ]
                },
                {
                  "key": "👥 Pessoas|relation",
                  "relationValue": [
                    "={{ $('Webhook').item.json.body.participantes[0] }}"
                  ]
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            208,
            0
          ],
          "id": "69ff20cd-9bb6-4c48-bda3-d755c5b42340",
          "name": "Create a database page",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "block",
            "blockId": {
              "__rl": true,
              "value": "={{ $('Create a database page').item.json.id }}",
              "mode": "id"
            },
            "blockUi": {
              "blockValues": [
                {
                  "type": "={{ $json.tipo }}",
                  "textContent": "={{ $json.conteudo }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1664,
            80
          ],
          "id": "e9eab896-81ba-4838-ae28-0b0f7a7f9be4",
          "name": "Append a block",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const body = $('Webhook').item.json.body || {};\nconst md = body.resumo || '';\n\nconst lines = md.split('\\n');\nconst itemsOut = [];\nlet listBuffer = [];\n\nfunction flushList() {\n  if (listBuffer.length) {\n    listBuffer.forEach(text => {\n      itemsOut.push({\n        json: {\n          tipo: 'bulleted_list_item',\n          conteudo: text\n        }\n      });\n    });\n    listBuffer = [];\n  }\n}\n\nfor (const rawLine of lines) {\n  const line = rawLine.replace(/\\r$/, '').trim();\n\n  if (!line) {\n    flushList();\n    continue;\n  }\n\n  // heading 1\n  if (line.startsWith('# ')) {\n    flushList();\n    itemsOut.push({\n      json: {\n        tipo: 'heading_1',\n        conteudo: line.replace(/^#\\s+/, '')\n      }\n    });\n    continue;\n  }\n\n  // heading 3\n  if (line.startsWith('### ')) {\n    flushList();\n    itemsOut.push({\n      json: {\n        tipo: 'heading_3',\n        conteudo: line.replace(/^###\\s+/, '')\n      }\n    });\n    continue;\n  }\n\n  // item de lista\n  if (/^\\s*-\\s+/.test(line)) {\n    listBuffer.push(line.replace(/^\\s*-\\s+/, ''));\n    continue;\n  }\n\n  // parágrafo\n  flushList();\n  itemsOut.push({\n    json: {\n      tipo: 'paragraph',\n      conteudo: line\n    }\n  });\n}\nflushList();\n\nreturn itemsOut;\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            992,
            16
          ],
          "id": "ea71634f-9c5e-4a22-9925-6c62082b9d2b",
          "name": "Code in JavaScript"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            1232,
            16
          ],
          "id": "be0814b7-5d0b-4924-8eca-7a1503341567",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.4,
          "position": [
            800,
            16
          ],
          "id": "d683c579-c953-47a2-b746-4e122c1b75d3",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "method": "PATCH",
            "url": "=https://api.notion.com/v1/pages/{{ $('Create a database page').item.json.id }}",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "notionApi",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={{ $json.pessoas }}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.2,
          "position": [
            592,
            16
          ],
          "id": "cd46b28a-f7dc-41c2-8602-c8eb1d1d9f15",
          "name": "HTTP Request",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "const body = $('Webhook').item.json.body || {};\nconst relation = (Array.isArray(body.participantes) ? body.participantes : [])\n  .filter(id => typeof id === 'string' && id.trim())\n  .map(id => ({ id }));\n\nreturn [{\n  json: {pessoas: {\n    properties: {\n      \"👥 Pessoas\": { relation }\n    }\n  }}\n}];\n\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            384,
            0
          ],
          "id": "2e9e90bc-f429-4141-90eb-f800e6dc01c8",
          "name": "Code in JavaScript1"
        }
      ],
      "connections": {
        "Webhook": {
          "main": [
            [
              {
                "node": "Create a database page",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a database page": {
          "main": [
            [
              {
                "node": "Code in JavaScript1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Append a block",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Append a block": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Respond to Webhook": {
          "main": [
            [
              {
                "node": "Code in JavaScript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript1": {
          "main": [
            [
              {
                "node": "HTTP Request",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "e82c0182-1c1c-4471-b216-79bea73db02a",
      "activeVersionId": "e82c0182-1c1c-4471-b216-79bea73db02a",
      "versionCounter": 51,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-08-29T19:19:26.579Z",
          "createdAt": "2025-08-29T19:19:26.579Z",
          "role": "workflow:owner",
          "workflowId": "bQ3zvMKLZlxeBW31",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2025-03-25T17:28:44.590Z",
          "createdAt": "2025-03-25T17:28:44.590Z",
          "id": "SGLcCfFPtH9ESbyP",
          "name": "Marujo"
        },
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "e82c0182-1c1c-4471-b216-79bea73db02a",
        "workflowId": "bQ3zvMKLZlxeBW31",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "criar-ata-notion",
              "responseMode": "responseNode",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
              0,
              0
            ],
            "id": "50d37089-c970-4936-8ba2-6958e5a4229e",
            "name": "Webhook",
            "webhookId": "19a5e01f-d661-483d-9874-2b9c16171fe6"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "databaseId": {
                "__rl": true,
                "value": "66a3cfa0e0024323a279d63d19a9c6a9",
                "mode": "id"
              },
              "title": "={{ $('Webhook').item.json.body.titulo }}",
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "Data|date",
                    "date": "={{ $json.body.data }}",
                    "timezone": "Brazil/East"
                  },
                  {
                    "key": "Projetos|relation",
                    "relationValue": [
                      "={{ $('Webhook').item.json.body.id_projeto }}"
                    ]
                  },
                  {
                    "key": "👥 Pessoas|relation",
                    "relationValue": [
                      "={{ $('Webhook').item.json.body.participantes[0] }}"
                    ]
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              208,
              0
            ],
            "id": "69ff20cd-9bb6-4c48-bda3-d755c5b42340",
            "name": "Create a database page",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "block",
              "blockId": {
                "__rl": true,
                "value": "={{ $('Create a database page').item.json.id }}",
                "mode": "id"
              },
              "blockUi": {
                "blockValues": [
                  {
                    "type": "={{ $json.tipo }}",
                    "textContent": "={{ $json.conteudo }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1664,
              80
            ],
            "id": "e9eab896-81ba-4838-ae28-0b0f7a7f9be4",
            "name": "Append a block",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "const body = $('Webhook').item.json.body || {};\nconst md = body.resumo || '';\n\nconst lines = md.split('\\n');\nconst itemsOut = [];\nlet listBuffer = [];\n\nfunction flushList() {\n  if (listBuffer.length) {\n    listBuffer.forEach(text => {\n      itemsOut.push({\n        json: {\n          tipo: 'bulleted_list_item',\n          conteudo: text\n        }\n      });\n    });\n    listBuffer = [];\n  }\n}\n\nfor (const rawLine of lines) {\n  const line = rawLine.replace(/\\r$/, '').trim();\n\n  if (!line) {\n    flushList();\n    continue;\n  }\n\n  // heading 1\n  if (line.startsWith('# ')) {\n    flushList();\n    itemsOut.push({\n      json: {\n        tipo: 'heading_1',\n        conteudo: line.replace(/^#\\s+/, '')\n      }\n    });\n    continue;\n  }\n\n  // heading 3\n  if (line.startsWith('### ')) {\n    flushList();\n    itemsOut.push({\n      json: {\n        tipo: 'heading_3',\n        conteudo: line.replace(/^###\\s+/, '')\n      }\n    });\n    continue;\n  }\n\n  // item de lista\n  if (/^\\s*-\\s+/.test(line)) {\n    listBuffer.push(line.replace(/^\\s*-\\s+/, ''));\n    continue;\n  }\n\n  // parágrafo\n  flushList();\n  itemsOut.push({\n    json: {\n      tipo: 'paragraph',\n      conteudo: line\n    }\n  });\n}\nflushList();\n\nreturn itemsOut;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              992,
              16
            ],
            "id": "ea71634f-9c5e-4a22-9925-6c62082b9d2b",
            "name": "Code in JavaScript"
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              1232,
              16
            ],
            "id": "be0814b7-5d0b-4924-8eca-7a1503341567",
            "name": "Loop Over Items"
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.4,
            "position": [
              800,
              16
            ],
            "id": "d683c579-c953-47a2-b746-4e122c1b75d3",
            "name": "Respond to Webhook"
          },
          {
            "parameters": {
              "method": "PATCH",
              "url": "=https://api.notion.com/v1/pages/{{ $('Create a database page').item.json.id }}",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "notionApi",
              "sendBody": true,
              "specifyBody": "json",
              "jsonBody": "={{ $json.pessoas }}",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.2,
            "position": [
              592,
              16
            ],
            "id": "cd46b28a-f7dc-41c2-8602-c8eb1d1d9f15",
            "name": "HTTP Request",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "const body = $('Webhook').item.json.body || {};\nconst relation = (Array.isArray(body.participantes) ? body.participantes : [])\n  .filter(id => typeof id === 'string' && id.trim())\n  .map(id => ({ id }));\n\nreturn [{\n  json: {pessoas: {\n    properties: {\n      \"👥 Pessoas\": { relation }\n    }\n  }}\n}];\n\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              384,
              0
            ],
            "id": "2e9e90bc-f429-4141-90eb-f800e6dc01c8",
            "name": "Code in JavaScript1"
          }
        ],
        "connections": {
          "Webhook": {
            "main": [
              [
                {
                  "node": "Create a database page",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a database page": {
            "main": [
              [
                {
                  "node": "Code in JavaScript1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items": {
            "main": [
              [],
              [
                {
                  "node": "Append a block",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Append a block": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Respond to Webhook": {
            "main": [
              [
                {
                  "node": "Code in JavaScript",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript1": {
            "main": [
              [
                {
                  "node": "HTTP Request",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "HTTP Request": {
            "main": [
              [
                {
                  "node": "Respond to Webhook",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-09-01T12:35:21.111Z",
            "id": 16,
            "workflowId": "bQ3zvMKLZlxeBW31",
            "versionId": "e82c0182-1c1c-4471-b216-79bea73db02a",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-14T13:41:01.527Z",
      "createdAt": "2025-09-04T13:13:01.589Z",
      "id": "sW955Or5AM2B8nxv",
      "name": "Teste Lista produtos Elevato",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.3,
          "position": [
            0,
            0
          ],
          "id": "a6574fe2-7956-4350-ae07-7e53db07ead2",
          "name": "When chat message received",
          "webhookId": "c8dba644-5839-4f0f-bb39-5a1ce274a26e"
        },
        {
          "parameters": {
            "operation": "executeQuery",
            "query": "SELECT DISTINCT elem AS tag\n\nFROM vnda.products\n\nCROSS JOIN LATERAL jsonb_array_elements_text(tag_names::jsonb) AS t(elem);",
            "options": {}
          },
          "type": "n8n-nodes-base.postgres",
          "typeVersion": 2.6,
          "position": [
            208,
            0
          ],
          "id": "09309ae2-81ca-4621-875a-4f2903cf8d18",
          "name": "Execute a SQL query",
          "credentials": {
            "postgres": {
              "id": "BWxGPuxHxE5iZvbI",
              "name": "Elevato (deletar)"
            }
          }
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "tag"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            416,
            0
          ],
          "id": "fbd59be7-1a46-43dd-94a5-101a1099513a",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $('When chat message received').item.json.chatInput }}",
            "options": {
              "systemMessage": "=Você é um auxiliar de montagem de orçamentos em uma empresa de acabementos. Você deve orientar a criação do orçamento, mas deve abordar um item por vez.\n\nUtilize a lista de tags a seguir para buscar por produtos e ajudar o vendedor a montar um orçamento:\n\nTAGS:\n {{ $json.tag }}\n\nUse essa árvore de decisão para orientar a escolha dos produtos (por enquanto só temos banheiro):\nBANHEIRO\nCubas e Lavatórios\n• Cubas\n    ◦ Materiais de Instalação:\n        ▪ Sifão\n        ▪ Válvula\n    ◦ Tipos de Cuba:\n        ▪ Cuba de Embutir\n        ▪ Cuba de sobrepor\n        ▪ Cuba de apoio\n        ▪ Cuba de Piso\n• Lavatório\n    ◦ Tipos de Lavatório:\n        ▪ Lavatório de Piso com coluna:\n            • 2 pares de parafusos\n            • Lavatório\n            • Coluna\n        ▪ Lavatório Suspenso:\n            • Com Coluna:\n                ◦ 1 par de parafuso\n            • Sem Coluna:\n                ◦ 2 pares de parafusos\n    ◦ Materiais de Instalação:\n        ▪ Sifão\nVasos\n• Vaso Caixa Acoplada\n    ◦ Kit Vaso Caixa Acoplada:\n        ▪ Fita Veda Rosca\n    ◦ Conjunto:\n        ▪ Vaso para caixa\n        ▪ Caixa para acoplar\n        ▪ Assento (Escolher modelo)\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Ligação Flexível\n        ▪ Fita Veda Rosca\n        ▪ Anel de Vedação\n• Vaso Convencional\n    ◦ Material de Instalação:\n        ▪ Tubo de Ligação\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra (Completa ou Montada com Acabamento e Válvula)\n• Suspenso\n    ◦ Material de Instalação:\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra\n    ◦ Kit de Fixação na parede\n• Vaso eletrônico\n    ◦ Fita veda rosca\nBide\n• Suspenso\n    ◦ Kit fixação de parede\n    ◦ Misturador para bide\n• De piso\n    ◦ Kit fixação para bide\n    ◦ Misturador para bidê\nTorneira / Misturador\n• Torneira\n    ◦ Bancada:\n        ▪ Ligação flexível\n        ▪ Fita Veda rosca\n        ▪ Registro regulador de vazão\n    ◦ Parede com base:\n        ▪ Fita Veda rosca\n    ◦ Parede externa:\n        ▪ Fita veda Rosca\n• Misturador\n    ◦ Bancada:\n        ▪ 2 ligações flexíveis\n        ▪ Fita veda rosca\n    ◦ Parede:\n        ▪ Fita Veda Rosca\nAcabamentos\n• Acabamento para chuveiro\n• Acabamento gaveta\n• Acabamento ducha higiênica\nChuveiros\n• Elétrico\n    ◦ Com pressurizador\n    ◦ Sem pressurizador\n• Gás\n    ◦ Teto:\n        ▪ Completo (Fita veda rosca)\n        ▪ Montado (Tubo para chuveiro, Chuveiro)\n    ◦ Parede:\n        ▪ Sem desviador:\n            • Completo (Fita veda rosca)\n            • Montado (Tubo, Chuveiro)\n        ▪ Com desviador:\n            • Fita Veda Rosca\n            • (Componentes: Desviador, Ducha para chuveiro)\n    ◦ Material de instalação:\n        ▪ Fita veda rosca\nDucha Higiênica\n• Só água fria\n    ◦ Com derivação para o vaso\n    ◦ Sem derivação\n• Quente e fria\n    ◦ Base duplo comando:\n        ▪ Base duplo comando para ducha\n        ▪ 2 Acabamento de registro\n        ▪ Ducha higiênica\n    ◦ Base mono comando:\n        ▪ Base mono comando para ducha higiênica\n        ▪ Acabamento mono para ducha\n        ▪ Ducha higiênica\n• Material de instalação:\n    ◦ Fita veda rosca\nBanheiras/Spa/Hidromassagem\n• Banheira hidromassagem\n    ◦ Misturador de parede\n    ◦ Ban chu (quando abaixo do chuveiro)\n    ◦ Acabamento\n    ◦ Misturador de chuveiro mono/duplo\n• Banheira de imersão\n    ◦ Misturador de piso\n    ◦ Misturador de parede mono comando\n    ◦ Misturador de parede duplo comando\n• Spa\n    ◦ Pronto para instalação\nAcessórios de banheiro\n• Papeleira (De piso, De parede)\n• Saboneteira (Bancada, Parede)\n• Prateleira (Canto, Normal)\n• Cabide (Simples, Duplo)\n• Porta Toalha de banho (Aquecido, Normal - Simples/Duplo)\n• Porta Toalha de rosto (Argola, Barra)\n• Porta flor\n• Porta velas\n• Porta Escova de dentes\n• Porta algodão\n• Dosador de sabonete liquido (Parede, Mesa)\n• Lixeira\nGrelha / ralo\n• Quadrado (Completo, Montado)\n• Linear (Oculto, Decorativo)\nOutros Itens de Banheiro\n• Tinta (Parede, Teto)\n• Aberturas\n• Piso aquecido\n• Desembaçador de espelhos\n• Balcão de banheiro\n• Porta interna\n• Fechadura\n• Itens de proteção (Guardapiso, Fita Crepe, Iso pintura)\n• Itens de limpeza (Limpeza pesada, Limpeza diária)"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            624,
            0
          ],
          "id": "d45ba652-6959-42d7-94e1-5adce2baa2e1",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            560,
            192
          ],
          "id": "a322a8fe-4e48-4e21-ae01-ddb207e51a30",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "contextWindowLength": 20
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            704,
            192
          ],
          "id": "c0d85140-3d79-40d9-8869-f38e8058b9e0",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Use paga buscar produtos com base em uma tag.\n\nUse *exatamente* a query a seguir, inserindo o nome da tag no campo {tag_name}\n\nSELECT *\nFROM vnda.products\nWHERE tag_names LIKE '%{tag_name}%'",
            "operation": "executeQuery",
            "query": "{{ $fromAI('query') }}",
            "options": {}
          },
          "type": "n8n-nodes-base.postgresTool",
          "typeVersion": 2.6,
          "position": [
            880,
            192
          ],
          "id": "6ea81ed5-7864-4086-ae9c-a177d6b032cf",
          "name": "Execute a SQL query in Postgres",
          "credentials": {
            "postgres": {
              "id": "BWxGPuxHxE5iZvbI",
              "name": "Elevato (deletar)"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.toolThink",
          "typeVersion": 1.1,
          "position": [
            992,
            160
          ],
          "id": "81f62370-302b-4d5d-8aec-94e791f41538",
          "name": "Think"
        },
        {
          "parameters": {
            "operation": "executeQuery",
            "query": "SELECT DISTINCT elem AS tag\n\nFROM vnda.products\n\nCROSS JOIN LATERAL jsonb_array_elements_text(tag_names::jsonb) AS t(elem);",
            "options": {}
          },
          "type": "n8n-nodes-base.postgres",
          "typeVersion": 2.6,
          "position": [
            176,
            576
          ],
          "id": "cd131680-3569-4912-a6ce-4567e60d7df1",
          "name": "Execute a SQL query1",
          "credentials": {
            "postgres": {
              "id": "BWxGPuxHxE5iZvbI",
              "name": "Elevato (deletar)"
            }
          }
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "tag"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            384,
            576
          ],
          "id": "9016ce6f-31d1-425f-94f6-158f76174147",
          "name": "Aggregate1"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=retorne 'reference' e 'name' dos produtos que dão mamatch com a branch {{ $('Webhook').item.json.query.ramo }}",
            "options": {
              "systemMessage": "=Você é um auxiliar de montagem de orçamentos em uma empresa de acabementos.\n\nSeu retorno deve seguir o formato:\n{\"data\": [{'ref': ref1, 'name': name1, \"price\": \"price1\"}, {'ref': ref2, 'name': name2, \"price\": \"price2\"}]}\n\nUtilize a lista de tags a seguir para buscar por produtos e ajudar o vendedor a montar um orçamento:\n\nTAGS:\n {{ $json.tag }}\n\nUse essa árvore de decisão para orientar a escolha dos produtos (por enquanto só temos banheiro):\nBANHEIRO\nCubas e Lavatórios\n• Cubas\n    ◦ Materiais de Instalação:\n        ▪ Sifão\n        ▪ Válvula\n    ◦ Tipos de Cuba:\n        ▪ Cuba de Embutir\n        ▪ Cuba de sobrepor\n        ▪ Cuba de apoio\n        ▪ Cuba de Piso\n• Lavatório\n    ◦ Tipos de Lavatório:\n        ▪ Lavatório de Piso com coluna:\n            • 2 pares de parafusos\n            • Lavatório\n            • Coluna\n        ▪ Lavatório Suspenso:\n            • Com Coluna:\n                ◦ 1 par de parafuso\n            • Sem Coluna:\n                ◦ 2 pares de parafusos\n    ◦ Materiais de Instalação:\n        ▪ Sifão\nVasos\n• Vaso Caixa Acoplada\n    ◦ Kit Vaso Caixa Acoplada:\n        ▪ Fita Veda Rosca\n    ◦ Conjunto:\n        ▪ Vaso para caixa\n        ▪ Caixa para acoplar\n        ▪ Assento (Escolher modelo)\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Ligação Flexível\n        ▪ Fita Veda Rosca\n        ▪ Anel de Vedação\n• Vaso Convencional\n    ◦ Material de Instalação:\n        ▪ Tubo de Ligação\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra (Completa ou Montada com Acabamento e Válvula)\n• Suspenso\n    ◦ Material de Instalação:\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra\n    ◦ Kit de Fixação na parede\n• Vaso eletrônico\n    ◦ Fita veda rosca\nBide\n• Suspenso\n    ◦ Kit fixação de parede\n    ◦ Misturador para bide\n• De piso\n    ◦ Kit fixação para bide\n    ◦ Misturador para bidê\nTorneira / Misturador\n• Torneira\n    ◦ Bancada:\n        ▪ Ligação flexível\n        ▪ Fita Veda rosca\n        ▪ Registro regulador de vazão\n    ◦ Parede com base:\n        ▪ Fita Veda rosca\n    ◦ Parede externa:\n        ▪ Fita veda Rosca\n• Misturador\n    ◦ Bancada:\n        ▪ 2 ligações flexíveis\n        ▪ Fita veda rosca\n    ◦ Parede:\n        ▪ Fita Veda Rosca\nAcabamentos\n• Acabamento para chuveiro\n• Acabamento gaveta\n• Acabamento ducha higiênica\nChuveiros\n• Elétrico\n    ◦ Com pressurizador\n    ◦ Sem pressurizador\n• Gás\n    ◦ Teto:\n        ▪ Completo (Fita veda rosca)\n        ▪ Montado (Tubo para chuveiro, Chuveiro)\n    ◦ Parede:\n        ▪ Sem desviador:\n            • Completo (Fita veda rosca)\n            • Montado (Tubo, Chuveiro)\n        ▪ Com desviador:\n            • Fita Veda Rosca\n            • (Componentes: Desviador, Ducha para chuveiro)\n    ◦ Material de instalação:\n        ▪ Fita veda rosca\nDucha Higiênica\n• Só água fria\n    ◦ Com derivação para o vaso\n    ◦ Sem derivação\n• Quente e fria\n    ◦ Base duplo comando:\n        ▪ Base duplo comando para ducha\n        ▪ 2 Acabamento de registro\n        ▪ Ducha higiênica\n    ◦ Base mono comando:\n        ▪ Base mono comando para ducha higiênica\n        ▪ Acabamento mono para ducha\n        ▪ Ducha higiênica\n• Material de instalação:\n    ◦ Fita veda rosca\nBanheiras/Spa/Hidromassagem\n• Banheira hidromassagem\n    ◦ Misturador de parede\n    ◦ Ban chu (quando abaixo do chuveiro)\n    ◦ Acabamento\n    ◦ Misturador de chuveiro mono/duplo\n• Banheira de imersão\n    ◦ Misturador de piso\n    ◦ Misturador de parede mono comando\n    ◦ Misturador de parede duplo comando\n• Spa\n    ◦ Pronto para instalação\nAcessórios de banheiro\n• Papeleira (De piso, De parede)\n• Saboneteira (Bancada, Parede)\n• Prateleira (Canto, Normal)\n• Cabide (Simples, Duplo)\n• Porta Toalha de banho (Aquecido, Normal - Simples/Duplo)\n• Porta Toalha de rosto (Argola, Barra)\n• Porta flor\n• Porta velas\n• Porta Escova de dentes\n• Porta algodão\n• Dosador de sabonete liquido (Parede, Mesa)\n• Lixeira\nGrelha / ralo\n• Quadrado (Completo, Montado)\n• Linear (Oculto, Decorativo)\nOutros Itens de Banheiro\n• Tinta (Parede, Teto)\n• Aberturas\n• Piso aquecido\n• Desembaçador de espelhos\n• Balcão de banheiro\n• Porta interna\n• Fechadura\n• Itens de proteção (Guardapiso, Fita Crepe, Iso pintura)\n• Itens de limpeza (Limpeza pesada, Limpeza diária)"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 2.2,
          "position": [
            592,
            576
          ],
          "id": "c3c365d3-0ed3-4e99-b6fa-e2360dfac4a8",
          "name": "AI Agent1"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-4.1",
              "mode": "list",
              "cachedResultName": "gpt-4.1"
            },
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.2,
          "position": [
            608,
            784
          ],
          "id": "92dd6010-2443-4955-be83-a93fa5f8e623",
          "name": "OpenAI Chat Model1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Use paga buscar produtos com base em uma tag.\n\nUse *exatamente* a query a seguir, inserindo o nome da tag no campo {tag_name}\n\nSELECT *\nFROM vnda.products\nWHERE tag_names LIKE '%{tag_name}%'",
            "operation": "executeQuery",
            "query": "{{ $fromAI('query') }}",
            "options": {}
          },
          "type": "n8n-nodes-base.postgresTool",
          "typeVersion": 2.6,
          "position": [
            832,
            752
          ],
          "id": "c9749675-ce0f-4251-941d-c75909aba32b",
          "name": "Execute a SQL query in Postgres1",
          "credentials": {
            "postgres": {
              "id": "BWxGPuxHxE5iZvbI",
              "name": "Elevato (deletar)"
            }
          }
        },
        {
          "parameters": {
            "path": "f0b21ac2-8ac5-4f97-b21e-98aee242cf41",
            "responseMode": "lastNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -16,
            576
          ],
          "id": "0b6bb37d-7525-4660-8d25-2b231e7d65b9",
          "name": "Webhook",
          "webhookId": "f0b21ac2-8ac5-4f97-b21e-98aee242cf41",
          "alwaysOutputData": true
        },
        {
          "parameters": {
            "text": "={{ $json.output }}",
            "schemaType": "fromJson",
            "jsonSchemaExample": "{\"data\": [{\"ref\": \"ref1\", \"name\": \"name1\", \"price\": \"price1\"}, {\"ref\": \"ref2\", \"name\": \"name2\", \"price\": \"price2\"}]}",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1.2,
          "position": [
            944,
            576
          ],
          "id": "6074d243-1fe0-4a82-855d-5c73d2cd0d99",
          "name": "Information Extractor"
        }
      ],
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "Execute a SQL query",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Execute a SQL query": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Execute a SQL query in Postgres": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Think": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Execute a SQL query1": {
          "main": [
            [
              {
                "node": "Aggregate1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate1": {
          "main": [
            [
              {
                "node": "AI Agent1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_languageModel",
                "index": 0
              },
              {
                "node": "Information Extractor",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Execute a SQL query in Postgres1": {
          "ai_tool": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Execute a SQL query1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent1": {
          "main": [
            [
              {
                "node": "Information Extractor",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "9c07c617-a178-4ab8-a68d-54132453a16d",
      "activeVersionId": "9c07c617-a178-4ab8-a68d-54132453a16d",
      "versionCounter": 53,
      "triggerCount": 2,
      "shared": [
        {
          "updatedAt": "2025-09-04T13:13:01.589Z",
          "createdAt": "2025-09-04T13:13:01.589Z",
          "role": "workflow:owner",
          "workflowId": "sW955Or5AM2B8nxv",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:31:19.305Z",
          "createdAt": "2026-01-11T18:31:19.305Z",
          "id": "x2wGcGpXLlDoFQxp",
          "name": "testes-e-exemplos"
        },
        {
          "updatedAt": "2026-01-14T13:41:00.317Z",
          "createdAt": "2026-01-14T13:41:00.317Z",
          "id": "ASY2MGpsaJtjZaVI",
          "name": "externos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "9c07c617-a178-4ab8-a68d-54132453a16d",
        "workflowId": "sW955Or5AM2B8nxv",
        "nodes": [
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.3,
            "position": [
              0,
              0
            ],
            "id": "a6574fe2-7956-4350-ae07-7e53db07ead2",
            "name": "When chat message received",
            "webhookId": "c8dba644-5839-4f0f-bb39-5a1ce274a26e"
          },
          {
            "parameters": {
              "operation": "executeQuery",
              "query": "SELECT DISTINCT elem AS tag\n\nFROM vnda.products\n\nCROSS JOIN LATERAL jsonb_array_elements_text(tag_names::jsonb) AS t(elem);",
              "options": {}
            },
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 2.6,
            "position": [
              208,
              0
            ],
            "id": "09309ae2-81ca-4621-875a-4f2903cf8d18",
            "name": "Execute a SQL query",
            "credentials": {
              "postgres": {
                "id": "BWxGPuxHxE5iZvbI",
                "name": "Elevato (deletar)"
              }
            }
          },
          {
            "parameters": {
              "fieldsToAggregate": {
                "fieldToAggregate": [
                  {
                    "fieldToAggregate": "tag"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              416,
              0
            ],
            "id": "fbd59be7-1a46-43dd-94a5-101a1099513a",
            "name": "Aggregate"
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $('When chat message received').item.json.chatInput }}",
              "options": {
                "systemMessage": "=Você é um auxiliar de montagem de orçamentos em uma empresa de acabementos. Você deve orientar a criação do orçamento, mas deve abordar um item por vez.\n\nUtilize a lista de tags a seguir para buscar por produtos e ajudar o vendedor a montar um orçamento:\n\nTAGS:\n {{ $json.tag }}\n\nUse essa árvore de decisão para orientar a escolha dos produtos (por enquanto só temos banheiro):\nBANHEIRO\nCubas e Lavatórios\n• Cubas\n    ◦ Materiais de Instalação:\n        ▪ Sifão\n        ▪ Válvula\n    ◦ Tipos de Cuba:\n        ▪ Cuba de Embutir\n        ▪ Cuba de sobrepor\n        ▪ Cuba de apoio\n        ▪ Cuba de Piso\n• Lavatório\n    ◦ Tipos de Lavatório:\n        ▪ Lavatório de Piso com coluna:\n            • 2 pares de parafusos\n            • Lavatório\n            • Coluna\n        ▪ Lavatório Suspenso:\n            • Com Coluna:\n                ◦ 1 par de parafuso\n            • Sem Coluna:\n                ◦ 2 pares de parafusos\n    ◦ Materiais de Instalação:\n        ▪ Sifão\nVasos\n• Vaso Caixa Acoplada\n    ◦ Kit Vaso Caixa Acoplada:\n        ▪ Fita Veda Rosca\n    ◦ Conjunto:\n        ▪ Vaso para caixa\n        ▪ Caixa para acoplar\n        ▪ Assento (Escolher modelo)\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Ligação Flexível\n        ▪ Fita Veda Rosca\n        ▪ Anel de Vedação\n• Vaso Convencional\n    ◦ Material de Instalação:\n        ▪ Tubo de Ligação\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra (Completa ou Montada com Acabamento e Válvula)\n• Suspenso\n    ◦ Material de Instalação:\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra\n    ◦ Kit de Fixação na parede\n• Vaso eletrônico\n    ◦ Fita veda rosca\nBide\n• Suspenso\n    ◦ Kit fixação de parede\n    ◦ Misturador para bide\n• De piso\n    ◦ Kit fixação para bide\n    ◦ Misturador para bidê\nTorneira / Misturador\n• Torneira\n    ◦ Bancada:\n        ▪ Ligação flexível\n        ▪ Fita Veda rosca\n        ▪ Registro regulador de vazão\n    ◦ Parede com base:\n        ▪ Fita Veda rosca\n    ◦ Parede externa:\n        ▪ Fita veda Rosca\n• Misturador\n    ◦ Bancada:\n        ▪ 2 ligações flexíveis\n        ▪ Fita veda rosca\n    ◦ Parede:\n        ▪ Fita Veda Rosca\nAcabamentos\n• Acabamento para chuveiro\n• Acabamento gaveta\n• Acabamento ducha higiênica\nChuveiros\n• Elétrico\n    ◦ Com pressurizador\n    ◦ Sem pressurizador\n• Gás\n    ◦ Teto:\n        ▪ Completo (Fita veda rosca)\n        ▪ Montado (Tubo para chuveiro, Chuveiro)\n    ◦ Parede:\n        ▪ Sem desviador:\n            • Completo (Fita veda rosca)\n            • Montado (Tubo, Chuveiro)\n        ▪ Com desviador:\n            • Fita Veda Rosca\n            • (Componentes: Desviador, Ducha para chuveiro)\n    ◦ Material de instalação:\n        ▪ Fita veda rosca\nDucha Higiênica\n• Só água fria\n    ◦ Com derivação para o vaso\n    ◦ Sem derivação\n• Quente e fria\n    ◦ Base duplo comando:\n        ▪ Base duplo comando para ducha\n        ▪ 2 Acabamento de registro\n        ▪ Ducha higiênica\n    ◦ Base mono comando:\n        ▪ Base mono comando para ducha higiênica\n        ▪ Acabamento mono para ducha\n        ▪ Ducha higiênica\n• Material de instalação:\n    ◦ Fita veda rosca\nBanheiras/Spa/Hidromassagem\n• Banheira hidromassagem\n    ◦ Misturador de parede\n    ◦ Ban chu (quando abaixo do chuveiro)\n    ◦ Acabamento\n    ◦ Misturador de chuveiro mono/duplo\n• Banheira de imersão\n    ◦ Misturador de piso\n    ◦ Misturador de parede mono comando\n    ◦ Misturador de parede duplo comando\n• Spa\n    ◦ Pronto para instalação\nAcessórios de banheiro\n• Papeleira (De piso, De parede)\n• Saboneteira (Bancada, Parede)\n• Prateleira (Canto, Normal)\n• Cabide (Simples, Duplo)\n• Porta Toalha de banho (Aquecido, Normal - Simples/Duplo)\n• Porta Toalha de rosto (Argola, Barra)\n• Porta flor\n• Porta velas\n• Porta Escova de dentes\n• Porta algodão\n• Dosador de sabonete liquido (Parede, Mesa)\n• Lixeira\nGrelha / ralo\n• Quadrado (Completo, Montado)\n• Linear (Oculto, Decorativo)\nOutros Itens de Banheiro\n• Tinta (Parede, Teto)\n• Aberturas\n• Piso aquecido\n• Desembaçador de espelhos\n• Balcão de banheiro\n• Porta interna\n• Fechadura\n• Itens de proteção (Guardapiso, Fita Crepe, Iso pintura)\n• Itens de limpeza (Limpeza pesada, Limpeza diária)"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 2.2,
            "position": [
              624,
              0
            ],
            "id": "d45ba652-6959-42d7-94e1-5adce2baa2e1",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-4.1",
                "mode": "list",
                "cachedResultName": "gpt-4.1"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              560,
              192
            ],
            "id": "a322a8fe-4e48-4e21-ae01-ddb207e51a30",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "contextWindowLength": 20
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              704,
              192
            ],
            "id": "c0d85140-3d79-40d9-8869-f38e8058b9e0",
            "name": "Simple Memory"
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Use paga buscar produtos com base em uma tag.\n\nUse *exatamente* a query a seguir, inserindo o nome da tag no campo {tag_name}\n\nSELECT *\nFROM vnda.products\nWHERE tag_names LIKE '%{tag_name}%'",
              "operation": "executeQuery",
              "query": "{{ $fromAI('query') }}",
              "options": {}
            },
            "type": "n8n-nodes-base.postgresTool",
            "typeVersion": 2.6,
            "position": [
              880,
              192
            ],
            "id": "6ea81ed5-7864-4086-ae9c-a177d6b032cf",
            "name": "Execute a SQL query in Postgres",
            "credentials": {
              "postgres": {
                "id": "BWxGPuxHxE5iZvbI",
                "name": "Elevato (deletar)"
              }
            }
          },
          {
            "parameters": {},
            "type": "@n8n/n8n-nodes-langchain.toolThink",
            "typeVersion": 1.1,
            "position": [
              992,
              160
            ],
            "id": "81f62370-302b-4d5d-8aec-94e791f41538",
            "name": "Think"
          },
          {
            "parameters": {
              "operation": "executeQuery",
              "query": "SELECT DISTINCT elem AS tag\n\nFROM vnda.products\n\nCROSS JOIN LATERAL jsonb_array_elements_text(tag_names::jsonb) AS t(elem);",
              "options": {}
            },
            "type": "n8n-nodes-base.postgres",
            "typeVersion": 2.6,
            "position": [
              176,
              576
            ],
            "id": "cd131680-3569-4912-a6ce-4567e60d7df1",
            "name": "Execute a SQL query1",
            "credentials": {
              "postgres": {
                "id": "BWxGPuxHxE5iZvbI",
                "name": "Elevato (deletar)"
              }
            }
          },
          {
            "parameters": {
              "fieldsToAggregate": {
                "fieldToAggregate": [
                  {
                    "fieldToAggregate": "tag"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              384,
              576
            ],
            "id": "9016ce6f-31d1-425f-94f6-158f76174147",
            "name": "Aggregate1"
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "=retorne 'reference' e 'name' dos produtos que dão mamatch com a branch {{ $('Webhook').item.json.query.ramo }}",
              "options": {
                "systemMessage": "=Você é um auxiliar de montagem de orçamentos em uma empresa de acabementos.\n\nSeu retorno deve seguir o formato:\n{\"data\": [{'ref': ref1, 'name': name1, \"price\": \"price1\"}, {'ref': ref2, 'name': name2, \"price\": \"price2\"}]}\n\nUtilize a lista de tags a seguir para buscar por produtos e ajudar o vendedor a montar um orçamento:\n\nTAGS:\n {{ $json.tag }}\n\nUse essa árvore de decisão para orientar a escolha dos produtos (por enquanto só temos banheiro):\nBANHEIRO\nCubas e Lavatórios\n• Cubas\n    ◦ Materiais de Instalação:\n        ▪ Sifão\n        ▪ Válvula\n    ◦ Tipos de Cuba:\n        ▪ Cuba de Embutir\n        ▪ Cuba de sobrepor\n        ▪ Cuba de apoio\n        ▪ Cuba de Piso\n• Lavatório\n    ◦ Tipos de Lavatório:\n        ▪ Lavatório de Piso com coluna:\n            • 2 pares de parafusos\n            • Lavatório\n            • Coluna\n        ▪ Lavatório Suspenso:\n            • Com Coluna:\n                ◦ 1 par de parafuso\n            • Sem Coluna:\n                ◦ 2 pares de parafusos\n    ◦ Materiais de Instalação:\n        ▪ Sifão\nVasos\n• Vaso Caixa Acoplada\n    ◦ Kit Vaso Caixa Acoplada:\n        ▪ Fita Veda Rosca\n    ◦ Conjunto:\n        ▪ Vaso para caixa\n        ▪ Caixa para acoplar\n        ▪ Assento (Escolher modelo)\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Ligação Flexível\n        ▪ Fita Veda Rosca\n        ▪ Anel de Vedação\n• Vaso Convencional\n    ◦ Material de Instalação:\n        ▪ Tubo de Ligação\n        ▪ Parafuso (Fixação de Piso ou Fixação Lateral)\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra (Completa ou Montada com Acabamento e Válvula)\n• Suspenso\n    ◦ Material de Instalação:\n        ▪ Assento Sanitário\n        ▪ Anel de Vedação\n    ◦ Sistema de descarga:\n        ▪ Caixa de embutir + Acabamento\n        ▪ Válvula Hidra\n    ◦ Kit de Fixação na parede\n• Vaso eletrônico\n    ◦ Fita veda rosca\nBide\n• Suspenso\n    ◦ Kit fixação de parede\n    ◦ Misturador para bide\n• De piso\n    ◦ Kit fixação para bide\n    ◦ Misturador para bidê\nTorneira / Misturador\n• Torneira\n    ◦ Bancada:\n        ▪ Ligação flexível\n        ▪ Fita Veda rosca\n        ▪ Registro regulador de vazão\n    ◦ Parede com base:\n        ▪ Fita Veda rosca\n    ◦ Parede externa:\n        ▪ Fita veda Rosca\n• Misturador\n    ◦ Bancada:\n        ▪ 2 ligações flexíveis\n        ▪ Fita veda rosca\n    ◦ Parede:\n        ▪ Fita Veda Rosca\nAcabamentos\n• Acabamento para chuveiro\n• Acabamento gaveta\n• Acabamento ducha higiênica\nChuveiros\n• Elétrico\n    ◦ Com pressurizador\n    ◦ Sem pressurizador\n• Gás\n    ◦ Teto:\n        ▪ Completo (Fita veda rosca)\n        ▪ Montado (Tubo para chuveiro, Chuveiro)\n    ◦ Parede:\n        ▪ Sem desviador:\n            • Completo (Fita veda rosca)\n            • Montado (Tubo, Chuveiro)\n        ▪ Com desviador:\n            • Fita Veda Rosca\n            • (Componentes: Desviador, Ducha para chuveiro)\n    ◦ Material de instalação:\n        ▪ Fita veda rosca\nDucha Higiênica\n• Só água fria\n    ◦ Com derivação para o vaso\n    ◦ Sem derivação\n• Quente e fria\n    ◦ Base duplo comando:\n        ▪ Base duplo comando para ducha\n        ▪ 2 Acabamento de registro\n        ▪ Ducha higiênica\n    ◦ Base mono comando:\n        ▪ Base mono comando para ducha higiênica\n        ▪ Acabamento mono para ducha\n        ▪ Ducha higiênica\n• Material de instalação:\n    ◦ Fita veda rosca\nBanheiras/Spa/Hidromassagem\n• Banheira hidromassagem\n    ◦ Misturador de parede\n    ◦ Ban chu (quando abaixo do chuveiro)\n    ◦ Acabamento\n    ◦ Misturador de chuveiro mono/duplo\n• Banheira de imersão\n    ◦ Misturador de piso\n    ◦ Misturador de parede mono comando\n    ◦ Misturador de parede duplo comando\n• Spa\n    ◦ Pronto para instalação\nAcessórios de banheiro\n• Papeleira (De piso, De parede)\n• Saboneteira (Bancada, Parede)\n• Prateleira (Canto, Normal)\n• Cabide (Simples, Duplo)\n• Porta Toalha de banho (Aquecido, Normal - Simples/Duplo)\n• Porta Toalha de rosto (Argola, Barra)\n• Porta flor\n• Porta velas\n• Porta Escova de dentes\n• Porta algodão\n• Dosador de sabonete liquido (Parede, Mesa)\n• Lixeira\nGrelha / ralo\n• Quadrado (Completo, Montado)\n• Linear (Oculto, Decorativo)\nOutros Itens de Banheiro\n• Tinta (Parede, Teto)\n• Aberturas\n• Piso aquecido\n• Desembaçador de espelhos\n• Balcão de banheiro\n• Porta interna\n• Fechadura\n• Itens de proteção (Guardapiso, Fita Crepe, Iso pintura)\n• Itens de limpeza (Limpeza pesada, Limpeza diária)"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 2.2,
            "position": [
              592,
              576
            ],
            "id": "c3c365d3-0ed3-4e99-b6fa-e2360dfac4a8",
            "name": "AI Agent1"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-4.1",
                "mode": "list",
                "cachedResultName": "gpt-4.1"
              },
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.2,
            "position": [
              608,
              784
            ],
            "id": "92dd6010-2443-4955-be83-a93fa5f8e623",
            "name": "OpenAI Chat Model1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Use paga buscar produtos com base em uma tag.\n\nUse *exatamente* a query a seguir, inserindo o nome da tag no campo {tag_name}\n\nSELECT *\nFROM vnda.products\nWHERE tag_names LIKE '%{tag_name}%'",
              "operation": "executeQuery",
              "query": "{{ $fromAI('query') }}",
              "options": {}
            },
            "type": "n8n-nodes-base.postgresTool",
            "typeVersion": 2.6,
            "position": [
              832,
              752
            ],
            "id": "c9749675-ce0f-4251-941d-c75909aba32b",
            "name": "Execute a SQL query in Postgres1",
            "credentials": {
              "postgres": {
                "id": "BWxGPuxHxE5iZvbI",
                "name": "Elevato (deletar)"
              }
            }
          },
          {
            "parameters": {
              "path": "f0b21ac2-8ac5-4f97-b21e-98aee242cf41",
              "responseMode": "lastNode",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
              -16,
              576
            ],
            "id": "0b6bb37d-7525-4660-8d25-2b231e7d65b9",
            "name": "Webhook",
            "webhookId": "f0b21ac2-8ac5-4f97-b21e-98aee242cf41",
            "alwaysOutputData": true
          },
          {
            "parameters": {
              "text": "={{ $json.output }}",
              "schemaType": "fromJson",
              "jsonSchemaExample": "{\"data\": [{\"ref\": \"ref1\", \"name\": \"name1\", \"price\": \"price1\"}, {\"ref\": \"ref2\", \"name\": \"name2\", \"price\": \"price2\"}]}",
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.informationExtractor",
            "typeVersion": 1.2,
            "position": [
              944,
              576
            ],
            "id": "6074d243-1fe0-4a82-855d-5c73d2cd0d99",
            "name": "Information Extractor"
          }
        ],
        "connections": {
          "When chat message received": {
            "main": [
              [
                {
                  "node": "Execute a SQL query",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Execute a SQL query": {
            "main": [
              [
                {
                  "node": "Aggregate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Execute a SQL query in Postgres": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Think": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Execute a SQL query1": {
            "main": [
              [
                {
                  "node": "Aggregate1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate1": {
            "main": [
              [
                {
                  "node": "AI Agent1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model1": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent1",
                  "type": "ai_languageModel",
                  "index": 0
                },
                {
                  "node": "Information Extractor",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Execute a SQL query in Postgres1": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Webhook": {
            "main": [
              [
                {
                  "node": "Execute a SQL query1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent1": {
            "main": [
              [
                {
                  "node": "Information Extractor",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-09-04T14:41:30.023Z",
            "id": 20,
            "workflowId": "sW955Or5AM2B8nxv",
            "versionId": "9c07c617-a178-4ab8-a68d-54132453a16d",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-13T18:49:35.673Z",
      "createdAt": "2025-09-28T00:06:24.483Z",
      "id": "6dVGwJNkYFOGlLGD",
      "name": "Reporter Outlook",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "c2af396c-c2a3-47ec-a452-b2b2bf6b9031\t",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "key": "Status|select",
                  "condition": "equals",
                  "selectValue": "Ativo"
                },
                {
                  "key": "Nome|title",
                  "condition": "is_not_empty"
                }
              ]
            },
            "options": {
              "sort": {
                "sortValue": [
                  {
                    "key": "Nome|title",
                    "direction": "ascending"
                  }
                ]
              }
            }
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            368,
            -144
          ],
          "id": "a90704cb-4d11-45b6-a455-3b3ed109e1cb",
          "name": "Projetos",
          "executeOnce": true,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "key": "Email|email",
                  "condition": "is_not_empty"
                },
                {
                  "key": "Nome|title",
                  "condition": "is_not_empty"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            48,
            -144
          ],
          "id": "b8af578b-e2a5-4d1b-9dc4-fd34c04cdb94",
          "name": "Pessoas",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "4c7d07bb-5bc3-43b6-970e-25ab4d38c047",
                  "name": "id",
                  "value": "={{ $json.id }}",
                  "type": "string"
                },
                {
                  "id": "112a3953-6889-4172-89ee-264d3f1eddcd",
                  "name": "Nome",
                  "value": "={{ $json.name }}",
                  "type": "string"
                },
                {
                  "id": "21c41862-e0f6-4463-938c-1a9458cdcdc6",
                  "name": "Email",
                  "value": "={{ $json.property_email }}",
                  "type": "string"
                },
                {
                  "id": "e4ff2f53-325c-4b71-97ed-779195e2a776",
                  "name": "Posição",
                  "value": "={{ $json.property_posi_o }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            208,
            -144
          ],
          "id": "b1086c44-c7ac-4633-8133-f1b1b70167bf",
          "name": "FiltroPessoas"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "cb456732-c930-4e08-bf80-41500bbf42a5",
                  "name": "Projeto",
                  "value": "={{ $('Projetos').item.json.name }}",
                  "type": "string"
                },
                {
                  "id": "46c651b0-63fa-41a2-8256-025b01d3e70f",
                  "name": "Gestor",
                  "value": "={{ $('Projetos').item.json.property_gestor_de_projeto[0] }}",
                  "type": "string"
                },
                {
                  "id": "9916a80c-e6cf-419b-9842-5e82a9fb995e",
                  "name": "Atualização",
                  "value": "={{ $('Projetos').item.json.property_atualiza_es }}",
                  "type": "string"
                },
                {
                  "id": "57ec92b7-2816-420b-80dc-cafc5cfe3ad4",
                  "name": "Nível de Atenção",
                  "value": "={{ $('Projetos').item.json.property_n_vel_de_aten_o }}",
                  "type": "string"
                },
                {
                  "id": "88ecb4cf-5a51-4e5b-b777-91a1a6c9ad58",
                  "name": "Tarefas Semana",
                  "value": "={{ $('Projetos').item.json.property_tarefas_semana }}",
                  "type": "string"
                },
                {
                  "id": "ee0f68c3-ea2e-4f8b-8f65-299ed8c1fa38",
                  "name": "Pauta da Reunião",
                  "value": "={{ $('Projetos').item.json.property_pauta_reuni_o }}",
                  "type": "string"
                },
                {
                  "id": "960a2289-f2d8-4e1d-80f3-38d511fa7dc1",
                  "name": "Analista1",
                  "value": "={{ $json.property_analista_1 }}",
                  "type": "array"
                },
                {
                  "id": "bdeeb606-38e6-41ec-bcf4-c9eac201c422",
                  "name": "Analista2",
                  "value": "={{ $json.property_analista_2 }}",
                  "type": "array"
                },
                {
                  "id": "bf18d54c-dd59-483f-81cb-f703a758cd65",
                  "name": "Analista3",
                  "value": "={{ $json.property_analista_3 }}",
                  "type": "array"
                },
                {
                  "id": "d4ceaed0-38ea-4f43-8212-bd287550e205",
                  "name": "Sponsor1",
                  "value": "={{ $json.property_sponsor1 }}",
                  "type": "array"
                },
                {
                  "id": "e8bf23cd-be83-44a7-b651-75effcabfa9b",
                  "name": "Estagiário",
                  "value": "={{ $json.property_estagi_rio }}",
                  "type": "array"
                },
                {
                  "id": "55780399-f450-4b2b-b324-f5ef86badfed",
                  "name": "Última Edição",
                  "value": "={{ $json.property_ltima_edi_o }}",
                  "type": "string"
                },
                {
                  "id": "8d685dd2-9a3c-4a52-b45f-4054bad91e19",
                  "name": "Sponsor2",
                  "value": "={{ $json.property_sponsor2 }}",
                  "type": "array"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            528,
            -144
          ],
          "id": "66637aa5-66b0-4a5c-8076-fa03078cb3b7",
          "name": "FiltroProjetos"
        },
        {
          "parameters": {
            "jsCode": "/* ──────────────────────────────────────────────────────────────\n   Output1 – Updates semanais\n   • Envia para todas as pessoas com e‑mail (base Pessoas)\n   • Mostra Projeto (Última Edição, Nível, Papel) + Atualização + Tarefas\n   • Ordena por papel: Sponsor > Gestor > Analista > Estagiário,\n     depois por nível (Alto > Médio > Baixo), depois alfabético.\n   • Bullets/sub-bullets: indentação, \"--\", travessão; remove “1.” etc.\n   ────────────────────────────────────────────────────────────── */\n\nconst projetos = items; // do Merge\n\n// Pessoas (apenas quem tem e‑mail)\nconst pessoas = $items('FiltroPessoas', 0);\nconst nome2Pessoa = Object.fromEntries(\n  pessoas\n    .filter(p => p.json.Email)\n    .map(p => [(p.json.Nome || '').trim(), { email: p.json.Email.trim(), nome: (p.json.Nome || '').trim() }])\n);\n\n// helpers -------------------------------------------------------\nconst fmtDate = iso => {\n  if (!iso) return '–';\n  const d = new Date(iso);\n  return isNaN(d) ? '–'\n    : d.toLocaleDateString('pt-BR', { day:'2-digit', month:'2-digit', year:'2-digit', timeZone:'UTC' });\n};\n\nfunction toBullets(txt) {\n  if (!txt) return [];\n  return txt\n    .split('\\n')\n    .filter(Boolean)\n    .map(raw => {\n      const indented = /^[\\t ]{2,}/.test(raw);\n      let clean = raw.trimStart();\n      let level = indented ? 1 : 0;\n\n      if (clean.startsWith('--'))               { level = 1; clean = clean.slice(2).trimStart(); }\n      else if (/^[—–]\\s*/.test(clean))          { level = 1; clean = clean.replace(/^[—–]\\s*/, ''); }\n\n      clean = clean.replace(/^[-•*]\\s*/, '');        // marcador simples\n      clean = clean.replace(/^\\d+\\s*[.).]\\s*/, '');  // enumeração “1.”, “2)”\n      return { level, text: clean };\n    });\n}\n\nconst toArr = raw => {\n  if (!raw) return [];\n  if (typeof raw === 'string') { try { raw = JSON.parse(raw); } catch { raw = [raw]; } }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\n// prioridades\nconst PAPEL_ORDER = ['Sponsor', 'Gestor', 'Analista', 'Estagiário'];\nconst papelPrio   = Object.fromEntries(PAPEL_ORDER.map((p,i)=>[p,i]));\nconst nivelPrio   = { 'Alto':0, 'Médio':1, 'Baixo':2 };\n\n// 2) Gera linhas por pessoa × projeto × papel -------------------\nconst linhas = [];\n\nprojetos.forEach(pr => {\n  const projeto = pr.json.Projeto || pr.json.projeto;\n  const nivel   = pr.json['Nível de Atenção'] || pr.json.nivelAtencao || '—';\n  const ultima  = fmtDate(pr.json['Última Edição'] || pr.json.ultimaEdicao);\n  const atual   = toBullets(pr.json.Atualização       || pr.json.atualizacao);\n  const tarefas = toBullets(pr.json['Tarefas Semana'] || pr.json.tarefasSemana);\n\n  const addLinha = (nome, papel) => {\n    const pessoa = nome2Pessoa[nome?.trim()];\n    if (!pessoa) return; // sem e‑mail ou não mapeado\n    linhas.push({\n      email : pessoa.email,\n      nome  : pessoa.nome,\n      projeto, nivel, ultima,\n      papel,\n      atualizacao:   atual,\n      tarefasSemana: tarefas,\n    });\n  };\n\n  addLinha(pr.json.Gestor, 'Gestor');\n  toArr(pr.json.Analistas)                                 .forEach(n => addLinha(n, 'Analista'));\n  toArr(pr.json.Sponsor || pr.json.Sponsors)               .forEach(n => addLinha(n, 'Sponsor'));\n  toArr(pr.json['Estagiário'] || pr.json.Estagiario || pr.json.Estagiarios)\n                                                          .forEach(n => addLinha(n, 'Estagiário'));\n});\n\n// 3) Agrupa por e‑mail + projeto e define papelPrincipal --------\nconst agrupado = {};\nlinhas.forEach(l => {\n  if (!agrupado[l.email]) agrupado[l.email] = { email: l.email, nome: l.nome, projetos: [] };\n\n  let pj = agrupado[l.email].projetos.find(p => p.projeto === l.projeto);\n  if (!pj) {\n    pj = {\n      projeto       : l.projeto,\n      nivel         : l.nivel,\n      ultima        : l.ultima,\n      atualizacao   : l.atualizacao,\n      tarefasSemana : l.tarefasSemana,\n      papel         : [],\n    };\n    agrupado[l.email].projetos.push(pj);\n  }\n  if (!pj.papel.includes(l.papel)) pj.papel.push(l.papel);\n});\n\n// define papelPrincipal e ordena projetos por prioridade\nfor (const dest of Object.values(agrupado)) {\n  for (const p of dest.projetos) {\n    const principal = PAPEL_ORDER.find(r => p.papel.includes(r)) || p.papel[0] || '';\n    p.papelPrincipal = principal;\n  }\n  dest.projetos.sort((a,b) =>\n    (papelPrio[a.papelPrincipal] ?? 9) - (papelPrio[b.papelPrincipal] ?? 9) ||\n    (nivelPrio[a.nivel] ?? 9)            - (nivelPrio[b.nivel] ?? 9) ||\n    a.projeto.localeCompare(b.projeto, 'pt-BR')\n  );\n}\n\n// 4) Saída -------------------------------------------------------\nreturn Object.values(agrupado).map(p => ({ json: p }));\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            928,
            -352
          ],
          "id": "6750f63b-33a2-4a6d-9401-0b00f081d19b",
          "name": "Output1",
          "executeOnce": false
        },
        {
          "parameters": {
            "jsCode": "/* ──────────────────────────────────────────────────────────────\n   Output2 – Projetos em que o destinatário NÃO participa\n   • Destinatários: Sócios / Especialistas + todos os Gestores\n   • Inclui data da Última Edição (dd/mm/aa) sob o nome do projeto\n   • Proteção: só considera pessoas com e-mail\n   ────────────────────────────────────────────────────────────── */\n\n// 0) Projetos (IDs→nomes) ---------------------------------------\nconst projetos = items;\n\n// 1) Pessoas (FiltroPessoas) – mantém só quem tem e-mail --------\nconst pessoas = $items('FiltroPessoas', 0);\nconst allByName = Object.fromEntries(\n  pessoas\n    .filter(p => p.json.Email)\n    .map(p => [\n      (p.json.Nome || '').trim(),\n      {\n        email: p.json.Email.trim(),\n        nome : (p.json.Nome || '').trim(),\n        pos  : (p.json.Posicao || p.json.Posição || '').toLowerCase(),\n      },\n    ])\n);\n\n// 1a) Destinatários iniciais = Sócio / Especialista -------------\nconst destinatarios = {};\nObject.values(allByName)\n  .filter(p => ['sócio', 'socio', 'especialista', 'managing partner'].includes(p.pos))\n  .forEach(p => (destinatarios[p.nome] = { email: p.email, nome: p.nome }));\n\n// ---------- helpers -------------------------------------------\nconst toArr = raw => {\n  if (!raw) return [];\n  if (typeof raw === 'string') { try { raw = JSON.parse(raw); } catch { raw = [raw]; } }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\n// → 05/07/25\nconst fmtDate = iso => {\n  if (!iso) return '–';\n  const d = new Date(iso);\n  return isNaN(d)\n    ? '–'\n    : d.toLocaleDateString('pt-BR', {\n        day: '2-digit',\n        month: '2-digit',\n        year: '2-digit',\n        timeZone: 'UTC',\n      });\n};\n\nfunction toBullets(txt) {\n  if (!txt) return [];\n  return txt\n    .split('\\n')\n    .filter(Boolean)\n    .map(raw => {\n      const indented = /^[\\t ]{2,}/.test(raw);\n      let clean = raw.trimStart();\n      let level = indented ? 1 : 0;\n\n      if (clean.startsWith('--'))            { level = 1; clean = clean.slice(2).trimStart(); }\n      else if (/^[—–]\\s*/.test(clean))       { level = 1; clean = clean.replace(/^[—–]\\s*/, ''); }\n\n      clean = clean.replace(/^[-•*]\\s*/, '');\n      clean = clean.replace(/^\\d+\\s*[.).]\\s*/, '');\n      return { level, text: clean };\n    });\n}\n\n// 2) Cache detalhes de todos os projetos ------------------------\nconst detalhesProjeto = {};\n\nprojetos.forEach(pr => {\n  const nomeProj = pr.json.Projeto || pr.json.projeto;\n\n  detalhesProjeto[nomeProj] = {\n    gestor        : (pr.json.Gestor || '').trim() || 'Sem gestor atribuído',\n    ultimaEdicao  : pr.json['Última Edição'] || pr.json.ultimaEdicao,\n    atualizacao   : toBullets(pr.json.Atualização       || pr.json.atualizacao),\n    tarefasSemana : toBullets(pr.json['Tarefas Semana'] || pr.json.tarefasSemana),\n    analistas     : toArr(pr.json.Analistas).map(s => s.trim()),\n    sponsors      : toArr(pr.json.Sponsor || pr.json.Sponsors).map(s => s.trim()),\n    estag         : toArr(pr.json['Estagiário'] || pr.json.Estagiario || pr.json.Estagiarios).map(s => s.trim()),\n  };\n\n  /* adiciona Gestor como destinatário (se tiver e-mail) */\n  const gestNome = detalhesProjeto[nomeProj].gestor;\n  const pessoa   = allByName[gestNome];\n  if (pessoa) destinatarios[pessoa.nome] = { email: pessoa.email, nome: pessoa.nome };\n});\n\n// 3) ordenação Gestor → Projeto ---------------------------------\nconst ordProj = (a, b) => {\n  const gA = a.gestor.toLowerCase(), gB = b.gestor.toLowerCase();\n  return gA === gB\n    ? a.projeto.localeCompare(b.projeto, 'pt-BR')\n    : gA.localeCompare(gB, 'pt-BR');\n};\n\n// 4) saída -------------------------------------------------------\nconst saida = [];\n\nObject.values(destinatarios).forEach(dest => {\n  if (!dest.email) return; // segurança extra\n\n  const lista = Object.entries(detalhesProjeto)\n    .filter(([proj, det]) => {\n      const inv =\n        det.gestor === dest.nome ||\n        det.analistas.includes(dest.nome) ||\n        det.sponsors.includes(dest.nome) ||\n        det.estag.includes(dest.nome);\n      return !inv; // queremos só NÃO envolvidos\n    })\n    .map(([proj, det]) => ({\n      projeto       : proj,\n      gestor        : det.gestor,\n      ultima        : fmtDate(det.ultimaEdicao),\n      atualizacao   : det.atualizacao,\n      tarefasSemana : det.tarefasSemana,\n    }))\n    .sort(ordProj);\n\n  // mesmo que lista esteja vazia, ainda queremos enviar (mas pode omitir se preferir)\n  saida.push({ json: { email: dest.email, nome: dest.nome, projetos: lista } });\n});\n\nreturn saida;\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            928,
            -144
          ],
          "id": "d2fcc896-7633-4f08-8d06-f197a0acadd4",
          "name": "Output2"
        },
        {
          "parameters": {
            "jsCode": "/* ──────────────────────────────────────────────────────────────\n   Output3 – Pauta da Reunião Semanal\n   Destinatários:\n     • Sócios / Especialistas (base Pessoas, com e-mail)\n     • Todos os Gestores listados nos projetos (com e-mail)\n   Inclui TODOS os projetos que têm pauta.\n   ────────────────────────────────────────────────────────────── */\n\n// 0) Projetos vindos do Merge -----------------------------------\nconst projetos = items;\n\n// 1) Pessoas (FiltroPessoas) – só quem tem e-mail ---------------\nconst pessoas = $items('FiltroPessoas', 0);\nconst allByName = Object.fromEntries(\n  pessoas\n    .filter(p => p.json.Email)\n    .map(p => [\n      (p.json.Nome || '').trim(),\n      {\n        email: p.json.Email.trim(),\n        nome : (p.json.Nome || '').trim(),\n        pos  : (p.json.Posicao || p.json.Posição || '').toLowerCase(),\n      },\n    ])\n);\n\n// 1a) destinatários iniciais = Sócios / Especialistas -----------\nconst destinatarios = {};\nObject.values(allByName)\n  .filter(p => ['sócio', 'socio', 'especialista', 'managing partner'].includes(p.pos))\n  .forEach(p => (destinatarios[p.nome] = { email: p.email, nome: p.nome }));\n\n// 1b) guarda TODOS os nomes de Gestor (mesmo sem pauta) ---------\nconst todosGestores = new Set();\nprojetos.forEach(pr => {\n  const g = (pr.json.Gestor || '').trim();\n  if (g) todosGestores.add(g);\n});\n\n// adiciona Gestores com e-mail aos destinatários ----------------\ntodosGestores.forEach(g => {\n  const pessoa = allByName[g];\n  if (pessoa) destinatarios[pessoa.nome] = { email: pessoa.email, nome: pessoa.nome };\n});\n\n// helpers -------------------------------------------------------\nconst toArr = raw => {\n  if (!raw) return [];\n  if (typeof raw === 'string') { try { raw = JSON.parse(raw); } catch { raw = [raw]; } }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\nfunction toBullets(txt) {\n  if (!txt) return [];\n  return txt\n    .split('\\n')\n    .filter(Boolean)\n    .map(raw => {\n      const indented = /^[\\t ]{2,}/.test(raw);\n      let clean = raw.trimStart();\n      let level = indented ? 1 : 0;\n\n      if (clean.startsWith('--')) { level = 1; clean = clean.slice(2).trimStart(); }\n      else if (/^[—–]\\s*/.test(clean)) {\n        level = 1;\n        clean = clean.replace(/^[—–]\\s*/, '');\n      }\n\n      clean = clean.replace(/^[-•*]\\s*/, '');\n      clean = clean.replace(/^\\d+\\s*[.).]\\s*/, '');\n      return { level, text: clean };\n    });\n}\n\n// 2) Detalhes dos projetos (somente com pauta) ------------------\nconst detalhes = {};\nprojetos.forEach(pr => {\n  const nomeProj = pr.json.Projeto || pr.json.projeto;\n  const pauta    = toBullets(pr.json['Pauta da Reunião'] || pr.json.pautaReuniao);\n  if (!pauta.length) return;\n\n  detalhes[nomeProj] = {\n    gestor: (pr.json.Gestor || '').trim() || 'Sem gestor atribuído',\n    nivel : pr.json['Nível de Atenção'] || pr.json.nivelAtencao || '—',\n    pauta,\n  };\n});\n\n// 3) prioridade p/ ordenação ------------------------------------\nconst prio = { Alto: 0, 'Alto': 0, Médio: 1, 'Médio': 1, Baixo: 2, 'Baixo': 2 };\n\n// 4) constrói saída (manda mesmo se lista vazia) ----------------\nconst saida = [];\n\nObject.values(destinatarios).forEach(dest => {\n  if (!dest.email) return; // segurança extra\n\n  const lista = Object.entries(detalhes)\n    .map(([proj, det]) => ({\n      projeto: proj,\n      gestor : det.gestor,\n      nivel  : det.nivel,\n      pauta  : det.pauta,\n    }))\n    .sort((a, b) => (prio[a.nivel] ?? 3) - (prio[b.nivel] ?? 3) ||\n                    a.projeto.localeCompare(b.projeto, 'pt-BR'));\n\n  // ✱ sempre inclui o destinatário, mesmo que lista esteja vazia\n  saida.push({ json: { email: dest.email, nome: dest.nome, projetos: lista } });\n});\n\nreturn saida;\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            928,
            64
          ],
          "id": "7c7e1aa1-1558-4892-aebd-db626ee46b32",
          "name": "Output3"
        },
        {
          "parameters": {
            "jsCode": "/**\n * MERGE (Code / JavaScript)\n * - Lê projetos do FiltroProjetos (items)\n * - Lê pessoas do FiltroPessoas ($items) e monta id → Nome\n * - Converte IDs → Nomes:\n *   Gestor (string)\n *   Analista1/2/3 (arrays)  → gera Analistas = união sem duplicatas\n *   Sponsor1/2 + Sponsor/Sponsors (arrays) → normaliza em Sponsor (array)\n *   Estagiário (arrays)\n * - Mantém os demais campos (ex.: \"Última Edição\")\n * - Retorna somente um array de projetos prontos para os outputs\n */\n\n// 0) Projetos que chegaram ao node (FiltroProjetos)\nconst projetos = items;\n\n// 1) Pessoas vindas do node \"FiltroPessoas\"\nconst pessoas = $items('FiltroPessoas', 0) || [];\n\n// 2) dicionário id → Nome\nconst idToName = {};\nfor (const p of pessoas) {\n  const id   = p?.json?.id;\n  const nome = (p?.json?.Nome || '').trim();\n  if (id && nome) idToName[id] = nome;\n}\n\n// helpers -------------------------------------------------------\nconst toArray = (raw) => {\n  if (!raw) return [];\n  if (typeof raw === 'string') {\n    // às vezes vem string JSON; tenta parsear\n    try { raw = JSON.parse(raw); } catch { raw = [raw]; }\n  }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\n// Converte um campo (array/JSON/string) em nomes, aceitando Notion relations {id:...}\n// Se não encontrar no dicionário, devolve o próprio valor\nconst idsToNames = (raw) =>\n  toArray(raw)\n    .map(r => {\n      const id = (r && typeof r === 'object' && 'id' in r) ? r.id : r;\n      return (idToName[id] || id || '').toString();\n    })\n    .filter(Boolean)\n    .map(s => s.trim());\n\n// Remove duplicatas preservando ordem\nconst uniq = (arr) => [...new Set(arr.filter(Boolean).map(x => x.trim()))];\n\n// 3) Percorre projetos e substitui IDs por nomes\nconst saida = projetos.map(pr => {\n  const j = { ...pr.json };\n\n  // --- Gestor (ID → Nome) ---\n  if (j.Gestor) {\n    const id = (j.Gestor && j.Gestor.id) ? j.Gestor.id : j.Gestor;\n    j.Gestor = (idToName[id] || id || '').trim();\n  }\n\n  // --- Analistas: Analista1, Analista2 e Analista3 (arrays) ---\n  const analista1 = idsToNames(j.Analista1 || j['Analista 1']);\n  const analista2 = idsToNames(j.Analista2 || j['Analista 2']);\n  const analista3 = idsToNames(j.Analista3 || j['Analista 3']);\n\n  if ('Analista1' in j || 'Analista 1' in j) j.Analista1 = analista1;\n  if ('Analista2' in j || 'Analista 2' in j) j.Analista2 = analista2;\n  if ('Analista3' in j || 'Analista 3' in j) j.Analista3 = analista3;\n\n  const analistasPreExistentes = idsToNames(j.Analistas);\n  j.Analistas = uniq([\n    ...analistasPreExistentes,\n    ...analista1,\n    ...analista2,\n    ...analista3,\n  ]);\n\n  // --- Sponsors: Sponsor1, Sponsor2, Sponsor/Sponsors → Sponsor (array nomes) ---\n  const sponsor1   = idsToNames(j.Sponsor1   || j['Sponsor 1']);\n  const sponsor2   = idsToNames(j.Sponsor2   || j['Sponsor 2']);\n  const sponsorsEx = idsToNames(j.Sponsor    || j.Sponsors);\n\n  j.Sponsor = uniq([\n    ...sponsorsEx,\n    ...sponsor1,\n    ...sponsor2,\n  ]);\n\n  // limpa \"Sponsors\" se existir, pois normalizamos em Sponsor\n  if ('Sponsors' in j) delete j.Sponsors;\n\n  // --- Estagiário (variações) → nomes ---\n  const estagiarios = idsToNames(\n    j['Estagiário'] ||\n    j.Estagiario   ||\n    j.Estagiarios  ||\n    j.estagiarios  ||\n    j['Estagiário(a)']\n  );\n  j['Estagiário'] = estagiarios;\n\n  // Observação: \"Última Edição\" e todos os demais campos ficam como estão\n  return { json: j };\n});\n\nreturn saida;\n"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            688,
            -144
          ],
          "id": "b3d35552-d99b-47d8-a538-35e6959dd180",
          "name": "Merge"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "weeks",
                  "triggerAtHour": 4
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.2,
          "position": [
            -128,
            -144
          ],
          "id": "a8cd7c8f-c1dd-47f1-b8f2-71a37d622980",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "toRecipients": "={{ $json.email }}",
            "subject": "Atualização dos teus projetos",
            "bodyContent": "=<link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n<div style=\"font-family:'Montserrat',Arial,sans-serif; font-size:10pt; line-height:1.4;\">\n  <p>Olá {{$json.nome}},</p>\n\n  <p>Seguem os updates semanais dos projetos em que tu participas:</p>\n\n  <table border=\"1\" cellpadding=\"6\" cellspacing=\"0\" style=\"border-collapse:collapse; width:100%;\">\n    <tr style=\"background:#f2f2f2; font-weight:bold;\">\n      <th style=\"width:30%;\">Projeto (updated at, nível e papel)</th>\n      <th style=\"width:35%;\">Atualização</th>\n      <th style=\"width:35%;\">Tarefas da Semana</th>\n    </tr>\n\n    {{\n      $json.projetos.map(p => {\n        const corNivel = { 'Alto':'#d9534f', 'Médio':'#b8860b', 'Baixo':'#4caf50' }[p.nivel] || '#888';\n        const corPapel = { 'Sponsor':'#6f42c1', 'Gestor':'#0aa2a1', 'Analista':'#495057', 'Estagiário':'#adb5bd' }[p.papelPrincipal] || '#999';\n\n        const badge = (texto, bg) => `\n          <span style=\"\n            display:inline-block;\n            margin-left:6px;\n            padding:2px 6px;\n            border-radius:4px;\n            background:${bg};\n            color:#fff;\n            font-size:9pt;\n            font-weight:400;\">\n            ${texto}\n          </span>`;\n\n        return `\n          <tr>\n            <td style=\"vertical-align:top;\">\n              <strong>${p.projeto}</strong><br>\n              <span style=\"font-size:9pt;color:#666;\">(${p.ultima || '–'})</span>\n              ${badge(p.nivel, corNivel)}\n              ${p.papelPrincipal ? badge(p.papelPrincipal, corPapel) : ''}\n            </td>\n\n            <td style=\"vertical-align:top;\">\n              ${\n                p.atualizacao.length\n                  ? '<ul style=\"margin:0; padding-left:18px;\">' +\n                      p.atualizacao.map(a =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(a.level*4)}${a.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n\n            <td style=\"vertical-align:top;\">\n              ${\n                p.tarefasSemana.length\n                  ? '<ul style=\"margin:0; padding-left:18px;\">' +\n                      p.tarefasSemana.map(t =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(t.level*4)}${t.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n          </tr>`;\n      }).join('')\n    }}\n  </table>\n</div>\n",
            "additionalFields": {
              "bodyContentType": "html"
            }
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            1168,
            -352
          ],
          "id": "d124d2e5-4511-48d0-8409-55096f9c9da3",
          "name": "Send a message",
          "webhookId": "d8cbb149-9dbe-49c1-b104-706c70e22401",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "fB8siXDRjQ8ykMBp",
              "name": "Outlook Pier"
            }
          }
        },
        {
          "parameters": {
            "toRecipients": "={{ $json.email }}",
            "subject": "Atualização dos demais projetos",
            "bodyContent": "=<link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n<div style=\"font-family:'Montserrat',Arial,sans-serif;font-size:10pt;line-height:1.4;\">\n  <p>Olá {{$json.nome}},</p>\n\n  <p>Listamos abaixo os projetos em que tu não participas, agrupados por Gestor:</p>\n\n  {{\n    // agrupa por gestor\n    (() => {\n      const groups = {};\n      $json.projetos.forEach(p => {\n        if (!groups[p.gestor]) groups[p.gestor] = [];\n        groups[p.gestor].push(p);\n      });\n\n      return Object.entries(groups).map(([gestor, arr]) => {\n        const rows = arr.map(p => `\n          <tr>\n            <td style=\"vertical-align:top;\">\n              <strong>${p.projeto}</strong><br>\n              <span style=\"font-size:9pt;color:#666;\">(${p.ultima})</span>\n            </td>\n            <td style=\"vertical-align:top;\">\n              ${\n                p.atualizacao.length\n                  ? '<ul style=\"margin:0;padding-left:18px;\">' +\n                      p.atualizacao.map(a =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(a.level*4)}${a.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n            <td style=\"vertical-align:top;\">\n              ${\n                p.tarefasSemana.length\n                  ? '<ul style=\"margin:0;padding-left:18px;\">' +\n                      p.tarefasSemana.map(t =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(t.level*4)}${t.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n          </tr>\n        `).join('');\n\n        return `\n          <h4 style=\"margin:16px 0 4px 0;font-weight:700;\">Gestor: ${gestor}</h4>\n          <table border=\"1\" cellpadding=\"6\" cellspacing=\"0\" style=\"border-collapse:collapse;width:100%;margin-bottom:12px;\">\n            <tr style=\"background:#f2f2f2;font-weight:bold;\">\n              <th style=\"width:30%;\">Projeto (updated at)</th>\n              <th style=\"width:35%;\">Atualização</th>\n              <th style=\"width:35%;\">Tarefas / Ações</th>\n            </tr>\n            ${rows}\n          </table>\n        `;\n      }).join('');\n    })()\n  }}\n</div>\n",
            "additionalFields": {
              "bodyContentType": "html"
            }
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            1168,
            -144
          ],
          "id": "ec844cfa-4cd2-415e-a494-0804e3b4bd26",
          "name": "Send a message1",
          "webhookId": "d8cbb149-9dbe-49c1-b104-706c70e22401",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "fB8siXDRjQ8ykMBp",
              "name": "Outlook Pier"
            }
          }
        },
        {
          "parameters": {
            "toRecipients": "={{ $json.email }}",
            "subject": "Pauta para Alinhamento Semanal",
            "bodyContent": "=<link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n\n<div style=\"font-family:'Montserrat',Arial,sans-serif; font-size:10pt; line-height:1.4;\">\n  <p>Olá {{$json.nome}},</p>\n  <p>Segue a pauta para próxima reunião de alinhamento semanal:</p>\n\n  {{\n    (() => {\n      /* ▸ converte [{level,text}] em listas aninhadas */\n      const buildList = a => {\n        if (!a || !a.length) return '-';\n        let html='', open=false;\n        a.forEach(it=>{\n          if (it.level===0){\n            if (open){html+='</ul>';open=false;}\n            html+=`<li>${it.text}</li>`;\n          } else {\n            if (!open){html+='<ul style=\"margin:2px 0 0 18px;\">';open=true;}\n            html+=`<li>${it.text}</li>`;\n          }\n        });\n        if (open) html+='</ul>';\n        return `<ul style=\"margin:0; padding-left:18px;\">${html}</ul>`;\n      };\n\n      const color = n => ({Alto:'#d9534f',Médio:'#b8860b',Baixo:'#4caf50'})[n] || '#888';\n\n      return $json.projetos.map((p,i)=>`\n        <h4 style=\"margin:8px 0 4px 0;font-weight:700;\">\n          ${i+1}. ${p.projeto}\n          <em style=\"font-weight:400;font-style:italic;\">(${p.gestor})</em>\n          <span style=\"display:inline-block;margin-left:6px;padding:2px 6px;border-radius:4px;background:${color(p.nivel)};color:#fff;font-size:9pt;\">\n            ${p.nivel}\n          </span>\n        </h4>\n        ${buildList(p.pauta)}\n      `).join('');\n    })()\n  }}\n</div>\n",
            "additionalFields": {
              "bodyContentType": "html"
            }
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            1168,
            64
          ],
          "id": "91e8c3b4-62e9-40b1-8b87-a469fb558835",
          "name": "Send a message2",
          "webhookId": "d8cbb149-9dbe-49c1-b104-706c70e22401",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "fB8siXDRjQ8ykMBp",
              "name": "Outlook Pier"
            }
          }
        }
      ],
      "connections": {
        "Projetos": {
          "main": [
            [
              {
                "node": "FiltroProjetos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Pessoas": {
          "main": [
            [
              {
                "node": "FiltroPessoas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FiltroPessoas": {
          "main": [
            [
              {
                "node": "Projetos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "FiltroProjetos": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Output1": {
          "main": [
            [
              {
                "node": "Send a message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Output2": {
          "main": [
            [
              {
                "node": "Send a message1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Output3": {
          "main": [
            [
              {
                "node": "Send a message2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Output1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Output3",
                "type": "main",
                "index": 0
              },
              {
                "node": "Output2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Pessoas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "d3f8b631-02c4-4fe7-a4e7-2218aa56e552",
      "activeVersionId": "afc620b4-6648-4e5e-803f-dea860e4b58b",
      "versionCounter": 52,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2025-09-28T00:06:24.483Z",
          "createdAt": "2025-09-28T00:06:24.483Z",
          "role": "workflow:owner",
          "workflowId": "6dVGwJNkYFOGlLGD",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2025-12-12T17:26:55.816Z",
        "createdAt": "2025-12-12T17:26:55.816Z",
        "versionId": "afc620b4-6648-4e5e-803f-dea860e4b58b",
        "workflowId": "6dVGwJNkYFOGlLGD",
        "nodes": [
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "c2af396c-c2a3-47ec-a452-b2b2bf6b9031\t",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "key": "Status|select",
                    "condition": "equals",
                    "selectValue": "Ativo"
                  },
                  {
                    "key": "Nome|title",
                    "condition": "is_not_empty"
                  }
                ]
              },
              "options": {
                "sort": {
                  "sortValue": [
                    {
                      "key": "Nome|title",
                      "direction": "ascending"
                    }
                  ]
                }
              }
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              368,
              -144
            ],
            "id": "a90704cb-4d11-45b6-a455-3b3ed109e1cb",
            "name": "Projetos",
            "executeOnce": true,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "ad3cdbff851f4ec9981c8ff61d32dd19",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "key": "Email|email",
                    "condition": "is_not_empty"
                  },
                  {
                    "key": "Nome|title",
                    "condition": "is_not_empty"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              48,
              -144
            ],
            "id": "b8af578b-e2a5-4d1b-9dc4-fd34c04cdb94",
            "name": "Pessoas",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "4c7d07bb-5bc3-43b6-970e-25ab4d38c047",
                    "name": "id",
                    "value": "={{ $json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "112a3953-6889-4172-89ee-264d3f1eddcd",
                    "name": "Nome",
                    "value": "={{ $json.name }}",
                    "type": "string"
                  },
                  {
                    "id": "21c41862-e0f6-4463-938c-1a9458cdcdc6",
                    "name": "Email",
                    "value": "={{ $json.property_email }}",
                    "type": "string"
                  },
                  {
                    "id": "e4ff2f53-325c-4b71-97ed-779195e2a776",
                    "name": "Posição",
                    "value": "={{ $json.property_posi_o }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              208,
              -144
            ],
            "id": "b1086c44-c7ac-4633-8133-f1b1b70167bf",
            "name": "FiltroPessoas"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "cb456732-c930-4e08-bf80-41500bbf42a5",
                    "name": "Projeto",
                    "value": "={{ $('Projetos').item.json.name }}",
                    "type": "string"
                  },
                  {
                    "id": "46c651b0-63fa-41a2-8256-025b01d3e70f",
                    "name": "Gestor",
                    "value": "={{ $('Projetos').item.json.property_gestor_de_projeto[0] }}",
                    "type": "string"
                  },
                  {
                    "id": "9916a80c-e6cf-419b-9842-5e82a9fb995e",
                    "name": "Atualização",
                    "value": "={{ $('Projetos').item.json.property_atualiza_es }}",
                    "type": "string"
                  },
                  {
                    "id": "57ec92b7-2816-420b-80dc-cafc5cfe3ad4",
                    "name": "Nível de Atenção",
                    "value": "={{ $('Projetos').item.json.property_n_vel_de_aten_o }}",
                    "type": "string"
                  },
                  {
                    "id": "88ecb4cf-5a51-4e5b-b777-91a1a6c9ad58",
                    "name": "Tarefas Semana",
                    "value": "={{ $('Projetos').item.json.property_tarefas_semana }}",
                    "type": "string"
                  },
                  {
                    "id": "ee0f68c3-ea2e-4f8b-8f65-299ed8c1fa38",
                    "name": "Pauta da Reunião",
                    "value": "={{ $('Projetos').item.json.property_pauta_reuni_o }}",
                    "type": "string"
                  },
                  {
                    "id": "960a2289-f2d8-4e1d-80f3-38d511fa7dc1",
                    "name": "Analista1",
                    "value": "={{ $json.property_analista_1 }}",
                    "type": "array"
                  },
                  {
                    "id": "bdeeb606-38e6-41ec-bcf4-c9eac201c422",
                    "name": "Analista2",
                    "value": "={{ $json.property_analista_2 }}",
                    "type": "array"
                  },
                  {
                    "id": "bf18d54c-dd59-483f-81cb-f703a758cd65",
                    "name": "Analista3",
                    "value": "={{ $json.property_analista_3 }}",
                    "type": "array"
                  },
                  {
                    "id": "d4ceaed0-38ea-4f43-8212-bd287550e205",
                    "name": "Sponsor1",
                    "value": "={{ $json.property_sponsor1 }}",
                    "type": "array"
                  },
                  {
                    "id": "e8bf23cd-be83-44a7-b651-75effcabfa9b",
                    "name": "Estagiário",
                    "value": "={{ $json.property_estagi_rio }}",
                    "type": "array"
                  },
                  {
                    "id": "55780399-f450-4b2b-b324-f5ef86badfed",
                    "name": "Última Edição",
                    "value": "={{ $json.property_ltima_edi_o }}",
                    "type": "string"
                  },
                  {
                    "id": "8d685dd2-9a3c-4a52-b45f-4054bad91e19",
                    "name": "Sponsor2",
                    "value": "={{ $json.property_sponsor2 }}",
                    "type": "array"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              528,
              -144
            ],
            "id": "66637aa5-66b0-4a5c-8076-fa03078cb3b7",
            "name": "FiltroProjetos"
          },
          {
            "parameters": {
              "jsCode": "/* ──────────────────────────────────────────────────────────────\n   Output1 – Updates semanais\n   • Envia para todas as pessoas com e‑mail (base Pessoas)\n   • Mostra Projeto (Última Edição, Nível, Papel) + Atualização + Tarefas\n   • Ordena por papel: Sponsor > Gestor > Analista > Estagiário,\n     depois por nível (Alto > Médio > Baixo), depois alfabético.\n   • Bullets/sub-bullets: indentação, \"--\", travessão; remove “1.” etc.\n   ────────────────────────────────────────────────────────────── */\n\nconst projetos = items; // do Merge\n\n// Pessoas (apenas quem tem e‑mail)\nconst pessoas = $items('FiltroPessoas', 0);\nconst nome2Pessoa = Object.fromEntries(\n  pessoas\n    .filter(p => p.json.Email)\n    .map(p => [(p.json.Nome || '').trim(), { email: p.json.Email.trim(), nome: (p.json.Nome || '').trim() }])\n);\n\n// helpers -------------------------------------------------------\nconst fmtDate = iso => {\n  if (!iso) return '–';\n  const d = new Date(iso);\n  return isNaN(d) ? '–'\n    : d.toLocaleDateString('pt-BR', { day:'2-digit', month:'2-digit', year:'2-digit', timeZone:'UTC' });\n};\n\nfunction toBullets(txt) {\n  if (!txt) return [];\n  return txt\n    .split('\\n')\n    .filter(Boolean)\n    .map(raw => {\n      const indented = /^[\\t ]{2,}/.test(raw);\n      let clean = raw.trimStart();\n      let level = indented ? 1 : 0;\n\n      if (clean.startsWith('--'))               { level = 1; clean = clean.slice(2).trimStart(); }\n      else if (/^[—–]\\s*/.test(clean))          { level = 1; clean = clean.replace(/^[—–]\\s*/, ''); }\n\n      clean = clean.replace(/^[-•*]\\s*/, '');        // marcador simples\n      clean = clean.replace(/^\\d+\\s*[.).]\\s*/, '');  // enumeração “1.”, “2)”\n      return { level, text: clean };\n    });\n}\n\nconst toArr = raw => {\n  if (!raw) return [];\n  if (typeof raw === 'string') { try { raw = JSON.parse(raw); } catch { raw = [raw]; } }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\n// prioridades\nconst PAPEL_ORDER = ['Sponsor', 'Gestor', 'Analista', 'Estagiário'];\nconst papelPrio   = Object.fromEntries(PAPEL_ORDER.map((p,i)=>[p,i]));\nconst nivelPrio   = { 'Alto':0, 'Médio':1, 'Baixo':2 };\n\n// 2) Gera linhas por pessoa × projeto × papel -------------------\nconst linhas = [];\n\nprojetos.forEach(pr => {\n  const projeto = pr.json.Projeto || pr.json.projeto;\n  const nivel   = pr.json['Nível de Atenção'] || pr.json.nivelAtencao || '—';\n  const ultima  = fmtDate(pr.json['Última Edição'] || pr.json.ultimaEdicao);\n  const atual   = toBullets(pr.json.Atualização       || pr.json.atualizacao);\n  const tarefas = toBullets(pr.json['Tarefas Semana'] || pr.json.tarefasSemana);\n\n  const addLinha = (nome, papel) => {\n    const pessoa = nome2Pessoa[nome?.trim()];\n    if (!pessoa) return; // sem e‑mail ou não mapeado\n    linhas.push({\n      email : pessoa.email,\n      nome  : pessoa.nome,\n      projeto, nivel, ultima,\n      papel,\n      atualizacao:   atual,\n      tarefasSemana: tarefas,\n    });\n  };\n\n  addLinha(pr.json.Gestor, 'Gestor');\n  toArr(pr.json.Analistas)                                 .forEach(n => addLinha(n, 'Analista'));\n  toArr(pr.json.Sponsor || pr.json.Sponsors)               .forEach(n => addLinha(n, 'Sponsor'));\n  toArr(pr.json['Estagiário'] || pr.json.Estagiario || pr.json.Estagiarios)\n                                                          .forEach(n => addLinha(n, 'Estagiário'));\n});\n\n// 3) Agrupa por e‑mail + projeto e define papelPrincipal --------\nconst agrupado = {};\nlinhas.forEach(l => {\n  if (!agrupado[l.email]) agrupado[l.email] = { email: l.email, nome: l.nome, projetos: [] };\n\n  let pj = agrupado[l.email].projetos.find(p => p.projeto === l.projeto);\n  if (!pj) {\n    pj = {\n      projeto       : l.projeto,\n      nivel         : l.nivel,\n      ultima        : l.ultima,\n      atualizacao   : l.atualizacao,\n      tarefasSemana : l.tarefasSemana,\n      papel         : [],\n    };\n    agrupado[l.email].projetos.push(pj);\n  }\n  if (!pj.papel.includes(l.papel)) pj.papel.push(l.papel);\n});\n\n// define papelPrincipal e ordena projetos por prioridade\nfor (const dest of Object.values(agrupado)) {\n  for (const p of dest.projetos) {\n    const principal = PAPEL_ORDER.find(r => p.papel.includes(r)) || p.papel[0] || '';\n    p.papelPrincipal = principal;\n  }\n  dest.projetos.sort((a,b) =>\n    (papelPrio[a.papelPrincipal] ?? 9) - (papelPrio[b.papelPrincipal] ?? 9) ||\n    (nivelPrio[a.nivel] ?? 9)            - (nivelPrio[b.nivel] ?? 9) ||\n    a.projeto.localeCompare(b.projeto, 'pt-BR')\n  );\n}\n\n// 4) Saída -------------------------------------------------------\nreturn Object.values(agrupado).map(p => ({ json: p }));\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              928,
              -368
            ],
            "id": "6750f63b-33a2-4a6d-9401-0b00f081d19b",
            "name": "Output1",
            "executeOnce": false
          },
          {
            "parameters": {
              "jsCode": "/* ──────────────────────────────────────────────────────────────\n   Output2 – Projetos em que o destinatário NÃO participa\n   • Destinatários: Sócios / Especialistas + todos os Gestores\n   • Inclui data da Última Edição (dd/mm/aa) sob o nome do projeto\n   • Proteção: só considera pessoas com e-mail\n   ────────────────────────────────────────────────────────────── */\n\n// 0) Projetos (IDs→nomes) ---------------------------------------\nconst projetos = items;\n\n// 1) Pessoas (FiltroPessoas) – mantém só quem tem e-mail --------\nconst pessoas = $items('FiltroPessoas', 0);\nconst allByName = Object.fromEntries(\n  pessoas\n    .filter(p => p.json.Email)\n    .map(p => [\n      (p.json.Nome || '').trim(),\n      {\n        email: p.json.Email.trim(),\n        nome : (p.json.Nome || '').trim(),\n        pos  : (p.json.Posicao || p.json.Posição || '').toLowerCase(),\n      },\n    ])\n);\n\n// 1a) Destinatários iniciais = Sócio / Especialista -------------\nconst destinatarios = {};\nObject.values(allByName)\n  .filter(p => ['sócio', 'socio', 'especialista', 'managing partner'].includes(p.pos))\n  .forEach(p => (destinatarios[p.nome] = { email: p.email, nome: p.nome }));\n\n// ---------- helpers -------------------------------------------\nconst toArr = raw => {\n  if (!raw) return [];\n  if (typeof raw === 'string') { try { raw = JSON.parse(raw); } catch { raw = [raw]; } }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\n// → 05/07/25\nconst fmtDate = iso => {\n  if (!iso) return '–';\n  const d = new Date(iso);\n  return isNaN(d)\n    ? '–'\n    : d.toLocaleDateString('pt-BR', {\n        day: '2-digit',\n        month: '2-digit',\n        year: '2-digit',\n        timeZone: 'UTC',\n      });\n};\n\nfunction toBullets(txt) {\n  if (!txt) return [];\n  return txt\n    .split('\\n')\n    .filter(Boolean)\n    .map(raw => {\n      const indented = /^[\\t ]{2,}/.test(raw);\n      let clean = raw.trimStart();\n      let level = indented ? 1 : 0;\n\n      if (clean.startsWith('--'))            { level = 1; clean = clean.slice(2).trimStart(); }\n      else if (/^[—–]\\s*/.test(clean))       { level = 1; clean = clean.replace(/^[—–]\\s*/, ''); }\n\n      clean = clean.replace(/^[-•*]\\s*/, '');\n      clean = clean.replace(/^\\d+\\s*[.).]\\s*/, '');\n      return { level, text: clean };\n    });\n}\n\n// 2) Cache detalhes de todos os projetos ------------------------\nconst detalhesProjeto = {};\n\nprojetos.forEach(pr => {\n  const nomeProj = pr.json.Projeto || pr.json.projeto;\n\n  detalhesProjeto[nomeProj] = {\n    gestor        : (pr.json.Gestor || '').trim() || 'Sem gestor atribuído',\n    ultimaEdicao  : pr.json['Última Edição'] || pr.json.ultimaEdicao,\n    atualizacao   : toBullets(pr.json.Atualização       || pr.json.atualizacao),\n    tarefasSemana : toBullets(pr.json['Tarefas Semana'] || pr.json.tarefasSemana),\n    analistas     : toArr(pr.json.Analistas).map(s => s.trim()),\n    sponsors      : toArr(pr.json.Sponsor || pr.json.Sponsors).map(s => s.trim()),\n    estag         : toArr(pr.json['Estagiário'] || pr.json.Estagiario || pr.json.Estagiarios).map(s => s.trim()),\n  };\n\n  /* adiciona Gestor como destinatário (se tiver e-mail) */\n  const gestNome = detalhesProjeto[nomeProj].gestor;\n  const pessoa   = allByName[gestNome];\n  if (pessoa) destinatarios[pessoa.nome] = { email: pessoa.email, nome: pessoa.nome };\n});\n\n// 3) ordenação Gestor → Projeto ---------------------------------\nconst ordProj = (a, b) => {\n  const gA = a.gestor.toLowerCase(), gB = b.gestor.toLowerCase();\n  return gA === gB\n    ? a.projeto.localeCompare(b.projeto, 'pt-BR')\n    : gA.localeCompare(gB, 'pt-BR');\n};\n\n// 4) saída -------------------------------------------------------\nconst saida = [];\n\nObject.values(destinatarios).forEach(dest => {\n  if (!dest.email) return; // segurança extra\n\n  const lista = Object.entries(detalhesProjeto)\n    .filter(([proj, det]) => {\n      const inv =\n        det.gestor === dest.nome ||\n        det.analistas.includes(dest.nome) ||\n        det.sponsors.includes(dest.nome) ||\n        det.estag.includes(dest.nome);\n      return !inv; // queremos só NÃO envolvidos\n    })\n    .map(([proj, det]) => ({\n      projeto       : proj,\n      gestor        : det.gestor,\n      ultima        : fmtDate(det.ultimaEdicao),\n      atualizacao   : det.atualizacao,\n      tarefasSemana : det.tarefasSemana,\n    }))\n    .sort(ordProj);\n\n  // mesmo que lista esteja vazia, ainda queremos enviar (mas pode omitir se preferir)\n  saida.push({ json: { email: dest.email, nome: dest.nome, projetos: lista } });\n});\n\nreturn saida;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              928,
              -160
            ],
            "id": "d2fcc896-7633-4f08-8d06-f197a0acadd4",
            "name": "Output2"
          },
          {
            "parameters": {
              "jsCode": "/* ──────────────────────────────────────────────────────────────\n   Output3 – Pauta da Reunião Semanal\n   Destinatários:\n     • Sócios / Especialistas (base Pessoas, com e-mail)\n     • Todos os Gestores listados nos projetos (com e-mail)\n   Inclui TODOS os projetos que têm pauta.\n   ────────────────────────────────────────────────────────────── */\n\n// 0) Projetos vindos do Merge -----------------------------------\nconst projetos = items;\n\n// 1) Pessoas (FiltroPessoas) – só quem tem e-mail ---------------\nconst pessoas = $items('FiltroPessoas', 0);\nconst allByName = Object.fromEntries(\n  pessoas\n    .filter(p => p.json.Email)\n    .map(p => [\n      (p.json.Nome || '').trim(),\n      {\n        email: p.json.Email.trim(),\n        nome : (p.json.Nome || '').trim(),\n        pos  : (p.json.Posicao || p.json.Posição || '').toLowerCase(),\n      },\n    ])\n);\n\n// 1a) destinatários iniciais = Sócios / Especialistas -----------\nconst destinatarios = {};\nObject.values(allByName)\n  .filter(p => ['sócio', 'socio', 'especialista', 'managing partner'].includes(p.pos))\n  .forEach(p => (destinatarios[p.nome] = { email: p.email, nome: p.nome }));\n\n// 1b) guarda TODOS os nomes de Gestor (mesmo sem pauta) ---------\nconst todosGestores = new Set();\nprojetos.forEach(pr => {\n  const g = (pr.json.Gestor || '').trim();\n  if (g) todosGestores.add(g);\n});\n\n// adiciona Gestores com e-mail aos destinatários ----------------\ntodosGestores.forEach(g => {\n  const pessoa = allByName[g];\n  if (pessoa) destinatarios[pessoa.nome] = { email: pessoa.email, nome: pessoa.nome };\n});\n\n// helpers -------------------------------------------------------\nconst toArr = raw => {\n  if (!raw) return [];\n  if (typeof raw === 'string') { try { raw = JSON.parse(raw); } catch { raw = [raw]; } }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\nfunction toBullets(txt) {\n  if (!txt) return [];\n  return txt\n    .split('\\n')\n    .filter(Boolean)\n    .map(raw => {\n      const indented = /^[\\t ]{2,}/.test(raw);\n      let clean = raw.trimStart();\n      let level = indented ? 1 : 0;\n\n      if (clean.startsWith('--')) { level = 1; clean = clean.slice(2).trimStart(); }\n      else if (/^[—–]\\s*/.test(clean)) {\n        level = 1;\n        clean = clean.replace(/^[—–]\\s*/, '');\n      }\n\n      clean = clean.replace(/^[-•*]\\s*/, '');\n      clean = clean.replace(/^\\d+\\s*[.).]\\s*/, '');\n      return { level, text: clean };\n    });\n}\n\n// 2) Detalhes dos projetos (somente com pauta) ------------------\nconst detalhes = {};\nprojetos.forEach(pr => {\n  const nomeProj = pr.json.Projeto || pr.json.projeto;\n  const pauta    = toBullets(pr.json['Pauta da Reunião'] || pr.json.pautaReuniao);\n  if (!pauta.length) return;\n\n  detalhes[nomeProj] = {\n    gestor: (pr.json.Gestor || '').trim() || 'Sem gestor atribuído',\n    nivel : pr.json['Nível de Atenção'] || pr.json.nivelAtencao || '—',\n    pauta,\n  };\n});\n\n// 3) prioridade p/ ordenação ------------------------------------\nconst prio = { Alto: 0, 'Alto': 0, Médio: 1, 'Médio': 1, Baixo: 2, 'Baixo': 2 };\n\n// 4) constrói saída (manda mesmo se lista vazia) ----------------\nconst saida = [];\n\nObject.values(destinatarios).forEach(dest => {\n  if (!dest.email) return; // segurança extra\n\n  const lista = Object.entries(detalhes)\n    .map(([proj, det]) => ({\n      projeto: proj,\n      gestor : det.gestor,\n      nivel  : det.nivel,\n      pauta  : det.pauta,\n    }))\n    .sort((a, b) => (prio[a.nivel] ?? 3) - (prio[b.nivel] ?? 3) ||\n                    a.projeto.localeCompare(b.projeto, 'pt-BR'));\n\n  // ✱ sempre inclui o destinatário, mesmo que lista esteja vazia\n  saida.push({ json: { email: dest.email, nome: dest.nome, projetos: lista } });\n});\n\nreturn saida;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              928,
              48
            ],
            "id": "7c7e1aa1-1558-4892-aebd-db626ee46b32",
            "name": "Output3"
          },
          {
            "parameters": {
              "jsCode": "/**\n * MERGE (Code / JavaScript)\n * - Lê projetos do FiltroProjetos (items)\n * - Lê pessoas do FiltroPessoas ($items) e monta id → Nome\n * - Converte IDs → Nomes:\n *   Gestor (string)\n *   Analista1/2/3 (arrays)  → gera Analistas = união sem duplicatas\n *   Sponsor1/2 + Sponsor/Sponsors (arrays) → normaliza em Sponsor (array)\n *   Estagiário (arrays)\n * - Mantém os demais campos (ex.: \"Última Edição\")\n * - Retorna somente um array de projetos prontos para os outputs\n */\n\n// 0) Projetos que chegaram ao node (FiltroProjetos)\nconst projetos = items;\n\n// 1) Pessoas vindas do node \"FiltroPessoas\"\nconst pessoas = $items('FiltroPessoas', 0) || [];\n\n// 2) dicionário id → Nome\nconst idToName = {};\nfor (const p of pessoas) {\n  const id   = p?.json?.id;\n  const nome = (p?.json?.Nome || '').trim();\n  if (id && nome) idToName[id] = nome;\n}\n\n// helpers -------------------------------------------------------\nconst toArray = (raw) => {\n  if (!raw) return [];\n  if (typeof raw === 'string') {\n    // às vezes vem string JSON; tenta parsear\n    try { raw = JSON.parse(raw); } catch { raw = [raw]; }\n  }\n  return Array.isArray(raw) ? raw : [raw];\n};\n\n// Converte um campo (array/JSON/string) em nomes, aceitando Notion relations {id:...}\n// Se não encontrar no dicionário, devolve o próprio valor\nconst idsToNames = (raw) =>\n  toArray(raw)\n    .map(r => {\n      const id = (r && typeof r === 'object' && 'id' in r) ? r.id : r;\n      return (idToName[id] || id || '').toString();\n    })\n    .filter(Boolean)\n    .map(s => s.trim());\n\n// Remove duplicatas preservando ordem\nconst uniq = (arr) => [...new Set(arr.filter(Boolean).map(x => x.trim()))];\n\n// 3) Percorre projetos e substitui IDs por nomes\nconst saida = projetos.map(pr => {\n  const j = { ...pr.json };\n\n  // --- Gestor (ID → Nome) ---\n  if (j.Gestor) {\n    const id = (j.Gestor && j.Gestor.id) ? j.Gestor.id : j.Gestor;\n    j.Gestor = (idToName[id] || id || '').trim();\n  }\n\n  // --- Analistas: Analista1, Analista2 e Analista3 (arrays) ---\n  const analista1 = idsToNames(j.Analista1 || j['Analista 1']);\n  const analista2 = idsToNames(j.Analista2 || j['Analista 2']);\n  const analista3 = idsToNames(j.Analista3 || j['Analista 3']);\n\n  if ('Analista1' in j || 'Analista 1' in j) j.Analista1 = analista1;\n  if ('Analista2' in j || 'Analista 2' in j) j.Analista2 = analista2;\n  if ('Analista3' in j || 'Analista 3' in j) j.Analista3 = analista3;\n\n  const analistasPreExistentes = idsToNames(j.Analistas);\n  j.Analistas = uniq([\n    ...analistasPreExistentes,\n    ...analista1,\n    ...analista2,\n    ...analista3,\n  ]);\n\n  // --- Sponsors: Sponsor1, Sponsor2, Sponsor/Sponsors → Sponsor (array nomes) ---\n  const sponsor1   = idsToNames(j.Sponsor1   || j['Sponsor 1']);\n  const sponsor2   = idsToNames(j.Sponsor2   || j['Sponsor 2']);\n  const sponsorsEx = idsToNames(j.Sponsor    || j.Sponsors);\n\n  j.Sponsor = uniq([\n    ...sponsorsEx,\n    ...sponsor1,\n    ...sponsor2,\n  ]);\n\n  // limpa \"Sponsors\" se existir, pois normalizamos em Sponsor\n  if ('Sponsors' in j) delete j.Sponsors;\n\n  // --- Estagiário (variações) → nomes ---\n  const estagiarios = idsToNames(\n    j['Estagiário'] ||\n    j.Estagiario   ||\n    j.Estagiarios  ||\n    j.estagiarios  ||\n    j['Estagiário(a)']\n  );\n  j['Estagiário'] = estagiarios;\n\n  // Observação: \"Última Edição\" e todos os demais campos ficam como estão\n  return { json: j };\n});\n\nreturn saida;\n"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              688,
              -144
            ],
            "id": "b3d35552-d99b-47d8-a538-35e6959dd180",
            "name": "Merge"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "field": "weeks",
                    "triggerAtHour": 4
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.2,
            "position": [
              -128,
              -144
            ],
            "id": "a8cd7c8f-c1dd-47f1-b8f2-71a37d622980",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "toRecipients": "={{ $json.email }}",
              "subject": "Atualização dos teus projetos",
              "bodyContent": "=<link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n<div style=\"font-family:'Montserrat',Arial,sans-serif; font-size:10pt; line-height:1.4;\">\n  <p>Olá {{$json.nome}},</p>\n\n  <p>Seguem os updates semanais dos projetos em que tu participas:</p>\n\n  <table border=\"1\" cellpadding=\"6\" cellspacing=\"0\" style=\"border-collapse:collapse; width:100%;\">\n    <tr style=\"background:#f2f2f2; font-weight:bold;\">\n      <th style=\"width:30%;\">Projeto (updated at, nível e papel)</th>\n      <th style=\"width:35%;\">Atualização</th>\n      <th style=\"width:35%;\">Tarefas da Semana</th>\n    </tr>\n\n    {{\n      $json.projetos.map(p => {\n        const corNivel = { 'Alto':'#d9534f', 'Médio':'#b8860b', 'Baixo':'#4caf50' }[p.nivel] || '#888';\n        const corPapel = { 'Sponsor':'#6f42c1', 'Gestor':'#0aa2a1', 'Analista':'#495057', 'Estagiário':'#adb5bd' }[p.papelPrincipal] || '#999';\n\n        const badge = (texto, bg) => `\n          <span style=\"\n            display:inline-block;\n            margin-left:6px;\n            padding:2px 6px;\n            border-radius:4px;\n            background:${bg};\n            color:#fff;\n            font-size:9pt;\n            font-weight:400;\">\n            ${texto}\n          </span>`;\n\n        return `\n          <tr>\n            <td style=\"vertical-align:top;\">\n              <strong>${p.projeto}</strong><br>\n              <span style=\"font-size:9pt;color:#666;\">(${p.ultima || '–'})</span>\n              ${badge(p.nivel, corNivel)}\n              ${p.papelPrincipal ? badge(p.papelPrincipal, corPapel) : ''}\n            </td>\n\n            <td style=\"vertical-align:top;\">\n              ${\n                p.atualizacao.length\n                  ? '<ul style=\"margin:0; padding-left:18px;\">' +\n                      p.atualizacao.map(a =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(a.level*4)}${a.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n\n            <td style=\"vertical-align:top;\">\n              ${\n                p.tarefasSemana.length\n                  ? '<ul style=\"margin:0; padding-left:18px;\">' +\n                      p.tarefasSemana.map(t =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(t.level*4)}${t.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n          </tr>`;\n      }).join('')\n    }}\n  </table>\n</div>\n",
              "additionalFields": {
                "bodyContentType": "html"
              }
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              1168,
              -368
            ],
            "id": "d124d2e5-4511-48d0-8409-55096f9c9da3",
            "name": "Send a message",
            "webhookId": "d8cbb149-9dbe-49c1-b104-706c70e22401",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "fB8siXDRjQ8ykMBp",
                "name": "Outlook Pier"
              }
            }
          },
          {
            "parameters": {
              "toRecipients": "={{ $json.email }}",
              "subject": "Atualização dos demais projetos",
              "bodyContent": "=<link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n<div style=\"font-family:'Montserrat',Arial,sans-serif;font-size:10pt;line-height:1.4;\">\n  <p>Olá {{$json.nome}},</p>\n\n  <p>Listamos abaixo os projetos em que tu não participas, agrupados por Gestor:</p>\n\n  {{\n    // agrupa por gestor\n    (() => {\n      const groups = {};\n      $json.projetos.forEach(p => {\n        if (!groups[p.gestor]) groups[p.gestor] = [];\n        groups[p.gestor].push(p);\n      });\n\n      return Object.entries(groups).map(([gestor, arr]) => {\n        const rows = arr.map(p => `\n          <tr>\n            <td style=\"vertical-align:top;\">\n              <strong>${p.projeto}</strong><br>\n              <span style=\"font-size:9pt;color:#666;\">(${p.ultima})</span>\n            </td>\n            <td style=\"vertical-align:top;\">\n              ${\n                p.atualizacao.length\n                  ? '<ul style=\"margin:0;padding-left:18px;\">' +\n                      p.atualizacao.map(a =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(a.level*4)}${a.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n            <td style=\"vertical-align:top;\">\n              ${\n                p.tarefasSemana.length\n                  ? '<ul style=\"margin:0;padding-left:18px;\">' +\n                      p.tarefasSemana.map(t =>\n                        `<li style=\"margin:0 0 4px 0;\">\n                           ${'&nbsp;'.repeat(t.level*4)}${t.text}\n                         </li>`).join('') +\n                    '</ul>'\n                  : '-'\n              }\n            </td>\n          </tr>\n        `).join('');\n\n        return `\n          <h4 style=\"margin:16px 0 4px 0;font-weight:700;\">Gestor: ${gestor}</h4>\n          <table border=\"1\" cellpadding=\"6\" cellspacing=\"0\" style=\"border-collapse:collapse;width:100%;margin-bottom:12px;\">\n            <tr style=\"background:#f2f2f2;font-weight:bold;\">\n              <th style=\"width:30%;\">Projeto (updated at)</th>\n              <th style=\"width:35%;\">Atualização</th>\n              <th style=\"width:35%;\">Tarefas / Ações</th>\n            </tr>\n            ${rows}\n          </table>\n        `;\n      }).join('');\n    })()\n  }}\n</div>\n",
              "additionalFields": {
                "bodyContentType": "html"
              }
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              1168,
              -160
            ],
            "id": "ec844cfa-4cd2-415e-a494-0804e3b4bd26",
            "name": "Send a message1",
            "webhookId": "d8cbb149-9dbe-49c1-b104-706c70e22401",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "fB8siXDRjQ8ykMBp",
                "name": "Outlook Pier"
              }
            }
          },
          {
            "parameters": {
              "toRecipients": "={{ $json.email }}",
              "subject": "Pauta para Alinhamento Semanal",
              "bodyContent": "=<link href=\"https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap\" rel=\"stylesheet\">\n\n<div style=\"font-family:'Montserrat',Arial,sans-serif; font-size:10pt; line-height:1.4;\">\n  <p>Olá {{$json.nome}},</p>\n  <p>Segue a pauta para próxima reunião de alinhamento semanal:</p>\n\n  {{\n    (() => {\n      /* ▸ converte [{level,text}] em listas aninhadas */\n      const buildList = a => {\n        if (!a || !a.length) return '-';\n        let html='', open=false;\n        a.forEach(it=>{\n          if (it.level===0){\n            if (open){html+='</ul>';open=false;}\n            html+=`<li>${it.text}</li>`;\n          } else {\n            if (!open){html+='<ul style=\"margin:2px 0 0 18px;\">';open=true;}\n            html+=`<li>${it.text}</li>`;\n          }\n        });\n        if (open) html+='</ul>';\n        return `<ul style=\"margin:0; padding-left:18px;\">${html}</ul>`;\n      };\n\n      const color = n => ({Alto:'#d9534f',Médio:'#b8860b',Baixo:'#4caf50'})[n] || '#888';\n\n      return $json.projetos.map((p,i)=>`\n        <h4 style=\"margin:8px 0 4px 0;font-weight:700;\">\n          ${i+1}. ${p.projeto}\n          <em style=\"font-weight:400;font-style:italic;\">(${p.gestor})</em>\n          <span style=\"display:inline-block;margin-left:6px;padding:2px 6px;border-radius:4px;background:${color(p.nivel)};color:#fff;font-size:9pt;\">\n            ${p.nivel}\n          </span>\n        </h4>\n        ${buildList(p.pauta)}\n      `).join('');\n    })()\n  }}\n</div>\n",
              "additionalFields": {
                "bodyContentType": "html"
              }
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              1168,
              48
            ],
            "id": "91e8c3b4-62e9-40b1-8b87-a469fb558835",
            "name": "Send a message2",
            "webhookId": "d8cbb149-9dbe-49c1-b104-706c70e22401",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "fB8siXDRjQ8ykMBp",
                "name": "Outlook Pier"
              }
            }
          }
        ],
        "connections": {
          "Projetos": {
            "main": [
              [
                {
                  "node": "FiltroProjetos",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Pessoas": {
            "main": [
              [
                {
                  "node": "FiltroPessoas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "FiltroPessoas": {
            "main": [
              [
                {
                  "node": "Projetos",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "FiltroProjetos": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Output1": {
            "main": [
              [
                {
                  "node": "Send a message",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Output2": {
            "main": [
              [
                {
                  "node": "Send a message1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Output3": {
            "main": [
              [
                {
                  "node": "Send a message2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "Output1",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Output3",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Output2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "Pessoas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "system migration",
        "name": null,
        "description": null,
        "autosaved": false,
        "workflowPublishHistory": [
          {
            "createdAt": "2025-11-03T18:21:52.112Z",
            "id": 27,
            "workflowId": "6dVGwJNkYFOGlLGD",
            "versionId": "afc620b4-6648-4e5e-803f-dea860e4b58b",
            "event": "activated",
            "userId": null
          }
        ]
      }
    },
    {
      "updatedAt": "2026-02-14T22:01:39.320Z",
      "createdAt": "2025-11-03T18:49:50.947Z",
      "id": "lgZV72cGrL5CzAdm",
      "name": "mcp chat pier",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "path": "9ce7cc41-d07d-45a5-a948-33b914de8ee2"
          },
          "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
          "typeVersion": 2,
          "position": [
            0,
            0
          ],
          "id": "4ea4956a-f8da-4146-9c3e-aa955a192803",
          "name": "MCP Server Trigger",
          "webhookId": "9ce7cc41-d07d-45a5-a948-33b914de8ee2"
        },
        {
          "parameters": {
            "toolDescription": "Retorna dados de slides a partir de um termo de busca. # Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes no campo metadata.",
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/92f32531-bd06-4629-9be4-4b64a12a06d9",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "query",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {},
            "optimizeResponse": true
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            -96,
            224
          ],
          "id": "a0020d8a-e2e7-4866-b272-57c5fba5be1f",
          "name": "Slides"
        },
        {
          "parameters": {
            "toolDescription": "Auxiliar IA com acesso à base de dados interna, ele consegue encontrar e retornar os valores de indicadores de mercado, dados financeiros de empresas abertas, bolsas brasileiras e americanas.\nAlém disso ele tem acesso a indicadores econõmicos e pode te ajudar com análises e precisões para uma resposta completa a requisição do usuário.\nAo utilizar essa tool, tente descrever bem a tarefa que o agente deve realizar. Por exemplo, se o usuário questionar pelo historico do cdi mensal nos últimos 12 mêses, todas essas informações devem ser enviadas para o agente.",
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/1a015d6f-d7e3-49ab-b3ee-2e8107ff149a",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "chatInput",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            64,
            224
          ],
          "id": "7a9c709f-5b66-4dfa-8c47-90016188c801",
          "name": "Agente DataLake"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            416,
            336
          ],
          "id": "1a4bcdd3-c841-49d4-a007-fe7d527af6c1",
          "name": "Embeddings OpenAI1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "mode": "retrieve-as-tool",
            "toolName": "knowledge_database",
            "toolDescription": "Base de conhecimento da empresa. Deve ser consultada sempre que o usuário perguntar como se faz alguma coisa ou requisitar algum tipo de conhecimento",
            "tableName": {
              "__rl": true,
              "value": "rpc/match_documents_wiki",
              "mode": "list",
              "cachedResultName": "rpc/match_documents_wiki"
            },
            "options": {
              "queryName": "match_documents_wiki"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
          "typeVersion": 1,
          "position": [
            320,
            192
          ],
          "id": "d51c9764-ea28-4d94-a12d-a0425e00d831",
          "name": "Base de conhecimento",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Lista projetos ativos do Notion. Retorna informações básicas como o id do projeto e o nome",
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "c2af396cc2a347eca452b2b2bf6b9031",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Status|select",
                  "condition": "equals",
                  "selectValue": "Ativo"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notionTool",
          "typeVersion": 2.2,
          "position": [
            192,
            304
          ],
          "id": "1d411b5d-b77e-4f49-90f1-1b1cb083961a",
          "name": "Listar projetos",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Retorna a memória de um projeto com base no seu id do Notion. Usar para pegar o status mais recente do projeto ou listar o que sabemos sobre ele",
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "operation": "get",
            "tableId": "memorias_projetos",
            "filters": {
              "conditions": [
                {
                  "keyName": "projeto_id",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', `id do projeto no notion`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            -272,
            240
          ],
          "id": "19f86a89-04a3-4bc0-a4a7-84fc8235d1d6",
          "name": "Memória do projeto",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "description": "Ferramenta para busca de documentos na base de conhecimento da empresa",
            "workflowId": {
              "__rl": true,
              "value": "0UCrEB1iVflqCJG3",
              "mode": "list",
              "cachedResultUrl": "/workflow/0UCrEB1iVflqCJG3",
              "cachedResultName": "subflow qdrant"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `termo para busca de documentos na base de conhecimento da empresa`, 'string') }}"
              },
              "matchingColumns": [
                "query"
              ],
              "schema": [
                {
                  "id": "query",
                  "displayName": "query",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "typeVersion": 2.2,
          "position": [
            -32,
            880
          ],
          "id": "6b5b7920-e788-4e1b-8be3-a4783b7e2ffe",
          "name": "Busca de documentos"
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Busca de projeto. Retorna nome, id e outras informações interessantes",
            "operation": "getAll",
            "tableId": "projetos",
            "returnAll": true,
            "filters": {
              "conditions": [
                {
                  "keyName": "projeto",
                  "condition": "ilike",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `Termo de busca pelo projeto usando cláusula ILIKE. Usar * no lugar de %`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            80,
            896
          ],
          "id": "3945e879-2d78-4997-8c89-d00a02b19667",
          "name": "Busca projeto",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Retorna a memória de um projeto com base no seu id do Notion. Usar para pegar o status mais recente do projeto ou listar o que sabemos sobre ele",
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "operation": "getAll",
            "tableId": "memorias_projetos",
            "returnAll": true,
            "filters": {
              "conditions": [
                {
                  "keyName": "projeto_id",
                  "condition": "eq",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `id do projeto no notion`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            208,
            1088
          ],
          "id": "ba80041f-4340-434d-a24b-e54344eedc25",
          "name": "Memoria do Projeto",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "path": "be29ec61-6a66-46cb-ba7a-fd5376bcf1a7"
          },
          "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
          "typeVersion": 2,
          "position": [
            112,
            704
          ],
          "id": "5824b42e-da10-4350-bfec-2f68e92c0419",
          "name": "MCP Server Trigger1",
          "webhookId": "be29ec61-6a66-46cb-ba7a-fd5376bcf1a7"
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Criar novo evento de atualização ou contexto sobre o projeto. A criação desse evento dispara a atualização da memória/contexto do projeto (executado automaticamente nos segundos após a criação deste evento).",
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "tableId": "memorias_projetos_eventos",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "projeto_id",
                  "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', `id do projeto no Notion`, 'string') }}"
                },
                {
                  "fieldId": "texto",
                  "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', `Texto do evento`, 'string') }}"
                },
                {
                  "fieldId": "origem",
                  "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', `Indica a origem ou tipo do evento. Pode ser uma atualização geral do projeto, uma ata nova no notion, informação adicional sobre a empresa, qualquer coisa.`, 'string') }}"
                },
                {
                  "fieldId": "criador",
                  "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', `Pessoa que cricou o evento`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            224,
            960
          ],
          "id": "8cf2fb27-e888-46e5-9eda-962c61189ae0",
          "name": "Criar novo evento",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Retorna detalhes do projeto: sponsor, gestor, analistas, entregaveis e cronograma",
            "useCustomSchema": true,
            "schema": "notion",
            "operation": "getAll",
            "tableId": "projetos_detalhes",
            "returnAll": true,
            "filters": {
              "conditions": [
                {
                  "keyName": "projeto_id",
                  "condition": "eq",
                  "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `id do projeto`, 'string') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabaseTool",
          "typeVersion": 1,
          "position": [
            80,
            1056
          ],
          "id": "27a94bdf-7888-435d-8eca-f6fe5eb1cdb0",
          "name": "Busca detalhes do projeto",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.4,
          "position": [
            912,
            800
          ],
          "id": "3f854ba5-c00f-453d-99b3-089ecf1ad1c0",
          "name": "When chat message received",
          "webhookId": "007cd536-d6d4-4a13-afc3-9b63f94a3ad6"
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3.1,
          "position": [
            1120,
            800
          ],
          "id": "6d8fce72-2621-449a-9a07-94b1fbd09e82",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2-chat-latest",
              "mode": "list",
              "cachedResultName": "gpt-5.2-chat-latest"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            992,
            1008
          ],
          "id": "c7106380-1608-411c-a65d-1c9e222c6bd7",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "endpointUrl": "https://primary-production-0ad4f.up.railway.app/mcp/be29ec61-6a66-46cb-ba7a-fd5376bcf1a7",
            "include": "selected",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
          "typeVersion": 1.2,
          "position": [
            1360,
            976
          ],
          "id": "523101c4-984e-423d-816c-bb358dfa03c4",
          "name": "MCP Client"
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $('When chat message received').first().json.sessionId }}\n",
            "contextWindowLength": 10
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            1184,
            1072
          ],
          "id": "f4647a2f-30b4-4ca8-8fb2-e66ea21168f1",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "toolDescription": "Busca eventos e atualizações de um projeto semanticamente",
            "method": "POST",
            "url": "https://aeiyqqesteicozizkycn.supabase.co/functions/v1/search-eventos-projeto",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "supabaseApi",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "projeto_id",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `id do projeto`, 'string') }}"
                },
                {
                  "name": "query",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', `Busca semântica e por palavras-chave nos eventos do projeto. Descreva o que quer encontrar usando termos específicos (nomes de pessoas, empresas, valores) misturados com descrição do tema. Ex: 'decisões sobre prazo de entrega do valuation', 'reunião com Arthur sobre DW e BIs', 'mudanças no escopo de frete Xangri-Lá'`, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.4,
          "position": [
            432,
            912
          ],
          "id": "8dac9913-6396-45ba-b4fa-f5a3856412a1",
          "name": "Busca atualizações por tema",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Busca os últimos eventos/atualizações do projeto. Ajuda a entender o que aconteceu por último",
            "method": "POST",
            "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/rpc/get_ultimos_eventos",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "supabaseApi",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "p_projeto_id",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `id do projeto`, 'string') }}"
                },
                {
                  "name": "p_limit",
                  "value": "5"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.4,
          "position": [
            352,
            1056
          ],
          "id": "f318663b-c593-4f07-a1a9-5a482ceb353e",
          "name": "Últimas 5 atualizações do projeto",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        }
      ],
      "connections": {
        "Slides": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Agente DataLake": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI1": {
          "ai_embedding": [
            [
              {
                "node": "Base de conhecimento",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Base de conhecimento": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Listar projetos": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Memória do projeto": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Busca de documentos": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Busca projeto": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Memoria do Projeto": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Criar novo evento": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Busca detalhes do projeto": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "MCP Client": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Busca atualizações por tema": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Últimas 5 atualizações do projeto": {
          "ai_tool": [
            [
              {
                "node": "MCP Server Trigger1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "88950458-6a21-420d-b184-3ac19915f1e9",
      "activeVersionId": "88950458-6a21-420d-b184-3ac19915f1e9",
      "versionCounter": 303,
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2025-11-03T18:49:50.947Z",
          "createdAt": "2025-11-03T18:49:50.947Z",
          "role": "workflow:owner",
          "workflowId": "lgZV72cGrL5CzAdm",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [],
      "activeVersion": {
        "updatedAt": "2026-02-14T22:01:45.293Z",
        "createdAt": "2026-02-14T22:01:39.336Z",
        "versionId": "88950458-6a21-420d-b184-3ac19915f1e9",
        "workflowId": "lgZV72cGrL5CzAdm",
        "nodes": [
          {
            "parameters": {
              "path": "9ce7cc41-d07d-45a5-a948-33b914de8ee2"
            },
            "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
            "typeVersion": 2,
            "position": [
              0,
              0
            ],
            "id": "4ea4956a-f8da-4146-9c3e-aa955a192803",
            "name": "MCP Server Trigger",
            "webhookId": "9ce7cc41-d07d-45a5-a948-33b914de8ee2"
          },
          {
            "parameters": {
              "toolDescription": "Retorna dados de slides a partir de um termo de busca. # Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes no campo metadata.",
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/92f32531-bd06-4629-9be4-4b64a12a06d9",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "query",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {},
              "optimizeResponse": true
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.2,
            "position": [
              -96,
              224
            ],
            "id": "a0020d8a-e2e7-4866-b272-57c5fba5be1f",
            "name": "Slides"
          },
          {
            "parameters": {
              "toolDescription": "Auxiliar IA com acesso à base de dados interna, ele consegue encontrar e retornar os valores de indicadores de mercado, dados financeiros de empresas abertas, bolsas brasileiras e americanas.\nAlém disso ele tem acesso a indicadores econõmicos e pode te ajudar com análises e precisões para uma resposta completa a requisição do usuário.\nAo utilizar essa tool, tente descrever bem a tarefa que o agente deve realizar. Por exemplo, se o usuário questionar pelo historico do cdi mensal nos últimos 12 mêses, todas essas informações devem ser enviadas para o agente.",
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/1a015d6f-d7e3-49ab-b3ee-2e8107ff149a",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "chatInput",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.2,
            "position": [
              64,
              224
            ],
            "id": "7a9c709f-5b66-4dfa-8c47-90016188c801",
            "name": "Agente DataLake"
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              416,
              336
            ],
            "id": "1a4bcdd3-c841-49d4-a007-fe7d527af6c1",
            "name": "Embeddings OpenAI1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "mode": "retrieve-as-tool",
              "toolName": "knowledge_database",
              "toolDescription": "Base de conhecimento da empresa. Deve ser consultada sempre que o usuário perguntar como se faz alguma coisa ou requisitar algum tipo de conhecimento",
              "tableName": {
                "__rl": true,
                "value": "rpc/match_documents_wiki",
                "mode": "list",
                "cachedResultName": "rpc/match_documents_wiki"
              },
              "options": {
                "queryName": "match_documents_wiki"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreSupabase",
            "typeVersion": 1,
            "position": [
              320,
              192
            ],
            "id": "d51c9764-ea28-4d94-a12d-a0425e00d831",
            "name": "Base de conhecimento",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Lista projetos ativos do Notion. Retorna informações básicas como o id do projeto e o nome",
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "c2af396cc2a347eca452b2b2bf6b9031",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Status|select",
                    "condition": "equals",
                    "selectValue": "Ativo"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notionTool",
            "typeVersion": 2.2,
            "position": [
              192,
              304
            ],
            "id": "1d411b5d-b77e-4f49-90f1-1b1cb083961a",
            "name": "Listar projetos",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Retorna a memória de um projeto com base no seu id do Notion. Usar para pegar o status mais recente do projeto ou listar o que sabemos sobre ele",
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "operation": "get",
              "tableId": "memorias_projetos",
              "filters": {
                "conditions": [
                  {
                    "keyName": "projeto_id",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Value', `id do projeto no notion`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              -272,
              240
            ],
            "id": "19f86a89-04a3-4bc0-a4a7-84fc8235d1d6",
            "name": "Memória do projeto",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "description": "Ferramenta para busca de documentos na base de conhecimento da empresa",
              "workflowId": {
                "__rl": true,
                "value": "0UCrEB1iVflqCJG3",
                "mode": "list",
                "cachedResultUrl": "/workflow/0UCrEB1iVflqCJG3",
                "cachedResultName": "subflow qdrant"
              },
              "workflowInputs": {
                "mappingMode": "defineBelow",
                "value": {
                  "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `termo para busca de documentos na base de conhecimento da empresa`, 'string') }}"
                },
                "matchingColumns": [
                  "query"
                ],
                "schema": [
                  {
                    "id": "query",
                    "displayName": "query",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "canBeUsedToMatch": true,
                    "type": "string",
                    "removed": false
                  }
                ],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
            "typeVersion": 2.2,
            "position": [
              -32,
              880
            ],
            "id": "6b5b7920-e788-4e1b-8be3-a4783b7e2ffe",
            "name": "Busca de documentos"
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Busca de projeto. Retorna nome, id e outras informações interessantes",
              "operation": "getAll",
              "tableId": "projetos",
              "returnAll": true,
              "filters": {
                "conditions": [
                  {
                    "keyName": "projeto",
                    "condition": "ilike",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `Termo de busca pelo projeto usando cláusula ILIKE. Usar * no lugar de %`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              80,
              896
            ],
            "id": "3945e879-2d78-4997-8c89-d00a02b19667",
            "name": "Busca projeto",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Retorna a memória de um projeto com base no seu id do Notion. Usar para pegar o status mais recente do projeto ou listar o que sabemos sobre ele",
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "operation": "getAll",
              "tableId": "memorias_projetos",
              "returnAll": true,
              "filters": {
                "conditions": [
                  {
                    "keyName": "projeto_id",
                    "condition": "eq",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `id do projeto no notion`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              208,
              1088
            ],
            "id": "ba80041f-4340-434d-a24b-e54344eedc25",
            "name": "Memoria do Projeto",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "path": "be29ec61-6a66-46cb-ba7a-fd5376bcf1a7"
            },
            "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
            "typeVersion": 2,
            "position": [
              112,
              704
            ],
            "id": "5824b42e-da10-4350-bfec-2f68e92c0419",
            "name": "MCP Server Trigger1",
            "webhookId": "be29ec61-6a66-46cb-ba7a-fd5376bcf1a7"
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Criar novo evento de atualização ou contexto sobre o projeto. A criação desse evento dispara a atualização da memória/contexto do projeto (executado automaticamente nos segundos após a criação deste evento).",
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "tableId": "memorias_projetos_eventos",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "projeto_id",
                    "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues0_Field_Value', `id do projeto no Notion`, 'string') }}"
                  },
                  {
                    "fieldId": "texto",
                    "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues1_Field_Value', `Texto do evento`, 'string') }}"
                  },
                  {
                    "fieldId": "origem",
                    "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues2_Field_Value', `Indica a origem ou tipo do evento. Pode ser uma atualização geral do projeto, uma ata nova no notion, informação adicional sobre a empresa, qualquer coisa.`, 'string') }}"
                  },
                  {
                    "fieldId": "criador",
                    "fieldValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('fieldValues3_Field_Value', `Pessoa que cricou o evento`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              224,
              960
            ],
            "id": "8cf2fb27-e888-46e5-9eda-962c61189ae0",
            "name": "Criar novo evento",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Retorna detalhes do projeto: sponsor, gestor, analistas, entregaveis e cronograma",
              "useCustomSchema": true,
              "schema": "notion",
              "operation": "getAll",
              "tableId": "projetos_detalhes",
              "returnAll": true,
              "filters": {
                "conditions": [
                  {
                    "keyName": "projeto_id",
                    "condition": "eq",
                    "keyValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('conditions0_Field_Value', `id do projeto`, 'string') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabaseTool",
            "typeVersion": 1,
            "position": [
              80,
              1056
            ],
            "id": "27a94bdf-7888-435d-8eca-f6fe5eb1cdb0",
            "name": "Busca detalhes do projeto",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.4,
            "position": [
              912,
              800
            ],
            "id": "3f854ba5-c00f-453d-99b3-089ecf1ad1c0",
            "name": "When chat message received",
            "webhookId": "007cd536-d6d4-4a13-afc3-9b63f94a3ad6"
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3.1,
            "position": [
              1120,
              800
            ],
            "id": "6d8fce72-2621-449a-9a07-94b1fbd09e82",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.2-chat-latest",
                "mode": "list",
                "cachedResultName": "gpt-5.2-chat-latest"
              },
              "builtInTools": {},
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
              992,
              1008
            ],
            "id": "c7106380-1608-411c-a65d-1c9e222c6bd7",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "endpointUrl": "https://primary-production-0ad4f.up.railway.app/mcp/be29ec61-6a66-46cb-ba7a-fd5376bcf1a7",
              "include": "selected",
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
            "typeVersion": 1.2,
            "position": [
              1360,
              976
            ],
            "id": "523101c4-984e-423d-816c-bb358dfa03c4",
            "name": "MCP Client"
          },
          {
            "parameters": {
              "sessionIdType": "customKey",
              "sessionKey": "={{ $('When chat message received').first().json.sessionId }}\n",
              "contextWindowLength": 10
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              1184,
              1072
            ],
            "id": "f4647a2f-30b4-4ca8-8fb2-e66ea21168f1",
            "name": "Simple Memory"
          },
          {
            "parameters": {
              "toolDescription": "Busca eventos e atualizações de um projeto semanticamente",
              "method": "POST",
              "url": "https://aeiyqqesteicozizkycn.supabase.co/functions/v1/search-eventos-projeto",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "supabaseApi",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "projeto_id",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `id do projeto`, 'string') }}"
                  },
                  {
                    "name": "query",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', `Busca semântica e por palavras-chave nos eventos do projeto. Descreva o que quer encontrar usando termos específicos (nomes de pessoas, empresas, valores) misturados com descrição do tema. Ex: 'decisões sobre prazo de entrega do valuation', 'reunião com Arthur sobre DW e BIs', 'mudanças no escopo de frete Xangri-Lá'`, 'string') }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.4,
            "position": [
              432,
              912
            ],
            "id": "8dac9913-6396-45ba-b4fa-f5a3856412a1",
            "name": "Busca atualizações por tema",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "toolDescription": "Busca os últimos eventos/atualizações do projeto. Ajuda a entender o que aconteceu por último",
              "method": "POST",
              "url": "https://aeiyqqesteicozizkycn.supabase.co/rest/v1/rpc/get_ultimos_eventos",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "supabaseApi",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "p_projeto_id",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `id do projeto`, 'string') }}"
                  },
                  {
                    "name": "p_limit",
                    "value": "5"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.4,
            "position": [
              352,
              1056
            ],
            "id": "f318663b-c593-4f07-a1a9-5a482ceb353e",
            "name": "Últimas 5 atualizações do projeto",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          }
        ],
        "connections": {
          "Slides": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Agente DataLake": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI1": {
            "ai_embedding": [
              [
                {
                  "node": "Base de conhecimento",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Base de conhecimento": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Listar projetos": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Memória do projeto": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Busca de documentos": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Busca projeto": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Memoria do Projeto": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Criar novo evento": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Busca detalhes do projeto": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "When chat message received": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "MCP Client": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Busca atualizações por tema": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Últimas 5 atualizações do projeto": {
            "ai_tool": [
              [
                {
                  "node": "MCP Server Trigger1",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 88950458",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-02-14T22:01:45.287Z",
            "id": 367,
            "workflowId": "lgZV72cGrL5CzAdm",
            "versionId": "88950458-6a21-420d-b184-3ac19915f1e9",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-02-13T01:59:24.968Z",
      "createdAt": "2025-12-28T16:41:54.247Z",
      "id": "gKNGnV5aOelesPEn",
      "name": "PPT Chat Agent Workflow",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.4,
          "position": [
            816,
            2576
          ],
          "id": "0092ce53-b257-43a8-bfc6-e31997605fbe",
          "name": "When chat message received",
          "webhookId": "5ba440e1-5711-4fca-9ac5-08601c504ec0"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "2c902cfe4c0e8047b2c6daa6791da9e2",
              "mode": "id"
            },
            "limit": 5,
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            576,
            416
          ],
          "id": "67cc9d98-e942-49c1-8afd-fd24f91d0d17",
          "name": "Get many database pages",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "block",
            "operation": "getAll",
            "blockId": {
              "__rl": true,
              "value": "={{ $json.url }}",
              "mode": "url"
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1056,
            144
          ],
          "id": "70ec9b98-0699-4520-a8cd-573dfe25da19",
          "name": "Get many child blocks",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "let output = [];\n\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nreturn [\n  {\n    json: {\n      content: output.join('\\n\\n')\n    }\n  }\n];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1296,
            144
          ],
          "id": "94ea182e-6a8f-401d-93ee-fd7955e844ff",
          "name": "Code in JavaScript",
          "executeOnce": false
        },
        {
          "parameters": {
            "mode": "insert",
            "qdrantCollection": {
              "__rl": true,
              "value": "pier_knowledge",
              "mode": "list",
              "cachedResultName": "pier_knowledge"
            },
            "options": {
              "contentPayloadKey": "content"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
          "typeVersion": 1.3,
          "position": [
            1872,
            320
          ],
          "id": "63a9c5ca-4fa3-40ef-9c67-8bd8faf93be2",
          "name": "Qdrant Vector Store1",
          "credentials": {
            "qdrantApi": {
              "id": "BZ0gPnzsubvT5Zw1",
              "name": "QdrantApi account 2"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            800,
            320
          ],
          "id": "e8eb1c59-963c-4a47-bd73-e9f80d257f8e",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "model": "text-embedding-3-large",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
          "typeVersion": 1.2,
          "position": [
            1792,
            560
          ],
          "id": "a40f18cb-4960-48f6-a326-b76c26d000fe",
          "name": "Embeddings OpenAI",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "textSplittingMode": "custom",
            "options": {
              "metadata": {
                "metadataValues": [
                  {
                    "name": "document_id",
                    "value": "={{ $json.id }}"
                  },
                  {
                    "name": "name",
                    "value": "={{ $json.name }}"
                  },
                  {
                    "name": "url",
                    "value": "={{ $json.url }}"
                  },
                  {
                    "name": "subject",
                    "value": "={{ $json.property_tema_natureza }}"
                  }
                ]
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
          "typeVersion": 1.1,
          "position": [
            2160,
            480
          ],
          "id": "0705d8f9-1f33-4f11-8d02-9221b1e537d6",
          "name": "Default Data Loader"
        },
        {
          "parameters": {
            "chunkSize": 1000000
          },
          "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
          "typeVersion": 1,
          "position": [
            2272,
            576
          ],
          "id": "78c03e7b-dd3d-4d3c-a535-d158603b27df",
          "name": "Token Splitter"
        },
        {
          "parameters": {
            "resource": "point",
            "operation": "deletePoints",
            "collectionName": {
              "__rl": true,
              "value": "pier",
              "mode": "list",
              "cachedResultName": "pier"
            },
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            1792,
            2240
          ],
          "id": "770cb2a5-cdb8-40ef-9abd-b15121fbe2a1",
          "name": "Delete Points",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "resource": "point",
            "operation": "scrollPoints",
            "collectionName": {
              "__rl": true,
              "value": "pier",
              "mode": "list",
              "cachedResultName": "pier"
            },
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            1152,
            2224
          ],
          "id": "99de0890-f678-4503-ae7b-be58a6b05a9c",
          "name": "Scroll Points",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            1552,
            2176
          ],
          "id": "7bc57dc3-1132-447f-a2cb-973579a205c0",
          "name": "Loop Over Items1"
        },
        {
          "parameters": {
            "fieldToSplitOut": "result.points",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            1360,
            2224
          ],
          "id": "54579fa7-0f1c-4a4c-856c-9b2dc6891bd7",
          "name": "Split Out"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "ec80d8f5-8a5b-4f7a-be3c-93ed3771f99e",
                  "name": "id",
                  "value": "={{ $json.id }}",
                  "type": "string"
                },
                {
                  "id": "5693a142-1555-4384-8df2-12994814d418",
                  "name": "name",
                  "value": "={{ $json.name }}",
                  "type": "string"
                },
                {
                  "id": "24d2b57c-48a9-4fc9-ade2-182617591c93",
                  "name": "url",
                  "value": "={{ $json.url }}",
                  "type": "string"
                },
                {
                  "id": "6e4da1f8-2690-4166-935a-7d7feb5bc522",
                  "name": "property_tema_natureza",
                  "value": "={{ $json.property_tema_natureza }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1056,
            304
          ],
          "id": "51363c7c-0851-4a51-8ef0-ad6a1654f876",
          "name": "Edit Fields"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            1584,
            320
          ],
          "id": "a87f35bd-020d-4582-8173-03dfa44ce431",
          "name": "Merge"
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "Responda apenas com conteudos buscados atraves das ferramentas. As respostas devem sempre ser referenciadas com indicadores como [1] e [2] e ao final das respostas que usam fontes deve ser inserido uma seção se fontes com o nome e url destes documentos usando hyperlinks"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3.1,
          "position": [
            1024,
            2576
          ],
          "id": "107324d8-a24b-418d-a506-d3f62a727197",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2-chat-latest",
              "mode": "list",
              "cachedResultName": "gpt-5.2-chat-latest"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            896,
            2784
          ],
          "id": "0e90b97a-b0c6-4dca-a533-e31bd602ab94",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {},
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            1040,
            2784
          ],
          "id": "0b677de5-5813-4fff-b54b-1045e7b07c86",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "description": "Ferramenta para busca de documentos na base de conhecimento da empresa",
            "workflowId": {
              "__rl": true,
              "value": "0UCrEB1iVflqCJG3",
              "mode": "list",
              "cachedResultUrl": "/workflow/0UCrEB1iVflqCJG3",
              "cachedResultName": "subflow qdrant"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `termo para busca de documentos na base de conhecimento da empresa`, 'string') }}"
              },
              "matchingColumns": [
                "query"
              ],
              "schema": [
                {
                  "id": "query",
                  "displayName": "query",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "typeVersion": 2.2,
          "position": [
            1184,
            2784
          ],
          "id": "89ccb881-f39a-429a-b651-7312f5032442",
          "name": "Call 'subflow qdrant'"
        },
        {
          "parameters": {
            "content": "## Deletar documentos da base",
            "height": 304,
            "width": 1024
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            1024,
            2144
          ],
          "id": "6f2011f2-12d3-478e-a5d4-e9974417079e",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "890fcb54-df00-40de-867b-96aed1c6f337",
            "responseMode": "responseNode",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            1360,
            3392
          ],
          "id": "7c007442-16c4-4a67-b844-0d6722374b03",
          "name": "Webhook",
          "webhookId": "890fcb54-df00-40de-867b-96aed1c6f337"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.body.toJsonString() }}",
            "options": {
              "systemMessage": "# Contexto\nVocê recebe o conteúdo de um slide de power point ou um range de células do Excel e, opcionalmente, uma mensagem da pessoa que o contruiu e conteúdo dos demais slides/abas. Se houver uma mensagem do usuário, faça o que ele pedir, do contrário você deve realizar uma análise crítica:\n\n## Power Point:\n#### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (busque documentos de referência)\n-Fonte homogênea em todas as caixas com texto\n-Erros de português\n-Tamanho da fonte coerente entre os slides\n-Alinhamento de titulo (mesma posição em todos os slides)\n-Uso adequado de slide mestre\n-Slides contém numeração\n-Unidades nos números (coerência interna no slide)\n-Padrão de frases começarem com letra maiúscula OU cada palavra em letra maiúscula\n-Caso o conteúdo dos demais slides seja passado também (i) os utilize para ver se o slide em questão está bem construído e posicionado na apresentação e (ii) indique slides com problemas.\n-Quando uma imagem do slide for enviada junto com a requisição, use-a para avaliar aspectos visuais como layout, alinhamento, uso de cores, hierarquia visual e\n  legibilidade. A imagem é o slide real renderizado.\n## Opcional:\n-O usuário também pode pedir sugestões de slides. Nesse caso busque slides na tool de banco de slides e retorne o link da imagem do slide e o link do sharepoint\n\n## Excel:\n### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (indentifique o conteúdo (técnico e teórico) e busque documentos de referência)\n-Fonte homogênea em todas as células\n-Erros de português\n-Tamanho da fonte coerente\n-Aderência sólida com conceitos contábeis e financeiros\n\n# Diretrizes Gerais\n- Suas respostas devem seguir as diretrizes da Píer Partners, e para isso consulte a base de conhecimento disponível, onde diversos documentos sobre os temas com os quais trabalhamos estão disponíveis.\n- Nossa base de conhecimento possui artigos sobre como lidamos com temas específicos e mais técnicos (padrões de formato para apresentações, modelos em excel, etc). Sempre identifique o tema e tipo de ferramenta que o usuário está usando e busque artigo compatíveis para melhorar seu contexto\n- Se o usuário pedir a revisão nos dados (números de mercado, índices, etc) utilize as ferramenta de busca na web (Google para buscas simples e Perpexity para buscas avançadas).\n- As respostas devem sempre ser referenciadas com indicadores como [1] e [2] e ao final das respostas que usam fontes deve ser inserido uma seção se fontes com o nome e url destes documentos usando hyperlinks.\n- Seja direto, indo direto para a análise, com profundidade mas sendo breve.\n- Sempre retorne sua resposta em formato Markdown.",
              "passthroughBinaryImages": true
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3.1,
          "position": [
            1744,
            3392
          ],
          "id": "6ee2eb1e-a485-4f66-b814-572326392264",
          "name": "AI Agent1"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2-chat-latest",
              "mode": "list",
              "cachedResultName": "gpt-5.2-chat-latest"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            1680,
            3568
          ],
          "id": "450474fb-9a8b-4427-bd44-9c9e2aba7267",
          "name": "OpenAI Chat Model1",
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "respondWith": "text",
            "responseBody": "={{ $json.output }}",
            "options": {}
          },
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.5,
          "position": [
            2096,
            3392
          ],
          "id": "9510693a-fa19-40e7-8c3a-f60c2530b74d",
          "name": "Respond to Webhook"
        },
        {
          "parameters": {
            "description": "Ferramenta para busca de documentos na base de conhecimento da empresa. Possui documentos concenituais e técnicos (padrões de execução em power point, excel, modelos etc)",
            "workflowId": {
              "__rl": true,
              "value": "0UCrEB1iVflqCJG3",
              "mode": "list",
              "cachedResultUrl": "/workflow/0UCrEB1iVflqCJG3",
              "cachedResultName": "subflow qdrant"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `termo para busca de documentos na base de conhecimento da empresa`, 'string') }}"
              },
              "matchingColumns": [
                "query"
              ],
              "schema": [
                {
                  "id": "query",
                  "displayName": "query",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "typeVersion": 2.2,
          "position": [
            1760,
            3680
          ],
          "id": "243eb7f8-1ce1-445e-bcc7-e1417cb64f59",
          "name": "Base de conhecimento"
        },
        {
          "parameters": {
            "toolDescription": "Retorna dados de slides a partir de um termo de busca. # Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes no campo metadata.",
            "method": "POST",
            "url": "https://primary-production-0ad4f.up.railway.app/webhook/92f32531-bd06-4629-9be4-4b64a12a06d9",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "query",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {},
            "optimizeResponse": true
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.2,
          "position": [
            1904,
            3680
          ],
          "id": "0d34283e-fefc-49cd-9195-a6e3aed91df9",
          "name": "Banco de slides"
        },
        {
          "parameters": {
            "toolDescription": "Ferramenta para buscas profundas usando Perplexity.",
            "method": "POST",
            "url": "https://api.perplexity.ai/search",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "query",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `termo a ser buscado`, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.3,
          "position": [
            2032,
            3680
          ],
          "id": "24b3c82c-9d71-4e8d-af38-787caff62e84",
          "name": "Perplexity",
          "credentials": {
            "httpHeaderAuth": {
              "id": "eCJEWUrc23hz9LHt",
              "name": "Perplexity"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Ferramenta de busca básica usando Google.",
            "url": "https://serpapi.com/search",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpQueryAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "engine",
                  "value": "google"
                },
                {
                  "name": "q",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', ``, 'string') }}"
                },
                {
                  "name": "location",
                  "value": "Rio Grande do Sul, Brazil"
                },
                {
                  "name": "google_domain",
                  "value": "google.com.br"
                },
                {
                  "name": "gl",
                  "value": "br"
                },
                {
                  "name": "hl",
                  "value": "pt-br"
                },
                {
                  "name": "device",
                  "value": "desktop"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.3,
          "position": [
            2160,
            3680
          ],
          "id": "668aded9-2f00-40ae-be07-82603b6bee4f",
          "name": "Google",
          "credentials": {
            "httpCustomAuth": {
              "id": "qKnOTJSZTd9nJJET",
              "name": "Omie teste"
            },
            "httpHeaderAuth": {
              "id": "a6xzsEvXe7Ra14j0",
              "name": "Header Auth account 3"
            },
            "httpQueryAuth": {
              "id": "yoOlOAmK1laRLPV3",
              "name": "Google busca"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.manualTrigger",
          "typeVersion": 1,
          "position": [
            -176,
            1424
          ],
          "id": "3b3be0fc-17db-44e5-90b3-7f0ba4e2e2e8",
          "name": "When clicking ‘Execute workflow’"
        },
        {
          "parameters": {
            "resource": "point",
            "operation": "upsertPoints",
            "collectionName": {
              "__rl": true,
              "value": "pier",
              "mode": "list",
              "cachedResultName": "pier"
            },
            "requestOptions": {}
          },
          "id": "9ca80b2f-d349-40ca-8128-a483bf7a85c2",
          "name": "Upsert Points2",
          "type": "n8n-nodes-qdrant.qdrant",
          "position": [
            2512,
            1184
          ],
          "typeVersion": 1,
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "mode": "combine",
            "combineBy": "combineByPosition",
            "options": {}
          },
          "id": "8700aa36-9908-4046-953f-05a0d8723877",
          "name": "Merge3",
          "type": "n8n-nodes-base.merge",
          "position": [
            2192,
            1168
          ],
          "typeVersion": 3.2
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.openai.com/v1/embeddings",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "openAiApi",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "input",
                  "value": "={{ $json.content }}"
                },
                {
                  "name": "model",
                  "value": "text-embedding-3-large"
                }
              ]
            },
            "options": {}
          },
          "id": "1b5d7c68-d97a-40ec-bc12-7072e5deec68",
          "name": "Get OpenAI embeddings1",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            2032,
            992
          ],
          "typeVersion": 4.2,
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "2c902cfe4c0e8047b2c6daa6791da9e2",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            656,
            1168
          ],
          "id": "70002802-e79d-48bc-a803-467ca4ed954c",
          "name": "Get many database pages1",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "block",
            "operation": "getAll",
            "blockId": {
              "__rl": true,
              "value": "={{ $json.url }}",
              "mode": "url"
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1376,
            992
          ],
          "id": "72be92a0-c979-4626-8a8d-508bdabc600f",
          "name": "Get many child blocks1",
          "alwaysOutputData": true,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "let output = [];\n\n// --- PART 1: Process the blocks (Your existing logic) ---\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nconst finalContent = output.join('\\n\\n');\n\n// --- PART 2: Retrieve Metadata safely ---\n// We pull the ID, Name, and URL from the 'Edit Fields2' node \n// that ran immediately before this execution.\nconst metadata = $('Edit Fields2').first().json;\n\n// --- PART 3: Return Combined Data ---\n// We return ONE object containing both the Metadata and the Content.\nreturn [\n  {\n    json: {\n      ...metadata,          // Inherits: id, name, url, property_tema_natureza\n      content: finalContent // Adds: The generated text\n    }\n  }\n];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1552,
            1008
          ],
          "id": "057d3047-80d2-4453-9726-aef60e67cbae",
          "name": "Code in JavaScript1",
          "executeOnce": false
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            848,
            1040
          ],
          "id": "06b15324-9f1f-4049-8882-9f7b4970f7cc",
          "name": "Loop Over Items2"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "ec80d8f5-8a5b-4f7a-be3c-93ed3771f99e",
                  "name": "id",
                  "value": "={{ $('Loop Over Items2').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "5693a142-1555-4384-8df2-12994814d418",
                  "name": "name",
                  "value": "={{ $('Loop Over Items2').item.json.name }}",
                  "type": "string"
                },
                {
                  "id": "24d2b57c-48a9-4fc9-ade2-182617591c93",
                  "name": "url",
                  "value": "={{ $('Loop Over Items2').item.json.url }}",
                  "type": "string"
                },
                {
                  "id": "6e4da1f8-2690-4166-935a-7d7feb5bc522",
                  "name": "property_tema_natureza",
                  "value": "={{ $('Loop Over Items2').item.json.property_tema_natureza }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1168,
            1056
          ],
          "id": "137b47df-b6da-47e4-96ca-ba42e51d1500",
          "name": "Edit Fields2"
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "0a00b2a3-f7c9-4015-986a-48a2df958f39",
                  "leftValue": "={{ $json.content }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "equals",
                    "name": "filter.operator.equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            1776,
            1056
          ],
          "id": "b2388a09-427e-4cf8-9df7-95170b235ab8",
          "name": "If2"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {}
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.3,
          "position": [
            432,
            1168
          ],
          "id": "c0049093-fd62-434b-a02f-c7423b5fd4ce",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "content": "## Fluxo principal de atualização",
            "height": 528,
            "width": 2528
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            256,
            912
          ],
          "id": "e6c4f3da-535c-445f-8daa-8f6c7f335292",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "operation": "createCollection",
            "collectionName": "fdsfdf",
            "shardNumber": {},
            "replicationFactor": {},
            "writeConsistencyFactor": {},
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            2608,
            2432
          ],
          "id": "e5db12af-3b8f-4948-967a-41bf3e6c4ea3",
          "name": "Create Collection",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "resource": "point",
            "operation": "upsertPoints",
            "collectionName": {
              "__rl": true,
              "value": "atas",
              "mode": "list",
              "cachedResultName": "atas"
            },
            "requestOptions": {}
          },
          "id": "00936697-9ec4-4508-8cae-dd7805b4adb4",
          "name": "Upsert Points3",
          "type": "n8n-nodes-qdrant.qdrant",
          "position": [
            2512,
            1792
          ],
          "typeVersion": 1,
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.openai.com/v1/embeddings",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "openAiApi",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "input",
                  "value": "={{ $json.content || \"-\" }}"
                },
                {
                  "name": "model",
                  "value": "text-embedding-3-large"
                }
              ]
            },
            "options": {}
          },
          "id": "610a5fa3-0e15-4b1d-b415-4aab164f0b85",
          "name": "Get OpenAI embeddings2",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            2032,
            1600
          ],
          "typeVersion": 4.2,
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "66a3cfa0e0024323a279d63d19a9c6a9",
              "mode": "id"
            },
            "returnAll": true,
            "filterType": "manual",
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "key": "Projetos|relation",
                  "condition": "is_not_empty"
                },
                {
                  "key": "Created time|created_time",
                  "condition": "on_or_after",
                  "createdTimeValue": "2026-01-01T00:00:00"
                },
                {
                  "key": "Nome|title",
                  "condition": "is_not_empty"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            656,
            1776
          ],
          "id": "a46c2260-a8c3-4778-b9f8-19c98a560e3d",
          "name": "Get many database pages3",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "block",
            "operation": "getAll",
            "blockId": {
              "__rl": true,
              "value": "={{ $json.url }}",
              "mode": "url"
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1376,
            1600
          ],
          "id": "d6986d0f-f0b9-4576-8bce-03cd228e49b2",
          "name": "Get many child blocks3",
          "alwaysOutputData": true,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "let output = [];\n\n// --- PART 1: Process the blocks (Your existing logic) ---\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nconst finalContent = output.join('\\n\\n');\n\n// --- PART 2: Retrieve Metadata safely ---\n// We pull the ID, Name, and URL from the 'Edit Fields2' node \n// that ran immediately before this execution.\nconst metadata = $('Edit Fields4').first().json;\n\n// --- PART 3: Return Combined Data ---\n// We return ONE object containing both the Metadata and the Content.\nreturn [\n  {\n    json: {\n      ...metadata,          // Inherits: id, name, url, property_tema_natureza\n      content: finalContent // Adds: The generated text\n    }\n  }\n];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1584,
            1600
          ],
          "id": "de875ee1-4d6a-4a35-932d-c5819183ee75",
          "name": "Code in JavaScript3",
          "executeOnce": false
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            848,
            1648
          ],
          "id": "7335bce6-637a-469d-b00a-df2f8af33e2c",
          "name": "Loop Over Items4"
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "ec80d8f5-8a5b-4f7a-be3c-93ed3771f99e",
                  "name": "id",
                  "value": "={{ $('Loop Over Items4').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "5693a142-1555-4384-8df2-12994814d418",
                  "name": "name",
                  "value": "={{ $('Loop Over Items4').item.json.name }}",
                  "type": "string"
                },
                {
                  "id": "24d2b57c-48a9-4fc9-ade2-182617591c93",
                  "name": "url",
                  "value": "={{ $('Loop Over Items4').item.json.url }}",
                  "type": "string"
                },
                {
                  "id": "26e8544b-2ae2-4f17-8aa4-df325b538d5e",
                  "name": "projeto",
                  "value": "={{ $json.property_projetos[0] }}",
                  "type": "string"
                },
                {
                  "id": "f934706e-b35d-4e3f-ab60-b2997c82effa",
                  "name": "data",
                  "value": "={{ $json.property_created_time.slice(0, 10) }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            1168,
            1664
          ],
          "id": "369059fc-c551-4e43-a247-fce80483d6ef",
          "name": "Edit Fields4"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {}
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.3,
          "position": [
            432,
            1776
          ],
          "id": "0f9d04ea-9978-47e8-bc01-f32befc1f7e1",
          "name": "Schedule Trigger2"
        },
        {
          "parameters": {
            "content": "## Atas",
            "height": 528,
            "width": 2528
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            256,
            1520
          ],
          "id": "25cf998e-d4d9-4085-ab46-30ac045d303c",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "operation": "deleteCollection",
            "collectionName": {
              "__rl": true,
              "value": "atas",
              "mode": "list",
              "cachedResultName": "atas"
            },
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            2288,
            2304
          ],
          "id": "6aa96a82-d7de-4e2a-b236-42d0f6b36af1",
          "name": "Delete Collection",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "operation": "getCollection",
            "collectionName": {
              "__rl": true,
              "value": "atas",
              "mode": "list",
              "cachedResultName": "atas"
            },
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            2304,
            2560
          ],
          "id": "8eb1d3c8-381d-4b5d-aaed-80b638b625b7",
          "name": "Get Collection",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "resource": "point",
            "operation": "scrollPoints",
            "collectionName": {
              "__rl": true,
              "value": "atas",
              "mode": "list",
              "cachedResultName": "atas"
            },
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            2896,
            2208
          ],
          "id": "af52eea9-6ab3-48c7-9304-e453257dab70",
          "name": "Scroll Points1",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "# Contexto\nVocê recebe o conteúdo de um slide de power point ou um range de células do Excel e, opcionalmente, uma mensagem da pessoa que o contruiu e conteúdo dos demais slides/abas. Se houver uma mensagem do usuário, faça o que ele pedir, do contrário você deve realizar uma análise crítica:\n\n## Power Point:\n#### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (busque documentos de referência)\n-Fonte homogênea em todas as caixas com texto\n-Erros de português\n-Tamanho da fonte coerente entre os slides\n-Alinhamento de titulo (mesma posição em todos os slides)\n-Uso adequado de slide mestre\n-Slides contém numeração\n-Unidades nos números (coerência interna no slide)\n-Padrão de frases começarem com letra maiúscula OU cada palavra em letra maiúscula\n-Caso o conteúdo dos demais slides seja passado também os utilize para ver se o slide em questão está bem construído e posicionado na apresentação.\n## Opcional:\n-O usuário também pode pedir sugestões de slides. Nesse caso busque slides na tool de banco de slides e retorne o link da imagem do slide e o link do sharepoint\n\n## Excel:\n### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (indentifique o conteúdo (técnico e teórico) e busque documentos de referência)\n-Fonte homogênea em todas as células\n-Erros de português\n-Tamanho da fonte coerente\n-Aderência sólida com conceitos contábeis e financeiros\n\n# Diretrizes Gerais\n- Suas respostas devem seguir as diretrizes da Píer Partners, e para isso consulte a base de conhecimento disponível, onde diversos documentos sobre os temas com os quais trabalhamos estão disponíveis.\n- Se o usuário pedir a revisão nos dados (números de mercado, índices, etc) utilize as ferramenta de busca na web (Google para buscas simples e Perpexity para buscas avançadas).\n- As respostas devem sempre ser referenciadas com indicadores como [1] e [2] e ao final das respostas que usam fontes deve ser inserido uma seção se fontes com o nome e url destes documentos usando hyperlinks.\n- Seja direto, indo direto para a análise, com profundidade mas sendo breve.\n- Sempre retorne sua resposta em formato Markdown."
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3.1,
          "position": [
            3712,
            3936
          ],
          "id": "aae740f9-d1be-4ea9-8e68-9e17962e8b13",
          "name": "AI Agent2"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2-chat-latest",
              "mode": "list",
              "cachedResultName": "gpt-5.2-chat-latest"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            3488,
            4160
          ],
          "id": "261a2026-d650-409b-88fc-003293704a11",
          "name": "OpenAI Chat Model2",
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Lista os projetos do Notion",
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "c2af396cc2a347eca452b2b2bf6b9031",
              "mode": "id"
            },
            "returnAll": true,
            "options": {}
          },
          "type": "n8n-nodes-base.notionTool",
          "typeVersion": 2.2,
          "position": [
            4064,
            4160
          ],
          "id": "8a024e46-e765-4d3b-a5e4-b82fa8836bad",
          "name": "Lista projetos",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "operation": "__CUSTOM_API_CALL__",
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            2624,
            2256
          ],
          "id": "6d206cb1-4882-4d44-87bd-8422762a754a",
          "name": "__CUSTOM_API_CALL__ collection",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "url": "https://021f8bc6-6e1c-467e-a41c-6f7c0d6c461d.us-east4-0.gcp.cloud.qdrant.io/collections/atas",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "qdrantRestApi",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {}
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            2784,
            2784
          ],
          "id": "7c38f8ee-c7e1-4e33-a5b7-3ab70e2de494",
          "name": "HTTP Request",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        },
        {
          "parameters": {
            "contextWindowLength": 10
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            3744,
            4192
          ],
          "id": "2999ff4c-a264-43bc-bf76-440d7cd594ac",
          "name": "Simple Memory1"
        },
        {
          "parameters": {
            "description": "Ferramenta para busca de atas. é necessário informar o id do projeto, que deve ser buscado pela tool de listagem de projetos",
            "workflowId": {
              "__rl": true,
              "value": "uoyG9WwFxe56M0vy",
              "mode": "list",
              "cachedResultUrl": "/workflow/uoyG9WwFxe56M0vy",
              "cachedResultName": "subflow qdrant atas"
            },
            "workflowInputs": {
              "mappingMode": "defineBelow",
              "value": {
                "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `tema da ata para refinar a busca`, 'string') }}",
                "projeto_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('projeto_id', `id do projeto, coletado a partir da ferramenta de listagem de projetos`, 'string') }}"
              },
              "matchingColumns": [
                "query"
              ],
              "schema": [
                {
                  "id": "query",
                  "displayName": "query",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                },
                {
                  "id": "projeto_id",
                  "displayName": "projeto_id",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "canBeUsedToMatch": true,
                  "type": "string",
                  "removed": false
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            }
          },
          "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
          "typeVersion": 2.2,
          "position": [
            3904,
            4224
          ],
          "id": "3c6f0965-4681-490b-9db1-68fb30d919d1",
          "name": "Busca de atas"
        },
        {
          "parameters": {
            "jsCode": "// Extract and prepare data for translation\nconst input = $input.first().json.body;\n\nconst targetLanguage = input.target_language || 'en';\nconst targetLanguageName = input.target_language_name || 'English';\nconst scope = input.translate_scope || 'current';\nconst contentToTranslate = input.content_to_translate || [];\nconst allSlides = input.slides || [];\n\n// Build context from all slides (for terminology consistency)\nlet contextText = '';\nif (allSlides.length > 0) {\n  contextText = allSlides.map(slide => {\n    const shapes = slide.shapes || [];\n    const texts = shapes.map(s => s.original_text).join('\\n');\n    return `Slide ${slide.slide_number}:\\n${texts}`;\n  }).join('\\n\\n---\\n\\n');\n}\n\n// Build content to translate with shape identifiers\n// Format: [SLIDE X][SHAPE:shape_name] text\nlet translateText = '';\nconst shapeMapping = []; // Keep track of slide/shape mapping for response\n\nfor (const slide of contentToTranslate) {\n  for (const shape of (slide.shapes || [])) {\n    translateText += `[SLIDE ${slide.slide_number}][SHAPE:${shape.shape_name}]\\n${shape.original_text}\\n\\n`;\n    shapeMapping.push({\n      slide_number: slide.slide_number,\n      shape_name: shape.shape_name,\n      original_text: shape.original_text\n    });\n  }\n}\n\nreturn [{\n  json: {\n    targetLanguage,\n    targetLanguageName,\n    scope,\n    contextText,\n    translateText,\n    shapeMapping: JSON.stringify(shapeMapping),\n    slideCount: contentToTranslate.length,\n    shapeCount: shapeMapping.length\n  }\n}];"
          },
          "id": "ca663da8-20e0-459c-b83c-2846677dfccc",
          "name": "Prepare Data",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            3008,
            3568
          ]
        },
        {
          "parameters": {
            "modelId": {
              "__rl": true,
              "value": "gpt-5.2",
              "mode": "list",
              "cachedResultName": "GPT-5.2"
            },
            "messages": {
              "values": [
                {
                  "content": "=Você é um tradutor profissional especializado em apresentações corporativas. Sua tarefa é traduzir o conteúdo de slides de PowerPoint para {{ $json.targetLanguageName }}.\n\n## Regras CRÍTICAS de formatação:\n1. **PRESERVE TODOS os marcadores de formatação**:\n   - **texto** = negrito (bold)\n   - *texto* = itálico (italic)\n   - __texto__ = sublinhado (underline)\n2. Os marcadores devem permanecer EXATAMENTE nas mesmas posições relativas no texto traduzido\n3. Se o original tem **palavra importante**, a tradução deve ter **palavra traduzida importante**\n\n## Outras regras:\n1. Mantenha bullet points e quebras de linha\n2. Preserve termos técnicos comumente usados em inglês\n3. Mantenha consistência terminológica entre os slides\n4. Adapte expressões idiomáticas naturalmente\n5. Preserve nomes próprios, siglas e acrônimos\n6. Mantenha tom profissional e formal\n7. MUITO IMPORTANTE: Mantenha os marcadores [SLIDE X][SHAPE:nome] exatamente como estão\n\n## Contexto completo da apresentação:\n{{ $json.contextText }}\n\n## Formato de resposta:\n- Para cada shape, mantenha o marcador [SLIDE X][SHAPE:nome] seguido da tradução\n- Não adicione explicações, apenas a tradução\n- PRESERVE **negrito**, *itálico* e __sublinhado__ na tradução",
                  "role": "system"
                },
                {
                  "content": "=Traduza o seguinte conteúdo para {{ $json.targetLanguageName }}. Mantenha os marcadores [SLIDE X][SHAPE:nome] intactos:\n\n{{ $json.translateText }}"
                }
              ]
            },
            "options": {
              "maxTokens": 4096,
              "temperature": 0.3
            }
          },
          "id": "abf693d2-0362-4887-a447-6a806542cb1f",
          "name": "OpenAI Translate",
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 1.8,
          "position": [
            3232,
            3568
          ],
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// Parse the translation response and format for PowerPoint application\nconst translationResult = $input.first().json;\nconst preparedData = $('Prepare Data').first().json;\n\n// Get the translated text from OpenAI response\nlet translatedText = '';\nif (translationResult.message && translationResult.message.content) {\n  translatedText = translationResult.message.content;\n} else if (translationResult.text) {\n  translatedText = translationResult.text;\n} else if (typeof translationResult === 'string') {\n  translatedText = translationResult;\n}\n\n// Parse shape-level translations\n// Pattern: [SLIDE X][SHAPE:name]\\ntext\nconst shapePattern = /\\[SLIDE (\\d+)\\]\\[SHAPE:([^\\]]+)\\]\\n([\\s\\S]*?)(?=\\[SLIDE \\d+\\]\\[SHAPE:|$)/g;\nconst translationsBySlide = new Map();\nlet match;\n\nwhile ((match = shapePattern.exec(translatedText)) !== null) {\n  const slideNumber = parseInt(match[1]);\n  const shapeName = match[2];\n  const translatedContent = match[3].trim();\n  \n  if (!translationsBySlide.has(slideNumber)) {\n    translationsBySlide.set(slideNumber, []);\n  }\n  \n  translationsBySlide.get(slideNumber).push({\n    shape_name: shapeName,\n    translated_text: translatedContent\n  });\n}\n\n// Build the response in the format expected by PowerPoint\nconst translations = [];\nfor (const [slideNumber, shapes] of translationsBySlide) {\n  translations.push({\n    slide_number: slideNumber,\n    shapes: shapes\n  });\n}\n\n// Sort by slide number\ntranslations.sort((a, b) => a.slide_number - b.slide_number);\n\n// Build markdown preview\nlet markdown = `# Tradução para ${preparedData.targetLanguageName}\\n\\n`;\nmarkdown += `**Slides traduzidos:** ${translations.length}\\n`;\nmarkdown += `**Shapes traduzidos:** ${translations.reduce((acc, s) => acc + s.shapes.length, 0)}\\n\\n`;\n\nfor (const slide of translations) {\n  markdown += `## Slide ${slide.slide_number}\\n\\n`;\n  for (const shape of slide.shapes) {\n    markdown += `**${shape.shape_name}:**\\n${shape.translated_text}\\n\\n`;\n  }\n  markdown += '---\\n\\n';\n}\n\nreturn [{\n  json: {\n    apply_translations: true,\n    translations: translations,\n    markdown: markdown,\n    target_language: preparedData.targetLanguage,\n    target_language_name: preparedData.targetLanguageName\n  }\n}];"
          },
          "id": "674785aa-4cb7-4d66-b22b-ef86b34cf52b",
          "name": "Format Response",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            3520,
            3568
          ]
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "translate-slides",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "e50e2d8e-bad0-493a-97b2-ba08e805ad9a",
          "name": "Webhook1",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            2784,
            3568
          ],
          "webhookId": "translate-slides-webhook"
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {
              "responseHeaders": {
                "entries": [
                  {
                    "name": "Content-Type",
                    "value": "application/json"
                  }
                ]
              }
            }
          },
          "id": "a4c85361-46bd-4c26-bfc2-09a71bf1166c",
          "name": "Respond to Webhook1",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.1,
          "position": [
            3728,
            3568
          ]
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.userMessage }}",
            "options": {
              "systemMessage": "=Você é um assistente especializado em apresentações PowerPoint para a empresa Píer Partners. Você ajuda os usuários a criar, melhorar e analisar seus slides.\n\n  ## Suas capacidades:\n  - Avaliar a clareza e efetividade dos slides\n  - Sugerir melhorias de layout, texto e design\n  - Ajudar a estruturar argumentos e narrativas\n  - Simplificar textos complexos\n  - Criar resumos executivos\n  - Verificar consistência entre slides\n  - Responder perguntas sobre melhores práticas de apresentação\n\n  ## Diretrizes:\n  - Seja conciso e direto nas respostas\n  - Use bullet points quando apropriado\n  - Faça referência específica aos slides quando relevante\n  - Mantenha um tom profissional mas amigável\n  - Se não tiver informação suficiente sobre os slides, peça mais contexto\n\n  ## Capacidade de modificar slides\n\n  Quando o usuário pedir para ALTERAR, MODIFICAR ou AJUSTAR algo no slide, você pode gerar código Office.js que será executado diretamente no PowerPoint.\n\n  ### Como usar:\n  Coloque o código dentro de um bloco ```officejs```. O ambiente de execução já fornece estas variáveis prontas:\n  - `context` — o contexto do PowerPoint.run (já ativo)\n  - `slide` — o slide atual, com shapes já carregados\n  - `getShapeByName(name)` — busca um shape pelo nome exato (lança erro se não encontrar)\n\n  ### APIs disponíveis:\n  - Buscar shape: `const shape = getShapeByName(\"Title 1\")`\n  - Texto: `shape.textFrame.textRange.text = \"novo texto\"`\n  - Cor da fonte: `shape.textFrame.textRange.font.color = \"#FF0000\"`\n  - Tamanho da fonte: `shape.textFrame.textRange.font.size = 24`\n  - Negrito: `shape.textFrame.textRange.font.bold = true`\n  - Itálico: `shape.textFrame.textRange.font.italic = true`\n  - Posição: `shape.left = 100; shape.top = 50`\n  - Tamanho shape: `shape.width = 500; shape.height = 300`\n  - Sincronizar: `await context.sync()`\n\n  ### Regras:\n  - NUNCA inclua PowerPoint.run() no código — o add-in já faz isso\n  - NUNCA use slide.shapes.getItem() — use getShapeByName() que busca pelo nome\n  - SEMPRE use os nomes exatos dos shapes fornecidos no contexto do slide\n  - SEMPRE use await context.sync() após modificar propriedades\n  - Sempre explique o que vai fazer no texto da mensagem ANTES do bloco de código\n  - Se não tiver certeza do nome do shape, pergunte ao usuário\n  - Gere código simples e direto, sem funções auxiliares\n  - A variável `slide` já está disponível — NÃO redefina ela\n\n  ## Contexto da apresentação atual:\n  {{ $json.slideContext }}"
            }
          },
          "id": "ce928c5b-25fd-424b-aa23-7df69a23e517",
          "name": "Agent Config",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.7,
          "position": [
            1856,
            3872
          ]
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "ppt-chat",
            "responseMode": "responseNode",
            "options": {}
          },
          "id": "3a5b4baa-1c2d-4617-9fbc-1b38a447bb3f",
          "name": "Webhook2",
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2,
          "position": [
            1424,
            3872
          ],
          "webhookId": "ppt-chat-webhook"
        },
        {
          "parameters": {
            "jsCode": "  // Extract data from webhook\n  const input = $input.first().json.body;\n\n  const sessionId = input.session_id || 'default';\n  const userMessage = input.message || '';\n  const currentSlide = input.current_slide || {};\n  const includeAllSlides = input.include_all_slides || false;\n  const allSlides = input.slides || [];\n  const slideImage = input.slide_image || null;\n\n  // Build context about the presentation\n  let slideContext = '';\n\n  if (currentSlide.number) {\n    slideContext += `\\n\\nSLIDE ATUAL (${currentSlide.number}):\\n`;\n    if (currentSlide.text && currentSlide.text.length > 0) {\n      slideContext += currentSlide.text.join('\\n');\n    }\n    if (currentSlide.shapes && currentSlide.shapes.length > 0) {\n      slideContext += '\\n\\nElementos do slide:\\n';\n      currentSlide.shapes.forEach(s => {\n        if (s.text) {\n          slideContext += `- \"${s.name}\" (${s.type || 'shape'}): \"${s.text}\"`;\n          if (s.font) {\n            const parts = [];\n            if (s.font.name) parts.push(`fonte: ${s.font.name}`);\n            if (s.font.size) parts.push(`tamanho: ${s.font.size}`);\n            if (s.font.color) parts.push(`cor: ${s.font.color}`);\n            if (s.font.bold) parts.push('negrito');\n            if (s.font.italic) parts.push('itálico');\n            if (parts.length) slideContext += ` [${parts.join(', ')}]`;\n          }\n          slideContext += ` | pos: (${Math.round(s.left)}, ${Math.round(s.top)}) tam: ${Math.round(s.width)}x${Math.round(s.height)}\\n`;\n        }\n      });\n    }\n  }\n\n  if (includeAllSlides && allSlides.length > 0) {\n    slideContext += '\\n\\nTODOS OS SLIDES DA APRESENTAÇÃO:\\n';\n    allSlides.forEach(slide => {\n      slideContext += `\\nSlide ${slide.number}:\\n`;\n      if (slide.text && slide.text.length > 0) {\n        slideContext += slide.text.join('\\n');\n      }\n    });\n  }\n\n  const output = {\n    json: {\n      sessionId,\n      userMessage,\n      slideContext,\n      currentSlideNumber: currentSlide.number || null,\n      has_image: !!slideImage,\n    }\n  };\n\n  // Attach image as binary for vision\n  if (slideImage) {\n    output.binary = {\n      data: {\n        data: slideImage,\n        mimeType: 'image/png',\n        fileName: 'slide.png',\n      }\n    };\n  }\n\n  return [output];"
          },
          "id": "446a89fa-a6d9-4348-a916-b6aacf0585ea",
          "name": "Prepare Data1",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1648,
            3872
          ]
        },
        {
          "parameters": {
            "model": "gpt-5.2-chat-latest",
            "options": {}
          },
          "id": "d077ab81-a536-4557-a138-f08fb0b4c9ac",
          "name": "OpenAI Chat Model3",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1,
          "position": [
            1744,
            4080
          ],
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.sessionId }}",
            "contextWindowLength": 10
          },
          "id": "cc347f65-d1fc-4cf6-9086-7de0e65b31f6",
          "name": "Simple Memory2",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.2,
          "position": [
            1904,
            4080
          ]
        },
        {
          "parameters": {
            "jsCode": "// Format the agent response\n  const agentOutput = $input.first().json;\n\n  let responseMessage = '';\n\n  if (agentOutput.output) {\n    responseMessage = agentOutput.output;\n  } else if (agentOutput.text) {\n    responseMessage = agentOutput.text;\n  } else if (typeof agentOutput === 'string') {\n    responseMessage = agentOutput;\n  } else {\n    responseMessage = JSON.stringify(agentOutput);\n  }\n\n  // Extrair bloco ```officejs ... ```\n  const codeMatch = responseMessage.match(/```officejs\\s*\\n([\\s\\S]*?)```/);\n  let code = null;\n  if (codeMatch) {\n    code = codeMatch[1].trim();\n    responseMessage = responseMessage.replace(/```officejs\\s*\\n[\\s\\S]*?```/, '').trim();\n  }\n\n  return [{\n    json: {\n      message: responseMessage,\n      ...(code ? { code } : {})\n    }\n  }];"
          },
          "id": "bde1af10-a49c-43f4-9d12-2ccf2ce4f8c6",
          "name": "Format Response1",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2176,
            3872
          ]
        },
        {
          "parameters": {
            "respondWith": "json",
            "responseBody": "={{ $json }}",
            "options": {
              "responseHeaders": {
                "entries": [
                  {
                    "name": "Content-Type",
                    "value": "application/json"
                  }
                ]
              }
            }
          },
          "id": "e657fe07-2d45-4e3a-b18d-5a940ebcfb27",
          "name": "Respond to Webhook2",
          "type": "n8n-nodes-base.respondToWebhook",
          "typeVersion": 1.1,
          "position": [
            2368,
            3872
          ]
        },
        {
          "parameters": {
            "jsCode": "  const body = $input.first().json.body;                                                                                                                                      \n  const slideImage = body.slide_image || null;\n\n  // Build clean body without the image blob\n  const cleanBody = { ...body };\n  delete cleanBody.slide_image;\n\n  const output = {\n    json: {\n      body: cleanBody,\n      has_image: !!slideImage,\n    }\n  };\n\n  // Attach image as binary so the AI Agent can send it as vision input\n  if (slideImage) {\n    output.binary = {\n      data: {\n        data: slideImage,\n        mimeType: 'image/png',\n        fileName: 'slide.png',\n      }\n    };\n  }\n\n  return [output];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1552,
            3392
          ],
          "id": "2dcf0e28-cdcf-4cfe-a351-1ef1d68612a7",
          "name": "Code in JavaScript2"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "={{ $json.userMessage }}",
            "options": {
              "systemMessage": "=Você é um assistente especializado em apresentações PowerPoint para a empresa Píer Partners. Você ajuda os usuários a criar, melhorar e analisar seus slides.\n\n## Suas capacidades:\n- Avaliar a clareza e efetividade dos slides\n- Sugerir melhorias de layout, texto e design\n- Ajudar a estruturar argumentos e narrativas\n- Simplificar textos complexos\n- Criar resumos executivos\n- Verificar consistência entre slides\n- Responder perguntas sobre melhores práticas de apresentação\n\n## Diretrizes:\n- Seja conciso e direto nas respostas\n- Use bullet points quando apropriado\n- Faça referência específica aos slides quando relevante\n- Mantenha um tom profissional mas amigável\n- Se não tiver informação suficiente sobre os slides, peça mais contexto\n\n## Contexto da apresentação atual:\n{{ $json.slideContext }}"
            }
          },
          "id": "7416da7f-9811-4677-9358-d72af10a82cd",
          "name": "Agent Config1",
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 1.7,
          "position": [
            1904,
            4384
          ]
        },
        {
          "parameters": {
            "jsCode": "// Extract data from webhook                                                                                                                  \n  const input = $input.first().json.body;\n                                                                                                                                                \n  const sessionId = input.session_id || 'default';                                 \n  const userMessage = input.message || '';\n  const currentSlide = input.current_slide || {};\n  const includeAllSlides = input.include_all_slides || false;\n  const allSlides = input.slides || [];\n  const slideImage = input.slide_image || null;\n\n  // Build context about the presentation\n  let slideContext = '';\n\n  if (currentSlide.number) {\n    slideContext += `\\n\\nSLIDE ATUAL (${currentSlide.number}):\\n`;\n    if (currentSlide.text && currentSlide.text.length > 0) {\n      slideContext += currentSlide.text.join('\\n');\n    }\n    if (currentSlide.shapes && currentSlide.shapes.length > 0) {\n      slideContext += '\\n\\nElementos do slide:\\n';\n      currentSlide.shapes.forEach(s => {\n        if (s.text) slideContext += `- ${s.name}: ${s.text}\\n`;\n      });\n    }\n  }\n\n  if (includeAllSlides && allSlides.length > 0) {\n    slideContext += '\\n\\nTODOS OS SLIDES DA APRESENTAÇÃO:\\n';\n    allSlides.forEach(slide => {\n      slideContext += `\\nSlide ${slide.number}:\\n`;\n      if (slide.text && slide.text.length > 0) {\n        slideContext += slide.text.join('\\n');\n      }\n    });\n  }\n\n  const output = {\n    json: {\n      sessionId,\n      userMessage,\n      slideContext,\n      currentSlideNumber: currentSlide.number || null,\n      has_image: !!slideImage,\n    }\n  };\n\n  // Attach image as binary for vision\n  if (slideImage) {\n    output.binary = {\n      data: {\n        data: slideImage,\n        mimeType: 'image/png',\n        fileName: 'slide.png',\n      }\n    };\n  }\n\n  return [output];"
          },
          "id": "b8002d76-3371-47ea-b15f-24351eb0521d",
          "name": "Prepare Data2",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            1696,
            4384
          ]
        },
        {
          "parameters": {
            "model": "gpt-5.2-chat-latest",
            "options": {}
          },
          "id": "5aa35815-b362-492b-ab3e-1127af7e433e",
          "name": "OpenAI Chat Model4",
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1,
          "position": [
            1872,
            4592
          ],
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $json.sessionId }}",
            "contextWindowLength": 10
          },
          "id": "f62a973c-702e-46a0-bb5d-222403754f2e",
          "name": "Simple Memory3",
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.2,
          "position": [
            2032,
            4592
          ]
        },
        {
          "parameters": {
            "jsCode": "// Format the agent response\nconst agentOutput = $input.first().json;\n\nlet responseMessage = '';\n\nif (agentOutput.output) {\n  responseMessage = agentOutput.output;\n} else if (agentOutput.text) {\n  responseMessage = agentOutput.text;\n} else if (typeof agentOutput === 'string') {\n  responseMessage = agentOutput;\n} else {\n  responseMessage = JSON.stringify(agentOutput);\n}\n\nreturn [{\n  json: {\n    message: responseMessage\n  }\n}];"
          },
          "id": "b1c67a34-5f5b-475e-9806-9f76484292f5",
          "name": "Format Response2",
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            2224,
            4384
          ]
        }
      ],
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many database pages": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many child blocks": {
          "main": [
            [
              {
                "node": "Code in JavaScript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              },
              {
                "node": "Get many child blocks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Qdrant Vector Store1": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Embeddings OpenAI": {
          "ai_embedding": [
            [
              {
                "node": "Qdrant Vector Store1",
                "type": "ai_embedding",
                "index": 0
              }
            ]
          ]
        },
        "Default Data Loader": {
          "ai_document": [
            [
              {
                "node": "Qdrant Vector Store1",
                "type": "ai_document",
                "index": 0
              }
            ]
          ]
        },
        "Token Splitter": {
          "ai_textSplitter": [
            [
              {
                "node": "Default Data Loader",
                "type": "ai_textSplitter",
                "index": 0
              }
            ]
          ]
        },
        "Delete Points": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Scroll Points": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items1": {
          "main": [
            [],
            [
              {
                "node": "Delete Points",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Loop Over Items1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "Qdrant Vector Store1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Call 'subflow qdrant'": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Webhook": {
          "main": [
            [
              {
                "node": "Code in JavaScript2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent1": {
          "main": [
            [
              {
                "node": "Respond to Webhook",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Base de conhecimento": {
          "ai_tool": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_tool",
                "index": 0
              },
              {
                "node": "Agent Config",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Banco de slides": {
          "ai_tool": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_tool",
                "index": 0
              },
              {
                "node": "Agent Config",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Perplexity": {
          "ai_tool": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_tool",
                "index": 0
              },
              {
                "node": "Agent Config",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Google": {
          "ai_tool": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_tool",
                "index": 0
              },
              {
                "node": "Agent Config",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "When clicking ‘Execute workflow’": {
          "main": [
            []
          ]
        },
        "Upsert Points2": {
          "main": [
            [
              {
                "node": "Loop Over Items2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Merge3": {
          "main": [
            [
              {
                "node": "Upsert Points2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get OpenAI embeddings1": {
          "main": [
            [
              {
                "node": "Merge3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many database pages1": {
          "main": [
            [
              {
                "node": "Loop Over Items2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many child blocks1": {
          "main": [
            [
              {
                "node": "Code in JavaScript1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript1": {
          "main": [
            [
              {
                "node": "If2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items2": {
          "main": [
            [],
            [
              {
                "node": "Edit Fields2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields2": {
          "main": [
            [
              {
                "node": "Get many child blocks1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If2": {
          "main": [
            [
              {
                "node": "Loop Over Items2",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Get OpenAI embeddings1",
                "type": "main",
                "index": 0
              },
              {
                "node": "Merge3",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Get many database pages1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Upsert Points3": {
          "main": [
            [
              {
                "node": "Loop Over Items4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get OpenAI embeddings2": {
          "main": [
            [
              {
                "node": "Upsert Points3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many database pages3": {
          "main": [
            [
              {
                "node": "Loop Over Items4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many child blocks3": {
          "main": [
            [
              {
                "node": "Code in JavaScript3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript3": {
          "main": [
            [
              {
                "node": "Get OpenAI embeddings2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items4": {
          "main": [
            [],
            [
              {
                "node": "Edit Fields4",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields4": {
          "main": [
            [
              {
                "node": "Get many child blocks3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger2": {
          "main": [
            [
              {
                "node": "Get many database pages3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent2": {
          "main": [
            []
          ]
        },
        "OpenAI Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent2",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Lista projetos": {
          "ai_tool": [
            [
              {
                "node": "AI Agent2",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory1": {
          "ai_memory": [
            [
              {
                "node": "AI Agent2",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Busca de atas": {
          "ai_tool": [
            [
              {
                "node": "AI Agent2",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Prepare Data": {
          "main": [
            [
              {
                "node": "OpenAI Translate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Translate": {
          "main": [
            [
              {
                "node": "Format Response",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Format Response": {
          "main": [
            [
              {
                "node": "Respond to Webhook1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook1": {
          "main": [
            [
              {
                "node": "Prepare Data",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Agent Config": {
          "main": [
            [
              {
                "node": "Format Response1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook2": {
          "main": [
            [
              {
                "node": "Prepare Data1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prepare Data1": {
          "main": [
            [
              {
                "node": "Agent Config",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model3": {
          "ai_languageModel": [
            [
              {
                "node": "Agent Config",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory2": {
          "ai_memory": [
            [
              {
                "node": "Agent Config",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Format Response1": {
          "main": [
            [
              {
                "node": "Respond to Webhook2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript2": {
          "main": [
            [
              {
                "node": "AI Agent1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Agent Config1": {
          "main": [
            [
              {
                "node": "Format Response2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Prepare Data2": {
          "main": [
            [
              {
                "node": "Agent Config1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model4": {
          "ai_languageModel": [
            [
              {
                "node": "Agent Config1",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory3": {
          "ai_memory": [
            [
              {
                "node": "Agent Config1",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Format Response2": {
          "main": [
            []
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "availableInMCP": false
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        },
        "node:Schedule Trigger1": {
          "recurrenceRules": []
        },
        "node:Schedule Trigger2": {
          "recurrenceRules": []
        },
        "node:Notion Trigger": {
          "lastTimeChecked": "2026-02-12T23:00:00.000Z",
          "possibleDuplicates": [
            "2f702cfe-4c0e-8046-bb66-f515104ba2cb"
          ]
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "ab3adb56-b4d0-4470-8b2b-42b6ec89cac2",
      "activeVersionId": "ab3adb56-b4d0-4470-8b2b-42b6ec89cac2",
      "versionCounter": 1286,
      "triggerCount": 6,
      "shared": [
        {
          "updatedAt": "2025-12-28T16:41:54.247Z",
          "createdAt": "2025-12-28T16:41:54.247Z",
          "role": "workflow:owner",
          "workflowId": "gKNGnV5aOelesPEn",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [],
      "activeVersion": {
        "updatedAt": "2026-02-13T01:59:27.228Z",
        "createdAt": "2026-02-13T01:59:24.989Z",
        "versionId": "ab3adb56-b4d0-4470-8b2b-42b6ec89cac2",
        "workflowId": "gKNGnV5aOelesPEn",
        "nodes": [
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.4,
            "position": [
              816,
              2576
            ],
            "id": "0092ce53-b257-43a8-bfc6-e31997605fbe",
            "name": "When chat message received",
            "webhookId": "5ba440e1-5711-4fca-9ac5-08601c504ec0"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "2c902cfe4c0e8047b2c6daa6791da9e2",
                "mode": "id"
              },
              "limit": 5,
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              576,
              416
            ],
            "id": "67cc9d98-e942-49c1-8afd-fd24f91d0d17",
            "name": "Get many database pages",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "block",
              "operation": "getAll",
              "blockId": {
                "__rl": true,
                "value": "={{ $json.url }}",
                "mode": "url"
              },
              "returnAll": true
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1056,
              144
            ],
            "id": "70ec9b98-0699-4520-a8cd-573dfe25da19",
            "name": "Get many child blocks",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "let output = [];\n\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nreturn [\n  {\n    json: {\n      content: output.join('\\n\\n')\n    }\n  }\n];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1296,
              144
            ],
            "id": "94ea182e-6a8f-401d-93ee-fd7955e844ff",
            "name": "Code in JavaScript",
            "executeOnce": false
          },
          {
            "parameters": {
              "mode": "insert",
              "qdrantCollection": {
                "__rl": true,
                "value": "pier_knowledge",
                "mode": "list",
                "cachedResultName": "pier_knowledge"
              },
              "options": {
                "contentPayloadKey": "content"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.vectorStoreQdrant",
            "typeVersion": 1.3,
            "position": [
              1872,
              320
            ],
            "id": "63a9c5ca-4fa3-40ef-9c67-8bd8faf93be2",
            "name": "Qdrant Vector Store1",
            "credentials": {
              "qdrantApi": {
                "id": "BZ0gPnzsubvT5Zw1",
                "name": "QdrantApi account 2"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              800,
              320
            ],
            "id": "e8eb1c59-963c-4a47-bd73-e9f80d257f8e",
            "name": "Loop Over Items"
          },
          {
            "parameters": {
              "model": "text-embedding-3-large",
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
            "typeVersion": 1.2,
            "position": [
              1792,
              560
            ],
            "id": "a40f18cb-4960-48f6-a326-b76c26d000fe",
            "name": "Embeddings OpenAI",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "textSplittingMode": "custom",
              "options": {
                "metadata": {
                  "metadataValues": [
                    {
                      "name": "document_id",
                      "value": "={{ $json.id }}"
                    },
                    {
                      "name": "name",
                      "value": "={{ $json.name }}"
                    },
                    {
                      "name": "url",
                      "value": "={{ $json.url }}"
                    },
                    {
                      "name": "subject",
                      "value": "={{ $json.property_tema_natureza }}"
                    }
                  ]
                }
              }
            },
            "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
            "typeVersion": 1.1,
            "position": [
              2160,
              480
            ],
            "id": "0705d8f9-1f33-4f11-8d02-9221b1e537d6",
            "name": "Default Data Loader"
          },
          {
            "parameters": {
              "chunkSize": 1000000
            },
            "type": "@n8n/n8n-nodes-langchain.textSplitterTokenSplitter",
            "typeVersion": 1,
            "position": [
              2272,
              576
            ],
            "id": "78c03e7b-dd3d-4d3c-a535-d158603b27df",
            "name": "Token Splitter"
          },
          {
            "parameters": {
              "resource": "point",
              "operation": "deletePoints",
              "collectionName": {
                "__rl": true,
                "value": "pier",
                "mode": "list",
                "cachedResultName": "pier"
              },
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              1792,
              2240
            ],
            "id": "770cb2a5-cdb8-40ef-9abd-b15121fbe2a1",
            "name": "Delete Points",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "resource": "point",
              "operation": "scrollPoints",
              "collectionName": {
                "__rl": true,
                "value": "pier",
                "mode": "list",
                "cachedResultName": "pier"
              },
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              1152,
              2224
            ],
            "id": "99de0890-f678-4503-ae7b-be58a6b05a9c",
            "name": "Scroll Points",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              1552,
              2176
            ],
            "id": "7bc57dc3-1132-447f-a2cb-973579a205c0",
            "name": "Loop Over Items1"
          },
          {
            "parameters": {
              "fieldToSplitOut": "result.points",
              "options": {}
            },
            "type": "n8n-nodes-base.splitOut",
            "typeVersion": 1,
            "position": [
              1360,
              2224
            ],
            "id": "54579fa7-0f1c-4a4c-856c-9b2dc6891bd7",
            "name": "Split Out"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "ec80d8f5-8a5b-4f7a-be3c-93ed3771f99e",
                    "name": "id",
                    "value": "={{ $json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "5693a142-1555-4384-8df2-12994814d418",
                    "name": "name",
                    "value": "={{ $json.name }}",
                    "type": "string"
                  },
                  {
                    "id": "24d2b57c-48a9-4fc9-ade2-182617591c93",
                    "name": "url",
                    "value": "={{ $json.url }}",
                    "type": "string"
                  },
                  {
                    "id": "6e4da1f8-2690-4166-935a-7d7feb5bc522",
                    "name": "property_tema_natureza",
                    "value": "={{ $json.property_tema_natureza }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              1056,
              304
            ],
            "id": "51363c7c-0851-4a51-8ef0-ad6a1654f876",
            "name": "Edit Fields"
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              1584,
              320
            ],
            "id": "a87f35bd-020d-4582-8173-03dfa44ce431",
            "name": "Merge"
          },
          {
            "parameters": {
              "options": {
                "systemMessage": "Responda apenas com conteudos buscados atraves das ferramentas. As respostas devem sempre ser referenciadas com indicadores como [1] e [2] e ao final das respostas que usam fontes deve ser inserido uma seção se fontes com o nome e url destes documentos usando hyperlinks"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3.1,
            "position": [
              1024,
              2576
            ],
            "id": "107324d8-a24b-418d-a506-d3f62a727197",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.2-chat-latest",
                "mode": "list",
                "cachedResultName": "gpt-5.2-chat-latest"
              },
              "builtInTools": {},
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
              896,
              2784
            ],
            "id": "0e90b97a-b0c6-4dca-a533-e31bd602ab94",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {},
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              1040,
              2784
            ],
            "id": "0b677de5-5813-4fff-b54b-1045e7b07c86",
            "name": "Simple Memory"
          },
          {
            "parameters": {
              "description": "Ferramenta para busca de documentos na base de conhecimento da empresa",
              "workflowId": {
                "__rl": true,
                "value": "0UCrEB1iVflqCJG3",
                "mode": "list",
                "cachedResultUrl": "/workflow/0UCrEB1iVflqCJG3",
                "cachedResultName": "subflow qdrant"
              },
              "workflowInputs": {
                "mappingMode": "defineBelow",
                "value": {
                  "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `termo para busca de documentos na base de conhecimento da empresa`, 'string') }}"
                },
                "matchingColumns": [
                  "query"
                ],
                "schema": [
                  {
                    "id": "query",
                    "displayName": "query",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "canBeUsedToMatch": true,
                    "type": "string",
                    "removed": false
                  }
                ],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
            "typeVersion": 2.2,
            "position": [
              1184,
              2784
            ],
            "id": "89ccb881-f39a-429a-b651-7312f5032442",
            "name": "Call 'subflow qdrant'"
          },
          {
            "parameters": {
              "content": "## Deletar documentos da base",
              "height": 304,
              "width": 1024
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              1024,
              2144
            ],
            "id": "6f2011f2-12d3-478e-a5d4-e9974417079e",
            "name": "Sticky Note1"
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "890fcb54-df00-40de-867b-96aed1c6f337",
              "responseMode": "responseNode",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
              1360,
              3392
            ],
            "id": "7c007442-16c4-4a67-b844-0d6722374b03",
            "name": "Webhook",
            "webhookId": "890fcb54-df00-40de-867b-96aed1c6f337"
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $json.body.toJsonString() }}",
              "options": {
                "systemMessage": "# Contexto\nVocê recebe o conteúdo de um slide de power point ou um range de células do Excel e, opcionalmente, uma mensagem da pessoa que o contruiu e conteúdo dos demais slides/abas. Se houver uma mensagem do usuário, faça o que ele pedir, do contrário você deve realizar uma análise crítica:\n\n## Power Point:\n#### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (busque documentos de referência)\n-Fonte homogênea em todas as caixas com texto\n-Erros de português\n-Tamanho da fonte coerente entre os slides\n-Alinhamento de titulo (mesma posição em todos os slides)\n-Uso adequado de slide mestre\n-Slides contém numeração\n-Unidades nos números (coerência interna no slide)\n-Padrão de frases começarem com letra maiúscula OU cada palavra em letra maiúscula\n-Caso o conteúdo dos demais slides seja passado também (i) os utilize para ver se o slide em questão está bem construído e posicionado na apresentação e (ii) indique slides com problemas.\n-Quando uma imagem do slide for enviada junto com a requisição, use-a para avaliar aspectos visuais como layout, alinhamento, uso de cores, hierarquia visual e\n  legibilidade. A imagem é o slide real renderizado.\n## Opcional:\n-O usuário também pode pedir sugestões de slides. Nesse caso busque slides na tool de banco de slides e retorne o link da imagem do slide e o link do sharepoint\n\n## Excel:\n### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (indentifique o conteúdo (técnico e teórico) e busque documentos de referência)\n-Fonte homogênea em todas as células\n-Erros de português\n-Tamanho da fonte coerente\n-Aderência sólida com conceitos contábeis e financeiros\n\n# Diretrizes Gerais\n- Suas respostas devem seguir as diretrizes da Píer Partners, e para isso consulte a base de conhecimento disponível, onde diversos documentos sobre os temas com os quais trabalhamos estão disponíveis.\n- Nossa base de conhecimento possui artigos sobre como lidamos com temas específicos e mais técnicos (padrões de formato para apresentações, modelos em excel, etc). Sempre identifique o tema e tipo de ferramenta que o usuário está usando e busque artigo compatíveis para melhorar seu contexto\n- Se o usuário pedir a revisão nos dados (números de mercado, índices, etc) utilize as ferramenta de busca na web (Google para buscas simples e Perpexity para buscas avançadas).\n- As respostas devem sempre ser referenciadas com indicadores como [1] e [2] e ao final das respostas que usam fontes deve ser inserido uma seção se fontes com o nome e url destes documentos usando hyperlinks.\n- Seja direto, indo direto para a análise, com profundidade mas sendo breve.\n- Sempre retorne sua resposta em formato Markdown.",
                "passthroughBinaryImages": true
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3.1,
            "position": [
              1744,
              3392
            ],
            "id": "6ee2eb1e-a485-4f66-b814-572326392264",
            "name": "AI Agent1"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.2-chat-latest",
                "mode": "list",
                "cachedResultName": "gpt-5.2-chat-latest"
              },
              "builtInTools": {},
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
              1680,
              3568
            ],
            "id": "450474fb-9a8b-4427-bd44-9c9e2aba7267",
            "name": "OpenAI Chat Model1",
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "respondWith": "text",
              "responseBody": "={{ $json.output }}",
              "options": {}
            },
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.5,
            "position": [
              2096,
              3392
            ],
            "id": "9510693a-fa19-40e7-8c3a-f60c2530b74d",
            "name": "Respond to Webhook"
          },
          {
            "parameters": {
              "description": "Ferramenta para busca de documentos na base de conhecimento da empresa. Possui documentos concenituais e técnicos (padrões de execução em power point, excel, modelos etc)",
              "workflowId": {
                "__rl": true,
                "value": "0UCrEB1iVflqCJG3",
                "mode": "list",
                "cachedResultUrl": "/workflow/0UCrEB1iVflqCJG3",
                "cachedResultName": "subflow qdrant"
              },
              "workflowInputs": {
                "mappingMode": "defineBelow",
                "value": {
                  "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `termo para busca de documentos na base de conhecimento da empresa`, 'string') }}"
                },
                "matchingColumns": [
                  "query"
                ],
                "schema": [
                  {
                    "id": "query",
                    "displayName": "query",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "canBeUsedToMatch": true,
                    "type": "string",
                    "removed": false
                  }
                ],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
            "typeVersion": 2.2,
            "position": [
              1760,
              3680
            ],
            "id": "243eb7f8-1ce1-445e-bcc7-e1417cb64f59",
            "name": "Base de conhecimento"
          },
          {
            "parameters": {
              "toolDescription": "Retorna dados de slides a partir de um termo de busca. # Quando questionado sobre sugestões de slides, retorne para o usuário somenete os links das imagens presentes no campo metadata.",
              "method": "POST",
              "url": "https://primary-production-0ad4f.up.railway.app/webhook/92f32531-bd06-4629-9be4-4b64a12a06d9",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "query",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {},
              "optimizeResponse": true
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.2,
            "position": [
              1904,
              3680
            ],
            "id": "0d34283e-fefc-49cd-9195-a6e3aed91df9",
            "name": "Banco de slides"
          },
          {
            "parameters": {
              "toolDescription": "Ferramenta para buscas profundas usando Perplexity.",
              "method": "POST",
              "url": "https://api.perplexity.ai/search",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpHeaderAuth",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "query",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', `termo a ser buscado`, 'string') }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.3,
            "position": [
              2032,
              3680
            ],
            "id": "24b3c82c-9d71-4e8d-af38-787caff62e84",
            "name": "Perplexity",
            "credentials": {
              "httpHeaderAuth": {
                "id": "eCJEWUrc23hz9LHt",
                "name": "Perplexity"
              }
            }
          },
          {
            "parameters": {
              "toolDescription": "Ferramenta de busca básica usando Google.",
              "url": "https://serpapi.com/search",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpQueryAuth",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {
                    "name": "engine",
                    "value": "google"
                  },
                  {
                    "name": "q",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters1_Value', ``, 'string') }}"
                  },
                  {
                    "name": "location",
                    "value": "Rio Grande do Sul, Brazil"
                  },
                  {
                    "name": "google_domain",
                    "value": "google.com.br"
                  },
                  {
                    "name": "gl",
                    "value": "br"
                  },
                  {
                    "name": "hl",
                    "value": "pt-br"
                  },
                  {
                    "name": "device",
                    "value": "desktop"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.3,
            "position": [
              2160,
              3680
            ],
            "id": "668aded9-2f00-40ae-be07-82603b6bee4f",
            "name": "Google",
            "credentials": {
              "httpCustomAuth": {
                "id": "qKnOTJSZTd9nJJET",
                "name": "Omie teste"
              },
              "httpHeaderAuth": {
                "id": "a6xzsEvXe7Ra14j0",
                "name": "Header Auth account 3"
              },
              "httpQueryAuth": {
                "id": "yoOlOAmK1laRLPV3",
                "name": "Google busca"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.manualTrigger",
            "typeVersion": 1,
            "position": [
              -176,
              1424
            ],
            "id": "3b3be0fc-17db-44e5-90b3-7f0ba4e2e2e8",
            "name": "When clicking ‘Execute workflow’"
          },
          {
            "parameters": {
              "resource": "point",
              "operation": "upsertPoints",
              "collectionName": {
                "__rl": true,
                "value": "pier",
                "mode": "list",
                "cachedResultName": "pier"
              },
              "requestOptions": {}
            },
            "id": "9ca80b2f-d349-40ca-8128-a483bf7a85c2",
            "name": "Upsert Points2",
            "type": "n8n-nodes-qdrant.qdrant",
            "position": [
              2512,
              1184
            ],
            "typeVersion": 1,
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "mode": "combine",
              "combineBy": "combineByPosition",
              "options": {}
            },
            "id": "8700aa36-9908-4046-953f-05a0d8723877",
            "name": "Merge3",
            "type": "n8n-nodes-base.merge",
            "position": [
              2192,
              1168
            ],
            "typeVersion": 3.2
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://api.openai.com/v1/embeddings",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "openAiApi",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "input",
                    "value": "={{ $json.content }}"
                  },
                  {
                    "name": "model",
                    "value": "text-embedding-3-large"
                  }
                ]
              },
              "options": {}
            },
            "id": "1b5d7c68-d97a-40ec-bc12-7072e5deec68",
            "name": "Get OpenAI embeddings1",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
              2032,
              992
            ],
            "typeVersion": 4.2,
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "2c902cfe4c0e8047b2c6daa6791da9e2",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              656,
              1168
            ],
            "id": "70002802-e79d-48bc-a803-467ca4ed954c",
            "name": "Get many database pages1",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "block",
              "operation": "getAll",
              "blockId": {
                "__rl": true,
                "value": "={{ $json.url }}",
                "mode": "url"
              },
              "returnAll": true
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1376,
              992
            ],
            "id": "72be92a0-c979-4626-8a8d-508bdabc600f",
            "name": "Get many child blocks1",
            "alwaysOutputData": true,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "let output = [];\n\n// --- PART 1: Process the blocks (Your existing logic) ---\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nconst finalContent = output.join('\\n\\n');\n\n// --- PART 2: Retrieve Metadata safely ---\n// We pull the ID, Name, and URL from the 'Edit Fields2' node \n// that ran immediately before this execution.\nconst metadata = $('Edit Fields2').first().json;\n\n// --- PART 3: Return Combined Data ---\n// We return ONE object containing both the Metadata and the Content.\nreturn [\n  {\n    json: {\n      ...metadata,          // Inherits: id, name, url, property_tema_natureza\n      content: finalContent // Adds: The generated text\n    }\n  }\n];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1552,
              1008
            ],
            "id": "057d3047-80d2-4453-9726-aef60e67cbae",
            "name": "Code in JavaScript1",
            "executeOnce": false
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              848,
              1040
            ],
            "id": "06b15324-9f1f-4049-8882-9f7b4970f7cc",
            "name": "Loop Over Items2"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "ec80d8f5-8a5b-4f7a-be3c-93ed3771f99e",
                    "name": "id",
                    "value": "={{ $('Loop Over Items2').item.json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "5693a142-1555-4384-8df2-12994814d418",
                    "name": "name",
                    "value": "={{ $('Loop Over Items2').item.json.name }}",
                    "type": "string"
                  },
                  {
                    "id": "24d2b57c-48a9-4fc9-ade2-182617591c93",
                    "name": "url",
                    "value": "={{ $('Loop Over Items2').item.json.url }}",
                    "type": "string"
                  },
                  {
                    "id": "6e4da1f8-2690-4166-935a-7d7feb5bc522",
                    "name": "property_tema_natureza",
                    "value": "={{ $('Loop Over Items2').item.json.property_tema_natureza }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              1168,
              1056
            ],
            "id": "137b47df-b6da-47e4-96ca-ba42e51d1500",
            "name": "Edit Fields2"
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "0a00b2a3-f7c9-4015-986a-48a2df958f39",
                    "leftValue": "={{ $json.content }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
              1776,
              1056
            ],
            "id": "b2388a09-427e-4cf8-9df7-95170b235ab8",
            "name": "If2"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {}
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.3,
            "position": [
              432,
              1168
            ],
            "id": "c0049093-fd62-434b-a02f-c7423b5fd4ce",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "content": "## Fluxo principal de atualização",
              "height": 528,
              "width": 2528
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              256,
              912
            ],
            "id": "e6c4f3da-535c-445f-8daa-8f6c7f335292",
            "name": "Sticky Note"
          },
          {
            "parameters": {
              "operation": "createCollection",
              "collectionName": "fdsfdf",
              "shardNumber": {},
              "replicationFactor": {},
              "writeConsistencyFactor": {},
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              2608,
              2432
            ],
            "id": "e5db12af-3b8f-4948-967a-41bf3e6c4ea3",
            "name": "Create Collection",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "resource": "point",
              "operation": "upsertPoints",
              "collectionName": {
                "__rl": true,
                "value": "atas",
                "mode": "list",
                "cachedResultName": "atas"
              },
              "requestOptions": {}
            },
            "id": "00936697-9ec4-4508-8cae-dd7805b4adb4",
            "name": "Upsert Points3",
            "type": "n8n-nodes-qdrant.qdrant",
            "position": [
              2512,
              1792
            ],
            "typeVersion": 1,
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://api.openai.com/v1/embeddings",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "openAiApi",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "input",
                    "value": "={{ $json.content || \"-\" }}"
                  },
                  {
                    "name": "model",
                    "value": "text-embedding-3-large"
                  }
                ]
              },
              "options": {}
            },
            "id": "610a5fa3-0e15-4b1d-b415-4aab164f0b85",
            "name": "Get OpenAI embeddings2",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
              2032,
              1600
            ],
            "typeVersion": 4.2,
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "66a3cfa0e0024323a279d63d19a9c6a9",
                "mode": "id"
              },
              "returnAll": true,
              "filterType": "manual",
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "key": "Projetos|relation",
                    "condition": "is_not_empty"
                  },
                  {
                    "key": "Created time|created_time",
                    "condition": "on_or_after",
                    "createdTimeValue": "2026-01-01T00:00:00"
                  },
                  {
                    "key": "Nome|title",
                    "condition": "is_not_empty"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              656,
              1776
            ],
            "id": "a46c2260-a8c3-4778-b9f8-19c98a560e3d",
            "name": "Get many database pages3",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "block",
              "operation": "getAll",
              "blockId": {
                "__rl": true,
                "value": "={{ $json.url }}",
                "mode": "url"
              },
              "returnAll": true
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1376,
              1600
            ],
            "id": "d6986d0f-f0b9-4576-8bce-03cd228e49b2",
            "name": "Get many child blocks3",
            "alwaysOutputData": true,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "let output = [];\n\n// --- PART 1: Process the blocks (Your existing logic) ---\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nconst finalContent = output.join('\\n\\n');\n\n// --- PART 2: Retrieve Metadata safely ---\n// We pull the ID, Name, and URL from the 'Edit Fields2' node \n// that ran immediately before this execution.\nconst metadata = $('Edit Fields4').first().json;\n\n// --- PART 3: Return Combined Data ---\n// We return ONE object containing both the Metadata and the Content.\nreturn [\n  {\n    json: {\n      ...metadata,          // Inherits: id, name, url, property_tema_natureza\n      content: finalContent // Adds: The generated text\n    }\n  }\n];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1584,
              1600
            ],
            "id": "de875ee1-4d6a-4a35-932d-c5819183ee75",
            "name": "Code in JavaScript3",
            "executeOnce": false
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              848,
              1648
            ],
            "id": "7335bce6-637a-469d-b00a-df2f8af33e2c",
            "name": "Loop Over Items4"
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "ec80d8f5-8a5b-4f7a-be3c-93ed3771f99e",
                    "name": "id",
                    "value": "={{ $('Loop Over Items4').item.json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "5693a142-1555-4384-8df2-12994814d418",
                    "name": "name",
                    "value": "={{ $('Loop Over Items4').item.json.name }}",
                    "type": "string"
                  },
                  {
                    "id": "24d2b57c-48a9-4fc9-ade2-182617591c93",
                    "name": "url",
                    "value": "={{ $('Loop Over Items4').item.json.url }}",
                    "type": "string"
                  },
                  {
                    "id": "26e8544b-2ae2-4f17-8aa4-df325b538d5e",
                    "name": "projeto",
                    "value": "={{ $json.property_projetos[0] }}",
                    "type": "string"
                  },
                  {
                    "id": "f934706e-b35d-4e3f-ab60-b2997c82effa",
                    "name": "data",
                    "value": "={{ $json.property_created_time.slice(0, 10) }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              1168,
              1664
            ],
            "id": "369059fc-c551-4e43-a247-fce80483d6ef",
            "name": "Edit Fields4"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {}
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.3,
            "position": [
              432,
              1776
            ],
            "id": "0f9d04ea-9978-47e8-bc01-f32befc1f7e1",
            "name": "Schedule Trigger2"
          },
          {
            "parameters": {
              "content": "## Atas",
              "height": 528,
              "width": 2528
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              256,
              1520
            ],
            "id": "25cf998e-d4d9-4085-ab46-30ac045d303c",
            "name": "Sticky Note3"
          },
          {
            "parameters": {
              "operation": "deleteCollection",
              "collectionName": {
                "__rl": true,
                "value": "atas",
                "mode": "list",
                "cachedResultName": "atas"
              },
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              2288,
              2304
            ],
            "id": "6aa96a82-d7de-4e2a-b236-42d0f6b36af1",
            "name": "Delete Collection",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "operation": "getCollection",
              "collectionName": {
                "__rl": true,
                "value": "atas",
                "mode": "list",
                "cachedResultName": "atas"
              },
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              2304,
              2560
            ],
            "id": "8eb1d3c8-381d-4b5d-aaed-80b638b625b7",
            "name": "Get Collection",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "resource": "point",
              "operation": "scrollPoints",
              "collectionName": {
                "__rl": true,
                "value": "atas",
                "mode": "list",
                "cachedResultName": "atas"
              },
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              2896,
              2208
            ],
            "id": "af52eea9-6ab3-48c7-9304-e453257dab70",
            "name": "Scroll Points1",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "options": {
                "systemMessage": "# Contexto\nVocê recebe o conteúdo de um slide de power point ou um range de células do Excel e, opcionalmente, uma mensagem da pessoa que o contruiu e conteúdo dos demais slides/abas. Se houver uma mensagem do usuário, faça o que ele pedir, do contrário você deve realizar uma análise crítica:\n\n## Power Point:\n#### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (busque documentos de referência)\n-Fonte homogênea em todas as caixas com texto\n-Erros de português\n-Tamanho da fonte coerente entre os slides\n-Alinhamento de titulo (mesma posição em todos os slides)\n-Uso adequado de slide mestre\n-Slides contém numeração\n-Unidades nos números (coerência interna no slide)\n-Padrão de frases começarem com letra maiúscula OU cada palavra em letra maiúscula\n-Caso o conteúdo dos demais slides seja passado também os utilize para ver se o slide em questão está bem construído e posicionado na apresentação.\n## Opcional:\n-O usuário também pode pedir sugestões de slides. Nesse caso busque slides na tool de banco de slides e retorne o link da imagem do slide e o link do sharepoint\n\n## Excel:\n### Obrigatório\n-Conteúdo aderente às diretrizes da Píer (indentifique o conteúdo (técnico e teórico) e busque documentos de referência)\n-Fonte homogênea em todas as células\n-Erros de português\n-Tamanho da fonte coerente\n-Aderência sólida com conceitos contábeis e financeiros\n\n# Diretrizes Gerais\n- Suas respostas devem seguir as diretrizes da Píer Partners, e para isso consulte a base de conhecimento disponível, onde diversos documentos sobre os temas com os quais trabalhamos estão disponíveis.\n- Se o usuário pedir a revisão nos dados (números de mercado, índices, etc) utilize as ferramenta de busca na web (Google para buscas simples e Perpexity para buscas avançadas).\n- As respostas devem sempre ser referenciadas com indicadores como [1] e [2] e ao final das respostas que usam fontes deve ser inserido uma seção se fontes com o nome e url destes documentos usando hyperlinks.\n- Seja direto, indo direto para a análise, com profundidade mas sendo breve.\n- Sempre retorne sua resposta em formato Markdown."
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3.1,
            "position": [
              3712,
              3936
            ],
            "id": "aae740f9-d1be-4ea9-8e68-9e17962e8b13",
            "name": "AI Agent2"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.2-chat-latest",
                "mode": "list",
                "cachedResultName": "gpt-5.2-chat-latest"
              },
              "builtInTools": {},
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
              3488,
              4160
            ],
            "id": "261a2026-d650-409b-88fc-003293704a11",
            "name": "OpenAI Chat Model2",
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Lista os projetos do Notion",
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "c2af396cc2a347eca452b2b2bf6b9031",
                "mode": "id"
              },
              "returnAll": true,
              "options": {}
            },
            "type": "n8n-nodes-base.notionTool",
            "typeVersion": 2.2,
            "position": [
              4064,
              4160
            ],
            "id": "8a024e46-e765-4d3b-a5e4-b82fa8836bad",
            "name": "Lista projetos",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "operation": "__CUSTOM_API_CALL__",
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              2624,
              2256
            ],
            "id": "6d206cb1-4882-4d44-87bd-8422762a754a",
            "name": "__CUSTOM_API_CALL__ collection",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "url": "https://021f8bc6-6e1c-467e-a41c-6f7c0d6c461d.us-east4-0.gcp.cloud.qdrant.io/collections/atas",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "qdrantRestApi",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {}
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
              2784,
              2784
            ],
            "id": "7c38f8ee-c7e1-4e33-a5b7-3ab70e2de494",
            "name": "HTTP Request",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          },
          {
            "parameters": {
              "contextWindowLength": 10
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              3744,
              4192
            ],
            "id": "2999ff4c-a264-43bc-bf76-440d7cd594ac",
            "name": "Simple Memory1"
          },
          {
            "parameters": {
              "description": "Ferramenta para busca de atas. é necessário informar o id do projeto, que deve ser buscado pela tool de listagem de projetos",
              "workflowId": {
                "__rl": true,
                "value": "uoyG9WwFxe56M0vy",
                "mode": "list",
                "cachedResultUrl": "/workflow/uoyG9WwFxe56M0vy",
                "cachedResultName": "subflow qdrant atas"
              },
              "workflowInputs": {
                "mappingMode": "defineBelow",
                "value": {
                  "query": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('query', `tema da ata para refinar a busca`, 'string') }}",
                  "projeto_id": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('projeto_id', `id do projeto, coletado a partir da ferramenta de listagem de projetos`, 'string') }}"
                },
                "matchingColumns": [
                  "query"
                ],
                "schema": [
                  {
                    "id": "query",
                    "displayName": "query",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "canBeUsedToMatch": true,
                    "type": "string",
                    "removed": false
                  },
                  {
                    "id": "projeto_id",
                    "displayName": "projeto_id",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "canBeUsedToMatch": true,
                    "type": "string",
                    "removed": false
                  }
                ],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              }
            },
            "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
            "typeVersion": 2.2,
            "position": [
              3904,
              4224
            ],
            "id": "3c6f0965-4681-490b-9db1-68fb30d919d1",
            "name": "Busca de atas"
          },
          {
            "parameters": {
              "jsCode": "// Extract and prepare data for translation\nconst input = $input.first().json.body;\n\nconst targetLanguage = input.target_language || 'en';\nconst targetLanguageName = input.target_language_name || 'English';\nconst scope = input.translate_scope || 'current';\nconst contentToTranslate = input.content_to_translate || [];\nconst allSlides = input.slides || [];\n\n// Build context from all slides (for terminology consistency)\nlet contextText = '';\nif (allSlides.length > 0) {\n  contextText = allSlides.map(slide => {\n    const shapes = slide.shapes || [];\n    const texts = shapes.map(s => s.original_text).join('\\n');\n    return `Slide ${slide.slide_number}:\\n${texts}`;\n  }).join('\\n\\n---\\n\\n');\n}\n\n// Build content to translate with shape identifiers\n// Format: [SLIDE X][SHAPE:shape_name] text\nlet translateText = '';\nconst shapeMapping = []; // Keep track of slide/shape mapping for response\n\nfor (const slide of contentToTranslate) {\n  for (const shape of (slide.shapes || [])) {\n    translateText += `[SLIDE ${slide.slide_number}][SHAPE:${shape.shape_name}]\\n${shape.original_text}\\n\\n`;\n    shapeMapping.push({\n      slide_number: slide.slide_number,\n      shape_name: shape.shape_name,\n      original_text: shape.original_text\n    });\n  }\n}\n\nreturn [{\n  json: {\n    targetLanguage,\n    targetLanguageName,\n    scope,\n    contextText,\n    translateText,\n    shapeMapping: JSON.stringify(shapeMapping),\n    slideCount: contentToTranslate.length,\n    shapeCount: shapeMapping.length\n  }\n}];"
            },
            "id": "ca663da8-20e0-459c-b83c-2846677dfccc",
            "name": "Prepare Data",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              3008,
              3568
            ]
          },
          {
            "parameters": {
              "modelId": {
                "__rl": true,
                "value": "gpt-5.2",
                "mode": "list",
                "cachedResultName": "GPT-5.2"
              },
              "messages": {
                "values": [
                  {
                    "content": "=Você é um tradutor profissional especializado em apresentações corporativas. Sua tarefa é traduzir o conteúdo de slides de PowerPoint para {{ $json.targetLanguageName }}.\n\n## Regras CRÍTICAS de formatação:\n1. **PRESERVE TODOS os marcadores de formatação**:\n   - **texto** = negrito (bold)\n   - *texto* = itálico (italic)\n   - __texto__ = sublinhado (underline)\n2. Os marcadores devem permanecer EXATAMENTE nas mesmas posições relativas no texto traduzido\n3. Se o original tem **palavra importante**, a tradução deve ter **palavra traduzida importante**\n\n## Outras regras:\n1. Mantenha bullet points e quebras de linha\n2. Preserve termos técnicos comumente usados em inglês\n3. Mantenha consistência terminológica entre os slides\n4. Adapte expressões idiomáticas naturalmente\n5. Preserve nomes próprios, siglas e acrônimos\n6. Mantenha tom profissional e formal\n7. MUITO IMPORTANTE: Mantenha os marcadores [SLIDE X][SHAPE:nome] exatamente como estão\n\n## Contexto completo da apresentação:\n{{ $json.contextText }}\n\n## Formato de resposta:\n- Para cada shape, mantenha o marcador [SLIDE X][SHAPE:nome] seguido da tradução\n- Não adicione explicações, apenas a tradução\n- PRESERVE **negrito**, *itálico* e __sublinhado__ na tradução",
                    "role": "system"
                  },
                  {
                    "content": "=Traduza o seguinte conteúdo para {{ $json.targetLanguageName }}. Mantenha os marcadores [SLIDE X][SHAPE:nome] intactos:\n\n{{ $json.translateText }}"
                  }
                ]
              },
              "options": {
                "maxTokens": 4096,
                "temperature": 0.3
              }
            },
            "id": "abf693d2-0362-4887-a447-6a806542cb1f",
            "name": "OpenAI Translate",
            "type": "@n8n/n8n-nodes-langchain.openAi",
            "typeVersion": 1.8,
            "position": [
              3232,
              3568
            ],
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "// Parse the translation response and format for PowerPoint application\nconst translationResult = $input.first().json;\nconst preparedData = $('Prepare Data').first().json;\n\n// Get the translated text from OpenAI response\nlet translatedText = '';\nif (translationResult.message && translationResult.message.content) {\n  translatedText = translationResult.message.content;\n} else if (translationResult.text) {\n  translatedText = translationResult.text;\n} else if (typeof translationResult === 'string') {\n  translatedText = translationResult;\n}\n\n// Parse shape-level translations\n// Pattern: [SLIDE X][SHAPE:name]\\ntext\nconst shapePattern = /\\[SLIDE (\\d+)\\]\\[SHAPE:([^\\]]+)\\]\\n([\\s\\S]*?)(?=\\[SLIDE \\d+\\]\\[SHAPE:|$)/g;\nconst translationsBySlide = new Map();\nlet match;\n\nwhile ((match = shapePattern.exec(translatedText)) !== null) {\n  const slideNumber = parseInt(match[1]);\n  const shapeName = match[2];\n  const translatedContent = match[3].trim();\n  \n  if (!translationsBySlide.has(slideNumber)) {\n    translationsBySlide.set(slideNumber, []);\n  }\n  \n  translationsBySlide.get(slideNumber).push({\n    shape_name: shapeName,\n    translated_text: translatedContent\n  });\n}\n\n// Build the response in the format expected by PowerPoint\nconst translations = [];\nfor (const [slideNumber, shapes] of translationsBySlide) {\n  translations.push({\n    slide_number: slideNumber,\n    shapes: shapes\n  });\n}\n\n// Sort by slide number\ntranslations.sort((a, b) => a.slide_number - b.slide_number);\n\n// Build markdown preview\nlet markdown = `# Tradução para ${preparedData.targetLanguageName}\\n\\n`;\nmarkdown += `**Slides traduzidos:** ${translations.length}\\n`;\nmarkdown += `**Shapes traduzidos:** ${translations.reduce((acc, s) => acc + s.shapes.length, 0)}\\n\\n`;\n\nfor (const slide of translations) {\n  markdown += `## Slide ${slide.slide_number}\\n\\n`;\n  for (const shape of slide.shapes) {\n    markdown += `**${shape.shape_name}:**\\n${shape.translated_text}\\n\\n`;\n  }\n  markdown += '---\\n\\n';\n}\n\nreturn [{\n  json: {\n    apply_translations: true,\n    translations: translations,\n    markdown: markdown,\n    target_language: preparedData.targetLanguage,\n    target_language_name: preparedData.targetLanguageName\n  }\n}];"
            },
            "id": "674785aa-4cb7-4d66-b22b-ef86b34cf52b",
            "name": "Format Response",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              3520,
              3568
            ]
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "translate-slides",
              "responseMode": "responseNode",
              "options": {}
            },
            "id": "e50e2d8e-bad0-493a-97b2-ba08e805ad9a",
            "name": "Webhook1",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              2784,
              3568
            ],
            "webhookId": "translate-slides-webhook"
          },
          {
            "parameters": {
              "respondWith": "json",
              "responseBody": "={{ $json }}",
              "options": {
                "responseHeaders": {
                  "entries": [
                    {
                      "name": "Content-Type",
                      "value": "application/json"
                    }
                  ]
                }
              }
            },
            "id": "a4c85361-46bd-4c26-bfc2-09a71bf1166c",
            "name": "Respond to Webhook1",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.1,
            "position": [
              3728,
              3568
            ]
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $json.userMessage }}",
              "options": {
                "systemMessage": "=Você é um assistente especializado em apresentações PowerPoint para a empresa Píer Partners. Você ajuda os usuários a criar, melhorar e analisar seus slides.\n\n  ## Suas capacidades:\n  - Avaliar a clareza e efetividade dos slides\n  - Sugerir melhorias de layout, texto e design\n  - Ajudar a estruturar argumentos e narrativas\n  - Simplificar textos complexos\n  - Criar resumos executivos\n  - Verificar consistência entre slides\n  - Responder perguntas sobre melhores práticas de apresentação\n\n  ## Diretrizes:\n  - Seja conciso e direto nas respostas\n  - Use bullet points quando apropriado\n  - Faça referência específica aos slides quando relevante\n  - Mantenha um tom profissional mas amigável\n  - Se não tiver informação suficiente sobre os slides, peça mais contexto\n\n  ## Capacidade de modificar slides\n\n  Quando o usuário pedir para ALTERAR, MODIFICAR ou AJUSTAR algo no slide, você pode gerar código Office.js que será executado diretamente no PowerPoint.\n\n  ### Como usar:\n  Coloque o código dentro de um bloco ```officejs```. O ambiente de execução já fornece estas variáveis prontas:\n  - `context` — o contexto do PowerPoint.run (já ativo)\n  - `slide` — o slide atual, com shapes já carregados\n  - `getShapeByName(name)` — busca um shape pelo nome exato (lança erro se não encontrar)\n\n  ### APIs disponíveis:\n  - Buscar shape: `const shape = getShapeByName(\"Title 1\")`\n  - Texto: `shape.textFrame.textRange.text = \"novo texto\"`\n  - Cor da fonte: `shape.textFrame.textRange.font.color = \"#FF0000\"`\n  - Tamanho da fonte: `shape.textFrame.textRange.font.size = 24`\n  - Negrito: `shape.textFrame.textRange.font.bold = true`\n  - Itálico: `shape.textFrame.textRange.font.italic = true`\n  - Posição: `shape.left = 100; shape.top = 50`\n  - Tamanho shape: `shape.width = 500; shape.height = 300`\n  - Sincronizar: `await context.sync()`\n\n  ### Regras:\n  - NUNCA inclua PowerPoint.run() no código — o add-in já faz isso\n  - NUNCA use slide.shapes.getItem() — use getShapeByName() que busca pelo nome\n  - SEMPRE use os nomes exatos dos shapes fornecidos no contexto do slide\n  - SEMPRE use await context.sync() após modificar propriedades\n  - Sempre explique o que vai fazer no texto da mensagem ANTES do bloco de código\n  - Se não tiver certeza do nome do shape, pergunte ao usuário\n  - Gere código simples e direto, sem funções auxiliares\n  - A variável `slide` já está disponível — NÃO redefina ela\n\n  ## Contexto da apresentação atual:\n  {{ $json.slideContext }}"
              }
            },
            "id": "ce928c5b-25fd-424b-aa23-7df69a23e517",
            "name": "Agent Config",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.7,
            "position": [
              1856,
              3872
            ]
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "ppt-chat",
              "responseMode": "responseNode",
              "options": {}
            },
            "id": "3a5b4baa-1c2d-4617-9fbc-1b38a447bb3f",
            "name": "Webhook2",
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2,
            "position": [
              1424,
              3872
            ],
            "webhookId": "ppt-chat-webhook"
          },
          {
            "parameters": {
              "jsCode": "  // Extract data from webhook\n  const input = $input.first().json.body;\n\n  const sessionId = input.session_id || 'default';\n  const userMessage = input.message || '';\n  const currentSlide = input.current_slide || {};\n  const includeAllSlides = input.include_all_slides || false;\n  const allSlides = input.slides || [];\n  const slideImage = input.slide_image || null;\n\n  // Build context about the presentation\n  let slideContext = '';\n\n  if (currentSlide.number) {\n    slideContext += `\\n\\nSLIDE ATUAL (${currentSlide.number}):\\n`;\n    if (currentSlide.text && currentSlide.text.length > 0) {\n      slideContext += currentSlide.text.join('\\n');\n    }\n    if (currentSlide.shapes && currentSlide.shapes.length > 0) {\n      slideContext += '\\n\\nElementos do slide:\\n';\n      currentSlide.shapes.forEach(s => {\n        if (s.text) {\n          slideContext += `- \"${s.name}\" (${s.type || 'shape'}): \"${s.text}\"`;\n          if (s.font) {\n            const parts = [];\n            if (s.font.name) parts.push(`fonte: ${s.font.name}`);\n            if (s.font.size) parts.push(`tamanho: ${s.font.size}`);\n            if (s.font.color) parts.push(`cor: ${s.font.color}`);\n            if (s.font.bold) parts.push('negrito');\n            if (s.font.italic) parts.push('itálico');\n            if (parts.length) slideContext += ` [${parts.join(', ')}]`;\n          }\n          slideContext += ` | pos: (${Math.round(s.left)}, ${Math.round(s.top)}) tam: ${Math.round(s.width)}x${Math.round(s.height)}\\n`;\n        }\n      });\n    }\n  }\n\n  if (includeAllSlides && allSlides.length > 0) {\n    slideContext += '\\n\\nTODOS OS SLIDES DA APRESENTAÇÃO:\\n';\n    allSlides.forEach(slide => {\n      slideContext += `\\nSlide ${slide.number}:\\n`;\n      if (slide.text && slide.text.length > 0) {\n        slideContext += slide.text.join('\\n');\n      }\n    });\n  }\n\n  const output = {\n    json: {\n      sessionId,\n      userMessage,\n      slideContext,\n      currentSlideNumber: currentSlide.number || null,\n      has_image: !!slideImage,\n    }\n  };\n\n  // Attach image as binary for vision\n  if (slideImage) {\n    output.binary = {\n      data: {\n        data: slideImage,\n        mimeType: 'image/png',\n        fileName: 'slide.png',\n      }\n    };\n  }\n\n  return [output];"
            },
            "id": "446a89fa-a6d9-4348-a916-b6aacf0585ea",
            "name": "Prepare Data1",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1648,
              3872
            ]
          },
          {
            "parameters": {
              "model": "gpt-5.2-chat-latest",
              "options": {}
            },
            "id": "d077ab81-a536-4557-a138-f08fb0b4c9ac",
            "name": "OpenAI Chat Model3",
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1,
            "position": [
              1744,
              4080
            ],
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "sessionIdType": "customKey",
              "sessionKey": "={{ $json.sessionId }}",
              "contextWindowLength": 10
            },
            "id": "cc347f65-d1fc-4cf6-9086-7de0e65b31f6",
            "name": "Simple Memory2",
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.2,
            "position": [
              1904,
              4080
            ]
          },
          {
            "parameters": {
              "jsCode": "// Format the agent response\n  const agentOutput = $input.first().json;\n\n  let responseMessage = '';\n\n  if (agentOutput.output) {\n    responseMessage = agentOutput.output;\n  } else if (agentOutput.text) {\n    responseMessage = agentOutput.text;\n  } else if (typeof agentOutput === 'string') {\n    responseMessage = agentOutput;\n  } else {\n    responseMessage = JSON.stringify(agentOutput);\n  }\n\n  // Extrair bloco ```officejs ... ```\n  const codeMatch = responseMessage.match(/```officejs\\s*\\n([\\s\\S]*?)```/);\n  let code = null;\n  if (codeMatch) {\n    code = codeMatch[1].trim();\n    responseMessage = responseMessage.replace(/```officejs\\s*\\n[\\s\\S]*?```/, '').trim();\n  }\n\n  return [{\n    json: {\n      message: responseMessage,\n      ...(code ? { code } : {})\n    }\n  }];"
            },
            "id": "bde1af10-a49c-43f4-9d12-2ccf2ce4f8c6",
            "name": "Format Response1",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              2176,
              3872
            ]
          },
          {
            "parameters": {
              "respondWith": "json",
              "responseBody": "={{ $json }}",
              "options": {
                "responseHeaders": {
                  "entries": [
                    {
                      "name": "Content-Type",
                      "value": "application/json"
                    }
                  ]
                }
              }
            },
            "id": "e657fe07-2d45-4e3a-b18d-5a940ebcfb27",
            "name": "Respond to Webhook2",
            "type": "n8n-nodes-base.respondToWebhook",
            "typeVersion": 1.1,
            "position": [
              2368,
              3872
            ]
          },
          {
            "parameters": {
              "jsCode": "  const body = $input.first().json.body;                                                                                                                                      \n  const slideImage = body.slide_image || null;\n\n  // Build clean body without the image blob\n  const cleanBody = { ...body };\n  delete cleanBody.slide_image;\n\n  const output = {\n    json: {\n      body: cleanBody,\n      has_image: !!slideImage,\n    }\n  };\n\n  // Attach image as binary so the AI Agent can send it as vision input\n  if (slideImage) {\n    output.binary = {\n      data: {\n        data: slideImage,\n        mimeType: 'image/png',\n        fileName: 'slide.png',\n      }\n    };\n  }\n\n  return [output];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1552,
              3392
            ],
            "id": "2dcf0e28-cdcf-4cfe-a351-1ef1d68612a7",
            "name": "Code in JavaScript2"
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "={{ $json.userMessage }}",
              "options": {
                "systemMessage": "=Você é um assistente especializado em apresentações PowerPoint para a empresa Píer Partners. Você ajuda os usuários a criar, melhorar e analisar seus slides.\n\n## Suas capacidades:\n- Avaliar a clareza e efetividade dos slides\n- Sugerir melhorias de layout, texto e design\n- Ajudar a estruturar argumentos e narrativas\n- Simplificar textos complexos\n- Criar resumos executivos\n- Verificar consistência entre slides\n- Responder perguntas sobre melhores práticas de apresentação\n\n## Diretrizes:\n- Seja conciso e direto nas respostas\n- Use bullet points quando apropriado\n- Faça referência específica aos slides quando relevante\n- Mantenha um tom profissional mas amigável\n- Se não tiver informação suficiente sobre os slides, peça mais contexto\n\n## Contexto da apresentação atual:\n{{ $json.slideContext }}"
              }
            },
            "id": "7416da7f-9811-4677-9358-d72af10a82cd",
            "name": "Agent Config1",
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 1.7,
            "position": [
              1904,
              4384
            ]
          },
          {
            "parameters": {
              "jsCode": "// Extract data from webhook                                                                                                                  \n  const input = $input.first().json.body;\n                                                                                                                                                \n  const sessionId = input.session_id || 'default';                                 \n  const userMessage = input.message || '';\n  const currentSlide = input.current_slide || {};\n  const includeAllSlides = input.include_all_slides || false;\n  const allSlides = input.slides || [];\n  const slideImage = input.slide_image || null;\n\n  // Build context about the presentation\n  let slideContext = '';\n\n  if (currentSlide.number) {\n    slideContext += `\\n\\nSLIDE ATUAL (${currentSlide.number}):\\n`;\n    if (currentSlide.text && currentSlide.text.length > 0) {\n      slideContext += currentSlide.text.join('\\n');\n    }\n    if (currentSlide.shapes && currentSlide.shapes.length > 0) {\n      slideContext += '\\n\\nElementos do slide:\\n';\n      currentSlide.shapes.forEach(s => {\n        if (s.text) slideContext += `- ${s.name}: ${s.text}\\n`;\n      });\n    }\n  }\n\n  if (includeAllSlides && allSlides.length > 0) {\n    slideContext += '\\n\\nTODOS OS SLIDES DA APRESENTAÇÃO:\\n';\n    allSlides.forEach(slide => {\n      slideContext += `\\nSlide ${slide.number}:\\n`;\n      if (slide.text && slide.text.length > 0) {\n        slideContext += slide.text.join('\\n');\n      }\n    });\n  }\n\n  const output = {\n    json: {\n      sessionId,\n      userMessage,\n      slideContext,\n      currentSlideNumber: currentSlide.number || null,\n      has_image: !!slideImage,\n    }\n  };\n\n  // Attach image as binary for vision\n  if (slideImage) {\n    output.binary = {\n      data: {\n        data: slideImage,\n        mimeType: 'image/png',\n        fileName: 'slide.png',\n      }\n    };\n  }\n\n  return [output];"
            },
            "id": "b8002d76-3371-47ea-b15f-24351eb0521d",
            "name": "Prepare Data2",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              1696,
              4384
            ]
          },
          {
            "parameters": {
              "model": "gpt-5.2-chat-latest",
              "options": {}
            },
            "id": "5aa35815-b362-492b-ab3e-1127af7e433e",
            "name": "OpenAI Chat Model4",
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1,
            "position": [
              1872,
              4592
            ],
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "sessionIdType": "customKey",
              "sessionKey": "={{ $json.sessionId }}",
              "contextWindowLength": 10
            },
            "id": "f62a973c-702e-46a0-bb5d-222403754f2e",
            "name": "Simple Memory3",
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.2,
            "position": [
              2032,
              4592
            ]
          },
          {
            "parameters": {
              "jsCode": "// Format the agent response\nconst agentOutput = $input.first().json;\n\nlet responseMessage = '';\n\nif (agentOutput.output) {\n  responseMessage = agentOutput.output;\n} else if (agentOutput.text) {\n  responseMessage = agentOutput.text;\n} else if (typeof agentOutput === 'string') {\n  responseMessage = agentOutput;\n} else {\n  responseMessage = JSON.stringify(agentOutput);\n}\n\nreturn [{\n  json: {\n    message: responseMessage\n  }\n}];"
            },
            "id": "b1c67a34-5f5b-475e-9806-9f76484292f5",
            "name": "Format Response2",
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              2224,
              4384
            ]
          }
        ],
        "connections": {
          "When chat message received": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many database pages": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many child blocks": {
            "main": [
              [
                {
                  "node": "Code in JavaScript",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items": {
            "main": [
              [],
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Get many child blocks",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Qdrant Vector Store1": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Embeddings OpenAI": {
            "ai_embedding": [
              [
                {
                  "node": "Qdrant Vector Store1",
                  "type": "ai_embedding",
                  "index": 0
                }
              ]
            ]
          },
          "Default Data Loader": {
            "ai_document": [
              [
                {
                  "node": "Qdrant Vector Store1",
                  "type": "ai_document",
                  "index": 0
                }
              ]
            ]
          },
          "Token Splitter": {
            "ai_textSplitter": [
              [
                {
                  "node": "Default Data Loader",
                  "type": "ai_textSplitter",
                  "index": 0
                }
              ]
            ]
          },
          "Delete Points": {
            "main": [
              [
                {
                  "node": "Loop Over Items1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Scroll Points": {
            "main": [
              [
                {
                  "node": "Split Out",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items1": {
            "main": [
              [],
              [
                {
                  "node": "Delete Points",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Split Out": {
            "main": [
              [
                {
                  "node": "Loop Over Items1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "Qdrant Vector Store1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Call 'subflow qdrant'": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model1": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent1",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Webhook": {
            "main": [
              [
                {
                  "node": "Code in JavaScript2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent1": {
            "main": [
              [
                {
                  "node": "Respond to Webhook",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Base de conhecimento": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent1",
                  "type": "ai_tool",
                  "index": 0
                },
                {
                  "node": "Agent Config",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Banco de slides": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent1",
                  "type": "ai_tool",
                  "index": 0
                },
                {
                  "node": "Agent Config",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Perplexity": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent1",
                  "type": "ai_tool",
                  "index": 0
                },
                {
                  "node": "Agent Config",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Google": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent1",
                  "type": "ai_tool",
                  "index": 0
                },
                {
                  "node": "Agent Config",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "When clicking ‘Execute workflow’": {
            "main": [
              []
            ]
          },
          "Upsert Points2": {
            "main": [
              [
                {
                  "node": "Loop Over Items2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Merge3": {
            "main": [
              [
                {
                  "node": "Upsert Points2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get OpenAI embeddings1": {
            "main": [
              [
                {
                  "node": "Merge3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many database pages1": {
            "main": [
              [
                {
                  "node": "Loop Over Items2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many child blocks1": {
            "main": [
              [
                {
                  "node": "Code in JavaScript1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript1": {
            "main": [
              [
                {
                  "node": "If2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items2": {
            "main": [
              [],
              [
                {
                  "node": "Edit Fields2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields2": {
            "main": [
              [
                {
                  "node": "Get many child blocks1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "If2": {
            "main": [
              [
                {
                  "node": "Loop Over Items2",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Get OpenAI embeddings1",
                  "type": "main",
                  "index": 0
                },
                {
                  "node": "Merge3",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "Get many database pages1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Upsert Points3": {
            "main": [
              [
                {
                  "node": "Loop Over Items4",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get OpenAI embeddings2": {
            "main": [
              [
                {
                  "node": "Upsert Points3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many database pages3": {
            "main": [
              [
                {
                  "node": "Loop Over Items4",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many child blocks3": {
            "main": [
              [
                {
                  "node": "Code in JavaScript3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript3": {
            "main": [
              [
                {
                  "node": "Get OpenAI embeddings2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items4": {
            "main": [
              [],
              [
                {
                  "node": "Edit Fields4",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields4": {
            "main": [
              [
                {
                  "node": "Get many child blocks3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger2": {
            "main": [
              [
                {
                  "node": "Get many database pages3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent2": {
            "main": [
              []
            ]
          },
          "OpenAI Chat Model2": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent2",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Lista projetos": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent2",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory1": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent2",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Busca de atas": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent2",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Prepare Data": {
            "main": [
              [
                {
                  "node": "OpenAI Translate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Translate": {
            "main": [
              [
                {
                  "node": "Format Response",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Format Response": {
            "main": [
              [
                {
                  "node": "Respond to Webhook1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Webhook1": {
            "main": [
              [
                {
                  "node": "Prepare Data",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Agent Config": {
            "main": [
              [
                {
                  "node": "Format Response1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Webhook2": {
            "main": [
              [
                {
                  "node": "Prepare Data1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Prepare Data1": {
            "main": [
              [
                {
                  "node": "Agent Config",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model3": {
            "ai_languageModel": [
              [
                {
                  "node": "Agent Config",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory2": {
            "ai_memory": [
              [
                {
                  "node": "Agent Config",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Format Response1": {
            "main": [
              [
                {
                  "node": "Respond to Webhook2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript2": {
            "main": [
              [
                {
                  "node": "AI Agent1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Agent Config1": {
            "main": [
              [
                {
                  "node": "Format Response2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Prepare Data2": {
            "main": [
              [
                {
                  "node": "Agent Config1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model4": {
            "ai_languageModel": [
              [
                {
                  "node": "Agent Config1",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory3": {
            "ai_memory": [
              [
                {
                  "node": "Agent Config1",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Format Response2": {
            "main": [
              []
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version ab3adb56",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-02-13T01:59:27.224Z",
            "id": 346,
            "workflowId": "gKNGnV5aOelesPEn",
            "versionId": "ab3adb56-b4d0-4470-8b2b-42b6ec89cac2",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-22T21:13:36.480Z",
      "createdAt": "2026-01-06T20:55:08.071Z",
      "id": "0UCrEB1iVflqCJG3",
      "name": "subflow qdrant",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "query"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            144,
            2208
          ],
          "id": "f489625d-e8db-4e5b-846e-9fdbff344736",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.openai.com/v1/embeddings",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "openAiApi",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "input",
                  "value": "=como faler um modelo de m&a"
                },
                {
                  "name": "model",
                  "value": "text-embedding-3-large"
                }
              ]
            },
            "options": {}
          },
          "id": "fd03af17-4972-4f31-b35d-5f1f1af01e83",
          "name": "Get OpenAI embeddings2",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            368,
            2208
          ],
          "typeVersion": 4.2,
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "resource": "search",
            "operation": "queryPoints",
            "collectionName": {
              "__rl": true,
              "value": "pier",
              "mode": "list",
              "cachedResultName": "pier"
            },
            "query": "={{ $json.data[0].embedding.toJsonString() }}",
            "using": "open_ai_large",
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            592,
            2208
          ],
          "id": "ed9d93da-6874-4645-816f-96ba35e3d257",
          "name": "Query Points",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        }
      ],
      "connections": {
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Get OpenAI embeddings2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get OpenAI embeddings2": {
          "main": [
            [
              {
                "node": "Query Points",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "When Executed by Another Workflow": [
          {
            "json": {
              "query": "diretrizes apresentação PowerPoint Píer Partners"
            }
          }
        ]
      },
      "versionId": "1d373284-c146-4089-bf29-73442844cf8d",
      "activeVersionId": "1d373284-c146-4089-bf29-73442844cf8d",
      "versionCounter": 63,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2026-01-06T20:55:08.071Z",
          "createdAt": "2026-01-06T20:55:08.071Z",
          "role": "workflow:owner",
          "workflowId": "0UCrEB1iVflqCJG3",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:01.637Z",
          "createdAt": "2026-01-11T18:30:01.637Z",
          "id": "qgFYYFG154gb0OYi",
          "name": "knowledge-base"
        }
      ],
      "activeVersion": {
        "updatedAt": "2026-01-22T21:13:42.843Z",
        "createdAt": "2026-01-22T21:13:36.486Z",
        "versionId": "1d373284-c146-4089-bf29-73442844cf8d",
        "workflowId": "0UCrEB1iVflqCJG3",
        "nodes": [
          {
            "parameters": {
              "workflowInputs": {
                "values": [
                  {
                    "name": "query"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.executeWorkflowTrigger",
            "typeVersion": 1.1,
            "position": [
              144,
              2208
            ],
            "id": "f489625d-e8db-4e5b-846e-9fdbff344736",
            "name": "When Executed by Another Workflow"
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://api.openai.com/v1/embeddings",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "openAiApi",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "input",
                    "value": "=como faler um modelo de m&a"
                  },
                  {
                    "name": "model",
                    "value": "text-embedding-3-large"
                  }
                ]
              },
              "options": {}
            },
            "id": "fd03af17-4972-4f31-b35d-5f1f1af01e83",
            "name": "Get OpenAI embeddings2",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
              368,
              2208
            ],
            "typeVersion": 4.2,
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "resource": "search",
              "operation": "queryPoints",
              "collectionName": {
                "__rl": true,
                "value": "pier",
                "mode": "list",
                "cachedResultName": "pier"
              },
              "query": "={{ $json.data[0].embedding.toJsonString() }}",
              "using": "open_ai_large",
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              592,
              2208
            ],
            "id": "ed9d93da-6874-4645-816f-96ba35e3d257",
            "name": "Query Points",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          }
        ],
        "connections": {
          "When Executed by Another Workflow": {
            "main": [
              [
                {
                  "node": "Get OpenAI embeddings2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get OpenAI embeddings2": {
            "main": [
              [
                {
                  "node": "Query Points",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 1d373284",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-22T21:13:42.837Z",
            "id": 157,
            "workflowId": "0UCrEB1iVflqCJG3",
            "versionId": "1d373284-c146-4089-bf29-73442844cf8d",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-02-03T22:56:06.516Z",
      "createdAt": "2026-01-11T13:41:07.747Z",
      "id": "yKpQ3wX35Ci0A4NW",
      "name": "Leadsx",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "tableId": "leads_emails",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "email_id",
                  "fieldValue": "={{ $('Get a message').item.json.id }}"
                },
                {
                  "fieldId": "sender",
                  "fieldValue": "={{ $('Get a message').item.json.sender.emailAddress.address }}"
                },
                {
                  "fieldId": "body",
                  "fieldValue": "={{ $('Get a message').item.json.body.content }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3504,
            1216
          ],
          "id": "4b14f31a-068d-40c3-9e54-611c266e3388",
          "name": "Create a row",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "tableId": "leads_emails",
            "filters": {
              "conditions": [
                {
                  "keyName": "email_id",
                  "keyValue": "={{ $json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            2832,
            1312
          ],
          "id": "2baf60bb-bf27-4e51-b32e-21b4c78c03d0",
          "name": "Get a row",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "5c21e2aa-919c-4008-bc91-fb8da241c60d",
                  "leftValue": "={{ $json.email_id }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            2976,
            1312
          ],
          "id": "c3051bdf-59a3-430d-b1a8-6f882e48e75d",
          "name": "If"
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "leads_emails",
            "filters": {
              "conditions": [
                {
                  "keyName": "email_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Get a message').item.json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3312,
            1216
          ],
          "id": "26e387bf-f8be-4249-a0e9-d494649e1b74",
          "name": "Delete a row",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "operation": "delete",
            "tableId": "leads",
            "filters": {
              "conditions": [
                {
                  "keyName": "email_id",
                  "condition": "eq",
                  "keyValue": "={{ $('Get a message').item.json.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3152,
            1216
          ],
          "id": "6fdd8ee4-718d-421f-bdc4-518dfa92e282",
          "name": "Delete a row1",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "fieldToSplitOut": "output.leads",
            "include": "allOtherFields",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            4736,
            1344
          ],
          "id": "c5ff084f-ca65-4a51-a964-6b1b1974e366",
          "name": "Split Out"
        },
        {
          "parameters": {
            "tableId": "leads",
            "dataToSend": "autoMapInputData"
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            5104,
            1344
          ],
          "id": "a873c16a-97ad-4a82-a7fd-f7575c31e8f3",
          "name": "Create a row1",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "5ddb43fa-04ba-4f67-a343-86b00883b57f",
                  "name": "email_id",
                  "value": "={{ $('Get a message').item.json.id }}",
                  "type": "string"
                },
                {
                  "id": "6317e211-a930-4a75-b263-12229abbc9f9",
                  "name": "email",
                  "value": "={{ $json['output.leads'].email }}",
                  "type": "string"
                },
                {
                  "id": "be6c3098-ab2d-493c-a7a7-684046beff9b",
                  "name": "first_name",
                  "value": "={{ $json['output.leads'].first_name }}",
                  "type": "string"
                },
                {
                  "id": "40b3c296-5383-4a6f-9330-60df37512ef9",
                  "name": "last_name",
                  "value": "={{ $json['output.leads'].last_name }}",
                  "type": "string"
                },
                {
                  "id": "c6c61903-e98c-4417-aa53-100dd777c0e5",
                  "name": "linkedin",
                  "value": "={{ $json['output.leads'].linkedin }}",
                  "type": "string"
                },
                {
                  "id": "9c88a05e-72b8-48f9-a566-08d07058dc09",
                  "name": "city",
                  "value": "={{ $json['output.leads'].city }}",
                  "type": "string"
                },
                {
                  "id": "947f1604-2ad3-4523-b803-04000ed304d2",
                  "name": "current_position",
                  "value": "={{ $json['output.leads'].current_position }}",
                  "type": "string"
                },
                {
                  "id": "05f70397-0ef0-40b8-aa66-b962079d1a88",
                  "name": "company",
                  "value": "={{ $json['output.leads'].company }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            4896,
            1344
          ],
          "id": "992fafe9-d4fb-4d3a-a266-b1593d71b4f2",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "databaseId": {
              "__rl": true,
              "value": "2e402cfe4c0e801692c7cdab48c0c241",
              "mode": "id"
            },
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "Email|email",
                  "emailValue": "={{ $('Edit Fields').item.json.email }}"
                },
                {
                  "key": "Nome|title",
                  "title": "={{ $('Edit Fields').item.json.first_name }}"
                },
                {
                  "key": "Sobrenome|rich_text",
                  "textContent": "={{ $('Edit Fields').item.json.last_name }}"
                },
                {
                  "key": "Posição|rich_text",
                  "textContent": "={{ $('Edit Fields').item.json.current_position }}"
                },
                {
                  "key": "Empresa|rich_text",
                  "textContent": "={{ $('Edit Fields').item.json.company }}"
                },
                {
                  "key": "Linkedin|rich_text",
                  "textContent": "={{ $('Edit Fields').item.json.linkedin }}"
                },
                {
                  "key": "Contato Pier|rich_text",
                  "textContent": "={{ $('Get a message').item.json.sender.emailAddress.address }}"
                },
                {
                  "key": "Cidade|rich_text",
                  "textContent": "={{ $('Edit Fields').item.json.city }}"
                },
                {
                  "key": "Email ID|rich_text",
                  "textContent": "={{ $('Get a message').item.json.id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            5312,
            1344
          ],
          "id": "a0b1ffda-ee91-4130-813e-b9063bf1720a",
          "name": "Create a database page",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            2224,
            1312
          ],
          "id": "1992548b-bf41-4be4-ad8f-7f38e4ee4ec9",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {}
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            5520,
            1344
          ],
          "id": "8e41648b-6658-4a8d-9b95-3e86f9c6eb47",
          "name": "Aggregate"
        },
        {
          "parameters": {
            "tableId": "leads_emails",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "email_id",
                  "fieldValue": "={{ $('Get a message').item.json.id }}"
                },
                {
                  "fieldId": "sender",
                  "fieldValue": "={{ $('Get a message').item.json.sender.emailAddress.address }}"
                },
                {
                  "fieldId": "body",
                  "fieldValue": "={{ $('Get a message').item.json.body.content }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            3504,
            1408
          ],
          "id": "ea23ce6c-8e49-4ccf-b196-346eda46d666",
          "name": "Create a row2",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.merge",
          "typeVersion": 3.2,
          "position": [
            3680,
            1312
          ],
          "id": "919d07e3-bd64-4f10-9ca5-486efbe27b11",
          "name": "Merge"
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=sender email:  {{ $('Get a message').item.json.sender.emailAddress.address }}\nsender name: {{ $('Get a message').item.json.sender.emailAddress.name }}\nbody:\n{{ $json.body }}",
            "options": {
              "systemMessage": "Extract email information from this email body. Include all emails exept those from @pierpartners.com.br (our company). Also consider the sender (in case he is not from pier).\n\nRules:\n\n1. Split full names into first_name and last_name.\n2. If a person only has one name (e.g., 'Douglas'), set last_name to 'NA'.\n3. When possible, infer first and last name from the email\n4. Use the available tool to get current position, linkedin and city. Also return NA if not found\n\nReturn a json exactly in the following format:\n\n{\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"properties\": {\n    \"leads\": {\n      \"type\": \"array\",\n      \"description\": \"The list of extracted people.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"first_name\": {\n            \"type\": \"string\",\n            \"description\": \"The first name.\"\n          },\n          \"last_name\": {\n            \"type\": \"string\",\n            \"description\": \"The family name. If missing, use 'NA'.\"\n          },\n          \"email\": {\n            \"type\": \"string\",\n            \"description\": \"The email address.\"\n          },\n          \"company\": {\n            \"type\": \"string\",\n            \"description\": \"The company of the person. If missing or unsure, use 'NA'\"\n          },\n          \"city\": {\n            \"type\": \"string\"\n          },\n          \"current_position\": {\n            \"type\": \"string\"\n          },\n          \"linkedin\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\n          \"first_name\",\n          \"last_name\",\n          \"company\",\n          \"email\",\n          \"city\",\n          \"current_position\",\n          \"linkedin\"\n        ]\n      }\n    }\n  },\n  \"required\": [\n    \"leads\"\n  ]\n}"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3.1,
          "position": [
            4016,
            1328
          ],
          "id": "3552d09d-d46f-47ea-966d-c1196fecde79",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2",
              "mode": "list",
              "cachedResultName": "gpt-5.2"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            3984,
            1584
          ],
          "id": "83509c6f-372e-49cc-8c51-f72ae4a5830e",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "minutes",
                  "minutesInterval": 2
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.3,
          "position": [
            1776,
            1312
          ],
          "id": "f1180fbd-f7d2-43c6-b965-ed4f4061c02d",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "text": "={{ $json.output }}",
            "schemaType": "manual",
            "inputSchema": "{\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"properties\": {\n    \"leads\": {\n      \"type\": \"array\",\n      \"description\": \"The list of extracted people.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"first_name\": {\n            \"type\": \"string\",\n            \"description\": \"The first name.\"\n          },\n          \"last_name\": {\n            \"type\": \"string\",\n            \"description\": \"The family name. If missing, use 'NA'.\"\n          },\n          \"email\": {\n            \"type\": \"string\",\n            \"description\": \"The email address.\"\n          },\n          \"company\": {\n            \"type\": \"string\",\n            \"description\": \"The company of the person. If missing or unsure, use 'NA'\"\n          },\n          \"city\": {\n            \"type\": \"string\"\n          },\n          \"current_position\": {\n            \"type\": \"string\"\n          },\n          \"linkedin\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\n          \"first_name\",\n          \"last_name\",\n          \"company\",\n          \"email\",\n          \"city\",\n          \"current_position\",\n          \"linkedin\"\n        ]\n      }\n    }\n  },\n  \"required\": [\n    \"leads\"\n  ]\n}",
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.informationExtractor",
          "typeVersion": 1.2,
          "position": [
            4384,
            1344
          ],
          "id": "d83f597c-bfbf-4d2c-b229-2d1a142f3366",
          "name": "Information Extractor"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2",
              "mode": "list",
              "cachedResultName": "gpt-5.2"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            4368,
            1520
          ],
          "id": "5d63c91c-40a6-4c5f-ba11-c9ace7fd5485",
          "name": "OpenAI Chat Model1",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "operation": "get",
            "messageId": {
              "__rl": true,
              "value": "={{ $json.id }}",
              "mode": "id"
            },
            "output": "fields",
            "fields": [
              "body",
              "sender"
            ],
            "options": {}
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            2448,
            1312
          ],
          "id": "039fe58b-c96c-452a-aae8-e930a7ef11ed",
          "name": "Get a message",
          "webhookId": "ba553e29-b3a0-4a54-a2fc-78f39a891d70",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "pkc2Wwsx7H0ROl5A",
              "name": "Leads"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Enriches a person data based on its emails. Can get company, linkedin, city and current position",
            "method": "POST",
            "url": "https://api.apollo.io/api/v1/people/match",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "reveal_personal_emails",
                  "value": "false"
                },
                {
                  "name": "reveal_phone_number",
                  "value": "false"
                },
                {
                  "name": "email",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', `The person's email`, 'string') }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Cache-Control",
                  "value": "no-cache"
                },
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.3,
          "position": [
            4160,
            1600
          ],
          "id": "045981e3-98d0-4817-a69e-76d2995b49d4",
          "name": "Enrich person data",
          "credentials": {
            "httpBearerAuth": {
              "id": "ltYB1nYeZMvbLyF6",
              "name": "Apollo"
            },
            "httpHeaderAuth": {
              "id": "O2BHqQyciOyYnqKY",
              "name": "Apollo"
            }
          }
        },
        {
          "parameters": {
            "operation": "getAll",
            "returnAll": true,
            "filtersUI": {
              "values": {
                "filters": {
                  "readStatus": "unread"
                }
              }
            },
            "options": {}
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            1984,
            1312
          ],
          "id": "9784fae8-c9f1-4928-b021-083b266ada7a",
          "name": "Get many messages",
          "webhookId": "5d574cd9-06eb-4046-9af9-823153dd8f20",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "pkc2Wwsx7H0ROl5A",
              "name": "Leads"
            }
          }
        },
        {
          "parameters": {
            "operation": "update",
            "messageId": {
              "__rl": true,
              "value": "={{ $('Loop Over Items').item.json.id }}",
              "mode": "id"
            },
            "updateFields": {
              "isRead": true
            }
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            2640,
            1312
          ],
          "id": "efe45cb6-1480-41a3-a218-e23fd7c19a03",
          "name": "Update a message1",
          "webhookId": "b4f45d1a-cd10-4893-b6f2-e540d9ae9dcd",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "pkc2Wwsx7H0ROl5A",
              "name": "Leads"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Enriches a person data based on its emails. Can get company, linkedin, city and current position",
            "method": "POST",
            "url": "https://api.apollo.io/api/v1/people/match",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "reveal_personal_emails",
                  "value": "false"
                },
                {
                  "name": "reveal_phone_number",
                  "value": "false"
                },
                {
                  "name": "email",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', `The person's email`, 'string') }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Cache-Control",
                  "value": "no-cache"
                },
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.3,
          "position": [
            3072,
            1904
          ],
          "id": "aed79806-2489-4c3d-97b5-e72921317714",
          "name": "Enrich person data1",
          "credentials": {
            "httpBearerAuth": {
              "id": "ltYB1nYeZMvbLyF6",
              "name": "Apollo"
            },
            "httpHeaderAuth": {
              "id": "O2BHqQyciOyYnqKY",
              "name": "Apollo"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.apollo.io/api/v1/mixed_companies/search",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "q_organization_name",
                  "value": "Tecnova Energia"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Cache-Control",
                  "value": "no-cache"
                },
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3344,
            1792
          ],
          "id": "1b6e1661-7f97-4ab4-9a5b-988b09e3c36f",
          "name": "HTTP Request",
          "credentials": {
            "httpHeaderAuth": {
              "id": "O2BHqQyciOyYnqKY",
              "name": "Apollo"
            }
          }
        },
        {
          "parameters": {
            "url": "=https://api.apollo.io/api/v1/organizations/{{ $json.organizations[0].id }}",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Cache-Control",
                  "value": "no-cache"
                },
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3632,
            1792
          ],
          "id": "7f12cf6f-dafa-4c3d-bacd-9f127ee32fa0",
          "name": "HTTP Request1",
          "credentials": {
            "httpHeaderAuth": {
              "id": "O2BHqQyciOyYnqKY",
              "name": "Apollo"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.apollo.io/api/v1/mixed_people/api_search",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "organization_ids[]",
                  "value": "={{ $('HTTP Request').item.json.organizations[0].id }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Cache-Control",
                  "value": "no-cache"
                },
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {}
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3856,
            1792
          ],
          "id": "debf378d-7fdd-45dc-9f65-9f9daa3172c6",
          "name": "HTTP Request2",
          "credentials": {
            "httpHeaderAuth": {
              "id": "O2BHqQyciOyYnqKY",
              "name": "Apollo"
            }
          }
        },
        {
          "parameters": {
            "url": "=https://api.apollo.io/api/v1/people/match",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "id",
                  "value": "5e70fd9afa9c8200018718b4"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Cache-Control",
                  "value": "no-cache"
                },
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            3760,
            2032
          ],
          "id": "36072ef3-ca65-4756-a5f3-671d911bc3fc",
          "name": "HTTP Request3",
          "credentials": {
            "httpHeaderAuth": {
              "id": "O2BHqQyciOyYnqKY",
              "name": "Apollo"
            }
          }
        },
        {
          "parameters": {
            "promptType": "define",
            "text": "=sender email:  {{ $('Get a message').item.json.sender.emailAddress.address }}\nsender name: {{ $('Get a message').item.json.sender.emailAddress.name }}\nbody:\n{{ $json.body }}",
            "options": {
              "systemMessage": "Extract email information from this email body. Include all emails exept those from @pierpartners.com.br (our company). Also consider the sender (in case he is not from pier).\n\nRules:\n\n1. Split full names into first_name and last_name.\n2. If a person only has one name (e.g., 'Douglas'), set last_name to 'NA'.\n3. When possible, infer first and last name from the email\n4. Use the available tool to get current position, linkedin and city. Also return NA if not found\n\nReturn a json exactly in the following format:\n\n{\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"properties\": {\n    \"leads\": {\n      \"type\": \"array\",\n      \"description\": \"The list of extracted people.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"first_name\": {\n            \"type\": \"string\",\n            \"description\": \"The first name.\"\n          },\n          \"last_name\": {\n            \"type\": \"string\",\n            \"description\": \"The family name. If missing, use 'NA'.\"\n          },\n          \"email\": {\n            \"type\": \"string\",\n            \"description\": \"The email address.\"\n          },\n          \"company\": {\n            \"type\": \"string\",\n            \"description\": \"The company of the person. If missing or unsure, use 'NA'\"\n          },\n          \"city\": {\n            \"type\": \"string\"\n          },\n          \"current_position\": {\n            \"type\": \"string\"\n          },\n          \"linkedin\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\n          \"first_name\",\n          \"last_name\",\n          \"company\",\n          \"email\",\n          \"city\",\n          \"current_position\",\n          \"linkedin\"\n        ]\n      }\n    }\n  },\n  \"required\": [\n    \"leads\"\n  ]\n}"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3.1,
          "position": [
            4384,
            1968
          ],
          "id": "779b49c7-3fef-42eb-91c7-25bc235d9720",
          "name": "AI Agent1"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2",
              "mode": "list",
              "cachedResultName": "gpt-5.2"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            4288,
            2224
          ],
          "id": "41b29133-ecd4-4f46-8410-c4f9c2a8a1c7",
          "name": "OpenAI Chat Model2",
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "toolDescription": "Enriches a person data based on its emails. Can get company, linkedin, city and current position",
            "method": "POST",
            "url": "https://api.apollo.io/api/v1/people/match",
            "authentication": "genericCredentialType",
            "genericAuthType": "httpHeaderAuth",
            "sendQuery": true,
            "queryParameters": {
              "parameters": [
                {
                  "name": "reveal_personal_emails",
                  "value": "false"
                },
                {
                  "name": "reveal_phone_number",
                  "value": "false"
                },
                {
                  "name": "email",
                  "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', `The person's email`, 'string') }}"
                }
              ]
            },
            "sendHeaders": true,
            "headerParameters": {
              "parameters": [
                {
                  "name": "Cache-Control",
                  "value": "no-cache"
                },
                {
                  "name": "accept",
                  "value": "application/json"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequestTool",
          "typeVersion": 4.3,
          "position": [
            4560,
            2240
          ],
          "id": "8533afee-4b4a-4e27-95f7-375bf1c86c94",
          "name": "Enrich person data2",
          "credentials": {
            "httpBearerAuth": {
              "id": "ltYB1nYeZMvbLyF6",
              "name": "Apollo"
            },
            "httpHeaderAuth": {
              "id": "O2BHqQyciOyYnqKY",
              "name": "Apollo"
            }
          }
        }
      ],
      "connections": {
        "Create a row": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a row": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Delete a row1",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create a row2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete a row": {
          "main": [
            [
              {
                "node": "Create a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Delete a row1": {
          "main": [
            [
              {
                "node": "Delete a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row1": {
          "main": [
            [
              {
                "node": "Create a database page",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Create a row1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a database page": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Get a message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row2": {
          "main": [
            [
              {
                "node": "Merge",
                "type": "main",
                "index": 1
              }
            ]
          ]
        },
        "Merge": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "AI Agent": {
          "main": [
            [
              {
                "node": "Information Extractor",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Get many messages",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Information Extractor": {
          "main": [
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model1": {
          "ai_languageModel": [
            [
              {
                "node": "Information Extractor",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Get a message": {
          "main": [
            [
              {
                "node": "Update a message1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Enrich person data": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Get many messages": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Update a message1": {
          "main": [
            [
              {
                "node": "Get a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request": {
          "main": [
            [
              {
                "node": "HTTP Request1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "HTTP Request1": {
          "main": [
            [
              {
                "node": "HTTP Request2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model2": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Enrich person data2": {
          "ai_tool": [
            [
              {
                "node": "AI Agent1",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "d2d9c8dc-1cd5-4125-8197-6693b288dcfc",
      "activeVersionId": "2d4618b2-5a5f-41bf-a9e7-511c0dfb9e6e",
      "versionCounter": 135,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2026-01-11T13:41:07.747Z",
          "createdAt": "2026-01-11T13:41:07.747Z",
          "role": "workflow:owner",
          "workflowId": "yKpQ3wX35Ci0A4NW",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2026-01-12T21:08:54.342Z",
        "createdAt": "2026-01-12T21:08:45.594Z",
        "versionId": "2d4618b2-5a5f-41bf-a9e7-511c0dfb9e6e",
        "workflowId": "yKpQ3wX35Ci0A4NW",
        "nodes": [
          {
            "parameters": {
              "tableId": "leads_emails",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "email_id",
                    "fieldValue": "={{ $('Get a message').item.json.id }}"
                  },
                  {
                    "fieldId": "sender",
                    "fieldValue": "={{ $('Get a message').item.json.sender.emailAddress.address }}"
                  },
                  {
                    "fieldId": "body",
                    "fieldValue": "={{ $('Get a message').item.json.body.content }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              3504,
              1216
            ],
            "id": "4b14f31a-068d-40c3-9e54-611c266e3388",
            "name": "Create a row",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "tableId": "leads_emails",
              "filters": {
                "conditions": [
                  {
                    "keyName": "email_id",
                    "keyValue": "={{ $json.id }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              2832,
              1312
            ],
            "id": "2baf60bb-bf27-4e51-b32e-21b4c78c03d0",
            "name": "Get a row",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "5c21e2aa-919c-4008-bc91-fb8da241c60d",
                    "leftValue": "={{ $json.email_id }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
              2976,
              1312
            ],
            "id": "c3051bdf-59a3-430d-b1a8-6f882e48e75d",
            "name": "If"
          },
          {
            "parameters": {
              "operation": "delete",
              "tableId": "leads_emails",
              "filters": {
                "conditions": [
                  {
                    "keyName": "email_id",
                    "condition": "eq",
                    "keyValue": "={{ $('Get a message').item.json.id }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              3312,
              1216
            ],
            "id": "26e387bf-f8be-4249-a0e9-d494649e1b74",
            "name": "Delete a row",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "operation": "delete",
              "tableId": "leads",
              "filters": {
                "conditions": [
                  {
                    "keyName": "email_id",
                    "condition": "eq",
                    "keyValue": "={{ $('Get a message').item.json.id }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              3152,
              1216
            ],
            "id": "6fdd8ee4-718d-421f-bdc4-518dfa92e282",
            "name": "Delete a row1",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "fieldToSplitOut": "output.leads",
              "include": "allOtherFields",
              "options": {}
            },
            "type": "n8n-nodes-base.splitOut",
            "typeVersion": 1,
            "position": [
              4736,
              1344
            ],
            "id": "c5ff084f-ca65-4a51-a964-6b1b1974e366",
            "name": "Split Out"
          },
          {
            "parameters": {
              "tableId": "leads",
              "dataToSend": "autoMapInputData"
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              5104,
              1344
            ],
            "id": "a873c16a-97ad-4a82-a7fd-f7575c31e8f3",
            "name": "Create a row1",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "5ddb43fa-04ba-4f67-a343-86b00883b57f",
                    "name": "email_id",
                    "value": "={{ $('Get a message').item.json.id }}",
                    "type": "string"
                  },
                  {
                    "id": "6317e211-a930-4a75-b263-12229abbc9f9",
                    "name": "email",
                    "value": "={{ $json['output.leads'].email }}",
                    "type": "string"
                  },
                  {
                    "id": "be6c3098-ab2d-493c-a7a7-684046beff9b",
                    "name": "first_name",
                    "value": "={{ $json['output.leads'].first_name }}",
                    "type": "string"
                  },
                  {
                    "id": "40b3c296-5383-4a6f-9330-60df37512ef9",
                    "name": "last_name",
                    "value": "={{ $json['output.leads'].last_name }}",
                    "type": "string"
                  },
                  {
                    "id": "c6c61903-e98c-4417-aa53-100dd777c0e5",
                    "name": "linkedin",
                    "value": "={{ $json['output.leads'].linkedin }}",
                    "type": "string"
                  },
                  {
                    "id": "9c88a05e-72b8-48f9-a566-08d07058dc09",
                    "name": "city",
                    "value": "={{ $json['output.leads'].city }}",
                    "type": "string"
                  },
                  {
                    "id": "947f1604-2ad3-4523-b803-04000ed304d2",
                    "name": "current_position",
                    "value": "={{ $json['output.leads'].current_position }}",
                    "type": "string"
                  },
                  {
                    "id": "05f70397-0ef0-40b8-aa66-b962079d1a88",
                    "name": "company",
                    "value": "={{ $json['output.leads'].company }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              4896,
              1344
            ],
            "id": "992fafe9-d4fb-4d3a-a266-b1593d71b4f2",
            "name": "Edit Fields"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "databaseId": {
                "__rl": true,
                "value": "2e402cfe4c0e801692c7cdab48c0c241",
                "mode": "id"
              },
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "Email|email",
                    "emailValue": "={{ $('Edit Fields').item.json.email }}"
                  },
                  {
                    "key": "Nome|title",
                    "title": "={{ $('Edit Fields').item.json.first_name }}"
                  },
                  {
                    "key": "Sobrenome|rich_text",
                    "textContent": "={{ $('Edit Fields').item.json.last_name }}"
                  },
                  {
                    "key": "Posição|rich_text",
                    "textContent": "={{ $('Edit Fields').item.json.current_position }}"
                  },
                  {
                    "key": "Empresa|rich_text",
                    "textContent": "={{ $('Edit Fields').item.json.company }}"
                  },
                  {
                    "key": "Linkedin|rich_text",
                    "textContent": "={{ $('Edit Fields').item.json.linkedin }}"
                  },
                  {
                    "key": "Contato Pier|rich_text",
                    "textContent": "={{ $('Get a message').item.json.sender.emailAddress.address }}"
                  },
                  {
                    "key": "Cidade|rich_text",
                    "textContent": "={{ $('Edit Fields').item.json.city }}"
                  },
                  {
                    "key": "Email ID|rich_text",
                    "textContent": "={{ $('Get a message').item.json.id }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              5312,
              1344
            ],
            "id": "a0b1ffda-ee91-4130-813e-b9063bf1720a",
            "name": "Create a database page",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              2224,
              1312
            ],
            "id": "1992548b-bf41-4be4-ad8f-7f38e4ee4ec9",
            "name": "Loop Over Items"
          },
          {
            "parameters": {
              "fieldsToAggregate": {
                "fieldToAggregate": [
                  {}
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              5520,
              1344
            ],
            "id": "8e41648b-6658-4a8d-9b95-3e86f9c6eb47",
            "name": "Aggregate"
          },
          {
            "parameters": {
              "tableId": "leads_emails",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "email_id",
                    "fieldValue": "={{ $('Get a message').item.json.id }}"
                  },
                  {
                    "fieldId": "sender",
                    "fieldValue": "={{ $('Get a message').item.json.sender.emailAddress.address }}"
                  },
                  {
                    "fieldId": "body",
                    "fieldValue": "={{ $('Get a message').item.json.body.content }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              3504,
              1408
            ],
            "id": "ea23ce6c-8e49-4ccf-b196-346eda46d666",
            "name": "Create a row2",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.merge",
            "typeVersion": 3.2,
            "position": [
              3680,
              1312
            ],
            "id": "919d07e3-bd64-4f10-9ca5-486efbe27b11",
            "name": "Merge"
          },
          {
            "parameters": {
              "promptType": "define",
              "text": "=sender email:  {{ $('Get a message').item.json.sender.emailAddress.address }}\nsender name: {{ $('Get a message').item.json.sender.emailAddress.name }}\nbody:\n{{ $json.body }}",
              "options": {
                "systemMessage": "Extract email information from this email body. Include all emails exept those from @pierpartners.com.br (our company). Also consider the sender (in case he is not from pier).\n\nRules:\n\n1. Split full names into first_name and last_name.\n2. If a person only has one name (e.g., 'Douglas'), set last_name to 'NA'.\n3. When possible, infer first and last name from the email\n4. Use the available tool to get current position, linkedin and city. Also return NA if not found\n\nReturn a json exactly in the following format:\n\n{\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"properties\": {\n    \"leads\": {\n      \"type\": \"array\",\n      \"description\": \"The list of extracted people.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"first_name\": {\n            \"type\": \"string\",\n            \"description\": \"The first name.\"\n          },\n          \"last_name\": {\n            \"type\": \"string\",\n            \"description\": \"The family name. If missing, use 'NA'.\"\n          },\n          \"email\": {\n            \"type\": \"string\",\n            \"description\": \"The email address.\"\n          },\n          \"company\": {\n            \"type\": \"string\",\n            \"description\": \"The company of the person. If missing or unsure, use 'NA'\"\n          },\n          \"city\": {\n            \"type\": \"string\"\n          },\n          \"current_position\": {\n            \"type\": \"string\"\n          },\n          \"linkedin\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\n          \"first_name\",\n          \"last_name\",\n          \"company\",\n          \"email\",\n          \"city\",\n          \"current_position\",\n          \"linkedin\"\n        ]\n      }\n    }\n  },\n  \"required\": [\n    \"leads\"\n  ]\n}"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3.1,
            "position": [
              4016,
              1328
            ],
            "id": "3552d09d-d46f-47ea-966d-c1196fecde79",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.2",
                "mode": "list",
                "cachedResultName": "gpt-5.2"
              },
              "builtInTools": {},
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
              3984,
              1584
            ],
            "id": "83509c6f-372e-49cc-8c51-f72ae4a5830e",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "field": "minutes",
                    "minutesInterval": 2
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.3,
            "position": [
              1776,
              1312
            ],
            "id": "f1180fbd-f7d2-43c6-b965-ed4f4061c02d",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "text": "={{ $json.output }}",
              "schemaType": "manual",
              "inputSchema": "{\n  \"type\": \"object\",\n  \"additionalProperties\": false,\n  \"properties\": {\n    \"leads\": {\n      \"type\": \"array\",\n      \"description\": \"The list of extracted people.\",\n      \"items\": {\n        \"type\": \"object\",\n        \"additionalProperties\": false,\n        \"properties\": {\n          \"first_name\": {\n            \"type\": \"string\",\n            \"description\": \"The first name.\"\n          },\n          \"last_name\": {\n            \"type\": \"string\",\n            \"description\": \"The family name. If missing, use 'NA'.\"\n          },\n          \"email\": {\n            \"type\": \"string\",\n            \"description\": \"The email address.\"\n          },\n          \"company\": {\n            \"type\": \"string\",\n            \"description\": \"The company of the person. If missing or unsure, use 'NA'\"\n          },\n          \"city\": {\n            \"type\": \"string\"\n          },\n          \"current_position\": {\n            \"type\": \"string\"\n          },\n          \"linkedin\": {\n            \"type\": \"string\"\n          }\n        },\n        \"required\": [\n          \"first_name\",\n          \"last_name\",\n          \"company\",\n          \"email\",\n          \"city\",\n          \"current_position\",\n          \"linkedin\"\n        ]\n      }\n    }\n  },\n  \"required\": [\n    \"leads\"\n  ]\n}",
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.informationExtractor",
            "typeVersion": 1.2,
            "position": [
              4384,
              1344
            ],
            "id": "d83f597c-bfbf-4d2c-b229-2d1a142f3366",
            "name": "Information Extractor"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.2",
                "mode": "list",
                "cachedResultName": "gpt-5.2"
              },
              "builtInTools": {},
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
              4368,
              1520
            ],
            "id": "5d63c91c-40a6-4c5f-ba11-c9ace7fd5485",
            "name": "OpenAI Chat Model1",
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "operation": "get",
              "messageId": {
                "__rl": true,
                "value": "={{ $json.id }}",
                "mode": "id"
              },
              "output": "fields",
              "fields": [
                "body",
                "sender"
              ],
              "options": {}
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              2448,
              1312
            ],
            "id": "039fe58b-c96c-452a-aae8-e930a7ef11ed",
            "name": "Get a message",
            "webhookId": "ba553e29-b3a0-4a54-a2fc-78f39a891d70",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "pkc2Wwsx7H0ROl5A",
                "name": "Leads"
              }
            }
          },
          {
            "parameters": {
              "toolDescription": "Enriches a person data based on its emails. Can get company, linkedin, city and current position",
              "method": "POST",
              "url": "https://api.apollo.io/api/v1/people/match",
              "authentication": "genericCredentialType",
              "genericAuthType": "httpHeaderAuth",
              "sendQuery": true,
              "queryParameters": {
                "parameters": [
                  {
                    "name": "reveal_personal_emails",
                    "value": "false"
                  },
                  {
                    "name": "reveal_phone_number",
                    "value": "false"
                  },
                  {
                    "name": "email",
                    "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters2_Value', `The person's email`, 'string') }}"
                  }
                ]
              },
              "sendHeaders": true,
              "headerParameters": {
                "parameters": [
                  {
                    "name": "Cache-Control",
                    "value": "no-cache"
                  },
                  {
                    "name": "accept",
                    "value": "application/json"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequestTool",
            "typeVersion": 4.3,
            "position": [
              4160,
              1600
            ],
            "id": "045981e3-98d0-4817-a69e-76d2995b49d4",
            "name": "Enrich person data",
            "credentials": {
              "httpBearerAuth": {
                "id": "ltYB1nYeZMvbLyF6",
                "name": "Apollo"
              },
              "httpHeaderAuth": {
                "id": "O2BHqQyciOyYnqKY",
                "name": "Apollo"
              }
            }
          },
          {
            "parameters": {
              "operation": "getAll",
              "returnAll": true,
              "filtersUI": {
                "values": {
                  "filters": {
                    "readStatus": "unread"
                  }
                }
              },
              "options": {}
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              1984,
              1312
            ],
            "id": "9784fae8-c9f1-4928-b021-083b266ada7a",
            "name": "Get many messages",
            "webhookId": "5d574cd9-06eb-4046-9af9-823153dd8f20",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "pkc2Wwsx7H0ROl5A",
                "name": "Leads"
              }
            }
          },
          {
            "parameters": {
              "operation": "update",
              "messageId": {
                "__rl": true,
                "value": "={{ $('Loop Over Items').item.json.id }}",
                "mode": "id"
              },
              "updateFields": {
                "isRead": true
              }
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              2640,
              1312
            ],
            "id": "efe45cb6-1480-41a3-a218-e23fd7c19a03",
            "name": "Update a message1",
            "webhookId": "b4f45d1a-cd10-4893-b6f2-e540d9ae9dcd",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "pkc2Wwsx7H0ROl5A",
                "name": "Leads"
              }
            }
          }
        ],
        "connections": {
          "Create a row": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get a row": {
            "main": [
              [
                {
                  "node": "If",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "If": {
            "main": [
              [
                {
                  "node": "Delete a row1",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Create a row2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Delete a row": {
            "main": [
              [
                {
                  "node": "Create a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Delete a row1": {
            "main": [
              [
                {
                  "node": "Delete a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Split Out": {
            "main": [
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a row1": {
            "main": [
              [
                {
                  "node": "Create a database page",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "Create a row1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a database page": {
            "main": [
              [
                {
                  "node": "Aggregate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items": {
            "main": [
              [],
              [
                {
                  "node": "Get a message",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a row2": {
            "main": [
              [
                {
                  "node": "Merge",
                  "type": "main",
                  "index": 1
                }
              ]
            ]
          },
          "Merge": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "AI Agent": {
            "main": [
              [
                {
                  "node": "Information Extractor",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "Get many messages",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Information Extractor": {
            "main": [
              [
                {
                  "node": "Split Out",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model1": {
            "ai_languageModel": [
              [
                {
                  "node": "Information Extractor",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Get a message": {
            "main": [
              [
                {
                  "node": "Update a message1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Enrich person data": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Get many messages": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Update a message1": {
            "main": [
              [
                {
                  "node": "Get a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 2d4618b2",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-12T21:08:54.335Z",
            "id": 89,
            "workflowId": "yKpQ3wX35Ci0A4NW",
            "versionId": "2d4618b2-5a5f-41bf-a9e7-511c0dfb9e6e",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-26T21:06:31.223Z",
      "createdAt": "2026-01-13T20:34:52.637Z",
      "id": "Gd71iDc87upbWWRbk67L4",
      "name": "Drops",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "fieldToSplitOut": "property_pessoas",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            384,
            32
          ],
          "id": "6633a904-4848-4a04-a986-29d5485e4158",
          "name": "Split Out"
        },
        {
          "parameters": {
            "aggregate": "aggregateAllItemData",
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            752,
            32
          ],
          "id": "480839e0-fb9f-419e-8cdd-3e669a359972",
          "name": "Aggregate"
        },
        {
          "parameters": {},
          "type": "n8n-nodes-base.noOp",
          "typeVersion": 1,
          "position": [
            1824,
            16
          ],
          "id": "66ce0acc-2c49-4183-b222-9350b81beb5e",
          "name": "No Operation, do nothing"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "cronExpression",
                  "expression": "0 18 * * *"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.3,
          "position": [
            -336,
            16
          ],
          "id": "e5da8808-ff0d-47ac-87ae-fb5a7b535086",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "cronExpression",
                  "expression": "15 18 * * *"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.3,
          "position": [
            112,
            656
          ],
          "id": "3408bb17-40fb-409b-a123-b4a31bd8fb01",
          "name": "Schedule Trigger1"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "2e602cfe-4c0e-80b0-9bc7-f15db5ad804c",
              "mode": "list",
              "cachedResultName": "Drops",
              "cachedResultUrl": "https://www.notion.so/2e602cfe4c0e80b09bc7f15db5ad804c"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Data|date",
                  "condition": "after",
                  "date": "={{ $now }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            -96,
            16
          ],
          "id": "e184a453-5b09-4129-b548-284750d17def",
          "name": "Busca Proximos Drops",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            128,
            16
          ],
          "id": "34157352-2fe2-429b-aa5b-3146a85e9d9b",
          "name": "Loop Over Drops"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "get",
            "pageId": {
              "__rl": true,
              "value": "={{ $json.property_pessoas }}",
              "mode": "id"
            }
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            576,
            32
          ],
          "id": "3d76d5fd-be65-41a5-b4ca-2a959d435f7b",
          "name": "Busca Pessoas",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// 1. Captura os dados do Drop (Loop Externo)\nconst outerItem = $('Loop Over Drops').item.json;\n\n// 2. Acessa o array de pessoas que o Aggregate colocou dentro de \"data\"\n// Como o Aggregate gera um único item de saída, pegamos o primeiro item ($input.first())\nconst peopleList = $input.first().json.data || [];\n\n// 3. Filtra e Formata os convidados para o padrão do Outlook\nconst allAttendees = peopleList\n  .filter(person => {\n    // Garante que só entram pessoas com e-mail preenchido\n    return person.property_email && person.property_email.trim() !== \"\";\n  })\n  .map(person => {\n    return {\n      \"emailAddress\": {\n        \"address\": person.property_email,\n        \"name\": person.property_nome || \"Convidado\"\n      },\n      \"type\": \"required\"\n    };\n  });\n\n// 4. Retorna o objeto consolidado para o HTTP Request\nreturn {\n  attendees: allAttendees,\n  notionName: outerItem.name,\n  notionDate: outerItem.property_data.start,\n  notionId: outerItem.id\n};"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            960,
            32
          ],
          "id": "13a1f02c-b905-455f-b300-ea1f951c5459",
          "name": "Gera Json para Invite"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://graph.microsoft.com/v1.0/me/events",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "microsoftOutlookOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"subject\": \"DROP: {{ $json.notionName }}\",\n  \"start\": {\n    \"dateTime\": \"{{ $json.notionDate }}T08:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"end\": {\n    \"dateTime\": \"{{ $json.notionDate }}T09:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"attendees\": {{ JSON.stringify($json.attendees) }}\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            1520,
            -176
          ],
          "id": "04102d1f-d2e3-487d-aee0-0226d2ba6738",
          "name": "Cria Evento",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "04733178-9aaa-4e45-a5e2-715d3ab1ac8b",
                  "leftValue": "={{ $('Loop Over Drops').item.json.property_id_evento }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "empty",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            1168,
            32
          ],
          "id": "59faf263-d1ed-4baa-9993-6f56cbb37227",
          "name": "Se ID evento esta vazio no notion"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "update",
            "pageId": {
              "__rl": true,
              "value": "={{ $node[\"Gera Json para Invite\"].json.notionId }}",
              "mode": "id"
            },
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "ID Evento|rich_text",
                  "textContent": "={{ $json.id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            1696,
            -176
          ],
          "id": "223b043e-f44e-4acd-8289-a4aa77dfb7ec",
          "name": "Insere ID Evento no Notion",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "event",
            "operation": "get",
            "calendarId": {
              "__rl": true,
              "value": "AQMkAGEyMWEwYjRjLTFlNjgtNGU2Zi1hZWFjLTk4YmUzOGYyOWFkMABGAAADRPa9zOD-MUyykpAHnkLLiwcATUKYMOowO0OwrgDTeYvCvwAAAgEGAAAATUKYMOowO0OwrgDTeYvCvwAAAQvGowAAAA==",
              "mode": "list",
              "cachedResultName": "Calendar"
            },
            "eventId": {
              "__rl": true,
              "value": "={{ $('Loop Over Drops').item.json.property_id_evento }}",
              "mode": "id"
            }
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            1376,
            80
          ],
          "id": "69305c39-1f46-4cc8-9dec-bb51d2176bda",
          "name": "Busca Evento",
          "webhookId": "ba952b11-24ac-4790-a684-187808afaf08",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "98df8064-a602-429b-abea-e9495f821db6",
                  "leftValue": "={{ $json.subject.split(\"DROP: \")[1] }}",
                  "rightValue": "={{ $('Loop Over Drops').item.json.name }}",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                },
                {
                  "id": "22973c6c-0538-4b9b-9781-8c5f0f3f3e41",
                  "leftValue": "={{ $json.start.dateTime.slice(0, 10) }}",
                  "rightValue": "={{ $('Loop Over Drops').item.json.property_data.start }}",
                  "operator": {
                    "type": "dateTime",
                    "operation": "equals"
                  }
                },
                {
                  "id": "ee9303ca-1880-48e1-b12b-e25aff86fd8e",
                  "leftValue": "={{ $json.attendees.map(a => a.emailAddress.address.toLowerCase()).sort().join(',') }}",
                  "rightValue": "={{ $items(\"Busca Pessoas\").map(i => i.json.property_email.toLowerCase()).sort().join(',') }}",
                  "operator": {
                    "type": "string",
                    "operation": "equals"
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            1568,
            80
          ],
          "id": "c5890690-667a-421c-8ce1-db74626b03f7",
          "name": "Se alguma informacao mudou"
        },
        {
          "parameters": {
            "resource": "event",
            "operation": "delete",
            "calendarId": {
              "__rl": true,
              "value": "AQMkAGEyMWEwYjRjLTFlNjgtNGU2Zi1hZWFjLTk4YmUzOGYyOWFkMABGAAADRPa9zOD-MUyykpAHnkLLiwcATUKYMOowO0OwrgDTeYvCvwAAAgEGAAAATUKYMOowO0OwrgDTeYvCvwAAAQvGowAAAA==",
              "mode": "list",
              "cachedResultName": "Calendar"
            },
            "eventId": {
              "__rl": true,
              "value": "={{ $('Loop Over Drops').item.json.property_id_evento }}",
              "mode": "id"
            }
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            1824,
            192
          ],
          "id": "416f8e1c-233c-4675-8f23-1b561c4d25f7",
          "name": "Deleta Evento",
          "webhookId": "87032b6c-fc21-422f-8c31-09a75d22592f",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://graph.microsoft.com/v1.0/me/events",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "microsoftOutlookOAuth2Api",
            "sendBody": true,
            "specifyBody": "json",
            "jsonBody": "={\n  \"subject\": \"DROP: {{ $('Gera Json para Invite').item.json.notionName }}\",\n  \"start\": {\n    \"dateTime\": \"{{ $('Gera Json para Invite').item.json.notionDate }}T08:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"end\": {\n    \"dateTime\": \"{{ $('Gera Json para Invite').item.json.notionDate }}T09:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"attendees\": {{ JSON.stringify($('Gera Json para Invite').item.json.attendees) }}\n}",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            2032,
            192
          ],
          "id": "7bfd8251-b256-4e8a-967c-1842a37d7eb8",
          "name": "Cria Novo Evento",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "update",
            "pageId": {
              "__rl": true,
              "value": "={{ $node[\"Gera Json para Invite\"].json.notionId }}",
              "mode": "id"
            },
            "propertiesUi": {
              "propertyValues": [
                {
                  "key": "ID Evento|rich_text",
                  "textContent": "={{ $json.id }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            2272,
            192
          ],
          "id": "7a9844a1-7da9-4479-b149-64110145a015",
          "name": "Insere novo ID Evento no Notion",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "url": "=https://graph.microsoft.com/v1.0/me/events?$filter=start/dateTime ge '{{ $now.format('yyyy-MM-dd') }}' and startswith(subject,'DROP: ')",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "microsoftOutlookOAuth2Api",
            "options": {}
          },
          "type": "n8n-nodes-base.httpRequest",
          "typeVersion": 4.3,
          "position": [
            336,
            656
          ],
          "id": "133d6b3c-0a89-45d2-862e-2d8dd02921a0",
          "name": "Busca proximos eventos",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "2e602cfe-4c0e-80b0-9bc7-f15db5ad804c",
              "mode": "list",
              "cachedResultName": "Drops",
              "cachedResultUrl": "https://www.notion.so/2e602cfe4c0e80b09bc7f15db5ad804c"
            },
            "returnAll": true,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Data|date",
                  "condition": "after",
                  "date": "={{ $now }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            560,
            656
          ],
          "id": "d7f8035d-0cf4-49f8-a067-51afd4fd41a4",
          "name": "Busca proximos drops",
          "alwaysOutputData": true,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "jsCode": "// 1. Coleta todos os IDs de eventos que existem no Notion\nconst notionItems = $(\"Busca proximos drops\").all();\nconst IDsNoNotion = notionItems.map(item => item.json.property_id_evento);\n\n// 2. Coleta os eventos do Outlook acessando o campo 'value'\n// O HTTP Request retorna um objeto com a chave 'value' contendo a lista\nconst outlookResponse = $(\"Busca proximos eventos\").first().json;\nconst outlookItems = outlookResponse.value || [];\n\n// 3. Filtra eventos do Outlook que NÃO possuem o ID na lista do Notion\nconst eventosParaDeletar = outlookItems.filter(item => {\n  const idNoOutlook = item.id;\n  const subject = item.subject || \"\";\n  \n  // Só processamos eventos que tenham o prefixo \"DROP: \"\n  const isDropEvent = subject.startsWith(\"DROP: \");\n  \n  // Se for um evento de DROP e o ID NÃO estiver no Notion, marcamos para deletar\n  return isDropEvent && !IDsNoNotion.includes(idNoOutlook);\n});\n\n// 4. Retorna a lista de IDs órfãos formatada para o n8n\nreturn eventosParaDeletar.map(item => ({\n    id_para_deletar: item.id,\n    tema_deletado: item.subject\n}));"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            768,
            656
          ],
          "id": "26e863dc-0e66-4c9d-98b7-3f434c1155c6",
          "name": "Verifica se algum foi deletado no notion"
        },
        {
          "parameters": {
            "resource": "event",
            "operation": "delete",
            "calendarId": {
              "__rl": true,
              "value": "AQMkAGEyMWEwYjRjLTFlNjgtNGU2Zi1hZWFjLTk4YmUzOGYyOWFkMABGAAADRPa9zOD-MUyykpAHnkLLiwcATUKYMOowO0OwrgDTeYvCvwAAAgEGAAAATUKYMOowO0OwrgDTeYvCvwAAAQvGowAAAA==",
              "mode": "list",
              "cachedResultName": "Calendar"
            },
            "eventId": {
              "__rl": true,
              "value": "={{ $json.id_para_deletar }}",
              "mode": "id"
            }
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            976,
            656
          ],
          "id": "2ebbe252-1875-490a-b38a-0345a71304e2",
          "name": "se sim Deleta Evento",
          "webhookId": "87032b6c-fc21-422f-8c31-09a75d22592f",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "getAll",
            "databaseId": {
              "__rl": true,
              "value": "2e602cfe-4c0e-80b0-9bc7-f15db5ad804c",
              "mode": "list",
              "cachedResultName": "Drops",
              "cachedResultUrl": "https://www.notion.so/2e602cfe4c0e80b09bc7f15db5ad804c"
            },
            "limit": 1,
            "filterType": "manual",
            "filters": {
              "conditions": [
                {
                  "key": "Data|date",
                  "condition": "after",
                  "date": "={{ $now }}"
                }
              ]
            },
            "options": {
              "sort": {
                "sortValue": [
                  {
                    "key": "Data|date",
                    "direction": "ascending"
                  }
                ]
              }
            }
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            176,
            1040
          ],
          "id": "45b8fa28-a9b0-4f2e-86ef-8f92331252f7",
          "name": "Busca drop da semana",
          "alwaysOutputData": true,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "toRecipients": "={{ $json.emails }}",
            "subject": "=Aviso DROP: {{ $('Busca drop da semana').item.json.name }}",
            "bodyContent": "Opa! Email automático pra lembrar que o drop dessa semana é contigo. Valeu!",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            1216,
            1040
          ],
          "id": "9f2332fc-bf73-47aa-8779-8deca212cc5a",
          "name": "Send a message",
          "webhookId": "93a586c6-52cb-4d23-b517-15bd26047e88",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        },
        {
          "parameters": {
            "fieldToSplitOut": "property_pessoas",
            "options": {}
          },
          "type": "n8n-nodes-base.splitOut",
          "typeVersion": 1,
          "position": [
            384,
            1040
          ],
          "id": "8207c9cf-4c47-4313-a368-0f9eea0e4a2e",
          "name": "Split Out1"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "get",
            "pageId": {
              "__rl": true,
              "value": "={{ $json.property_pessoas }}",
              "mode": "id"
            }
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            576,
            1040
          ],
          "id": "e22e925b-6289-4439-b650-93ea1f174cf3",
          "name": "Busca Pessoas1",
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "assignments": {
              "assignments": [
                {
                  "id": "212a8581-aef3-49d1-973f-fec982b8b3c4",
                  "name": "emails",
                  "value": "={{ $items(\"Busca Pessoas1\").map(i => i.json.property_email.toLowerCase()).sort().join(',') }}",
                  "type": "string"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.set",
          "typeVersion": 3.4,
          "position": [
            992,
            1040
          ],
          "id": "256392d1-dd02-47fb-adb8-f1e070dddcaf",
          "name": "Edit Fields"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "cronExpression",
                  "expression": "0 10 * * TUE"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.3,
          "position": [
            -16,
            1040
          ],
          "id": "a7e0139c-bb39-4b76-8a14-203db1cae744",
          "name": "Schedule Trigger2"
        },
        {
          "parameters": {
            "content": "## Cria e edita invites\n### Roda diariamente às 18h",
            "height": 736,
            "width": 3040
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -480,
            -272
          ],
          "id": "6abeb727-5f0c-4406-8f26-10833f4eff0c",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "content": "## Deleta invite dos deletados no Notion\n### Roda diariamente às 18:15",
            "height": 320,
            "width": 1696
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -224,
            528
          ],
          "id": "68d99b20-633b-4148-8905-6ea4f0483de7",
          "name": "Sticky Note1"
        },
        {
          "parameters": {
            "content": "## Envia email com aviso na terça feira\n## Roda toda terça às 10h",
            "height": 304,
            "width": 1600
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -80,
            928
          ],
          "id": "4e566307-ffd3-47aa-80a2-b0f6d21de982",
          "name": "Sticky Note2"
        },
        {
          "parameters": {
            "fieldsToAggregate": {
              "fieldToAggregate": [
                {
                  "fieldToAggregate": "property_email"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.aggregate",
          "typeVersion": 1,
          "position": [
            784,
            1040
          ],
          "id": "71f8a614-0dc6-4ebf-b028-aaedb66ca5e9",
          "name": "Aggregate1"
        }
      ],
      "connections": {
        "Split Out": {
          "main": [
            [
              {
                "node": "Busca Pessoas",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate": {
          "main": [
            [
              {
                "node": "Gera Json para Invite",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "No Operation, do nothing": {
          "main": [
            [
              {
                "node": "Loop Over Drops",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Busca Proximos Drops",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger1": {
          "main": [
            [
              {
                "node": "Busca proximos eventos",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca Proximos Drops": {
          "main": [
            [
              {
                "node": "Loop Over Drops",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Drops": {
          "main": [
            [],
            [
              {
                "node": "Split Out",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca Pessoas": {
          "main": [
            [
              {
                "node": "Aggregate",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Gera Json para Invite": {
          "main": [
            [
              {
                "node": "Se ID evento esta vazio no notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cria Evento": {
          "main": [
            [
              {
                "node": "Insere ID Evento no Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Se ID evento esta vazio no notion": {
          "main": [
            [
              {
                "node": "Cria Evento",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Busca Evento",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insere ID Evento no Notion": {
          "main": [
            [
              {
                "node": "Loop Over Drops",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca Evento": {
          "main": [
            [
              {
                "node": "Se alguma informacao mudou",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Se alguma informacao mudou": {
          "main": [
            [
              {
                "node": "No Operation, do nothing",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Deleta Evento",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Deleta Evento": {
          "main": [
            [
              {
                "node": "Cria Novo Evento",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Cria Novo Evento": {
          "main": [
            [
              {
                "node": "Insere novo ID Evento no Notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Insere novo ID Evento no Notion": {
          "main": [
            [
              {
                "node": "Loop Over Drops",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca proximos eventos": {
          "main": [
            [
              {
                "node": "Busca proximos drops",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca proximos drops": {
          "main": [
            [
              {
                "node": "Verifica se algum foi deletado no notion",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Verifica se algum foi deletado no notion": {
          "main": [
            [
              {
                "node": "se sim Deleta Evento",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca drop da semana": {
          "main": [
            [
              {
                "node": "Split Out1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Split Out1": {
          "main": [
            [
              {
                "node": "Busca Pessoas1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Busca Pessoas1": {
          "main": [
            [
              {
                "node": "Aggregate1",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Edit Fields": {
          "main": [
            [
              {
                "node": "Send a message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger2": {
          "main": [
            [
              {
                "node": "Busca drop da semana",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Aggregate1": {
          "main": [
            [
              {
                "node": "Edit Fields",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "availableInMCP": false,
        "timeSavedMode": "fixed",
        "timezone": "America/Sao_Paulo",
        "callerPolicy": "workflowsFromSameOwner",
        "errorWorkflow": "JETmLBaO3fj2xDYa-A4Nc"
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        },
        "node:Schedule Trigger1": {
          "recurrenceRules": []
        },
        "node:Schedule Trigger2": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "28adf56c-f43a-4ece-9e37-1780d6507795",
      "activeVersionId": "a943ad4a-fcf1-43ff-8ab5-91eb6991fbd8",
      "versionCounter": 755,
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2026-01-13T20:34:52.637Z",
          "createdAt": "2026-01-13T20:34:52.637Z",
          "role": "workflow:owner",
          "workflowId": "Gd71iDc87upbWWRbk67L4",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2026-01-20T15:10:57.660Z",
        "createdAt": "2026-01-20T15:10:37.451Z",
        "versionId": "a943ad4a-fcf1-43ff-8ab5-91eb6991fbd8",
        "workflowId": "Gd71iDc87upbWWRbk67L4",
        "nodes": [
          {
            "parameters": {
              "fieldToSplitOut": "property_pessoas",
              "options": {}
            },
            "type": "n8n-nodes-base.splitOut",
            "typeVersion": 1,
            "position": [
              384,
              32
            ],
            "id": "6633a904-4848-4a04-a986-29d5485e4158",
            "name": "Split Out"
          },
          {
            "parameters": {
              "aggregate": "aggregateAllItemData",
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              752,
              32
            ],
            "id": "480839e0-fb9f-419e-8cdd-3e669a359972",
            "name": "Aggregate"
          },
          {
            "parameters": {},
            "type": "n8n-nodes-base.noOp",
            "typeVersion": 1,
            "position": [
              1824,
              16
            ],
            "id": "66ce0acc-2c49-4183-b222-9350b81beb5e",
            "name": "No Operation, do nothing"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "field": "cronExpression",
                    "expression": "0 18 * * *"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.3,
            "position": [
              -336,
              16
            ],
            "id": "e5da8808-ff0d-47ac-87ae-fb5a7b535086",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "field": "cronExpression",
                    "expression": "15 18 * * *"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.3,
            "position": [
              112,
              656
            ],
            "id": "3408bb17-40fb-409b-a123-b4a31bd8fb01",
            "name": "Schedule Trigger1"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "2e602cfe-4c0e-80b0-9bc7-f15db5ad804c",
                "mode": "list",
                "cachedResultName": "Drops",
                "cachedResultUrl": "https://www.notion.so/2e602cfe4c0e80b09bc7f15db5ad804c"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Data|date",
                    "condition": "after",
                    "date": "={{ $now }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              -96,
              16
            ],
            "id": "e184a453-5b09-4129-b548-284750d17def",
            "name": "Busca Proximos Drops",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              128,
              16
            ],
            "id": "34157352-2fe2-429b-aa5b-3146a85e9d9b",
            "name": "Loop Over Drops"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "get",
              "pageId": {
                "__rl": true,
                "value": "={{ $json.property_pessoas }}",
                "mode": "id"
              }
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              576,
              32
            ],
            "id": "3d76d5fd-be65-41a5-b4ca-2a959d435f7b",
            "name": "Busca Pessoas",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "// 1. Captura os dados do Drop (Loop Externo)\nconst outerItem = $('Loop Over Drops').item.json;\n\n// 2. Acessa o array de pessoas que o Aggregate colocou dentro de \"data\"\n// Como o Aggregate gera um único item de saída, pegamos o primeiro item ($input.first())\nconst peopleList = $input.first().json.data || [];\n\n// 3. Filtra e Formata os convidados para o padrão do Outlook\nconst allAttendees = peopleList\n  .filter(person => {\n    // Garante que só entram pessoas com e-mail preenchido\n    return person.property_email && person.property_email.trim() !== \"\";\n  })\n  .map(person => {\n    return {\n      \"emailAddress\": {\n        \"address\": person.property_email,\n        \"name\": person.property_nome || \"Convidado\"\n      },\n      \"type\": \"required\"\n    };\n  });\n\n// 4. Retorna o objeto consolidado para o HTTP Request\nreturn {\n  attendees: allAttendees,\n  notionName: outerItem.name,\n  notionDate: outerItem.property_data.start,\n  notionId: outerItem.id\n};"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              960,
              32
            ],
            "id": "13a1f02c-b905-455f-b300-ea1f951c5459",
            "name": "Gera Json para Invite"
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://graph.microsoft.com/v1.0/me/events",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "microsoftOutlookOAuth2Api",
              "sendBody": true,
              "specifyBody": "json",
              "jsonBody": "={\n  \"subject\": \"DROP: {{ $json.notionName }}\",\n  \"start\": {\n    \"dateTime\": \"{{ $json.notionDate }}T08:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"end\": {\n    \"dateTime\": \"{{ $json.notionDate }}T09:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"attendees\": {{ JSON.stringify($json.attendees) }}\n}",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
              1488,
              -160
            ],
            "id": "04102d1f-d2e3-487d-aee0-0226d2ba6738",
            "name": "Cria Evento",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "04733178-9aaa-4e45-a5e2-715d3ab1ac8b",
                    "leftValue": "={{ $('Loop Over Drops').item.json.property_id_evento }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "empty",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
              1168,
              32
            ],
            "id": "59faf263-d1ed-4baa-9993-6f56cbb37227",
            "name": "Se ID evento esta vazio no notion"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "update",
              "pageId": {
                "__rl": true,
                "value": "={{ $node[\"Gera Json para Invite\"].json.notionId }}",
                "mode": "id"
              },
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "ID Evento|rich_text",
                    "textContent": "={{ $json.id }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              1664,
              -160
            ],
            "id": "223b043e-f44e-4acd-8289-a4aa77dfb7ec",
            "name": "Insere ID Evento no Notion",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "event",
              "operation": "get",
              "calendarId": {
                "__rl": true,
                "value": "AQMkAGEyMWEwYjRjLTFlNjgtNGU2Zi1hZWFjLTk4YmUzOGYyOWFkMABGAAADRPa9zOD-MUyykpAHnkLLiwcATUKYMOowO0OwrgDTeYvCvwAAAgEGAAAATUKYMOowO0OwrgDTeYvCvwAAAQvGowAAAA==",
                "mode": "list",
                "cachedResultName": "Calendar"
              },
              "eventId": {
                "__rl": true,
                "value": "={{ $('Loop Over Drops').item.json.property_id_evento }}",
                "mode": "id"
              }
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              1376,
              80
            ],
            "id": "69305c39-1f46-4cc8-9dec-bb51d2176bda",
            "name": "Busca Evento",
            "webhookId": "ba952b11-24ac-4790-a684-187808afaf08",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "98df8064-a602-429b-abea-e9495f821db6",
                    "leftValue": "={{ $json.subject.split(\"DROP: \")[1] }}",
                    "rightValue": "={{ $('Loop Over Drops').item.json.name }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  },
                  {
                    "id": "22973c6c-0538-4b9b-9781-8c5f0f3f3e41",
                    "leftValue": "={{ $json.start.dateTime.slice(0, 10) }}",
                    "rightValue": "={{ $('Loop Over Drops').item.json.property_data.start }}",
                    "operator": {
                      "type": "dateTime",
                      "operation": "equals"
                    }
                  },
                  {
                    "id": "ee9303ca-1880-48e1-b12b-e25aff86fd8e",
                    "leftValue": "={{ $json.attendees.map(a => a.emailAddress.address.toLowerCase()).sort().join(',') }}",
                    "rightValue": "={{ $items(\"Busca Pessoas\").map(i => i.json.property_email.toLowerCase()).sort().join(',') }}",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
              1568,
              80
            ],
            "id": "c5890690-667a-421c-8ce1-db74626b03f7",
            "name": "Se alguma informacao mudou"
          },
          {
            "parameters": {
              "resource": "event",
              "operation": "delete",
              "calendarId": {
                "__rl": true,
                "value": "AQMkAGEyMWEwYjRjLTFlNjgtNGU2Zi1hZWFjLTk4YmUzOGYyOWFkMABGAAADRPa9zOD-MUyykpAHnkLLiwcATUKYMOowO0OwrgDTeYvCvwAAAgEGAAAATUKYMOowO0OwrgDTeYvCvwAAAQvGowAAAA==",
                "mode": "list",
                "cachedResultName": "Calendar"
              },
              "eventId": {
                "__rl": true,
                "value": "={{ $('Loop Over Drops').item.json.property_id_evento }}",
                "mode": "id"
              }
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              1824,
              192
            ],
            "id": "416f8e1c-233c-4675-8f23-1b561c4d25f7",
            "name": "Deleta Evento",
            "webhookId": "87032b6c-fc21-422f-8c31-09a75d22592f",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://graph.microsoft.com/v1.0/me/events",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "microsoftOutlookOAuth2Api",
              "sendBody": true,
              "specifyBody": "json",
              "jsonBody": "={\n  \"subject\": \"DROP: {{ $('Gera Json para Invite').item.json.notionName }}\",\n  \"start\": {\n    \"dateTime\": \"{{ $('Gera Json para Invite').item.json.notionDate }}T08:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"end\": {\n    \"dateTime\": \"{{ $('Gera Json para Invite').item.json.notionDate }}T09:00:00\",\n    \"timeZone\": \"America/Sao_Paulo\"\n  },\n  \"attendees\": {{ JSON.stringify($('Gera Json para Invite').item.json.attendees) }}\n}",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
              2032,
              192
            ],
            "id": "7bfd8251-b256-4e8a-967c-1842a37d7eb8",
            "name": "Cria Novo Evento",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "update",
              "pageId": {
                "__rl": true,
                "value": "={{ $node[\"Gera Json para Invite\"].json.notionId }}",
                "mode": "id"
              },
              "propertiesUi": {
                "propertyValues": [
                  {
                    "key": "ID Evento|rich_text",
                    "textContent": "={{ $json.id }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              2272,
              192
            ],
            "id": "7a9844a1-7da9-4479-b149-64110145a015",
            "name": "Insere novo ID Evento no Notion",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "url": "=https://graph.microsoft.com/v1.0/me/events?$filter=start/dateTime ge '{{ $now.format('yyyy-MM-dd') }}' and startswith(subject,'DROP: ')",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "microsoftOutlookOAuth2Api",
              "options": {}
            },
            "type": "n8n-nodes-base.httpRequest",
            "typeVersion": 4.3,
            "position": [
              336,
              656
            ],
            "id": "133d6b3c-0a89-45d2-862e-2d8dd02921a0",
            "name": "Busca proximos eventos",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "2e602cfe-4c0e-80b0-9bc7-f15db5ad804c",
                "mode": "list",
                "cachedResultName": "Drops",
                "cachedResultUrl": "https://www.notion.so/2e602cfe4c0e80b09bc7f15db5ad804c"
              },
              "returnAll": true,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Data|date",
                    "condition": "after",
                    "date": "={{ $now }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              560,
              656
            ],
            "id": "d7f8035d-0cf4-49f8-a067-51afd4fd41a4",
            "name": "Busca proximos drops",
            "alwaysOutputData": true,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "jsCode": "// 1. Coleta todos os IDs de eventos que existem no Notion\nconst notionItems = $(\"Busca proximos drops\").all();\nconst IDsNoNotion = notionItems.map(item => item.json.property_id_evento);\n\n// 2. Coleta os eventos do Outlook acessando o campo 'value'\n// O HTTP Request retorna um objeto com a chave 'value' contendo a lista\nconst outlookResponse = $(\"Busca proximos eventos\").first().json;\nconst outlookItems = outlookResponse.value || [];\n\n// 3. Filtra eventos do Outlook que NÃO possuem o ID na lista do Notion\nconst eventosParaDeletar = outlookItems.filter(item => {\n  const idNoOutlook = item.id;\n  const subject = item.subject || \"\";\n  \n  // Só processamos eventos que tenham o prefixo \"DROP: \"\n  const isDropEvent = subject.startsWith(\"DROP: \");\n  \n  // Se for um evento de DROP e o ID NÃO estiver no Notion, marcamos para deletar\n  return isDropEvent && !IDsNoNotion.includes(idNoOutlook);\n});\n\n// 4. Retorna a lista de IDs órfãos formatada para o n8n\nreturn eventosParaDeletar.map(item => ({\n    id_para_deletar: item.id,\n    tema_deletado: item.subject\n}));"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              768,
              656
            ],
            "id": "26e863dc-0e66-4c9d-98b7-3f434c1155c6",
            "name": "Verifica se algum foi deletado no notion"
          },
          {
            "parameters": {
              "resource": "event",
              "operation": "delete",
              "calendarId": {
                "__rl": true,
                "value": "AQMkAGEyMWEwYjRjLTFlNjgtNGU2Zi1hZWFjLTk4YmUzOGYyOWFkMABGAAADRPa9zOD-MUyykpAHnkLLiwcATUKYMOowO0OwrgDTeYvCvwAAAgEGAAAATUKYMOowO0OwrgDTeYvCvwAAAQvGowAAAA==",
                "mode": "list",
                "cachedResultName": "Calendar"
              },
              "eventId": {
                "__rl": true,
                "value": "={{ $json.id_para_deletar }}",
                "mode": "id"
              }
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              976,
              656
            ],
            "id": "2ebbe252-1875-490a-b38a-0345a71304e2",
            "name": "se sim Deleta Evento",
            "webhookId": "87032b6c-fc21-422f-8c31-09a75d22592f",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "getAll",
              "databaseId": {
                "__rl": true,
                "value": "2e602cfe-4c0e-80b0-9bc7-f15db5ad804c",
                "mode": "list",
                "cachedResultName": "Drops",
                "cachedResultUrl": "https://www.notion.so/2e602cfe4c0e80b09bc7f15db5ad804c"
              },
              "limit": 1,
              "filterType": "manual",
              "filters": {
                "conditions": [
                  {
                    "key": "Data|date",
                    "condition": "after",
                    "date": "={{ $now }}"
                  }
                ]
              },
              "options": {
                "sort": {
                  "sortValue": [
                    {
                      "key": "Data|date",
                      "direction": "ascending"
                    }
                  ]
                }
              }
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              176,
              1040
            ],
            "id": "45b8fa28-a9b0-4f2e-86ef-8f92331252f7",
            "name": "Busca drop da semana",
            "alwaysOutputData": true,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "toRecipients": "={{ $json.emails }}",
              "subject": "=Aviso DROP: {{ $('Busca drop da semana').item.json.name }}",
              "bodyContent": "Opa! Email automático pra lembrar que o drop dessa semana é contigo. Valeu!",
              "additionalFields": {}
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              1216,
              1040
            ],
            "id": "9f2332fc-bf73-47aa-8779-8deca212cc5a",
            "name": "Send a message",
            "webhookId": "93a586c6-52cb-4d23-b517-15bd26047e88",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          },
          {
            "parameters": {
              "fieldToSplitOut": "property_pessoas",
              "options": {}
            },
            "type": "n8n-nodes-base.splitOut",
            "typeVersion": 1,
            "position": [
              384,
              1040
            ],
            "id": "8207c9cf-4c47-4313-a368-0f9eea0e4a2e",
            "name": "Split Out1"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "get",
              "pageId": {
                "__rl": true,
                "value": "={{ $json.property_pessoas }}",
                "mode": "id"
              }
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              576,
              1040
            ],
            "id": "e22e925b-6289-4439-b650-93ea1f174cf3",
            "name": "Busca Pessoas1",
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "assignments": {
                "assignments": [
                  {
                    "id": "212a8581-aef3-49d1-973f-fec982b8b3c4",
                    "name": "emails",
                    "value": "={{ $items(\"Busca Pessoas1\").map(i => i.json.property_email.toLowerCase()).sort().join(',') }}",
                    "type": "string"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.set",
            "typeVersion": 3.4,
            "position": [
              992,
              1040
            ],
            "id": "256392d1-dd02-47fb-adb8-f1e070dddcaf",
            "name": "Edit Fields"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "field": "cronExpression",
                    "expression": "0 10 * * TUE"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.3,
            "position": [
              -16,
              1040
            ],
            "id": "a7e0139c-bb39-4b76-8a14-203db1cae744",
            "name": "Schedule Trigger2"
          },
          {
            "parameters": {
              "content": "## Cria e edita invites\n### Roda diariamente às 18h",
              "height": 736,
              "width": 3040
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              -480,
              -272
            ],
            "id": "6abeb727-5f0c-4406-8f26-10833f4eff0c",
            "name": "Sticky Note"
          },
          {
            "parameters": {
              "content": "## Deleta invite dos deletados no Notion\n### Roda diariamente às 18:15",
              "height": 320,
              "width": 1696
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              -224,
              528
            ],
            "id": "68d99b20-633b-4148-8905-6ea4f0483de7",
            "name": "Sticky Note1"
          },
          {
            "parameters": {
              "content": "## Envia email com aviso na terça feira\n## Roda toda terça às 10h",
              "height": 304,
              "width": 1600
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              -80,
              928
            ],
            "id": "4e566307-ffd3-47aa-80a2-b0f6d21de982",
            "name": "Sticky Note2"
          },
          {
            "parameters": {
              "fieldsToAggregate": {
                "fieldToAggregate": [
                  {
                    "fieldToAggregate": "property_email"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.aggregate",
            "typeVersion": 1,
            "position": [
              784,
              1040
            ],
            "id": "71f8a614-0dc6-4ebf-b028-aaedb66ca5e9",
            "name": "Aggregate1"
          }
        ],
        "connections": {
          "Split Out": {
            "main": [
              [
                {
                  "node": "Busca Pessoas",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate": {
            "main": [
              [
                {
                  "node": "Gera Json para Invite",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "No Operation, do nothing": {
            "main": [
              [
                {
                  "node": "Loop Over Drops",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "Busca Proximos Drops",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger1": {
            "main": [
              [
                {
                  "node": "Busca proximos eventos",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca Proximos Drops": {
            "main": [
              [
                {
                  "node": "Loop Over Drops",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Drops": {
            "main": [
              [],
              [
                {
                  "node": "Split Out",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca Pessoas": {
            "main": [
              [
                {
                  "node": "Aggregate",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Gera Json para Invite": {
            "main": [
              [
                {
                  "node": "Se ID evento esta vazio no notion",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Cria Evento": {
            "main": [
              [
                {
                  "node": "Insere ID Evento no Notion",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Se ID evento esta vazio no notion": {
            "main": [
              [
                {
                  "node": "Cria Evento",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Busca Evento",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Insere ID Evento no Notion": {
            "main": [
              [
                {
                  "node": "Loop Over Drops",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca Evento": {
            "main": [
              [
                {
                  "node": "Se alguma informacao mudou",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Se alguma informacao mudou": {
            "main": [
              [
                {
                  "node": "No Operation, do nothing",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Deleta Evento",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Deleta Evento": {
            "main": [
              [
                {
                  "node": "Cria Novo Evento",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Cria Novo Evento": {
            "main": [
              [
                {
                  "node": "Insere novo ID Evento no Notion",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Insere novo ID Evento no Notion": {
            "main": [
              [
                {
                  "node": "Loop Over Drops",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca proximos eventos": {
            "main": [
              [
                {
                  "node": "Busca proximos drops",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca proximos drops": {
            "main": [
              [
                {
                  "node": "Verifica se algum foi deletado no notion",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Verifica se algum foi deletado no notion": {
            "main": [
              [
                {
                  "node": "se sim Deleta Evento",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca drop da semana": {
            "main": [
              [
                {
                  "node": "Split Out1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Split Out1": {
            "main": [
              [
                {
                  "node": "Busca Pessoas1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Busca Pessoas1": {
            "main": [
              [
                {
                  "node": "Aggregate1",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Edit Fields": {
            "main": [
              [
                {
                  "node": "Send a message",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger2": {
            "main": [
              [
                {
                  "node": "Busca drop da semana",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Aggregate1": {
            "main": [
              [
                {
                  "node": "Edit Fields",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version a943ad4a",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-20T15:10:57.654Z",
            "id": 139,
            "workflowId": "Gd71iDc87upbWWRbk67L4",
            "versionId": "a943ad4a-fcf1-43ff-8ab5-91eb6991fbd8",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-15T18:17:26.231Z",
      "createdAt": "2026-01-15T18:09:37.363Z",
      "id": "JETmLBaO3fj2xDYa-A4Nc",
      "name": "Aviso de Erro",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {},
          "type": "n8n-nodes-base.errorTrigger",
          "typeVersion": 1,
          "position": [
            0,
            0
          ],
          "id": "3ec7be73-3ba0-4ac9-bab8-f96dbdddb276",
          "name": "Error Trigger"
        },
        {
          "parameters": {
            "toRecipients": "douglas.zechin@pierpartners.com.br, mateus.cardoso@pierpartners.com.br, joao.vitor@pierpartners.com.br",
            "subject": "={{`[n8n][FAIL] ${$json.workflow.name} #${$json.workflow.id} | Exec ${$json.execution.id}`}}",
            "bodyContent": "=Ocorreu um erro em um fluxo de trabalho do n8n.\nFluxo de Trabalho: {{$json.workflow.name}}\nID da Execução: {{$json.execution.id}}\nURL da Execução: {{$json.execution.url}}{{$json.execution.url}}\nÚltimo nó que rodou: {{ $json.execution.lastNodeExecuted }}\nDetalhes do Erro: {{ $json.execution.error.message }}",
            "additionalFields": {}
          },
          "type": "n8n-nodes-base.microsoftOutlook",
          "typeVersion": 2,
          "position": [
            208,
            0
          ],
          "id": "e23b02a8-2d5e-4574-af5b-e0c5361824b3",
          "name": "Send a message",
          "webhookId": "6108a58f-6a34-4cc4-80f3-17424c2027ed",
          "credentials": {
            "microsoftOutlookOAuth2Api": {
              "id": "ZreahnvQPfNwTzCn",
              "name": "Cardoso"
            }
          }
        }
      ],
      "connections": {
        "Error Trigger": {
          "main": [
            [
              {
                "node": "Send a message",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "availableInMCP": false
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "39f53063-d891-4c03-abb6-81cc5daf0e18",
      "activeVersionId": "39f53063-d891-4c03-abb6-81cc5daf0e18",
      "versionCounter": 66,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2026-01-15T18:09:37.363Z",
          "createdAt": "2026-01-15T18:09:37.363Z",
          "role": "workflow:owner",
          "workflowId": "JETmLBaO3fj2xDYa-A4Nc",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:50.671Z",
          "createdAt": "2026-01-11T18:30:50.671Z",
          "id": "CDV4a4fZOILmvByk",
          "name": "processos-internos"
        }
      ],
      "activeVersion": {
        "updatedAt": "2026-01-15T18:16:41.193Z",
        "createdAt": "2026-01-15T18:16:09.246Z",
        "versionId": "39f53063-d891-4c03-abb6-81cc5daf0e18",
        "workflowId": "JETmLBaO3fj2xDYa-A4Nc",
        "nodes": [
          {
            "parameters": {},
            "type": "n8n-nodes-base.errorTrigger",
            "typeVersion": 1,
            "position": [
              0,
              0
            ],
            "id": "3ec7be73-3ba0-4ac9-bab8-f96dbdddb276",
            "name": "Error Trigger"
          },
          {
            "parameters": {
              "toRecipients": "douglas.zechin@pierpartners.com.br, mateus.cardoso@pierpartners.com.br, joao.vitor@pierpartners.com.br",
              "subject": "={{`[n8n][FAIL] ${$json.workflow.name} #${$json.workflow.id} | Exec ${$json.execution.id}`}}",
              "bodyContent": "=Ocorreu um erro em um fluxo de trabalho do n8n.\nFluxo de Trabalho: {{$json.workflow.name}}\nID da Execução: {{$json.execution.id}}\nURL da Execução: {{$json.execution.url}}{{$json.execution.url}}\nÚltimo nó que rodou: {{ $json.execution.lastNodeExecuted }}\nDetalhes do Erro: {{ $json.execution.error.message }}",
              "additionalFields": {}
            },
            "type": "n8n-nodes-base.microsoftOutlook",
            "typeVersion": 2,
            "position": [
              208,
              0
            ],
            "id": "e23b02a8-2d5e-4574-af5b-e0c5361824b3",
            "name": "Send a message",
            "webhookId": "6108a58f-6a34-4cc4-80f3-17424c2027ed",
            "credentials": {
              "microsoftOutlookOAuth2Api": {
                "id": "ZreahnvQPfNwTzCn",
                "name": "Cardoso"
              }
            }
          }
        ],
        "connections": {
          "Error Trigger": {
            "main": [
              [
                {
                  "node": "Send a message",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 39f53063",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-15T18:16:41.160Z",
            "id": 126,
            "workflowId": "JETmLBaO3fj2xDYa-A4Nc",
            "versionId": "39f53063-d891-4c03-abb6-81cc5daf0e18",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-01-22T20:54:55.919Z",
      "createdAt": "2026-01-22T20:42:37.817Z",
      "id": "uoyG9WwFxe56M0vy",
      "name": "subflow qdrant atas",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "workflowInputs": {
              "values": [
                {
                  "name": "query"
                },
                {
                  "name": "projeto_id"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.executeWorkflowTrigger",
          "typeVersion": 1.1,
          "position": [
            144,
            2208
          ],
          "id": "ba53666d-5593-4924-a20c-34741be6a2d0",
          "name": "When Executed by Another Workflow"
        },
        {
          "parameters": {
            "method": "POST",
            "url": "https://api.openai.com/v1/embeddings",
            "authentication": "predefinedCredentialType",
            "nodeCredentialType": "openAiApi",
            "sendBody": true,
            "bodyParameters": {
              "parameters": [
                {
                  "name": "input",
                  "value": "=como faler um modelo de m&a"
                },
                {
                  "name": "model",
                  "value": "text-embedding-3-large"
                }
              ]
            },
            "options": {}
          },
          "id": "f8711918-aa9d-4fa1-abc3-d32f170e83ee",
          "name": "Get OpenAI embeddings2",
          "type": "n8n-nodes-base.httpRequest",
          "position": [
            368,
            2208
          ],
          "typeVersion": 4.2,
          "credentials": {
            "openAiApi": {
              "id": "qOLCslk7RAXP7UBp",
              "name": "OpenAi account"
            }
          }
        },
        {
          "parameters": {
            "resource": "search",
            "operation": "queryPoints",
            "collectionName": {
              "__rl": true,
              "value": "atas",
              "mode": "list",
              "cachedResultName": "atas"
            },
            "query": "={{ $json.data[0].embedding.toJsonString() }}",
            "filter": "={\n    \"must\": [\n      {\n        \"key\": \"projeto\",\n        \"match\": {\n          \"value\": \"19902cfe-4c0e-80e5-a0ac-f8cc14f25de7\"\n        }\n      }\n    ]\n  } ",
            "requestOptions": {}
          },
          "type": "n8n-nodes-qdrant.qdrant",
          "typeVersion": 1,
          "position": [
            592,
            2208
          ],
          "id": "5cd3719d-5ab9-418b-8594-b8eb25bbc7b4",
          "name": "Query Points",
          "credentials": {
            "qdrantRestApi": {
              "id": "DyeI41wEFTwZpaf7",
              "name": "Qdrant account"
            }
          }
        }
      ],
      "connections": {
        "When Executed by Another Workflow": {
          "main": [
            [
              {
                "node": "Get OpenAI embeddings2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get OpenAI embeddings2": {
          "main": [
            [
              {
                "node": "Query Points",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "availableInMCP": false
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "When Executed by Another Workflow": [
          {
            "json": {
              "query": "pricing",
              "projeto_id": "19902cfe-4c0e-80e5-a0ac-f8cc14f25de7"
            }
          }
        ]
      },
      "versionId": "cd04dd40-c930-42a1-aae3-ddd91e279e32",
      "activeVersionId": "cd04dd40-c930-42a1-aae3-ddd91e279e32",
      "versionCounter": 46,
      "triggerCount": 0,
      "shared": [
        {
          "updatedAt": "2026-01-22T20:42:37.817Z",
          "createdAt": "2026-01-22T20:42:37.817Z",
          "role": "workflow:owner",
          "workflowId": "uoyG9WwFxe56M0vy",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [
        {
          "updatedAt": "2026-01-11T18:30:01.637Z",
          "createdAt": "2026-01-11T18:30:01.637Z",
          "id": "qgFYYFG154gb0OYi",
          "name": "knowledge-base"
        }
      ],
      "activeVersion": {
        "updatedAt": "2026-01-22T21:11:59.375Z",
        "createdAt": "2026-01-22T20:54:55.922Z",
        "versionId": "cd04dd40-c930-42a1-aae3-ddd91e279e32",
        "workflowId": "uoyG9WwFxe56M0vy",
        "nodes": [
          {
            "parameters": {
              "workflowInputs": {
                "values": [
                  {
                    "name": "query"
                  },
                  {
                    "name": "projeto_id"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.executeWorkflowTrigger",
            "typeVersion": 1.1,
            "position": [
              144,
              2208
            ],
            "id": "ba53666d-5593-4924-a20c-34741be6a2d0",
            "name": "When Executed by Another Workflow"
          },
          {
            "parameters": {
              "method": "POST",
              "url": "https://api.openai.com/v1/embeddings",
              "authentication": "predefinedCredentialType",
              "nodeCredentialType": "openAiApi",
              "sendBody": true,
              "bodyParameters": {
                "parameters": [
                  {
                    "name": "input",
                    "value": "=como faler um modelo de m&a"
                  },
                  {
                    "name": "model",
                    "value": "text-embedding-3-large"
                  }
                ]
              },
              "options": {}
            },
            "id": "f8711918-aa9d-4fa1-abc3-d32f170e83ee",
            "name": "Get OpenAI embeddings2",
            "type": "n8n-nodes-base.httpRequest",
            "position": [
              368,
              2208
            ],
            "typeVersion": 4.2,
            "credentials": {
              "openAiApi": {
                "id": "qOLCslk7RAXP7UBp",
                "name": "OpenAi account"
              }
            }
          },
          {
            "parameters": {
              "resource": "search",
              "operation": "queryPoints",
              "collectionName": {
                "__rl": true,
                "value": "atas",
                "mode": "list",
                "cachedResultName": "atas"
              },
              "query": "={{ $json.data[0].embedding.toJsonString() }}",
              "filter": "={\n    \"must\": [\n      {\n        \"key\": \"projeto\",\n        \"match\": {\n          \"value\": \"19902cfe-4c0e-80e5-a0ac-f8cc14f25de7\"\n        }\n      }\n    ]\n  } ",
              "requestOptions": {}
            },
            "type": "n8n-nodes-qdrant.qdrant",
            "typeVersion": 1,
            "position": [
              592,
              2208
            ],
            "id": "5cd3719d-5ab9-418b-8594-b8eb25bbc7b4",
            "name": "Query Points",
            "credentials": {
              "qdrantRestApi": {
                "id": "DyeI41wEFTwZpaf7",
                "name": "Qdrant account"
              }
            }
          }
        ],
        "connections": {
          "When Executed by Another Workflow": {
            "main": [
              [
                {
                  "node": "Get OpenAI embeddings2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get OpenAI embeddings2": {
            "main": [
              [
                {
                  "node": "Query Points",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version cd04dd40",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-01-22T21:11:59.371Z",
            "id": 156,
            "workflowId": "uoyG9WwFxe56M0vy",
            "versionId": "cd04dd40-c930-42a1-aae3-ddd91e279e32",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-02-03T18:51:02.183Z",
      "createdAt": "2026-02-01T20:10:04.801Z",
      "id": "8oiVRxamU8Q8FCTdW7wWw",
      "name": "My workflow 22",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.chatTrigger",
          "typeVersion": 1.4,
          "position": [
            0,
            0
          ],
          "id": "8cb1ac16-1ec1-406e-8fa5-c6c317f62487",
          "name": "When chat message received",
          "webhookId": "36d919b3-0375-4e0f-b0fc-3e04456fe722"
        },
        {
          "parameters": {
            "options": {
              "systemMessage": "Você é um agente de vendas da Rodoil. Seu playbook é o seguinte:\n1. Identifique o cliente pelo nome\n2. ⁠Veja que preços estamos praticando com ele hoje\n3. ⁠Leia o último pedido feito pelo cliente e peça se ele quer repetir usando os preços de hoje. Mostre como ficaria o pedido\n4. ⁠Valide se pedido fica dentro do limite do cliente. Considere pedidos que não estejam finalizados\n4. ⁠Crie o pedido, mas antes confirme com o cliente se está tudo certo\n\nObs:\n- Você só precisa do primeiro nome do cliente (sem CNPJ, CPF, cidade, etc)\n- Se não localizar nenhum pedido, dê boas vindas e tire o pedido. Mas o cliente deve constar na tabela de preços\n- Você só precisa saber o volume e informar o preço para tirar o pedido\n- É possível que a lista de pedido volte vazia se ainda não foi feito nenhum pedido"
            }
          },
          "type": "@n8n/n8n-nodes-langchain.agent",
          "typeVersion": 3.1,
          "position": [
            208,
            0
          ],
          "id": "72c32b7d-67fa-4128-bed8-5644c132ce06",
          "name": "AI Agent"
        },
        {
          "parameters": {
            "model": {
              "__rl": true,
              "value": "gpt-5.2-chat-latest",
              "mode": "list",
              "cachedResultName": "gpt-5.2-chat-latest"
            },
            "builtInTools": {},
            "options": {}
          },
          "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
          "typeVersion": 1.3,
          "position": [
            48,
            208
          ],
          "id": "8a9e67c3-63b0-42b0-beb8-4e2e79aa73e2",
          "name": "OpenAI Chat Model",
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "sessionIdType": "customKey",
            "sessionKey": "={{ $('When chat message received').first().json.sessionId }}\n",
            "contextWindowLength": 10
          },
          "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
          "typeVersion": 1.3,
          "position": [
            208,
            208
          ],
          "id": "2178ea12-0fb3-401a-8ae1-f14f4db9a996",
          "name": "Simple Memory"
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Cria pedidos. Deve ser informado o preço e volume de ao menos um combustível",
            "operation": "append",
            "documentId": {
              "__rl": true,
              "value": "14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris",
              "mode": "list",
              "cachedResultName": "Exemplo Rodoil",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Pedidos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit#gid=0"
            },
            "columns": {
              "mappingMode": "defineBelow",
              "value": {
                "Cliente": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Cliente', ``, 'string') }}",
                "Data": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Data', ``, 'string') }}",
                "Status": "Em implantação",
                "Volume Gasolina": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Volume_Gasolina', ``, 'string') }}",
                "Volume Diesel": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Volume_Diesel', ``, 'string') }}",
                "Preço Galosina": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Pre_o_Galosina', ``, 'string') }}",
                "Valor Total": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Valor_Total', ``, 'string') }}",
                "Valor Diesel": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Valor_Diesel', ``, 'string') }}",
                "Valor Gasolina": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Valor_Gasolina', ``, 'string') }}",
                "Preço Diesel": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Pre_o_Diesel', ``, 'string') }}",
                "Forma de pagamento": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Forma_de_pagamento', ``, 'string') }}"
              },
              "matchingColumns": [],
              "schema": [
                {
                  "id": "Cliente",
                  "displayName": "Cliente",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Data",
                  "displayName": "Data",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Status",
                  "displayName": "Status",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Forma de pagamento",
                  "displayName": "Forma de pagamento",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true,
                  "removed": false
                },
                {
                  "id": "Volume Gasolina",
                  "displayName": "Volume Gasolina",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Volume Diesel",
                  "displayName": "Volume Diesel",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Preço Galosina",
                  "displayName": "Preço Galosina",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Preço Diesel",
                  "displayName": "Preço Diesel",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Valor Gasolina",
                  "displayName": "Valor Gasolina",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Valor Diesel",
                  "displayName": "Valor Diesel",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                },
                {
                  "id": "Valor Total",
                  "displayName": "Valor Total",
                  "required": false,
                  "defaultMatch": false,
                  "display": true,
                  "type": "string",
                  "canBeUsedToMatch": true
                }
              ],
              "attemptToConvertTypes": false,
              "convertFieldsToString": false
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            496,
            208
          ],
          "id": "8d2954ef-0d37-43b5-8f32-44d4b1a0168e",
          "name": "Criar pedidos",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "lMFiT7SzuPJCIRBD",
              "name": "Google Sheets account"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Lista preços e limite de crédito por cliente",
            "authentication": "serviceAccount",
            "documentId": {
              "__rl": true,
              "value": "14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris",
              "mode": "list",
              "cachedResultName": "Exemplo Rodoil",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": 105560877,
              "mode": "list",
              "cachedResultName": "Preços e limite de crédito",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit#gid=105560877"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Cliente",
                  "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            640,
            208
          ],
          "id": "d823e988-d397-4ae7-b880-d1f817c272c0",
          "name": "Listar preços e limite por cliente",
          "credentials": {
            "googleApi": {
              "id": "eiIuzHtcptz8Oky1",
              "name": "Google Sheets account 2"
            }
          }
        },
        {
          "parameters": {
            "descriptionType": "manual",
            "toolDescription": "Lista pedidos",
            "documentId": {
              "__rl": true,
              "value": "14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris",
              "mode": "list",
              "cachedResultName": "Exemplo Rodoil",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit?usp=drivesdk"
            },
            "sheetName": {
              "__rl": true,
              "value": "gid=0",
              "mode": "list",
              "cachedResultName": "Pedidos",
              "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit#gid=0"
            },
            "filtersUI": {
              "values": [
                {
                  "lookupColumn": "Cliente",
                  "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                }
              ]
            },
            "options": {}
          },
          "type": "n8n-nodes-base.googleSheetsTool",
          "typeVersion": 4.7,
          "position": [
            352,
            208
          ],
          "id": "1a9bf9f9-6098-44d1-b587-afb309230ced",
          "name": "Listar pedidos",
          "credentials": {
            "googleSheetsOAuth2Api": {
              "id": "lMFiT7SzuPJCIRBD",
              "name": "Google Sheets account"
            }
          }
        }
      ],
      "connections": {
        "When chat message received": {
          "main": [
            [
              {
                "node": "AI Agent",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "OpenAI Chat Model": {
          "ai_languageModel": [
            [
              {
                "node": "AI Agent",
                "type": "ai_languageModel",
                "index": 0
              }
            ]
          ]
        },
        "Simple Memory": {
          "ai_memory": [
            [
              {
                "node": "AI Agent",
                "type": "ai_memory",
                "index": 0
              }
            ]
          ]
        },
        "Listar preços e limite por cliente": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Criar pedidos": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        },
        "Listar pedidos": {
          "ai_tool": [
            [
              {
                "node": "AI Agent",
                "type": "ai_tool",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "availableInMCP": false
      },
      "staticData": null,
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {},
      "versionId": "c928be73-99ad-45c0-86de-52965487eee2",
      "activeVersionId": "6f920e06-88d9-4ba5-840d-faddcdea3f23",
      "versionCounter": 135,
      "triggerCount": 1,
      "shared": [
        {
          "updatedAt": "2026-02-01T20:10:04.801Z",
          "createdAt": "2026-02-01T20:10:04.801Z",
          "role": "workflow:owner",
          "workflowId": "8oiVRxamU8Q8FCTdW7wWw",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [],
      "activeVersion": {
        "updatedAt": "2026-02-01T20:38:54.283Z",
        "createdAt": "2026-02-01T20:37:53.668Z",
        "versionId": "6f920e06-88d9-4ba5-840d-faddcdea3f23",
        "workflowId": "8oiVRxamU8Q8FCTdW7wWw",
        "nodes": [
          {
            "parameters": {
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.chatTrigger",
            "typeVersion": 1.4,
            "position": [
              0,
              0
            ],
            "id": "8cb1ac16-1ec1-406e-8fa5-c6c317f62487",
            "name": "When chat message received",
            "webhookId": "36d919b3-0375-4e0f-b0fc-3e04456fe722"
          },
          {
            "parameters": {
              "options": {
                "systemMessage": "Você é um agente de vendas da Rodoil. Seu playook é o seguinte:\n1. Identifique o cliente pelo nome\n2. ⁠Veja que preços estamos praticando com ele hoje\n3. ⁠Leia o último pedido feito pelo cliente e peça se ele quer repetir usando os preços de hoje. Mostre como ficaria o pedido\n4. ⁠Valide se pedido fica dentro do limite do cliente. Considere pedidos que não estejam finalizados\n4. ⁠Crie o pedido, mas antes confirme com o cliente se está tudo certo\n\nObs:\n- Você só precisa do primeiro nome do cliente (sem CNPJ, CPF, cidade, etc)\n- Se não localizar nenhum pedido, dê boas vindas e tire o pedido. Mas o cliente deve constar na tabela de preços\n- Você só precisa saber o volume e informar o preço para tirar o pedido\n- É possível que a lista de pedido volte vazia se ainda não foi feito nenhum pedido"
              }
            },
            "type": "@n8n/n8n-nodes-langchain.agent",
            "typeVersion": 3.1,
            "position": [
              208,
              0
            ],
            "id": "72c32b7d-67fa-4128-bed8-5644c132ce06",
            "name": "AI Agent"
          },
          {
            "parameters": {
              "model": {
                "__rl": true,
                "value": "gpt-5.2-chat-latest",
                "mode": "list",
                "cachedResultName": "gpt-5.2-chat-latest"
              },
              "builtInTools": {},
              "options": {}
            },
            "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
            "typeVersion": 1.3,
            "position": [
              64,
              208
            ],
            "id": "8a9e67c3-63b0-42b0-beb8-4e2e79aa73e2",
            "name": "OpenAI Chat Model",
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "sessionIdType": "customKey",
              "sessionKey": "={{ $('When chat message received').first().json.sessionId }}\n",
              "contextWindowLength": 10
            },
            "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
            "typeVersion": 1.3,
            "position": [
              192,
              208
            ],
            "id": "2178ea12-0fb3-401a-8ae1-f14f4db9a996",
            "name": "Simple Memory"
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Cria pedidos. Deve ser informado o preço e volume de ao menos um combustível",
              "operation": "append",
              "documentId": {
                "__rl": true,
                "value": "14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris",
                "mode": "list",
                "cachedResultName": "Exemplo Rodoil",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit?usp=drivesdk"
              },
              "sheetName": {
                "__rl": true,
                "value": "gid=0",
                "mode": "list",
                "cachedResultName": "Pedidos",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit#gid=0"
              },
              "columns": {
                "mappingMode": "defineBelow",
                "value": {
                  "Cliente": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Cliente', ``, 'string') }}",
                  "Data": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Data', ``, 'string') }}",
                  "Status": "Em implantação",
                  "Volume Gasolina": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Volume_Gasolina', ``, 'string') }}",
                  "Volume Diesel": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Volume_Diesel', ``, 'string') }}",
                  "Preço Galosina": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Pre_o_Galosina', ``, 'string') }}",
                  "Valor Total": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Valor_Total', ``, 'string') }}",
                  "Valor Diesel": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Valor_Diesel', ``, 'string') }}",
                  "Valor Gasolina": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Valor_Gasolina', ``, 'string') }}",
                  "Preço Diesel": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Pre_o_Diesel', ``, 'string') }}",
                  "Forma de pagamento": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('Forma_de_pagamento', ``, 'string') }}"
                },
                "matchingColumns": [],
                "schema": [
                  {
                    "id": "Cliente",
                    "displayName": "Cliente",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Data",
                    "displayName": "Data",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Status",
                    "displayName": "Status",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Forma de pagamento",
                    "displayName": "Forma de pagamento",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true,
                    "removed": false
                  },
                  {
                    "id": "Volume Gasolina",
                    "displayName": "Volume Gasolina",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Volume Diesel",
                    "displayName": "Volume Diesel",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Preço Galosina",
                    "displayName": "Preço Galosina",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Preço Diesel",
                    "displayName": "Preço Diesel",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Valor Gasolina",
                    "displayName": "Valor Gasolina",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Valor Diesel",
                    "displayName": "Valor Diesel",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  },
                  {
                    "id": "Valor Total",
                    "displayName": "Valor Total",
                    "required": false,
                    "defaultMatch": false,
                    "display": true,
                    "type": "string",
                    "canBeUsedToMatch": true
                  }
                ],
                "attemptToConvertTypes": false,
                "convertFieldsToString": false
              },
              "options": {}
            },
            "type": "n8n-nodes-base.googleSheetsTool",
            "typeVersion": 4.7,
            "position": [
              416,
              432
            ],
            "id": "8d2954ef-0d37-43b5-8f32-44d4b1a0168e",
            "name": "Criar pedidos",
            "credentials": {
              "googleSheetsOAuth2Api": {
                "id": "lMFiT7SzuPJCIRBD",
                "name": "Google Sheets account"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Lista pedidos",
              "documentId": {
                "__rl": true,
                "value": "14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris",
                "mode": "list",
                "cachedResultName": "Exemplo Rodoil",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit?usp=drivesdk"
              },
              "sheetName": {
                "__rl": true,
                "value": "gid=0",
                "mode": "list",
                "cachedResultName": "Pedidos",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit#gid=0"
              },
              "filtersUI": {
                "values": [
                  {
                    "lookupColumn": "Cliente",
                    "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.googleSheetsTool",
            "typeVersion": 4.7,
            "position": [
              416,
              256
            ],
            "id": "1a9bf9f9-6098-44d1-b587-afb309230ced",
            "name": "Listar pedidos",
            "credentials": {
              "googleSheetsOAuth2Api": {
                "id": "lMFiT7SzuPJCIRBD",
                "name": "Google Sheets account"
              }
            }
          },
          {
            "parameters": {
              "descriptionType": "manual",
              "toolDescription": "Lista preços e limite de crédito por cliente",
              "authentication": "serviceAccount",
              "documentId": {
                "__rl": true,
                "value": "14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris",
                "mode": "list",
                "cachedResultName": "Exemplo Rodoil",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit?usp=drivesdk"
              },
              "sheetName": {
                "__rl": true,
                "value": 105560877,
                "mode": "list",
                "cachedResultName": "Preços e limite de crédito",
                "cachedResultUrl": "https://docs.google.com/spreadsheets/d/14blEQdOzCXfM_nl_P4O5JWjXi3BSZPanLjEQTJ33ris/edit#gid=105560877"
              },
              "filtersUI": {
                "values": [
                  {
                    "lookupColumn": "Cliente",
                    "lookupValue": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
                  }
                ]
              },
              "options": {}
            },
            "type": "n8n-nodes-base.googleSheetsTool",
            "typeVersion": 4.7,
            "position": [
              560,
              256
            ],
            "id": "d823e988-d397-4ae7-b880-d1f817c272c0",
            "name": "Listar preços e limite por cliente",
            "credentials": {
              "googleApi": {
                "id": "eiIuzHtcptz8Oky1",
                "name": "Google Sheets account 2"
              }
            }
          }
        ],
        "connections": {
          "When chat message received": {
            "main": [
              [
                {
                  "node": "AI Agent",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "OpenAI Chat Model": {
            "ai_languageModel": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_languageModel",
                  "index": 0
                }
              ]
            ]
          },
          "Simple Memory": {
            "ai_memory": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_memory",
                  "index": 0
                }
              ]
            ]
          },
          "Listar pedidos": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Listar preços e limite por cliente": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          },
          "Criar pedidos": {
            "ai_tool": [
              [
                {
                  "node": "AI Agent",
                  "type": "ai_tool",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 6f920e06",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-02-01T20:38:54.256Z",
            "id": 296,
            "workflowId": "8oiVRxamU8Q8FCTdW7wWw",
            "versionId": "6f920e06-88d9-4ba5-840d-faddcdea3f23",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    },
    {
      "updatedAt": "2026-02-14T17:45:28.202Z",
      "createdAt": "2026-02-09T17:02:49.887Z",
      "id": "9RXJ-hlStfYdNxlhDaV_1",
      "name": "Atualizador Memória Projeto",
      "description": null,
      "active": true,
      "isArchived": false,
      "nodes": [
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "novo_evento_memoria",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -608,
            16
          ],
          "id": "47af37fa-3e98-4368-87db-d262ebc7868b",
          "name": "Webhook3",
          "webhookId": "926e7ce4-c35b-4188-915b-b14e47b5fc89"
        },
        {
          "parameters": {
            "modelId": {
              "__rl": true,
              "value": "gpt-5.2",
              "mode": "list",
              "cachedResultName": "GPT-5.2"
            },
            "responses": {
              "values": [
                {
                  "content": "=# Agente de Atualização de Memória de Projetos — Píer Partners\n\n## Papel\nVocê é um agente especializado em manter a memória institucional de projetos da Píer Partners atualizada. Sua função é receber um documento (ata de reunião, atualização geral, nota técnica, etc.), extrair as informações relevantes e produzir uma versão atualizada da memória do projeto, preservando o histórico e incorporando as novidades.\n\n## Entradas\n\nVocê receberá cinco blocos de informação:\n\n### 1. Memória Atual do Projeto\n<memoria_atual>\n{{ $json.memoria || \"Ainda não há memória para esse projeto\"}}\n</memoria_atual>\n\n### 2. Novo Documento\n<novo_documento>\n{{ $('Webhook3').item.json.body.record.texto }}\n</novo_documento>\n\n### 3. Tipo de Documento\n<tipo_documento>\n{{ $('Webhook3').item.json.body.record.origem }}\n</tipo_documento>\n\n### 4. Data do Documento\n<data_documento>\n{{ $('Webhook3').item.json.body.record.created_at }}\n</data_documento>\n\n### 5. Criador do Documento\n<criador_documento>\n{{ $('Webhook3').item.json.body.record.criador || \"Sem criador específico\" }}\n</criador_documento>\n\nTipos possíveis:\n- **atas_notion**: Ata de reunião (contém decisões, participantes, próximos passos, pendências)\n- **atualizacao_geral**: Atualização informal ou resumo de status do projeto\n- **nota_tecnica**: Informação técnica, análise, parecer ou dado específico\n- **email**: Trecho relevante de comunicação por e-mail\n- **decisao**: Registro de decisão isolada tomada fora de reunião\n\n### 4. Contexto do Projeto\n<contexto_projeto>\n- **Nome do Projeto:** {{ $('Get a database page').item.json.name }}\n- **Cliente/Contraparte:** {{ $('Get a database page').item.json.property_empresa }}\n- **Equipe Píer Responsável:** {{ $('Get a database page').item.json.property_status }}\n- **Equipe Píer Responsável:** {{ $('Get a database page').item.json.property_pessoas_alocadas.replaceAll(\" \", \", \") }}\n- **Última atualização do gestor:** {{ $('Get a database page').item.json.property_atualiza_es }}\n- **Última atualização do gestor (tarefas da semana):** {{ $('Get a database page').item.json.property_tarefas_semana }}\n- **Data da última atualização do gestor:** {{ $('Get a database page').item.json.property_ltima_edi_o }}\n</contexto_projeto>\n\n## Instruções de Processamento\n\n### Extração\n1. Leia o novo documento e identifique todas as informações que alteram, complementam ou contradizem a memória atual.\n2. Classifique cada informação extraída em uma das categorias:\n   - **Fato novo**: informação que não existia na memória\n   - **Atualização**: informação que modifica algo já registrado\n   - **Confirmação**: informação que reforça algo já existente (não requer alteração)\n   - **Contradição**: informação que conflita com o registro atual (requer atenção especial)\n\n### Regras de Atualização\n- **Nunca apague informações históricas.** Se algo mudou, registre a mudança e mantenha o contexto anterior quando relevante (ex: \"Prazo revisado de Jun/25 para Ago/25 conforme reunião de 09/02\").\n- **Preserve a estrutura da memória atual.** Se a memória já tem seções definidas, mantenha-as. Adicione novas seções apenas se necessário.\n- **Marque contradições explicitamente** quando o novo documento contradiz a memória sem resolução clara. Use o formato: `⚠️ CONTRADIÇÃO: [descrição]`.\n- **Registre a fonte e data** de cada alteração significativa entre parênteses. Ex: \"(Ata 09/02/2026)\".\n- **Próximos passos e pendências**: atualize a lista removendo itens concluídos (mova para histórico se relevante) e adicionando novos.\n- **Entregáveis**: atualize o status dos entregáveis quando o documento mencionar progresso, conclusão ou mudança de prazo. Mantenha o histórico de alterações de prazo.\n- **Participantes e stakeholders**: adicione novos nomes/papéis mencionados sem remover os existentes.\n- **Datas e prazos**: atualize sempre com referência à fonte da mudança.\n- **Se a memória atual estiver vazia**, crie a estrutura inicial a partir do contexto do projeto, entregáveis e documento recebido.\n\n### Estrutura Padrão da Memória (usar quando criando do zero)\n```\n# [Nome do Projeto]\n\n## Resumo Executivo\nBreve descrição do projeto, objetivo e status atual.\n\n## Informações Gerais\n- **Cliente/Contraparte:**\n- **Tipo de Operação:**\n- **Setor/Indústria:**\n- **Equipe Píer:**\n- **Confidencialidade:**\n- **Status:**\n- **Início:**\n- **Prazo estimado:**\n\n## Contexto e Escopo\nDescrição do escopo, motivação e contexto do projeto.\n\n## Entregáveis\n| Entregável | Responsável | Prazo | Status |\n|---|---|---|---|\n| ... | ... | ... | ... |\n\n## Status Atual\nO que está acontecendo agora — workstreams ativos, fase atual, blockers.\n\n## Decisões-Chave\nLista cronológica das decisões mais importantes tomadas.\n\n## Pendências e Próximos Passos\n- [ ] Pendência 1 — Responsável — Prazo\n- [ ] Pendência 2 — Responsável — Prazo\n\n## Riscos e Pontos de Atenção\nItens que podem impactar prazo, escopo ou resultado do projeto.\n\n## Stakeholders e Participantes\nMapa de pessoas envolvidas e seus papéis.\n\n## Histórico de Atualizações\nRegistro cronológico reverso (mais recente primeiro) das principais mudanças.\n```\n\n## Formato de Saída\n\n- Retorne um json com o changelod e a memoria_atualizada, cada um em uma chave\n- Os valores de cada chave devem estar em formato markdown\n\n### Chave 1: changelog\nUm resumo conciso das alterações feitas, no formato:\n\n**Data do documento fonte:** [data]\n**Tipo:** [tipo_documento]\n\n**Alterações realizadas:**\n- [NOVO] Descrição do que foi adicionado\n- [ATUALIZADO] Descrição do que foi modificado (de → para)\n- [CONTRADIÇÃO] Descrição do conflito identificado\n- [CONCLUÍDO] Item removido de pendências / entregável finalizado\n- [RISCO] Novo risco ou ponto de atenção identificado\n\n### Chave 2: memoria_atualizada\nA memória completa e atualizada do projeto, pronta para substituir a versão anterior.\n\n## Diretrizes Gerais\n- Seja objetivo e conciso. Não adicione interpretações ou suposições.\n- Use linguagem profissional compatível com o contexto de M&A e finanças corporativas.\n- Mantenha consistência de formato e terminologia ao longo da memória.\n- Na dúvida entre manter ou descartar uma informação do novo documento, **mantenha**.\n- Se o documento contiver informações claramente irrelevantes para o projeto (small talk, assuntos pessoais), ignore-as.\n- Ao atualizar entregáveis, trate mudanças de prazo como informação crítica — sempre registre o prazo anterior."
                }
              ]
            },
            "builtInTools": {},
            "options": {
              "textFormat": {
                "textOptions": {
                  "type": "json_schema",
                  "name": "memoria_e_changelog",
                  "schema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"changelog\": {\n      \"type\": \"string\"\n    },\n    \"memoria_atualizada\": {\n      \"type\": \"string\"\n    }\n  },\n  \"additionalProperties\": false,\n  \"required\": [\"changelog\", \"memoria_atualizada\"]\n}"
                }
              }
            }
          },
          "type": "@n8n/n8n-nodes-langchain.openAi",
          "typeVersion": 2.1,
          "position": [
            80,
            16
          ],
          "id": "c6687527-6bc4-4734-b5cb-60c355af8cb3",
          "name": "Message a model",
          "credentials": {
            "openAiApi": {
              "id": "g3Ikw9hUcV3sNHD2",
              "name": "OpenAi ppt-interact"
            }
          }
        },
        {
          "parameters": {
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "operation": "get",
            "tableId": "memorias_projetos",
            "filters": {
              "conditions": [
                {
                  "keyName": "projeto_id",
                  "keyValue": "={{ $json.body.record.projeto_id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -144,
            16
          ],
          "id": "d2a297ef-5370-4770-a0a4-bd4da67fbc2b",
          "name": "Get a row",
          "alwaysOutputData": true,
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "operation": "update",
            "tableId": "memorias_projetos",
            "filters": {
              "conditions": [
                {
                  "keyName": "id",
                  "condition": "eq",
                  "keyValue": "={{ $('Get a row').item.json.id }}"
                }
              ]
            },
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "memoria",
                  "fieldValue": "={{ $json.output[0].content[0].text.memoria_atualizada }}"
                },
                {
                  "fieldId": "last_event",
                  "fieldValue": "={{ $('Webhook3').item.json.body.record.id }}"
                },
                {
                  "fieldId": "changelog",
                  "fieldValue": "={{ $json.output[0].content[0].text.changelog }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            640,
            0
          ],
          "id": "d9c782fa-9400-4d9d-8b12-efa3eeb6c348",
          "name": "Update a row",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "content": "## Atualiza a memória do projeto quando um novo evento acontece",
            "height": 544,
            "width": 1552
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -640,
            -64
          ],
          "id": "8628785b-4857-4f6e-83f4-81939080a961",
          "name": "Sticky Note"
        },
        {
          "parameters": {
            "jsCode": "let output = [];\n\n// --- PART 1: Process the blocks (Your existing logic) ---\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nconst finalContent = output.join('\\n\\n');\n\n// --- PART 2: Retrieve Metadata safely ---\n// We pull the ID, Name, and URL from the 'Edit Fields2' node \n// that ran immediately before this execution.\nconst metadata = $('Webhook1').first().json;\n\n// --- PART 3: Return Combined Data ---\n// We return ONE object containing both the Metadata and the Content.\nreturn [\n  {\n    json: {\n      ...metadata,          // Inherits: id, name, url, property_tema_natureza\n      content: finalContent // Adds: The generated text\n    }\n  }\n];"
          },
          "type": "n8n-nodes-base.code",
          "typeVersion": 2,
          "position": [
            240,
            624
          ],
          "id": "655f72ab-42dd-41a7-b57d-5b54e542b746",
          "name": "Code in JavaScript",
          "executeOnce": false
        },
        {
          "parameters": {
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "tableId": "memorias_projetos_eventos",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "projeto_id",
                  "fieldValue": "={{ $json.body.data.properties.Projetos.relation[0].id }}"
                },
                {
                  "fieldId": "texto",
                  "fieldValue": "={{ $json.content }}"
                },
                {
                  "fieldId": "origem",
                  "fieldValue": "atas_notion"
                },
                {
                  "fieldId": "id_na_origem",
                  "fieldValue": "={{ $json.body.data.id }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            432,
            624
          ],
          "id": "e41d1f68-0b7e-48ed-908d-50c363b1444b",
          "name": "Create a row2",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "resource": "block",
            "operation": "getAll",
            "blockId": {
              "__rl": true,
              "value": "={{ $json.body.data.id }}",
              "mode": "id"
            },
            "returnAll": true
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            32,
            624
          ],
          "id": "3e7db6cb-69b3-47ae-a053-e80493863494",
          "name": "Get many child blocks",
          "alwaysOutputData": true,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "content": "## Cria evento no supabase quando ata é finalizada no notion",
            "height": 272,
            "width": 896
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -208,
            544
          ],
          "id": "785ed955-4f1a-41c0-b3c7-d586bc6e6b6c",
          "name": "Sticky Note3"
        },
        {
          "parameters": {
            "httpMethod": "POST",
            "path": "e18bf982-d865-4c6d-99d2-c1b9f619ba97",
            "options": {}
          },
          "type": "n8n-nodes-base.webhook",
          "typeVersion": 2.1,
          "position": [
            -144,
            624
          ],
          "id": "c57930d2-c25c-43bb-ad65-40f05a20e452",
          "name": "Webhook1",
          "webhookId": "e18bf982-d865-4c6d-99d2-c1b9f619ba97"
        },
        {
          "parameters": {
            "resource": "databasePage",
            "operation": "get",
            "pageId": {
              "__rl": true,
              "mode": "id",
              "value": "={{ $json.body.record.projeto_id }}",
              "__regex": "^([0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12})"
            }
          },
          "type": "n8n-nodes-base.notion",
          "typeVersion": 2.2,
          "position": [
            -368,
            16
          ],
          "id": "8239a9ad-0ce7-4fd7-a7e4-1cb0d1772e2c",
          "name": "Get a database page",
          "alwaysOutputData": true,
          "credentials": {
            "notionApi": {
              "id": "QJqIInVEAt8nkp5t",
              "name": "Notion Pier"
            }
          }
        },
        {
          "parameters": {
            "conditions": {
              "options": {
                "caseSensitive": true,
                "leftValue": "",
                "typeValidation": "strict",
                "version": 3
              },
              "conditions": [
                {
                  "id": "ce31056b-e656-4a48-8763-cfcd35e79a23",
                  "leftValue": "={{ $('Get a row').item.json.memoria }}",
                  "rightValue": "",
                  "operator": {
                    "type": "string",
                    "operation": "exists",
                    "singleValue": true
                  }
                }
              ],
              "combinator": "and"
            },
            "options": {}
          },
          "type": "n8n-nodes-base.if",
          "typeVersion": 2.3,
          "position": [
            416,
            16
          ],
          "id": "9ba83bd5-7eb8-427c-ac0e-6679c82e2aa6",
          "name": "If"
        },
        {
          "parameters": {
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "tableId": "memorias_projetos",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "memoria",
                  "fieldValue": "={{ $json.output[0].content[0].text.memoria_atualizada }}"
                },
                {
                  "fieldId": "last_event",
                  "fieldValue": "={{ $('Webhook3').item.json.body.record.id }}"
                },
                {
                  "fieldId": "projeto_id",
                  "fieldValue": "={{ $('Webhook3').item.json.body.record.projeto_id }}"
                },
                {
                  "fieldId": "changelog",
                  "fieldValue": "={{ $json.output[0].content[0].text.changelog }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            640,
            208
          ],
          "id": "6374325a-a4e7-4c06-9557-028231ce12fd",
          "name": "Create a row",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "content": "## Cria evento no supabase para cada projeto atualizado no fim de semana",
            "height": 336,
            "width": 1264
          },
          "type": "n8n-nodes-base.stickyNote",
          "typeVersion": 1,
          "position": [
            -336,
            912
          ],
          "id": "8e5a63da-0df4-4ef7-91d4-775faefd2cc0",
          "name": "Sticky Note4"
        },
        {
          "parameters": {
            "rule": {
              "interval": [
                {
                  "field": "cronExpression",
                  "expression": "0 20 * * 0"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.scheduleTrigger",
          "typeVersion": 1.3,
          "position": [
            -288,
            1008
          ],
          "id": "6eefd267-1436-49c5-86de-be2a41bf5ff2",
          "name": "Schedule Trigger"
        },
        {
          "parameters": {
            "useCustomSchema": true,
            "schema": "notion",
            "operation": "getAll",
            "tableId": "projetos",
            "returnAll": true,
            "matchType": "allFilters",
            "filters": {
              "conditions": [
                {
                  "keyName": "atualizacoes",
                  "condition": "neq",
                  "keyValue": "="
                },
                {
                  "keyName": "status",
                  "condition": "eq",
                  "keyValue": "Ativo"
                },
                {
                  "keyName": "gestor_de_projeto",
                  "condition": "neq",
                  "keyValue": "None"
                },
                {
                  "keyName": "last_edited_time",
                  "condition": "gt",
                  "keyValue": "={{ DateTime.now().minus({ days: 4 }).toFormat('yyyy-MM-dd') }}"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            -80,
            1008
          ],
          "id": "eefc4e33-af05-4a1d-9f35-0351ddcd2cfa",
          "name": "Get many rows",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        },
        {
          "parameters": {
            "options": {}
          },
          "type": "n8n-nodes-base.splitInBatches",
          "typeVersion": 3,
          "position": [
            96,
            1008
          ],
          "id": "c078ed30-b971-4a5f-98d3-3c92f9ccbfc7",
          "name": "Loop Over Items"
        },
        {
          "parameters": {
            "useCustomSchema": true,
            "schema": "knowledge_base",
            "tableId": "memorias_projetos_eventos",
            "fieldsUi": {
              "fieldValues": [
                {
                  "fieldId": "projeto_id",
                  "fieldValue": "={{ $json.id }}"
                },
                {
                  "fieldId": "texto",
                  "fieldValue": "={{ $json.atualizacoes }}"
                },
                {
                  "fieldId": "origem",
                  "fieldValue": "Atualização semanal do gestor do projeto"
                }
              ]
            }
          },
          "type": "n8n-nodes-base.supabase",
          "typeVersion": 1,
          "position": [
            480,
            1008
          ],
          "id": "626fba65-7468-4997-b7cb-751211a0fa2c",
          "name": "Create a row3",
          "credentials": {
            "supabaseApi": {
              "id": "mWLJRM5VD8eNo21x",
              "name": "Supabase marujo-pier"
            }
          }
        }
      ],
      "connections": {
        "Webhook3": {
          "main": [
            [
              {
                "node": "Get a database page",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a row": {
          "main": [
            [
              {
                "node": "Message a model",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Message a model": {
          "main": [
            [
              {
                "node": "If",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Code in JavaScript": {
          "main": [
            [
              {
                "node": "Create a row2",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many child blocks": {
          "main": [
            [
              {
                "node": "Code in JavaScript",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Webhook1": {
          "main": [
            [
              {
                "node": "Get many child blocks",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get a database page": {
          "main": [
            [
              {
                "node": "Get a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "If": {
          "main": [
            [
              {
                "node": "Update a row",
                "type": "main",
                "index": 0
              }
            ],
            [
              {
                "node": "Create a row",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Schedule Trigger": {
          "main": [
            [
              {
                "node": "Get many rows",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Get many rows": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Loop Over Items": {
          "main": [
            [],
            [
              {
                "node": "Create a row3",
                "type": "main",
                "index": 0
              }
            ]
          ]
        },
        "Create a row3": {
          "main": [
            [
              {
                "node": "Loop Over Items",
                "type": "main",
                "index": 0
              }
            ]
          ]
        }
      },
      "settings": {
        "executionOrder": "v1",
        "availableInMCP": false
      },
      "staticData": {
        "node:Schedule Trigger": {
          "recurrenceRules": []
        }
      },
      "meta": {
        "templateCredsSetupCompleted": true
      },
      "pinData": {
        "Webhook1": [
          {
            "json": {
              "headers": {
                "host": "primary-production-0ad4f.up.railway.app",
                "user-agent": "NotionAutomation",
                "content-length": "1496",
                "content-type": "application/json",
                "traceparent": "00-5a1e26b8a1a3ba2c041791ffa93d9c19-5f96b0d9ea02edd4-00",
                "x-forwarded-for": "52.38.219.39",
                "x-forwarded-host": "primary-production-0ad4f.up.railway.app",
                "x-forwarded-proto": "https",
                "x-railway-edge": "railway/us-west2",
                "x-railway-request-id": "N5WFoVUBTwa7tlgBLPU1MQ",
                "x-real-ip": "52.38.219.39",
                "x-request-start": "1770950961065",
                "accept-encoding": "gzip"
              },
              "params": {},
              "query": {},
              "body": {
                "source": {
                  "type": "automation",
                  "automation_id": "30602cfe-4c0e-8099-96f8-004db36ae040",
                  "action_id": "30602cfe-4c0e-8011-acb4-005aed05b409",
                  "event_id": "f7aa9a86-b0b0-4f8b-81fa-30a153368342",
                  "attempt": 1
                },
                "data": {
                  "object": "page",
                  "id": "30502cfe-4c0e-8069-af0f-fead43cf05cb",
                  "created_time": "2026-02-12T12:28:00.000Z",
                  "last_edited_time": "2026-02-13T02:49:00.000Z",
                  "created_by": {
                    "object": "user",
                    "id": "94126311-ae91-4066-8d25-dc5afcd833e2"
                  },
                  "last_edited_by": {
                    "object": "user",
                    "id": "4cd24a3f-1bb5-4168-b3e9-8dcde1e9b1da"
                  },
                  "cover": null,
                  "icon": null,
                  "parent": {
                    "type": "data_source_id",
                    "data_source_id": "21e57147-99ca-4e38-88cd-31510e6ff296",
                    "database_id": "66a3cfa0-e002-4323-a279-d63d19a9c6a9"
                  },
                  "archived": false,
                  "in_trash": false,
                  "is_locked": false,
                  "properties": {
                    "Nome": {
                      "id": "title",
                      "type": "title",
                      "title": [
                        {
                          "type": "text",
                          "text": {
                            "content": "Elevato",
                            "link": null
                          },
                          "annotations": {
                            "bold": false,
                            "italic": false,
                            "strikethrough": false,
                            "underline": false,
                            "code": false,
                            "color": "default"
                          },
                          "plain_text": "Elevato",
                          "href": null
                        }
                      ]
                    },
                    "Última edição": {
                      "id": "IQxI",
                      "type": "last_edited_time",
                      "last_edited_time": "2026-02-13T02:49:00.000Z"
                    },
                    "Status": {
                      "id": "Hq%3E%3B",
                      "type": "status",
                      "status": {
                        "id": "f55c6c78-b060-4c5a-b58c-a6c9a1e87a40",
                        "name": "Pronta",
                        "color": "green"
                      }
                    },
                    "Projetos": {
                      "id": "PPxL",
                      "type": "relation",
                      "relation": [
                        {
                          "id": "990d459d-d118-431b-a551-fb5525140e2e"
                        }
                      ],
                      "has_more": false
                    }
                  },
                  "url": "https://www.notion.so/Elevato-30502cfe4c0e8069af0ffead43cf05cb",
                  "public_url": null,
                  "request_id": "f02075e8-a0a7-4125-ab5e-24fe74779387"
                }
              },
              "webhookUrl": "https://primary-production-0ad4f.up.railway.app/webhook-test/e18bf982-d865-4c6d-99d2-c1b9f619ba97",
              "executionMode": "test"
            },
            "pairedItem": {
              "item": 0
            }
          }
        ],
        "Webhook3": [
          {
            "json": {
              "headers": {
                "host": "primary-production-0ad4f.up.railway.app",
                "user-agent": "pg_net/0.14.0",
                "content-length": "332",
                "accept": "*/*",
                "content-type": "application/json",
                "x-forwarded-for": "34.200.200.129",
                "x-forwarded-host": "primary-production-0ad4f.up.railway.app",
                "x-forwarded-proto": "https",
                "x-railway-edge": "railway/us-east4-eqdc4a",
                "x-railway-request-id": "qsmAvKWjQXiVdY6JozsQ6Q",
                "x-real-ip": "34.200.200.129",
                "x-request-start": "1771090789058",
                "accept-encoding": "gzip"
              },
              "params": {},
              "query": {},
              "body": {
                "type": "INSERT",
                "table": "memorias_projetos_eventos",
                "record": {
                  "id": 55,
                  "texto": "teste (ignorar)",
                  "origem": null,
                  "criador": null,
                  "embedding": null,
                  "created_at": "2026-02-14T17:39:47.910194+00:00",
                  "projeto_id": "25502cfe-4c0e-8019-85e7-f2b3a98f2964",
                  "id_na_origem": null
                },
                "schema": "knowledge_base",
                "old_record": null
              },
              "webhookUrl": "https://primary-production-0ad4f.up.railway.app/webhook-test/novo_evento_memoria",
              "executionMode": "test"
            },
            "pairedItem": {
              "item": 0
            }
          }
        ]
      },
      "versionId": "4d1b9ba8-cdc1-4a35-9228-6df3d2658473",
      "activeVersionId": "4d1b9ba8-cdc1-4a35-9228-6df3d2658473",
      "versionCounter": 492,
      "triggerCount": 3,
      "shared": [
        {
          "updatedAt": "2026-02-09T17:02:49.887Z",
          "createdAt": "2026-02-09T17:02:49.887Z",
          "role": "workflow:owner",
          "workflowId": "9RXJ-hlStfYdNxlhDaV_1",
          "projectId": "RM08XJW2UnVIRsZg",
          "project": {
            "updatedAt": "2025-03-17T20:45:29.222Z",
            "createdAt": "2025-03-17T20:44:07.833Z",
            "id": "RM08XJW2UnVIRsZg",
            "name": "sistemas pier <sistemas@pierpartners.com.br>",
            "type": "personal",
            "icon": null,
            "description": null,
            "creatorId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
            "projectRelations": [
              {
                "updatedAt": "2025-03-17T20:44:07.833Z",
                "createdAt": "2025-03-17T20:44:07.833Z",
                "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                "projectId": "RM08XJW2UnVIRsZg",
                "user": {
                  "updatedAt": "2026-02-18T01:53:31.669Z",
                  "createdAt": "2025-03-17T20:44:04.376Z",
                  "id": "943e4ad9-1546-4b0a-bf6b-e5109b891a03",
                  "email": "sistemas@pierpartners.com.br",
                  "firstName": "sistemas",
                  "lastName": "pier",
                  "personalizationAnswers": {
                    "version": "v4",
                    "personalization_survey_submitted_at": "2025-03-17T20:45:43.316Z",
                    "personalization_survey_n8n_version": "1.83.2",
                    "companySize": "20-99",
                    "companyType": "ecommerce",
                    "role": "customer-support",
                    "reportedSource": "podcast"
                  },
                  "settings": {
                    "userActivated": true,
                    "easyAIWorkflowOnboarded": true,
                    "firstSuccessfulWorkflowId": "926UQuN4WyOXikAX",
                    "userActivatedAt": 1742292005575,
                    "npsSurvey": {
                      "responded": true,
                      "lastShownAt": 1762117383584
                    }
                  },
                  "disabled": false,
                  "mfaEnabled": false,
                  "lastActiveAt": "2026-02-17",
                  "isPending": false
                }
              }
            ]
          }
        }
      ],
      "tags": [],
      "activeVersion": {
        "updatedAt": "2026-02-14T17:45:34.105Z",
        "createdAt": "2026-02-14T17:45:28.222Z",
        "versionId": "4d1b9ba8-cdc1-4a35-9228-6df3d2658473",
        "workflowId": "9RXJ-hlStfYdNxlhDaV_1",
        "nodes": [
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "novo_evento_memoria",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
              -608,
              16
            ],
            "id": "47af37fa-3e98-4368-87db-d262ebc7868b",
            "name": "Webhook3",
            "webhookId": "926e7ce4-c35b-4188-915b-b14e47b5fc89"
          },
          {
            "parameters": {
              "modelId": {
                "__rl": true,
                "value": "gpt-5.2",
                "mode": "list",
                "cachedResultName": "GPT-5.2"
              },
              "responses": {
                "values": [
                  {
                    "content": "=# Agente de Atualização de Memória de Projetos — Píer Partners\n\n## Papel\nVocê é um agente especializado em manter a memória institucional de projetos da Píer Partners atualizada. Sua função é receber um documento (ata de reunião, atualização geral, nota técnica, etc.), extrair as informações relevantes e produzir uma versão atualizada da memória do projeto, preservando o histórico e incorporando as novidades.\n\n## Entradas\n\nVocê receberá cinco blocos de informação:\n\n### 1. Memória Atual do Projeto\n<memoria_atual>\n{{ $json.memoria || \"Ainda não há memória para esse projeto\"}}\n</memoria_atual>\n\n### 2. Novo Documento\n<novo_documento>\n{{ $('Webhook3').item.json.body.record.texto }}\n</novo_documento>\n\n### 3. Tipo de Documento\n<tipo_documento>\n{{ $('Webhook3').item.json.body.record.origem }}\n</tipo_documento>\n\n### 4. Data do Documento\n<data_documento>\n{{ $('Webhook3').item.json.body.record.created_at }}\n</data_documento>\n\n### 5. Criador do Documento\n<criador_documento>\n{{ $('Webhook3').item.json.body.record.criador || \"Sem criador específico\" }}\n</criador_documento>\n\nTipos possíveis:\n- **atas_notion**: Ata de reunião (contém decisões, participantes, próximos passos, pendências)\n- **atualizacao_geral**: Atualização informal ou resumo de status do projeto\n- **nota_tecnica**: Informação técnica, análise, parecer ou dado específico\n- **email**: Trecho relevante de comunicação por e-mail\n- **decisao**: Registro de decisão isolada tomada fora de reunião\n\n### 4. Contexto do Projeto\n<contexto_projeto>\n- **Nome do Projeto:** {{ $('Get a database page').item.json.name }}\n- **Cliente/Contraparte:** {{ $('Get a database page').item.json.property_empresa }}\n- **Equipe Píer Responsável:** {{ $('Get a database page').item.json.property_status }}\n- **Equipe Píer Responsável:** {{ $('Get a database page').item.json.property_pessoas_alocadas.replaceAll(\" \", \", \") }}\n- **Última atualização do gestor:** {{ $('Get a database page').item.json.property_atualiza_es }}\n- **Última atualização do gestor (tarefas da semana):** {{ $('Get a database page').item.json.property_tarefas_semana }}\n- **Data da última atualização do gestor:** {{ $('Get a database page').item.json.property_ltima_edi_o }}\n</contexto_projeto>\n\n## Instruções de Processamento\n\n### Extração\n1. Leia o novo documento e identifique todas as informações que alteram, complementam ou contradizem a memória atual.\n2. Classifique cada informação extraída em uma das categorias:\n   - **Fato novo**: informação que não existia na memória\n   - **Atualização**: informação que modifica algo já registrado\n   - **Confirmação**: informação que reforça algo já existente (não requer alteração)\n   - **Contradição**: informação que conflita com o registro atual (requer atenção especial)\n\n### Regras de Atualização\n- **Nunca apague informações históricas.** Se algo mudou, registre a mudança e mantenha o contexto anterior quando relevante (ex: \"Prazo revisado de Jun/25 para Ago/25 conforme reunião de 09/02\").\n- **Preserve a estrutura da memória atual.** Se a memória já tem seções definidas, mantenha-as. Adicione novas seções apenas se necessário.\n- **Marque contradições explicitamente** quando o novo documento contradiz a memória sem resolução clara. Use o formato: `⚠️ CONTRADIÇÃO: [descrição]`.\n- **Registre a fonte e data** de cada alteração significativa entre parênteses. Ex: \"(Ata 09/02/2026)\".\n- **Próximos passos e pendências**: atualize a lista removendo itens concluídos (mova para histórico se relevante) e adicionando novos.\n- **Entregáveis**: atualize o status dos entregáveis quando o documento mencionar progresso, conclusão ou mudança de prazo. Mantenha o histórico de alterações de prazo.\n- **Participantes e stakeholders**: adicione novos nomes/papéis mencionados sem remover os existentes.\n- **Datas e prazos**: atualize sempre com referência à fonte da mudança.\n- **Se a memória atual estiver vazia**, crie a estrutura inicial a partir do contexto do projeto, entregáveis e documento recebido.\n\n### Estrutura Padrão da Memória (usar quando criando do zero)\n```\n# [Nome do Projeto]\n\n## Resumo Executivo\nBreve descrição do projeto, objetivo e status atual.\n\n## Informações Gerais\n- **Cliente/Contraparte:**\n- **Tipo de Operação:**\n- **Setor/Indústria:**\n- **Equipe Píer:**\n- **Confidencialidade:**\n- **Status:**\n- **Início:**\n- **Prazo estimado:**\n\n## Contexto e Escopo\nDescrição do escopo, motivação e contexto do projeto.\n\n## Entregáveis\n| Entregável | Responsável | Prazo | Status |\n|---|---|---|---|\n| ... | ... | ... | ... |\n\n## Status Atual\nO que está acontecendo agora — workstreams ativos, fase atual, blockers.\n\n## Decisões-Chave\nLista cronológica das decisões mais importantes tomadas.\n\n## Pendências e Próximos Passos\n- [ ] Pendência 1 — Responsável — Prazo\n- [ ] Pendência 2 — Responsável — Prazo\n\n## Riscos e Pontos de Atenção\nItens que podem impactar prazo, escopo ou resultado do projeto.\n\n## Stakeholders e Participantes\nMapa de pessoas envolvidas e seus papéis.\n\n## Histórico de Atualizações\nRegistro cronológico reverso (mais recente primeiro) das principais mudanças.\n```\n\n## Formato de Saída\n\n- Retorne um json com o changelod e a memoria_atualizada, cada um em uma chave\n- Os valores de cada chave devem estar em formato markdown\n\n### Chave 1: changelog\nUm resumo conciso das alterações feitas, no formato:\n\n**Data do documento fonte:** [data]\n**Tipo:** [tipo_documento]\n\n**Alterações realizadas:**\n- [NOVO] Descrição do que foi adicionado\n- [ATUALIZADO] Descrição do que foi modificado (de → para)\n- [CONTRADIÇÃO] Descrição do conflito identificado\n- [CONCLUÍDO] Item removido de pendências / entregável finalizado\n- [RISCO] Novo risco ou ponto de atenção identificado\n\n### Chave 2: memoria_atualizada\nA memória completa e atualizada do projeto, pronta para substituir a versão anterior.\n\n## Diretrizes Gerais\n- Seja objetivo e conciso. Não adicione interpretações ou suposições.\n- Use linguagem profissional compatível com o contexto de M&A e finanças corporativas.\n- Mantenha consistência de formato e terminologia ao longo da memória.\n- Na dúvida entre manter ou descartar uma informação do novo documento, **mantenha**.\n- Se o documento contiver informações claramente irrelevantes para o projeto (small talk, assuntos pessoais), ignore-as.\n- Ao atualizar entregáveis, trate mudanças de prazo como informação crítica — sempre registre o prazo anterior."
                  }
                ]
              },
              "builtInTools": {},
              "options": {
                "textFormat": {
                  "textOptions": {
                    "type": "json_schema",
                    "name": "memoria_e_changelog",
                    "schema": "{\n  \"type\": \"object\",\n  \"properties\": {\n    \"changelog\": {\n      \"type\": \"string\"\n    },\n    \"memoria_atualizada\": {\n      \"type\": \"string\"\n    }\n  },\n  \"additionalProperties\": false,\n  \"required\": [\"changelog\", \"memoria_atualizada\"]\n}"
                  }
                }
              }
            },
            "type": "@n8n/n8n-nodes-langchain.openAi",
            "typeVersion": 2.1,
            "position": [
              80,
              16
            ],
            "id": "c6687527-6bc4-4734-b5cb-60c355af8cb3",
            "name": "Message a model",
            "credentials": {
              "openAiApi": {
                "id": "g3Ikw9hUcV3sNHD2",
                "name": "OpenAi ppt-interact"
              }
            }
          },
          {
            "parameters": {
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "operation": "get",
              "tableId": "memorias_projetos",
              "filters": {
                "conditions": [
                  {
                    "keyName": "projeto_id",
                    "keyValue": "={{ $json.body.record.projeto_id }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              -144,
              16
            ],
            "id": "d2a297ef-5370-4770-a0a4-bd4da67fbc2b",
            "name": "Get a row",
            "alwaysOutputData": true,
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "operation": "update",
              "tableId": "memorias_projetos",
              "filters": {
                "conditions": [
                  {
                    "keyName": "id",
                    "condition": "eq",
                    "keyValue": "={{ $('Get a row').item.json.id }}"
                  }
                ]
              },
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "memoria",
                    "fieldValue": "={{ $json.output[0].content[0].text.memoria_atualizada }}"
                  },
                  {
                    "fieldId": "last_event",
                    "fieldValue": "={{ $('Webhook3').item.json.body.record.id }}"
                  },
                  {
                    "fieldId": "changelog",
                    "fieldValue": "={{ $json.output[0].content[0].text.changelog }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              640,
              0
            ],
            "id": "d9c782fa-9400-4d9d-8b12-efa3eeb6c348",
            "name": "Update a row",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "content": "## Atualiza a memória do projeto quando um novo evento acontece",
              "height": 544,
              "width": 1552
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              -640,
              -64
            ],
            "id": "8628785b-4857-4f6e-83f4-81939080a961",
            "name": "Sticky Note"
          },
          {
            "parameters": {
              "jsCode": "let output = [];\n\n// --- PART 1: Process the blocks (Your existing logic) ---\nfor (const item of items) {\n  const block = item.json;\n\n  if (!block.content || !block.content.trim()) continue;\n\n  switch (block.type) {\n    case 'heading_1':\n      output.push(`# ${block.content}`);\n      break;\n    case 'heading_2':\n      output.push(`## ${block.content}`);\n      break;\n    case 'heading_3':\n      output.push(`### ${block.content}`);\n      break;\n    case 'paragraph':\n      output.push(block.content);\n      break;\n    case 'bulleted_list_item':\n      output.push(`- ${block.content}`);\n      break;\n    case 'numbered_list_item':\n      output.push(`1. ${block.content}`);\n      break;\n    case 'quote':\n      output.push(`> ${block.content}`);\n      break;\n    case 'divider':\n      output.push('---');\n      break;\n  }\n}\n\nconst finalContent = output.join('\\n\\n');\n\n// --- PART 2: Retrieve Metadata safely ---\n// We pull the ID, Name, and URL from the 'Edit Fields2' node \n// that ran immediately before this execution.\nconst metadata = $('Webhook1').first().json;\n\n// --- PART 3: Return Combined Data ---\n// We return ONE object containing both the Metadata and the Content.\nreturn [\n  {\n    json: {\n      ...metadata,          // Inherits: id, name, url, property_tema_natureza\n      content: finalContent // Adds: The generated text\n    }\n  }\n];"
            },
            "type": "n8n-nodes-base.code",
            "typeVersion": 2,
            "position": [
              240,
              624
            ],
            "id": "655f72ab-42dd-41a7-b57d-5b54e542b746",
            "name": "Code in JavaScript",
            "executeOnce": false
          },
          {
            "parameters": {
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "tableId": "memorias_projetos_eventos",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "projeto_id",
                    "fieldValue": "={{ $json.body.data.properties.Projetos.relation[0].id }}"
                  },
                  {
                    "fieldId": "texto",
                    "fieldValue": "={{ $json.content }}"
                  },
                  {
                    "fieldId": "origem",
                    "fieldValue": "atas_notion"
                  },
                  {
                    "fieldId": "id_na_origem",
                    "fieldValue": "={{ $json.body.data.id }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              432,
              624
            ],
            "id": "e41d1f68-0b7e-48ed-908d-50c363b1444b",
            "name": "Create a row2",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "resource": "block",
              "operation": "getAll",
              "blockId": {
                "__rl": true,
                "value": "={{ $json.body.data.id }}",
                "mode": "id"
              },
              "returnAll": true
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              32,
              624
            ],
            "id": "3e7db6cb-69b3-47ae-a053-e80493863494",
            "name": "Get many child blocks",
            "alwaysOutputData": true,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "content": "## Cria evento no supabase quando ata é finalizada no notion",
              "height": 272,
              "width": 896
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              -208,
              544
            ],
            "id": "785ed955-4f1a-41c0-b3c7-d586bc6e6b6c",
            "name": "Sticky Note3"
          },
          {
            "parameters": {
              "httpMethod": "POST",
              "path": "e18bf982-d865-4c6d-99d2-c1b9f619ba97",
              "options": {}
            },
            "type": "n8n-nodes-base.webhook",
            "typeVersion": 2.1,
            "position": [
              -144,
              624
            ],
            "id": "c57930d2-c25c-43bb-ad65-40f05a20e452",
            "name": "Webhook1",
            "webhookId": "e18bf982-d865-4c6d-99d2-c1b9f619ba97"
          },
          {
            "parameters": {
              "resource": "databasePage",
              "operation": "get",
              "pageId": {
                "__rl": true,
                "mode": "id",
                "value": "={{ $json.body.record.projeto_id }}",
                "__regex": "^([0-9a-f]{8}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{4}-?[0-9a-f]{12})"
              }
            },
            "type": "n8n-nodes-base.notion",
            "typeVersion": 2.2,
            "position": [
              -368,
              16
            ],
            "id": "8239a9ad-0ce7-4fd7-a7e4-1cb0d1772e2c",
            "name": "Get a database page",
            "alwaysOutputData": true,
            "credentials": {
              "notionApi": {
                "id": "QJqIInVEAt8nkp5t",
                "name": "Notion Pier"
              }
            }
          },
          {
            "parameters": {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 3
                },
                "conditions": [
                  {
                    "id": "ce31056b-e656-4a48-8763-cfcd35e79a23",
                    "leftValue": "={{ $('Get a row').item.json.memoria }}",
                    "rightValue": "",
                    "operator": {
                      "type": "string",
                      "operation": "exists",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              },
              "options": {}
            },
            "type": "n8n-nodes-base.if",
            "typeVersion": 2.3,
            "position": [
              416,
              16
            ],
            "id": "9ba83bd5-7eb8-427c-ac0e-6679c82e2aa6",
            "name": "If"
          },
          {
            "parameters": {
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "tableId": "memorias_projetos",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "memoria",
                    "fieldValue": "={{ $json.output[0].content[0].text.memoria_atualizada }}"
                  },
                  {
                    "fieldId": "last_event",
                    "fieldValue": "={{ $('Webhook3').item.json.body.record.id }}"
                  },
                  {
                    "fieldId": "projeto_id",
                    "fieldValue": "={{ $('Webhook3').item.json.body.record.projeto_id }}"
                  },
                  {
                    "fieldId": "changelog",
                    "fieldValue": "={{ $json.output[0].content[0].text.changelog }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              640,
              208
            ],
            "id": "6374325a-a4e7-4c06-9557-028231ce12fd",
            "name": "Create a row",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "content": "## Cria evento no supabase para cada projeto atualizado no fim de semana",
              "height": 336,
              "width": 1264
            },
            "type": "n8n-nodes-base.stickyNote",
            "typeVersion": 1,
            "position": [
              -336,
              912
            ],
            "id": "8e5a63da-0df4-4ef7-91d4-775faefd2cc0",
            "name": "Sticky Note4"
          },
          {
            "parameters": {
              "rule": {
                "interval": [
                  {
                    "field": "cronExpression",
                    "expression": "0 20 * * 0"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.scheduleTrigger",
            "typeVersion": 1.3,
            "position": [
              -288,
              1008
            ],
            "id": "6eefd267-1436-49c5-86de-be2a41bf5ff2",
            "name": "Schedule Trigger"
          },
          {
            "parameters": {
              "useCustomSchema": true,
              "schema": "notion",
              "operation": "getAll",
              "tableId": "projetos",
              "returnAll": true,
              "matchType": "allFilters",
              "filters": {
                "conditions": [
                  {
                    "keyName": "atualizacoes",
                    "condition": "neq",
                    "keyValue": "="
                  },
                  {
                    "keyName": "status",
                    "condition": "eq",
                    "keyValue": "Ativo"
                  },
                  {
                    "keyName": "gestor_de_projeto",
                    "condition": "neq",
                    "keyValue": "None"
                  },
                  {
                    "keyName": "last_edited_time",
                    "condition": "gt",
                    "keyValue": "={{ DateTime.now().minus({ days: 4 }).toFormat('yyyy-MM-dd') }}"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              -80,
              1008
            ],
            "id": "eefc4e33-af05-4a1d-9f35-0351ddcd2cfa",
            "name": "Get many rows",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          },
          {
            "parameters": {
              "options": {}
            },
            "type": "n8n-nodes-base.splitInBatches",
            "typeVersion": 3,
            "position": [
              96,
              1008
            ],
            "id": "c078ed30-b971-4a5f-98d3-3c92f9ccbfc7",
            "name": "Loop Over Items"
          },
          {
            "parameters": {
              "useCustomSchema": true,
              "schema": "knowledge_base",
              "tableId": "memorias_projetos_eventos",
              "fieldsUi": {
                "fieldValues": [
                  {
                    "fieldId": "projeto_id",
                    "fieldValue": "={{ $json.id }}"
                  },
                  {
                    "fieldId": "texto",
                    "fieldValue": "={{ $json.atualizacoes }}"
                  },
                  {
                    "fieldId": "origem",
                    "fieldValue": "Atualização semanal do gestor do projeto"
                  }
                ]
              }
            },
            "type": "n8n-nodes-base.supabase",
            "typeVersion": 1,
            "position": [
              480,
              1008
            ],
            "id": "626fba65-7468-4997-b7cb-751211a0fa2c",
            "name": "Create a row3",
            "credentials": {
              "supabaseApi": {
                "id": "mWLJRM5VD8eNo21x",
                "name": "Supabase marujo-pier"
              }
            }
          }
        ],
        "connections": {
          "Webhook3": {
            "main": [
              [
                {
                  "node": "Get a database page",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get a row": {
            "main": [
              [
                {
                  "node": "Message a model",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Message a model": {
            "main": [
              [
                {
                  "node": "If",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Code in JavaScript": {
            "main": [
              [
                {
                  "node": "Create a row2",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many child blocks": {
            "main": [
              [
                {
                  "node": "Code in JavaScript",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Webhook1": {
            "main": [
              [
                {
                  "node": "Get many child blocks",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get a database page": {
            "main": [
              [
                {
                  "node": "Get a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "If": {
            "main": [
              [
                {
                  "node": "Update a row",
                  "type": "main",
                  "index": 0
                }
              ],
              [
                {
                  "node": "Create a row",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Schedule Trigger": {
            "main": [
              [
                {
                  "node": "Get many rows",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Get many rows": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Loop Over Items": {
            "main": [
              [],
              [
                {
                  "node": "Create a row3",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          },
          "Create a row3": {
            "main": [
              [
                {
                  "node": "Loop Over Items",
                  "type": "main",
                  "index": 0
                }
              ]
            ]
          }
        },
        "authors": "sistemas pier",
        "name": "Version 4d1b9ba8",
        "description": "",
        "autosaved": true,
        "workflowPublishHistory": [
          {
            "createdAt": "2026-02-14T17:45:34.091Z",
            "id": 360,
            "workflowId": "9RXJ-hlStfYdNxlhDaV_1",
            "versionId": "4d1b9ba8-cdc1-4a35-9228-6df3d2658473",
            "event": "activated",
            "userId": "943e4ad9-1546-4b0a-bf6b-e5109b891a03"
          }
        ]
      }
    }
  ],
  "supabase": {
    "tables": [
      {
        "name": "alocacoes_horas",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "capitulos_material_de_apresentacoes",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "custom_agents_pier",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "dados_empresa_ficticia",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "df_slides_to_classify",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "embedding_slides",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "historico_marujo",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_actions",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_clients",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_connections",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_frentes",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_ideas",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_projects",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_sections",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "initiative_workstreams",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "leads",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "leads_emails",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "livro_damodaran",
        "schema": "public",
        "used_by_n8n": true
      },
      {
        "name": "marujo_messages_chatbot",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "memoria_orquestrador",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "metadata_datalake",
        "schema": "public",
        "used_by_n8n": true
      },
      {
        "name": "pessoas",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "projetos",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "projetos_gp",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "projetos_gp_rodrigo",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "reunioes_pinhao",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "transcricao_drops",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "user_activity_chatbot",
        "schema": "public",
        "used_by_n8n": false
      },
      {
        "name": "wiki",
        "schema": "public",
        "used_by_n8n": true
      }
    ],
    "functions": [
      {
        "name": "array_to_halfvec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_halfvec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_halfvec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_halfvec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_sparsevec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_sparsevec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_sparsevec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_sparsevec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_vector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_vector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_vector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "array_to_vector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "avg",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "avg",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "binary_quantize",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "binary_quantize",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "busca_reunioes_por_id_microsoft",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "buscar_reunioes_por_telefone",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": true
      },
      {
        "name": "cosine_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "cosine_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "cosine_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "execute_sql",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "generate_access_token",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "get_ultimos_eventos_projeto",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "get_user_by_phone",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gin_extract_query_trgm",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gin_extract_value_trgm",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gin_trgm_consistent",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gin_trgm_triconsistent",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_compress",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_consistent",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_decompress",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_in",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_options",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_out",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_penalty",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_picksplit",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_same",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "gtrgm_union",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_accum",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_add",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_avg",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_cmp",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_combine",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_concat",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_eq",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_ge",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_gt",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_in",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_l2_squared_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_le",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_lt",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_mul",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_ne",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_negative_inner_product",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_out",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_recv",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_send",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_spherical_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_sub",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_to_float4",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_to_sparsevec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_to_vector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "halfvec_typmod_in",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "hamming_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "hnsw_bit_support",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "hnsw_halfvec_support",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "hnsw_sparsevec_support",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "hnswhandler",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "hybrid_search_eventos",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "inner_product",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "inner_product",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "inner_product",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "ivfflat_bit_support",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "ivfflat_halfvec_support",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "ivfflathandler",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "jaccard_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l1_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l1_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l1_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_norm",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_norm",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_normalize",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_normalize",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "l2_normalize",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "list_all_columns",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "list_functions",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "list_tables",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "list_tables_and_columns",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "match_documents_datalake",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "match_documents_livro_damodaran",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "match_documents_wiki",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "match_memorias_projetos_eventos",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "match_slides",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "run_query",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "search_eventos_projeto",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "set_limit",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "show_limit",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "show_trgm",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "similarity",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "similarity_dist",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "similarity_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_cmp",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_eq",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_ge",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_gt",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_in",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_l2_squared_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_le",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_lt",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_ne",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_negative_inner_product",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_out",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_recv",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_send",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_to_halfvec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_to_vector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sparsevec_typmod_in",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "strict_word_similarity",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "strict_word_similarity_commutator_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "strict_word_similarity_dist_commutator_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "strict_word_similarity_dist_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "strict_word_similarity_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "subvector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "subvector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sum",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "sum",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "unaccent",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "unaccent",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "unaccent_init",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "unaccent_lexize",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "update_updated_at",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "update_updated_at_column",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_accum",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_add",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_avg",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_cmp",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_combine",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_concat",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_dims",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_dims",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_eq",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_ge",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_gt",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_in",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_l2_squared_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_le",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_lt",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_mul",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_ne",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_negative_inner_product",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_norm",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_out",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_recv",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_send",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_spherical_distance",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_sub",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_to_float4",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_to_halfvec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_to_sparsevec",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "vector_typmod_in",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "word_similarity",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "word_similarity_commutator_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "word_similarity_dist_commutator_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "word_similarity_dist_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      },
      {
        "name": "word_similarity_op",
        "schema": "public",
        "tables_used": [],
        "used_by_n8n": false
      }
    ]
  }
}