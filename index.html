<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>n8n Dependency Visualizer</title>
    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
    <!-- Custom Styles -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <!-- Dashboard Sidebar -->
        <div class="sidebar">
            <h1>n8n Dependencies</h1>

            <!-- Loader / Connection Panels -->
            <div id="connectionPanel">
                <div id="autoLoadStatus" style="display:none; color: #8b949e; font-size: 13px; margin-bottom: 12px;">
                </div>

                <div id="manualConnect" style="display:none;">
                    <h2>Carregar Dados</h2>
                    <div class="folder-upload" onclick="document.getElementById('folderInput').click()">
                        <strong>üìÅ Carregar Pasta de Workflows</strong>
                        <span>Selecione a pasta 'n8n_workflows_export'</span>
                    </div>
                    <!-- Webkitdirectory allows folder selection in modern browsers -->
                    <input type="file" id="folderInput" webkitdirectory directory multiple
                        onchange="handleFolderSelect(event)">

                    <div style="text-align: center; margin: 15px 0; color: #8b949e; font-size: 12px;">‚Äî OU CONECTAR VIA
                        API ‚Äî</div>

                    <input type="text" id="n8nUrl" placeholder="URL do n8n (ex: https://n8n.seudominio.com)">
                    <input type="password" id="n8nKey" placeholder="API Key (X-N8N-API-KEY)">
                    <button onclick="fetchFromApi()" style="width: 100%">Conectar & Carregar</button>
                    <div style="margin-top: 8px; font-size: 11px; color: #8b949e;">
                        *Requer configura√ß√£o de CORS no seu servidor n8n.
                    </div>
                </div>
            </div>

            <!-- Global Stats -->
            <div class="stats">
                <div class="stat-box">
                    <div class="stat-value" id="workflowCount">0</div>
                    <div class="stat-label">Fluxos</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="sourceCount">0</div>
                    <div class="stat-label">Fontes</div>
                </div>
            </div>

            <!-- Search Filter -->
            <input type="text" id="searchInput" placeholder="üîç Buscar fluxo, ferramenta ou tabela...">

            <!-- Tool Filtering List (Generated by JS) -->
            <h2>Filtrar por Fonte</h2>
            <div id="toolsList"></div>

            <!-- Dependency Impact Analysis -->
            <div id="impactPanel" class="impact-panel" style="display: none;">
                <div class="impact-title">Impacto da Depend√™ncia</div>
                <div id="impactText">Os seguintes fluxos dependem desta fonte:</div>
                <ul class="impact-list" id="impactList"></ul>
            </div>
        </div>

        <!-- Main Visualizer Area -->
        <div class="main-content">
            <div class="controls">
                <!-- Group Legend & Toggles -->
                <div class="legend" id="legend"></div>

                <div class="export-btn">
                    <button class="secondary" onclick="resetZoom()">üîÑ Reset Zoom</button>
                    <button class="secondary" onclick="exportMarkdown()">üìÑ Exportar Relat√≥rio</button>
                </div>
            </div>
            <!-- SVG Graph Rendered Here -->
            <div class="graph-container" id="graph"></div>
        </div>
    </div>

    <!-- Application Core Logic -->
    <script src="app.js"></script>
</body>

</html>